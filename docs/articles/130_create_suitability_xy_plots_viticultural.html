<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Plot shift in SLF risk to important viticultural regions under climate change • scari</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Plot shift in SLF risk to important viticultural regions under climate change">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">scari</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/scari.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Quantify risk to specific viticultural regions</h6></li>
    <li><a class="dropdown-item" href="../articles/150_create_risk_report.html">Example usage of create_risk_report() to create reports of key viticultural areas</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Initialize scari</h6></li>
    <li><a class="dropdown-item" href="../articles/010_initialize_pkg.html">Initialization of renv package for dependencies</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>1. Retrieve and tidy input data for MaxEnt</h6></li>
    <li><a class="dropdown-item" href="../articles/020_retrieve_bioclim_variables.html">Bioclim variable rasters: CHELSA</a></li>
    <li><a class="dropdown-item" href="../articles/030_retrieve_occurrence_records.html">SLF occurrence records: GBIF, lydemapR, literature</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>2. SDM modeling pipeline</h6></li>
    <li><a class="dropdown-item" href="../articles/040_setup_global_MaxEnt_model.html">Setup for global-scale MaxEnt model</a></li>
    <li><a class="dropdown-item" href="../articles/050_run_global_MaxEnt_model.html">Run global-scale MaxEnt model</a></li>
    <li><a class="dropdown-item" href="../articles/060_setup_regional_MaxEnt_models.html">Setup for regional-scale MaxEnt models</a></li>
    <li><a class="dropdown-item" href="../articles/070_run_regional_invaded_MaxEnt_model.html">Run 'Ri.NAmerica' model trained on SLF invaded region in North America</a></li>
    <li><a class="dropdown-item" href="../articles/080_run_regional_invaded_asian_MaxEnt_model.html">Run 'Ri.Asia' model trained on SLF invaded range in Japan and South Korea</a></li>
    <li><a class="dropdown-item" href="../articles/090_run_regional_native_MaxEnt_model.html">Run 'Rn' model trained on SLF native range in east Asia</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>3. Ensemble Regional-scale SDMs</h6></li>
    <li><a class="dropdown-item" href="../articles/100_run_ExDet_MIC.html">Run an Extrapolation Detection (NT2) analysis and calculate MIC</a></li>
    <li><a class="dropdown-item" href="../articles/110_ensemble_regional_models.html">Ensemble regional-scale models using a weighted mean</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>4. Quantify SLF risk and model fit</h6></li>
    <li><a class="dropdown-item" href="../articles/120_create_suitability_maps.html">Create risk maps of each model scale and intersect predictions</a></li>
    <li><a class="dropdown-item" href="../articles/130_create_suitability_xy_plots_viticultural.html">Plot shift in SLF risk to important viticultural regions under climate change</a></li>
    <li><a class="dropdown-item" href="../articles/131_create_suitability_xy_plots_SLF.html">Infer stability of known SLF populations due climate change effects</a></li>
    <li><a class="dropdown-item" href="../articles/140_plot_response_curves.html">Analyze biological realism of model response curves</a></li>
    <li><a class="dropdown-item" href="../articles/141_plot_AUC_var_cont.html">Check model goodness of fit via AUC, TSS and confusion matrices</a></li>
    <li><a class="dropdown-item" href="../articles/142_calculate_model_fit.html">Calculate model fit using confusion matrices</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ieco-lab/scari/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Plot shift in SLF risk to important viticultural regions under climate change</h1>
                        <h4 data-toc-skip class="author">Samuel M.
Owens<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Temple University &lt;a href="http://www.biodiversitycenter.org/" class="external-link"&gt;Center for Biodiversity&lt;/a&gt; &lt;a href="https://www.iecolab.org/" class="external-link"&gt;iEco Lab&lt;/a&gt; &lt;a href="mailto:sam.owens@temple.edu" class="email"&gt;sam.owens@temple.edu&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a>
</h4>
            
            <h4 data-toc-skip class="date">2024-08-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ieco-lab/scari/blob/HEAD/vignettes/130_create_suitability_xy_plots_viticultural.Rmd" class="external-link"><code>vignettes/130_create_suitability_xy_plots_viticultural.Rmd</code></a></small>
      <div class="d-none name"><code>130_create_suitability_xy_plots_viticultural.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In the last vignette, I created risk maps and range shift maps as the
first step in visualizing and comparing the predictions made by my
global and regional ensemble models. I will apply these maps for drawing
on general trends of SLF suitable area shift under climate change.
Downstream, I also plan to visualize these suitability maps across
geographical regions and at a finer scale, such as for viticulturally
important countries and provinces.</p>
<p>In this vignette, I will focus on making more specific predictions
for SLF establishment risk scatter plots of the suitability values for
the globally important viticultural regions in the global and regional
ensemble models. I will use a quadrant scatter plot to visualize the
movement of these regions across the minimum threshold suitability value
(the MTSS value). By plotting one model scale on each axis, we can
visualize the agreement between our modeled scales.</p>
<p>Gallien et al, 2012 originally defined this method for discerning the
“stage of invasion” for invasive populations according to different
scales of SDM. I will apply this method and re-interpret it as a method
for assessing the risk of establishment. These two models will not
completely agree on the suitability for a particular location, so
agreement between the modeled scales can give us more confidence in that
prediction. Where the modeled scales disagree, we might make different
interpretations of the biological mechanism at play.</p>
<pre><code><span><span class="co">## ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.5</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.1</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.5.1     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.3     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.1</span></span>
<span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2     </span></span>
<span><span class="co">## ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">## <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span></code></pre>
<p><img src="130_create_suitability_xy_plots_viticultural_files/figure-html/example%20quadrant%20plot-1.png" width="700"><strong>Fig. 1</strong> Example quadrant plot for assessing SLF risk
across two different scales of SDM.</p>
<p>We rate risk from low to extreme, based on the agreement between the
modeled scales. We rate suitability in the regional_ensemble only (top
left, high) as higher risk than suitability in the global model only
(bottom right, moderate) because we believe that unique suitability in
the regional-scale ensemble indicates a risk for adaptation to new
climatic niches (Gallien et al, 2012). Where the regional-scale model
detects suitability when the global model cannot, SLF might be adapting
to a climatic niche outside its global mean niche.</p>
<p>The MTSS threshold of suitability will be used as the central
crosshairs of this plot. We will then plot the same set of points
presently and in the future under our climate change scenarios. Movement
across the MTSS threshold on either axis due to climate change will
indicate that climate change is changing the suitability of these
regions for SLF establishment. I will need to transform these
suitability values so that the MTSS threshold falls on 0.5. This will
allow me to visualize the movement of these regions across the minimum
threshold suitability value.</p>
<p>First, I will plot the un-transformed version of the data and then
will transform and plot the data again. I will use a table to calculate
the number of regions that move across the MTSS threshold and fall into
each category before and after climate change. Finally, I will save the
predicted suitability values with our <code>wineries</code> dataset for
downstream analysis. Our <code>wineries.rda</code> dataset contains the
locations of 1,086 globally important viticultural regions.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># general tools</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>  <span class="co">#data manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span> <span class="co">#making directory pathways easier on different instances</span></span>
<span><span class="co"># here() starts at the root folder of this package.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># spatial data handling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ropensci.github.io/CoordinateCleaner/" class="external-link">CoordinateCleaner</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot aesthetics</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://scales.r-lib.org" class="external-link">scales</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">grid</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wch.github.io/webshot/" class="external-link">webshot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/webshot2/" class="external-link">webshot2</a></span><span class="op">)</span></span></code></pre></div>
<p><strong>Note:</strong> I will be setting the global options of this
document so that only certain code chunks are rendered in the final
.html file. I will set the <code>eval = FALSE</code> so that none of the
code is re-run (preventing files from being overwritten during knitting)
and will simply overwrite this in chunks with plots.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mypath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     <span class="st">"maxent/models"</span><span class="op">)</span></span></code></pre></div>
<p>I will load in some aesthetic objects for plotting.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">breaks</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.0</span>, <span class="fl">0.2</span>, <span class="fl">0.4</span>, <span class="fl">0.6</span>, <span class="fl">0.8</span>, <span class="fl">1.0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">labels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="load-rasters">load rasters<a class="anchor" aria-label="anchor" href="#load-rasters"></a>
</h3>
<p>Load in summary files for the global and regional ensemble models,
which contain the thresholds.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># summary file to extract thresholds from</span></span>
<span></span>
<span><span class="co"># global</span></span>
<span><span class="va">summary_global</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_global_v3"</span>, <span class="st">"global_summary_all_iterations.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">52</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">12</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span>  (1): statistic</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (11): iteration_1_summary, iteration_2_summary, iteration_3_summary, ite...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary_regional_ensemble</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_regional_ensemble_v1"</span>, <span class="st">"ensemble_threshold_values.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">10</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">4</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (3): thresh, time_period, CMIP6_model</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (1): value</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<p>I will load in the global and regional ensemble suitability maps.
These will be used both for extracting the new xy suitability values and
for plotting.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># global</span></span>
<span><span class="va">global_1995</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_global_v3"</span>, <span class="st">"global_pred_suit_clamped_cloglog_globe_1981-2010_mean.asc"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">global_2055</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_global_v3"</span>, <span class="st">"global_pred_suit_clamped_cloglog_globe_2041-2070_GFDL_ssp_averaged.asc"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># regional_ensemble</span></span>
<span><span class="co"># historical</span></span>
<span><span class="va">regional_ensemble_1995</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_regional_ensemble_v1"</span>, <span class="st">"ensemble_regional_weighted_mean_globe_1981-2010.asc"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co"># CMIP6</span></span>
<span><span class="co">## ssp 126</span></span>
<span><span class="va">regional_ensemble_2055_126</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_regional_ensemble_v1"</span>, <span class="st">"ensemble_regional_weighted_mean_globe_2041-2070_GFDL_ssp126.asc"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co"># ssp 370</span></span>
<span><span class="va">regional_ensemble_2055_370</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_regional_ensemble_v1"</span>, <span class="st">"ensemble_regional_weighted_mean_globe_2041-2070_GFDL_ssp370.asc"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co"># ssp 585</span></span>
<span><span class="va">regional_ensemble_2055_585</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_regional_ensemble_v1"</span>, <span class="st">"ensemble_regional_weighted_mean_globe_2041-2070_GFDL_ssp585.asc"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co"># ssp mean</span></span>
<span><span class="va">regional_ensemble_2055_ssp_mean</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_regional_ensemble_v1"</span>, <span class="st">"ensemble_regional_weighted_mean_globe_2041-2070_GFDL_ssp_averaged.asc"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tidy-wineries-dataset">tidy wineries dataset<a class="anchor" aria-label="anchor" href="#tidy-wineries-dataset"></a>
</h3>
<p>I will load in dataset containing locations of globally important
viticultural regions. I will also de-duplicate the records because there
were “many-to-many” joining matches downstream. De-duplicating removed
about 17 records. I also remove the species column, which is
automatically created by <code>SDMtune::predict()</code> upstream.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rstudio.github.io/renv/reference/load.html" class="external-link">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"wineries.rda"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">IVR_locations</span> <span class="op">&lt;-</span> <span class="va">wineries</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># tidy</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">Latitude</span>, <span class="va">Longitude</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>,</span>
<span>    <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>record_type <span class="op">=</span> <span class="st">"IVR_location"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remove duplicate coordinates</span></span>
<span><span class="va">IVR_locations</span> <span class="op">&lt;-</span> <span class="fu">CoordinateCleaner</span><span class="fu">::</span><span class="fu"><a href="https://ropensci.github.io/CoordinateCleaner/reference/clean_coordinates.html" class="external-link">clean_coordinates</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">IVR_locations</span>,</span>
<span>  lon <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>  lat <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>  species <span class="op">=</span> <span class="st">"record_type"</span>,</span>
<span>  tests <span class="op">=</span> <span class="st">"duplicates"</span>,</span>
<span>  value <span class="op">=</span> <span class="st">"clean"</span> <span class="co"># just return same df without duplicates</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">record_type</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remove unnecessary obj</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">wineries</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="import-and-tidy-xy-suitability">import and tidy xy suitability<a class="anchor" aria-label="anchor" href="#import-and-tidy-xy-suitability"></a>
</h3>
<p>These scatter plots will be based on the suitability for the IVR
points in both the global and regional_ensemble models. I have already
calculated the xy suitability for the global model based on these
points, using the function <code><a href="../reference/predict_xy_suitability.html">scari::predict_xy_suitability()</a></code>.
This function will not work for the regional_ensemble because it calls
for a model object, which we did not use to predict the ensemble
suitability. So, I will use <code><a href="https://rspatial.github.io/terra/reference/extract.html" class="external-link">terra::extract()</a></code> to perform
this action.</p>
<p>I will load in the global model datasets and create the
regional_ensemble datasets. I will also do some tidying of my datasets
for the plots I will create.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># historical</span></span>
<span><span class="va">xy_global_1995</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span></span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_global_v3"</span>, <span class="st">"global_wineries_1981-2010_xy_pred_suit_clamped_cloglog_mean_20000m_buffer.csv"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span><span class="co"># CMIP6</span></span>
<span><span class="co">## ssp 126</span></span>
<span><span class="va">xy_global_2055_126</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span></span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_global_v3"</span>, <span class="st">"global_wineries_2041-2070_GFDL_ssp126_xy_pred_suit_clamped_cloglog_mean_20000m_buffer.csv"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span>
<span><span class="co">## ssp 370</span></span>
<span><span class="va">xy_global_2055_370</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span></span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_global_v3"</span>, <span class="st">"global_wineries_2041-2070_GFDL_ssp370_xy_pred_suit_clamped_cloglog_mean_20000m_buffer.csv"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span>
<span><span class="co">## ssp 585</span></span>
<span><span class="va">xy_global_2055_585</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span></span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_global_v3"</span>, <span class="st">"global_wineries_2041-2070_GFDL_ssp585_xy_pred_suit_clamped_cloglog_mean_20000m_buffer.csv"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<p>The xy_suitabilities for the global models also contain a few less
records than the IVR regions. To ensure that I am retrieving the
suitability values for the exact same vineyards in the
regional_ensemble, I will perform a filtering join. The IVR dataset
should now contain the same records as the global suitability values
do.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># de-duplicate just to make sure</span></span>
<span><span class="va">xy_global_1995</span> <span class="op">&lt;-</span> <span class="va">xy_global_1995</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Lycorma delicatula"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">CoordinateCleaner</span><span class="fu">::</span><span class="fu"><a href="https://ropensci.github.io/CoordinateCleaner/reference/clean_coordinates.html" class="external-link">clean_coordinates</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">.</span>,</span>
<span>    lon <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    lat <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>    species <span class="op">=</span> <span class="st">"species"</span>,</span>
<span>    tests <span class="op">=</span> <span class="st">"duplicates"</span>,</span>
<span>    value <span class="op">=</span> <span class="st">"clean"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">max_cloglog_suitability</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># rename</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"max_cloglog_suit_hist"</span> <span class="op">=</span> <span class="st">"max_cloglog_suitability"</span><span class="op">)</span> </span>
<span></span>
<span></span>
<span><span class="co"># edits to IVR dataset</span></span>
<span><span class="co"># filter join of IVRs</span></span>
<span><span class="va">IVR_locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter-joins.html" class="external-link">semi_join</a></span><span class="op">(</span><span class="va">IVR_locations</span>, <span class="va">xy_global_1995</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span><span class="op">)</span> </span>
<span><span class="co"># add ID column</span></span>
<span><span class="va">IVR_locations</span> <span class="op">&lt;-</span> <span class="va">IVR_locations</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/row_number.html" class="external-link">row_number</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span><span class="va">IVR_locations</span>, <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"wineries_tidied.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span>  </span>
<span><span class="co">#read it back in</span></span>
<span><span class="va">IVR_locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"wineries_tidied.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now I will clean the remainder of the coordinates</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ssp 126</span></span>
<span><span class="va">xy_global_2055_126</span> <span class="op">&lt;-</span> <span class="va">xy_global_2055_126</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">CoordinateCleaner</span><span class="fu">::</span><span class="fu"><a href="https://ropensci.github.io/CoordinateCleaner/reference/clean_coordinates.html" class="external-link">clean_coordinates</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">.</span>,</span>
<span>    lon <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    lat <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>    species <span class="op">=</span> <span class="st">"Species"</span>,</span>
<span>    tests <span class="op">=</span> <span class="st">"duplicates"</span>,</span>
<span>    value <span class="op">=</span> <span class="st">"clean"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Species</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ssp 370</span></span>
<span><span class="va">xy_global_2055_370</span> <span class="op">&lt;-</span> <span class="va">xy_global_2055_370</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">CoordinateCleaner</span><span class="fu">::</span><span class="fu"><a href="https://ropensci.github.io/CoordinateCleaner/reference/clean_coordinates.html" class="external-link">clean_coordinates</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">.</span>,</span>
<span>    lon <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    lat <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>    species <span class="op">=</span> <span class="st">"Species"</span>,</span>
<span>    tests <span class="op">=</span> <span class="st">"duplicates"</span>,</span>
<span>    value <span class="op">=</span> <span class="st">"clean"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Species</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ssp 585</span></span>
<span><span class="va">xy_global_2055_585</span> <span class="op">&lt;-</span> <span class="va">xy_global_2055_585</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">CoordinateCleaner</span><span class="fu">::</span><span class="fu"><a href="https://ropensci.github.io/CoordinateCleaner/reference/clean_coordinates.html" class="external-link">clean_coordinates</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">.</span>,</span>
<span>    lon <span class="op">=</span> <span class="st">"x"</span>,</span>
<span>    lat <span class="op">=</span> <span class="st">"y"</span>,</span>
<span>    species <span class="op">=</span> <span class="st">"Species"</span>,</span>
<span>    tests <span class="op">=</span> <span class="st">"duplicates"</span>,</span>
<span>    value <span class="op">=</span> <span class="st">"clean"</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Species</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># also rename columns</span></span>
<span><span class="va">xy_global_2055_126</span> <span class="op">&lt;-</span> <span class="va">xy_global_2055_126</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"max_cloglog_suit_ssp126"</span> <span class="op">=</span> <span class="st">"max_cloglog_suitability_20000m_buffer"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">xy_global_2055_370</span> <span class="op">&lt;-</span> <span class="va">xy_global_2055_370</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"max_cloglog_suit_ssp370"</span> <span class="op">=</span> <span class="st">"max_cloglog_suitability_20000m_buffer"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">xy_global_2055_585</span> <span class="op">&lt;-</span> <span class="va">xy_global_2055_585</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"max_cloglog_suit_ssp585"</span> <span class="op">=</span> <span class="st">"max_cloglog_suitability_20000m_buffer"</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level3">
<h3 id="take-mean-of-global-model-ssp-scenarios">take mean of global model ssp scenarios<a class="anchor" aria-label="anchor" href="#take-mean-of-global-model-ssp-scenarios"></a>
</h3>
<p>I will take the mean of the suitability value within each of these
predicted suitability datasets. These suitability values were taken from
a 20km buffer around each viticultural area point to account for the
potentially large size of these viticultural areas. We will keep the max
values from those buffers. I will mean these values across ssp
scenarios.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first join datasets</span></span>
<span><span class="va">xy_global_2055_ssp_mean</span> <span class="op">&lt;-</span> <span class="va">xy_global_2055_126</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">xy_global_2055_370</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">xy_global_2055_585</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># take mean of columns</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>max_suit_ssp_averaged <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">.</span><span class="op">[</span>, <span class="fl">3</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span>, <span class="va">max_suit_ssp_averaged</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">xy_global_2055_ssp_mean</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_global_v3"</span>, <span class="st">"global_wineries_2041-2070_GFDL_ssp_mean_xy_pred_suit_clamped_cloglog_mean_20000m_buffer.csv"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="retrieve-suitability-values-for-regional_ensemble">retrieve suitability values for regional_ensemble<a class="anchor" aria-label="anchor" href="#retrieve-suitability-values-for-regional_ensemble"></a>
</h3>
<p>Now, I will retrieve the suitability values for the regional_ensemble
using the 20km buffer method described above. I will use
<code><a href="https://rspatial.github.io/terra/reference/buffer.html" class="external-link">buffer()</a></code> and <code><a href="https://rspatial.github.io/terra/reference/zonal.html" class="external-link">zonal()</a></code> from the
<code>terra</code> package to first create these 20km buffers around
each point, then to take zonal statistics (the max value) from each
buffer zone.</p>
<p>Instead of returning the coordinates from the map, I will join the
coordinates from the original IVR_locations dataset so that the
coordinates are exact for joining with other datasets. I will first
convert this dataset to an sv object and create a buffer region around
each point for extraction from each of the raster</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first, convert to a vector sv in terra</span></span>
<span><span class="va">IVR_locations_sv</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">IVR_locations</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span>,</span>
<span>    crs <span class="op">=</span> <span class="st">"EPSG:4326"</span>,</span>
<span>    geom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># take a buffer region around each IVR location</span></span>
<span><span class="va">IVR_locations_buffer</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/buffer.html" class="external-link">buffer</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">IVR_locations_sv</span>,</span>
<span>  width <span class="op">=</span> <span class="fl">20000</span> <span class="co"># 20km</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now, I will retrieve the max suitability value within that buffer for
each of the IVRs in each of the predicted rasters.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># rasters to retrieve suitability from</span></span>
<span><span class="va">rasters</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">regional_ensemble_1995</span>, <span class="va">regional_ensemble_2055_126</span>, <span class="va">regional_ensemble_2055_370</span>, <span class="va">regional_ensemble_2055_585</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># column identifiers</span></span>
<span><span class="va">col_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"hist"</span>, <span class="st">"ssp126"</span>, <span class="st">"ssp370"</span>, <span class="st">"ssp585"</span><span class="op">)</span></span>
<span><span class="co"># output file names</span></span>
<span><span class="va">output_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"regional_ensemble_v1_wineries_1981-2010"</span>,</span>
<span>  <span class="st">"regional_ensemble_v1_wineries_2041-2070_GFDL_ssp126"</span>,</span>
<span>  <span class="st">"regional_ensemble_v1_wineries_2041-2070_GFDL_ssp370"</span>,</span>
<span>  <span class="st">"regional_ensemble_v1_wineries_2041-2070_GFDL_ssp585"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># for loop to retrieve xy suitability</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">rasters</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># import</span></span>
<span>  <span class="va">column_name</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"max_cloglog_suit_"</span>, <span class="va">col_names</span><span class="op">[</span><span class="va">a</span><span class="op">]</span>, <span class="st">"_20000m"</span><span class="op">)</span></span>
<span>  <span class="va">rast_hold</span> <span class="op">&lt;-</span> <span class="va">rasters</span><span class="op">[[</span><span class="va">a</span><span class="op">]</span><span class="op">]</span></span>
<span>  </span>
<span>  <span class="co"># function</span></span>
<span>  <span class="va">xy_hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/zonal.html" class="external-link">zonal</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">rast_hold</span>, <span class="co"># raster of predictions we created</span></span>
<span>    z <span class="op">=</span> <span class="va">IVR_locations_buffer</span>, <span class="co"># buffer zones</span></span>
<span>    fun <span class="op">=</span> <span class="st">"max"</span>,</span>
<span>    na.rm <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># remove NAs from buffer stats</span></span>
<span>    <span class="co"># ID column</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># re-join ID and xy coords</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">IVR_locations</span><span class="op">[</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># rename suit column</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">xy_hold</span><span class="op">[</span>, <span class="fl">4</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">column_name</span></span>
<span>  </span>
<span>  <span class="co"># write to csv</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">xy_hold</span>,</span>
<span>    file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_regional_ensemble_v1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output_names</span><span class="op">[</span><span class="va">a</span><span class="op">]</span>, <span class="st">"_xy_pred_suit.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># success message</span></span>
<span>  <span class="fu">cli</span><span class="fu">::</span><span class="fu"><a href="https://cli.r-lib.org/reference/cli_alert.html" class="external-link">cli_alert_success</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"xy suit for"</span>, <span class="va">col_names</span><span class="op">[</span><span class="va">a</span><span class="op">]</span>, <span class="st">"written to file"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># remove temp objects</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">xy_hold</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">rast_hold</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">column_name</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level4">
<h4 id="take-mean-of-ssps">take mean of ssps<a class="anchor" aria-label="anchor" href="#take-mean-of-ssps"></a>
</h4>
<p>Now I will re-load the data files I just created</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># historical</span></span>
<span><span class="va">xy_regional_ensemble_1995</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_regional_ensemble_v1"</span>, <span class="st">"regional_ensemble_v1_wineries_1981-2010_xy_pred_suit.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># CMIP6</span></span>
<span><span class="co">## ssp 126</span></span>
<span><span class="va">xy_regional_ensemble_2055_126</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_regional_ensemble_v1"</span>, <span class="st">"regional_ensemble_v1_wineries_2041-2070_GFDL_ssp126_xy_pred_suit.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## ssp 370</span></span>
<span><span class="va">xy_regional_ensemble_2055_370</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_regional_ensemble_v1"</span>, <span class="st">"regional_ensemble_v1_wineries_2041-2070_GFDL_ssp370_xy_pred_suit.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## ssp 585</span></span>
<span><span class="va">xy_regional_ensemble_2055_585</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_regional_ensemble_v1"</span>, <span class="st">"regional_ensemble_v1_wineries_2041-2070_GFDL_ssp585_xy_pred_suit.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first join datasets</span></span>
<span><span class="va">xy_regional_ensemble_2055_ssp_mean</span> <span class="op">&lt;-</span> <span class="va">xy_regional_ensemble_2055_126</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">xy_regional_ensemble_2055_370</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">xy_regional_ensemble_2055_370</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># take mean of columns</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>max_suit_ssp_averaged <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">.</span><span class="op">[</span>, <span class="fl">4</span><span class="op">:</span><span class="fl">6</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">x</span>, <span class="va">y</span>, <span class="va">max_suit_ssp_averaged</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">xy_regional_ensemble_2055_ssp_mean</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_global_v3"</span>, <span class="st">"regional_ensemble_wineries_2041-2070_GFDL_ssp_mean_xy_pred_suit.csv"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="write-to-file">write to file<a class="anchor" aria-label="anchor" href="#write-to-file"></a>
</h3>
<p>Now, I will tidy and save the datasets to .rds for our analysis.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># global model datasets</span></span>
<span><span class="va">xy_global_1995</span> <span class="op">&lt;-</span> <span class="va">xy_global_1995</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># add ID column</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">IVR_locations</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># rename</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"xy_global_1995"</span> <span class="op">=</span> <span class="st">"max_cloglog_suit_hist"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># </span></span>
<span><span class="va">xy_global_2055_ssp_mean</span> <span class="op">&lt;-</span> <span class="va">xy_global_2055_ssp_mean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># add ID column</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">IVR_locations</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">ID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"xy_global_2055"</span> <span class="op">=</span> <span class="st">"max_suit_ssp_averaged"</span><span class="op">)</span> </span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># regional_ensemble datasets</span></span>
<span><span class="va">xy_regional_ensemble_1995</span> <span class="op">&lt;-</span> <span class="va">xy_regional_ensemble_1995</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># rename the column for future joining</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"xy_regional_ensemble_1995"</span> <span class="op">=</span> <span class="st">"max_suit_hist_20000m"</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">xy_regional_ensemble_2055_ssp_mean</span> <span class="op">&lt;-</span> <span class="va">xy_regional_ensemble_2055_ssp_mean</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># rename the column for future joining</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"xy_regional_ensemble_2055"</span> <span class="op">=</span> <span class="st">"max_suit_ssp_averaged"</span><span class="op">)</span> </span></code></pre></div>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># regional_ensemble</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span></span>
<span>  <span class="va">xy_regional_ensemble_1995</span>,  </span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"regional_ensemble_wineries_1981-2010_xy_pred_suit.rds"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span></span>
<span>  <span class="va">xy_regional_ensemble_2055_ssp_mean</span>,  </span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"regional_ensemble_wineries_2041-2070_GFDL_ssp_mean_xy_pred_suit.rds"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># save global datasets</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span></span>
<span>  <span class="va">xy_global_1995</span>,  </span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"global_wineries_1981-2010_xy_pred_suit.rds"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span></span>
<span>  <span class="va">xy_global_2055_ssp_mean</span>,  </span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"global_wineries_2041-2070_GFDL_ssp_mean_xy_pred_suit.rds"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="transform-xy-suitability">1. Transform xy suitability<a class="anchor" aria-label="anchor" href="#transform-xy-suitability"></a>
</h2>
<p>I will plot the suitability values in two different ways- I will plot
the raw xy suitability and then will transform the data so that the MTSS
threshold is the center of the scatter plot. This way, movement across
the minimum suitability threshold is more easily visualized. I will
transform all 4 vectors of suitability values, 2 per model, in
preparation for plotting.</p>
<p>I created the function
<code><a href="../reference/rescale_cloglog_suitability.html">scari::rescale_cloglog_suitability()</a></code> to accomplish this
task. This function uses a vector of exponential transformations for the
specified value of <code>thresh</code> to apply an exponential equation
to the vector of suitability values. It then applies the equation
<code>y = c1 * c2^x + c3</code> to the vector, where x is the input
suitability values, y is the transformed version of those values, c1 and
c3 are the maximum and its inverse, and c2 is the interpolated value of
the input <code>thresh</code>. The transformed suitability vector is
re-scaled so that <code>thresh</code> is the median (0.5) on a 0-1 scale
and all other values are transformed to fit this scale.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">IVR_locations</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"wineries_tidied.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># global</span></span>
<span><span class="va">xy_global_1995</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"global_wineries_1981-2010_xy_pred_suit.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">xy_global_2055</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"global_wineries_2041-2070_GFDL_ssp_mean_xy_pred_suit.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># regional</span></span>
<span><span class="va">xy_regional_ensemble_1995</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"regional_ensemble_wineries_1981-2010_xy_pred_suit.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">xy_regional_ensemble_2055</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"regional_ensemble_wineries_2041-2070_GFDL_ssp_mean_xy_pred_suit.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>I will use the internal function
<code><a href="../reference/rescale_cloglog_suitability.html">scari::rescale_cloglog_suitability()</a></code> to re-scale these
suitability values.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xy_global_1995_rescaled</span> <span class="op">&lt;-</span> <span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/rescale_cloglog_suitability.html">rescale_cloglog_suitability</a></span><span class="op">(</span></span>
<span>  xy.predicted <span class="op">=</span> <span class="va">xy_global_1995</span>,</span>
<span>  thresh <span class="op">=</span> <span class="st">"MTSS"</span>,</span>
<span>  exponential.file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"threshold_exponential_values.csv"</span><span class="op">)</span>,</span>
<span>  summary.file <span class="op">=</span> <span class="va">summary_global</span>,</span>
<span>  rescale.name <span class="op">=</span> <span class="st">"xy_global_1995"</span>,</span>
<span>  rescale.thresholds <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># separate data from thresholds</span></span>
<span><span class="va">xy_global_1995_rescaled_thresholds</span> <span class="op">&lt;-</span> <span class="va">xy_global_1995_rescaled</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">xy_global_1995_rescaled</span> <span class="op">&lt;-</span> <span class="va">xy_global_1995_rescaled</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">xy_global_2055_rescaled</span> <span class="op">&lt;-</span> <span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/rescale_cloglog_suitability.html">rescale_cloglog_suitability</a></span><span class="op">(</span></span>
<span>  xy.predicted <span class="op">=</span> <span class="va">xy_global_2055</span>,</span>
<span>  thresh <span class="op">=</span> <span class="st">"MTSS"</span>,  <span class="co"># the global model only has 1 MTSS thresh</span></span>
<span>  exponential.file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"threshold_exponential_values.csv"</span><span class="op">)</span>,</span>
<span>  summary.file <span class="op">=</span> <span class="va">summary_global</span>,</span>
<span>  rescale.name <span class="op">=</span> <span class="st">"xy_global_2055"</span>,</span>
<span>  rescale.thresholds <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">xy_global_2055_rescaled_thresholds</span> <span class="op">&lt;-</span> <span class="va">xy_global_2055_rescaled</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">xy_global_2055_rescaled</span> <span class="op">&lt;-</span> <span class="va">xy_global_2055_rescaled</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xy_regional_ensemble_1995_rescaled</span> <span class="op">&lt;-</span> <span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/rescale_cloglog_suitability.html">rescale_cloglog_suitability</a></span><span class="op">(</span></span>
<span>  xy.predicted <span class="op">=</span> <span class="va">xy_regional_ensemble_1995</span>,</span>
<span>  thresh <span class="op">=</span> <span class="st">"MTSS"</span>,</span>
<span>  exponential.file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"threshold_exponential_values.csv"</span><span class="op">)</span>,</span>
<span>  summary.file <span class="op">=</span> <span class="va">summary_regional_ensemble</span>,</span>
<span>  rescale.name <span class="op">=</span> <span class="st">"xy_regional_ensemble_1995"</span>,</span>
<span>  rescale.thresholds <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">xy_regional_ensemble_1995_rescaled_thresholds</span> <span class="op">&lt;-</span> <span class="va">xy_regional_ensemble_1995_rescaled</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">xy_regional_ensemble_1995_rescaled</span> <span class="op">&lt;-</span> <span class="va">xy_regional_ensemble_1995_rescaled</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="va">xy_regional_ensemble_2055_rescaled</span> <span class="op">&lt;-</span> <span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/rescale_cloglog_suitability.html">rescale_cloglog_suitability</a></span><span class="op">(</span></span>
<span>  xy.predicted <span class="op">=</span> <span class="va">xy_regional_ensemble_2055</span>,</span>
<span>  thresh <span class="op">=</span> <span class="st">"MTSS.CC"</span>, <span class="co"># the way the thresholds are calculated for the regional_ensemble model means that the threshold will be slightly different for climate change</span></span>
<span>  exponential.file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"threshold_exponential_values.csv"</span><span class="op">)</span>,</span>
<span>  summary.file <span class="op">=</span> <span class="va">summary_regional_ensemble</span>,</span>
<span>  rescale.name <span class="op">=</span> <span class="st">"xy_regional_ensemble_2055"</span>,</span>
<span>  rescale.thresholds <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in stri_detect_regex(string, pattern, negate = negate, opts_regex =</span></span>
<span><span class="co">## opts(pattern)): argument is not an atomic vector; coercing</span></span></code></pre>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xy_regional_ensemble_2055_rescaled_thresholds</span> <span class="op">&lt;-</span> <span class="va">xy_regional_ensemble_2055_rescaled</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">xy_regional_ensemble_2055_rescaled</span> <span class="op">&lt;-</span> <span class="va">xy_regional_ensemble_2055_rescaled</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># global</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span></span>
<span>  <span class="va">xy_global_1995_rescaled</span>, </span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"global_wineries_1981-2010_xy_pred_suit_rescaled.rds"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span></span>
<span>  <span class="va">xy_global_2055_rescaled</span>, </span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"global_wineries_2041-2070_GFDL_ssp_mean_xy_pred_suit_rescaled.rds"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># regional</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span></span>
<span>  <span class="va">xy_regional_ensemble_1995_rescaled</span>, </span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"regional_ensemble_wineries_1981-2010_xy_pred_suit_rescaled.rds"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span></span>
<span>  <span class="va">xy_regional_ensemble_2055_rescaled</span>, </span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"regional_ensemble_wineries_2041-2070_GFDL_ssp_mean_xy_pred_suit_rescaled.rds"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># global</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span></span>
<span>  <span class="va">xy_global_1995_rescaled_thresholds</span>, </span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"global_wineries_1981-2010_xy_pred_suit_rescaled_thresholds.rds"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span></span>
<span>  <span class="va">xy_global_2055_rescaled_thresholds</span>, </span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"global_wineries_2041-2070_GFDL_ssp_mean_xy_pred_suit_rescaled_thresholds.rds"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># regional</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span></span>
<span>  <span class="va">xy_regional_ensemble_1995_rescaled_thresholds</span>, </span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"regional_ensemble_wineries_1981-2010_xy_pred_suit_rescaled_thresholds.rds"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span></span>
<span>  <span class="va">xy_regional_ensemble_2055_rescaled_thresholds</span>, </span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"regional_ensemble_wineries_2041-2070_GFDL_ssp_mean_xy_pred_suit_rescaled_thresholds.rds"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-untransformed-suitability-values">2. Plot untransformed suitability values<a class="anchor" aria-label="anchor" href="#plot-untransformed-suitability-values"></a>
</h2>
<p>We need a baseline for visualizing the trends in these scatter plots,
so I will first plot the un-transformed datasets.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># join datasets for plotting</span></span>
<span><span class="va">xy_joined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">xy_global_1995</span>, <span class="va">xy_regional_ensemble_1995</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># join CC datasets</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">xy_global_2055</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">xy_regional_ensemble_2055</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># order</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">x</span>, <span class="va">y</span>, <span class="va">xy_global_1995</span>, <span class="va">xy_global_2055</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># figure annotation title</span></span>
<span><span class="co"># "suitability for Lycorma delicatula establishment in globally important viticultural areas, projected for climate change"</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="op">(</span><span class="va">xy_joined_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">xy_joined</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="co"># threshold lines</span></span>
<span>   <span class="co"># MTSS thresholds</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">summary_global</span><span class="op">[</span><span class="fl">42</span>, <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">ncol</a></span><span class="op">(</span><span class="va">summary_global</span><span class="op">)</span><span class="op">]</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> <span class="co"># global</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">summary_regional_ensemble</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">4</span><span class="op">]</span><span class="op">)</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> <span class="co"># regional_ensemble- there are two MTSS thresholds for this model, but the difference is so small that you will never see it on the plot</span></span>
<span>   <span class="co"># historical data</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xy_global_1995</span>, y <span class="op">=</span> <span class="va">xy_regional_ensemble_1995</span>, shape <span class="op">=</span> <span class="st">"Present"</span><span class="op">)</span>, </span>
<span>     size <span class="op">=</span> <span class="fl">2</span>, stroke <span class="op">=</span> <span class="fl">0.7</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"orchid1"</span></span>
<span>     <span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="co"># GFDL ssp370 data</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xy_global_2055</span>, y <span class="op">=</span> <span class="va">xy_regional_ensemble_2055</span>, shape <span class="op">=</span> <span class="st">"2041-2070\nGFDL-ESM4\nmean ssp126/370/585"</span><span class="op">)</span>, </span>
<span>     size <span class="op">=</span> <span class="fl">2</span>, stroke <span class="op">=</span> <span class="fl">0.7</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"purple3"</span></span>
<span>     <span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="co"># axes scaling</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>name <span class="op">=</span>  <span class="st">"'global' model cloglog suitability"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="va">breaks</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>name <span class="op">=</span>  <span class="st">"'regional_ensemble' model cloglog suitability"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="va">breaks</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="co"># aesthetics</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Time period"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">21</span>, <span class="fl">21</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">1</span>, override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span>, reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="130_create_suitability_xy_plots_viticultural_files/figure-html/plot%20SLF%20suitability%20values-%20untransformed-1.png" width="700"></p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span></span>
<span>  <span class="va">xy_joined_plot</span>, </span>
<span>  filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span></span>
<span>    <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"figures"</span>, <span class="st">"IVR_xy_suitability_IVR_regions_global_regional_ensemble.jpg"</span></span>
<span>    <span class="op">)</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">8</span>, </span>
<span>  width <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  device <span class="op">=</span> <span class="va">jpeg</span>,</span>
<span>  dpi <span class="op">=</span> <span class="st">"retina"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-transformed-suitability-values">3. plot transformed suitability values<a class="anchor" aria-label="anchor" href="#plot-transformed-suitability-values"></a>
</h2>
<p>I will manually change the scale of these values to a 1-10 scale so
that this plot of risk is not confused for a measure of suitability from
the model.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># global</span></span>
<span><span class="va">xy_global_1995_rescaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"global_wineries_1981-2010_xy_pred_suit_rescaled.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xy_global_2055_rescaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"global_wineries_2041-2070_GFDL_ssp_mean_xy_pred_suit_rescaled.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># regional</span></span>
<span><span class="va">xy_regional_ensemble_1995_rescaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"regional_ensemble_wineries_1981-2010_xy_pred_suit_rescaled.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xy_regional_ensemble_2055_rescaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"regional_ensemble_wineries_2041-2070_GFDL_ssp_mean_xy_pred_suit_rescaled.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># global</span></span>
<span><span class="va">xy_global_1995_rescaled_thresholds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"global_wineries_1981-2010_xy_pred_suit_rescaled_thresholds.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xy_global_2055_rescaled_thresholds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"global_wineries_2041-2070_GFDL_ssp_mean_xy_pred_suit_rescaled_thresholds.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># regional</span></span>
<span><span class="va">xy_regional_ensemble_1995_rescaled_thresholds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"regional_ensemble_wineries_1981-2010_xy_pred_suit_rescaled_thresholds.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">xy_regional_ensemble_2055_rescaled_thresholds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"regional_ensemble_wineries_2041-2070_GFDL_ssp_mean_xy_pred_suit_rescaled_thresholds.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># join datasets for plotting</span></span>
<span><span class="va">xy_joined_rescaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">xy_global_1995_rescaled</span>, <span class="va">xy_regional_ensemble_1995_rescaled</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># join CC datasets</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">xy_global_2055_rescaled</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">xy_regional_ensemble_2055_rescaled</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># order</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">x</span>, <span class="va">y</span>, <span class="va">xy_global_1995_rescaled</span>, <span class="va">xy_global_2055_rescaled</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">xy_global_1995</span>, <span class="va">xy_global_2055</span>, <span class="va">xy_regional_ensemble_1995</span>, <span class="va">xy_regional_ensemble_2055</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>I will need to create a second dataset for the arrow segments
indicating change. I will filter out only the segments that cross either
threshold and then plot these arrows.</p>
<p>First, I need to isolate the MTSS threshold values.</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># global</span></span>
<span><span class="va">global_MTSS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">xy_global_1995_rescaled_thresholds</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># regional ensemble</span></span>
<span><span class="va">regional_ensemble_MTSS_1995</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">xy_regional_ensemble_1995_rescaled_thresholds</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="va">regional_ensemble_MTSS_2055</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">xy_regional_ensemble_1995_rescaled_thresholds</span><span class="op">[</span><span class="fl">4</span>, <span class="fl">2</span><span class="op">]</span><span class="op">)</span></span></code></pre></div>
<p>Next, I will use <code><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when()</a></code> (a vectorized ifelse) to
calculate when a point shifts across a suitability threshold due to
climate change.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">xy_joined_rescaled_intersects</span> <span class="op">&lt;-</span> <span class="va">xy_joined_rescaled</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    crosses_threshold <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="co"># conditional for starting and ending points that overlap a the threshold</span></span>
<span>      <span class="co"># x-axis</span></span>
<span>      <span class="va">xy_global_1995_rescaled</span> <span class="op">&gt;</span> <span class="va">global_MTSS</span> <span class="op">&amp;</span> <span class="va">xy_global_2055_rescaled</span> <span class="op">&lt;</span> <span class="va">global_MTSS</span> <span class="op">~</span> <span class="st">"crosses"</span>,</span>
<span>      <span class="va">xy_global_1995_rescaled</span> <span class="op">&lt;</span> <span class="va">global_MTSS</span> <span class="op">&amp;</span> <span class="va">xy_global_2055_rescaled</span> <span class="op">&gt;</span> <span class="va">global_MTSS</span> <span class="op">~</span> <span class="st">"crosses"</span>,</span>
<span>      <span class="co"># y-axis</span></span>
<span>      <span class="va">xy_regional_ensemble_1995_rescaled</span> <span class="op">&gt;</span> <span class="va">regional_ensemble_MTSS_2055</span> <span class="op">&amp;</span> <span class="va">xy_regional_ensemble_2055_rescaled</span> <span class="op">&lt;</span> <span class="va">regional_ensemble_MTSS_2055</span> <span class="op">~</span> <span class="st">"crosses"</span>,</span>
<span>       <span class="va">xy_regional_ensemble_1995_rescaled</span> <span class="op">&lt;</span> <span class="va">regional_ensemble_MTSS_2055</span> <span class="op">&amp;</span> <span class="va">xy_regional_ensemble_2055_rescaled</span> <span class="op">&gt;</span> <span class="va">regional_ensemble_MTSS_2055</span> <span class="op">~</span> <span class="st">"crosses"</span>,</span>
<span>      <span class="co"># else</span></span>
<span>      .default <span class="op">=</span> <span class="st">"does not cross"</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># filter out the crosses</span></span>
<span><span class="va">xy_joined_rescaled_intersects</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>  <span class="va">xy_joined_rescaled_intersects</span>,</span>
<span>  <span class="va">crosses_threshold</span> <span class="op">==</span> <span class="st">"crosses"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now lets plot the data.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># figure annotation title</span></span>
<span><span class="co"># "Risk of Lycorma delicatula establishment in globally important viticultural areas, projected for climate change"</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="op">(</span><span class="va">xy_joined_rescaled_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">xy_joined_rescaled</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="co"># threshold lines</span></span>
<span>   <span class="co"># MTSS thresholds</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="va">global_MTSS</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> <span class="co"># global</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_hline</a></span><span class="op">(</span>yintercept <span class="op">=</span> <span class="va">regional_ensemble_MTSS_1995</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span>, linewidth <span class="op">=</span> <span class="fl">0.7</span><span class="op">)</span> <span class="op">+</span> <span class="co"># regional_ensemble- there are two MTSS thresholds for this model, but the difference is so small that you will never see it on the plot</span></span>
<span>   <span class="co"># arrows indicating change</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_segment.html" class="external-link">geom_segment</a></span><span class="op">(</span></span>
<span>     data <span class="op">=</span> <span class="va">xy_joined_rescaled_intersects</span>,</span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span></span>
<span>       x <span class="op">=</span> <span class="va">xy_global_1995_rescaled</span>,</span>
<span>       xend <span class="op">=</span> <span class="va">xy_global_2055_rescaled</span>,</span>
<span>       y <span class="op">=</span> <span class="va">xy_regional_ensemble_1995_rescaled</span>,</span>
<span>       yend <span class="op">=</span> <span class="va">xy_regional_ensemble_2055_rescaled</span></span>
<span>     <span class="op">)</span>, </span>
<span>     arrow <span class="op">=</span> <span class="fu">grid</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grid/arrow.html" class="external-link">arrow</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">5.5</span>, type <span class="op">=</span> <span class="st">"closed"</span><span class="op">)</span>, alpha <span class="op">=</span> <span class="fl">0.3</span>, linewidth <span class="op">=</span> <span class="fl">0.25</span>, color <span class="op">=</span> <span class="st">"black"</span></span>
<span>   <span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="co"># historical data</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xy_global_1995_rescaled</span>, y <span class="op">=</span> <span class="va">xy_regional_ensemble_1995_rescaled</span>, shape <span class="op">=</span> <span class="st">"Present"</span><span class="op">)</span>, </span>
<span>     size <span class="op">=</span> <span class="fl">2</span>, stroke <span class="op">=</span> <span class="fl">0.7</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"orchid1"</span></span>
<span>     <span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="co"># GFDL ssp370 data</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span></span>
<span>     <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">xy_global_2055_rescaled</span>, y <span class="op">=</span> <span class="va">xy_regional_ensemble_2055_rescaled</span>, shape <span class="op">=</span> <span class="st">"2041-2070\nGFDL-ESM4\nmean ssp126/370/585"</span><span class="op">)</span>, </span>
<span>     size <span class="op">=</span> <span class="fl">2</span>, stroke <span class="op">=</span> <span class="fl">0.7</span>, color <span class="op">=</span> <span class="st">"black"</span>, fill <span class="op">=</span> <span class="st">"purple3"</span></span>
<span>     <span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="co"># axes scaling</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"'global' model risk projection"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="va">breaks</span>, labels <span class="op">=</span> <span class="va">labels</span><span class="op">)</span> <span class="op">+</span> </span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"'regional_ensemble' model risk projection"</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span>, breaks <span class="op">=</span> <span class="va">breaks</span>, labels <span class="op">=</span> <span class="va">labels</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="co"># quadrant labels</span></span>
<span>   <span class="co"># extreme risk, top right, quad4</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_label</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.75</span>, y <span class="op">=</span> <span class="fl">0.9</span>, label <span class="op">=</span> <span class="st">"extreme risk"</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"darkred"</span>, color <span class="op">=</span> <span class="st">"azure"</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="co"># high risk, top left, quad3</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_label</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.25</span>, y <span class="op">=</span> <span class="fl">0.9</span>, label <span class="op">=</span> <span class="st">"high risk"</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"darkorange"</span>, color <span class="op">=</span> <span class="st">"azure"</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="co"># moderate risk, bottom right, quad2</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_label</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.75</span>, y <span class="op">=</span> <span class="fl">0.1</span>, label <span class="op">=</span> <span class="st">"moderate risk"</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"gold"</span>, color <span class="op">=</span> <span class="st">"azure"</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="co"># low risk, bottom left, quad1</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_text.html" class="external-link">geom_label</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fl">0.25</span>, y <span class="op">=</span> <span class="fl">0.1</span>, label <span class="op">=</span> <span class="st">"low risk"</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"azure4"</span>, color <span class="op">=</span> <span class="st">"azure"</span>, size <span class="op">=</span> <span class="fl">5</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="co"># aesthetics</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_shape_manual</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Time period"</span>, values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">21</span>, <span class="fl">21</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>shape <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">1</span>, override.aes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2.5</span><span class="op">)</span>, reverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>, panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>, panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_fixed</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in geom_label(aes(x = 0.75, y = 0.9, label = "extreme risk"), fill = "darkred", : All aesthetics have length 1, but the data has 1074 rows.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please consider using `annotate()` or provide this layer with data containing</span></span>
<span><span class="co">##   a single row.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in geom_label(aes(x = 0.25, y = 0.9, label = "high risk"), fill = "darkorange", : All aesthetics have length 1, but the data has 1074 rows.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please consider using `annotate()` or provide this layer with data containing</span></span>
<span><span class="co">##   a single row.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in geom_label(aes(x = 0.75, y = 0.1, label = "moderate risk"), fill = "gold", : All aesthetics have length 1, but the data has 1074 rows.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please consider using `annotate()` or provide this layer with data containing</span></span>
<span><span class="co">##   a single row.</span></span></code></pre>
<pre><code><span><span class="co">## Warning in geom_label(aes(x = 0.25, y = 0.1, label = "low risk"), fill = "azure4", : All aesthetics have length 1, but the data has 1074 rows.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Please consider using `annotate()` or provide this layer with data containing</span></span>
<span><span class="co">##   a single row.</span></span></code></pre>
<p><img src="130_create_suitability_xy_plots_viticultural_files/figure-html/plot%20SLF%20suitability%20values-%20rescaled-1.png" width="700"></p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span></span>
<span>  <span class="va">xy_joined_rescaled_plot</span>, </span>
<span>  filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span></span>
<span>    <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"figures"</span>, <span class="st">"IVR_risk_plot.jpg"</span></span>
<span>    <span class="op">)</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">8</span>, </span>
<span>  width <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  device <span class="op">=</span> <span class="va">jpeg</span>,</span>
<span>  dpi <span class="op">=</span> <span class="st">"retina"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># I will also save the ggplot object as an rds because I need to facet it later</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span></span>
<span>  <span class="va">xy_joined_rescaled_plot</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"figures"</span>, <span class="st">"figures-rds"</span>, <span class="st">"IVR_risk_plot.rds"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>The plot shows the projected change in suitability of our
viticultural regions under climate change. The arrows indicate that a
region is crossing a suitability value, from being suitable for SLF
establishment to being unsuitable.</p>
</div>
<div class="section level2">
<h2 id="create-summary-table-of-transformed-plot">4. Create summary table of transformed plot<a class="anchor" aria-label="anchor" href="#create-summary-table-of-transformed-plot"></a>
</h2>
<p>I will now create a summary table to explain the rescaled plots from
step 4. The table will depict the quadrant placement of the point in the
quadrant plot, both before and after climate change. From this, I will
calculate the total number of movements into and out of each quadrant. I
will apply the internal function
<code><a href="../reference/calculate_risk_quadrant.html">scari::calculate_risk_quadrant()</a></code>.</p>
<p>I will create a summary table of the quadrant placement (and thus the
level of risk) for each point in the IVR_locations dataset. I will use
<code><a href="../reference/calculate_risk_quadrant.html">calculate_risk_quadrant()</a></code> to accomplish this.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create dataset and tidy</span></span>
<span><span class="va">IVR_locations_joined</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">IVR_locations</span>, <span class="va">xy_joined_rescaled</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">ID</span>, <span class="va">x</span>, <span class="va">y</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="co"># calculate risk quadrants</span></span>
<span><span class="va">IVR_locations_risk</span> <span class="op">&lt;-</span> <span class="va">IVR_locations_joined</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    risk_1995 <span class="op">=</span> <span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_risk_quadrant.html">calculate_risk_quadrant</a></span><span class="op">(</span></span>
<span>      suit.x <span class="op">=</span> <span class="va">IVR_locations_joined</span><span class="op">$</span><span class="va">xy_global_1995_rescaled</span>,</span>
<span>      suit.y <span class="op">=</span> <span class="va">IVR_locations_joined</span><span class="op">$</span><span class="va">xy_regional_ensemble_1995_rescaled</span>,</span>
<span>      thresh.x <span class="op">=</span> <span class="va">global_MTSS</span>, <span class="co"># this threshold remains the same</span></span>
<span>      thresh.y <span class="op">=</span> <span class="va">regional_ensemble_MTSS_1995</span></span>
<span>    <span class="op">)</span>,</span>
<span>    risk_2055 <span class="op">=</span> <span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/calculate_risk_quadrant.html">calculate_risk_quadrant</a></span><span class="op">(</span></span>
<span>      suit.x <span class="op">=</span> <span class="va">IVR_locations_joined</span><span class="op">$</span><span class="va">xy_global_2055_rescaled</span>,</span>
<span>      suit.y <span class="op">=</span> <span class="va">IVR_locations_joined</span><span class="op">$</span><span class="va">xy_regional_ensemble_2055_rescaled</span>,</span>
<span>      thresh.x <span class="op">=</span> <span class="va">global_MTSS</span>,</span>
<span>      thresh.y <span class="op">=</span> <span class="va">regional_ensemble_MTSS_2055</span></span>
<span>    <span class="op">)</span>,</span>
<span>    risk_shift <span class="op">=</span> <span class="fu"><a href="https://stringr.tidyverse.org/reference/str_c.html" class="external-link">str_c</a></span><span class="op">(</span><span class="va">risk_1995</span>, <span class="va">risk_2055</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">risk_levels</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"extreme"</span>, <span class="st">"high"</span>, <span class="st">"moderate"</span>, <span class="st">"low"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">IVR_risk_table</span> <span class="op">&lt;-</span> <span class="va">IVR_locations_risk</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># create counts and make into acrostic table</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">risk_1995</span>, <span class="va">risk_2055</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html" class="external-link">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_wider.html" class="external-link">pivot_wider</a></span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">risk_2055</span>, values_from <span class="op">=</span> <span class="va">count</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># tidy</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"rows_1995_cols_2055"</span> <span class="op">=</span> <span class="st">"risk_1995"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="st">"rows_1995_cols_2055"</span>, <span class="st">"extreme"</span>, <span class="st">"high"</span>, <span class="st">"moderate"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">.</span><span class="op">$</span><span class="va">rows_1995_cols_2055</span>, levels <span class="op">=</span> <span class="va">risk_levels</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># replace missing categories with 0</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/replace.html" class="external-link">replace</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `summarise()` has grouped output by 'risk_1995'. You can override using the</span></span>
<span><span class="co">## `.groups` argument.</span></span></code></pre>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tidy</span></span>
<span><span class="va">IVR_risk_table</span> <span class="op">&lt;-</span> <span class="va">IVR_risk_table</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># add totals column</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_column.html" class="external-link">add_column</a></span><span class="op">(</span><span class="st">"total_present"</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rowSums.html" class="external-link">rowSums</a></span><span class="op">(</span><span class="va">.</span><span class="op">[</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># add row totals</span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/add_row.html" class="external-link">add_row</a></span><span class="op">(</span>rows_1995_cols_2055 <span class="op">=</span> <span class="st">"total_2055"</span>, extreme <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rowSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, high <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rowSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>, moderate <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rowSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span>, low <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/raster/man/rowSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">.</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span>, total_present <span class="op">=</span> <span class="fl">1074</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># convert to df</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">IVR_risk_table</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"IVR_risk_table.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We now have a table calculating the number of regions per quadrant,
before and after climate change!</p>
</div>
<div class="section level2">
<h2 id="global-risk-shift-vs-regional-risk-shift">5. global risk shift vs regional risk shift<a class="anchor" aria-label="anchor" href="#global-risk-shift-vs-regional-risk-shift"></a>
</h2>
<p>I will create a table to sum the number of points in three different
groups. My goal is to understand how the regional model adds resolution
to our calculation of risk. I will sum the number of points that are
suitable in the global model only, unsuitable in the global model only,
and unsuitable in the global model / suitable in the regional model. I
will repeat this operation for both time periods.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">global_regional_risk_shift</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  time_period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1995</span>, <span class="fl">1995</span>, <span class="fl">1995</span>, <span class="fl">2055</span>, <span class="fl">2055</span>, <span class="fl">2055</span><span class="op">)</span>,</span>
<span>  quadrants <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"quad4_quad2"</span>, <span class="st">"quad3_quad1"</span>, <span class="st">"quad3"</span>, <span class="st">"quad4_quad2"</span>, <span class="st">"quad3_quad1"</span>, <span class="st">"quad3"</span><span class="op">)</span>,</span>
<span>  risk <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"extreme_moderate"</span>, <span class="st">"high_low"</span>, <span class="st">"high"</span>, <span class="st">"extreme_moderate"</span>, <span class="st">"high_low"</span>, <span class="st">"high"</span><span class="op">)</span>,</span>
<span>  model_suit <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"global_suit"</span>, <span class="st">"global_unsuit"</span>, <span class="st">"global_unsuit_regional_suit"</span>, <span class="st">"global_suit"</span>, <span class="st">"global_unsuit"</span>, <span class="st">"global_unsuit_regional_suit"</span><span class="op">)</span>,</span>
<span>  IVR_region_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="co"># global suitable 1995</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">IVR_locations_joined</span><span class="op">$</span><span class="va">xy_global_1995_rescaled</span> <span class="op">&gt;=</span> <span class="va">global_MTSS</span><span class="op">)</span>,</span>
<span>    <span class="co"># global unsuitable 1995</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">IVR_locations_joined</span><span class="op">$</span><span class="va">xy_global_1995_rescaled</span> <span class="op">&lt;</span> <span class="va">global_MTSS</span><span class="op">)</span>,</span>
<span>    <span class="co"># global unsuitable and regional suitable 1995</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">IVR_locations_joined</span><span class="op">$</span><span class="va">xy_global_1995_rescaled</span> <span class="op">&lt;</span> <span class="va">global_MTSS</span> <span class="op">&amp;</span> <span class="va">IVR_locations_joined</span><span class="op">$</span><span class="va">xy_regional_ensemble_1995_rescaled</span> <span class="op">&gt;=</span> <span class="va">regional_ensemble_MTSS_1995</span><span class="op">)</span>,</span>
<span>    <span class="co"># global suitable 2055</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">IVR_locations_joined</span><span class="op">$</span><span class="va">xy_global_2055_rescaled</span> <span class="op">&gt;=</span> <span class="va">global_MTSS</span><span class="op">)</span>,</span>
<span>    <span class="co"># global unsuitable 2055</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">IVR_locations_joined</span><span class="op">$</span><span class="va">xy_global_2055_rescaled</span> <span class="op">&lt;</span> <span class="va">global_MTSS</span><span class="op">)</span>,</span>
<span>    <span class="co"># global unsuitable and regional suitable 2055</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">IVR_locations_joined</span><span class="op">$</span><span class="va">xy_global_2055_rescaled</span> <span class="op">&lt;</span> <span class="va">global_MTSS</span> <span class="op">&amp;</span> <span class="va">IVR_locations_joined</span><span class="op">$</span><span class="va">xy_regional_ensemble_2055_rescaled</span> <span class="op">&gt;=</span> <span class="va">regional_ensemble_MTSS_2055</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># total # IVRs</span></span>
<span><span class="va">total_IVR</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">global_regional_risk_shift</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="va">global_regional_risk_shift</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>  <span class="va">global_regional_risk_shift</span>, </span>
<span>  IVR_region_prop <span class="op">=</span> <span class="va">IVR_region_count</span> <span class="op">/</span> <span class="va">total_IVR</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># calculate % of unsuit (quad3 and quad 1) that are are in quad3</span></span>
<span><span class="va">quad3_risk_prop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span></span>
<span>  time_period <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"quad3_1995"</span>, <span class="st">"quad3_2055"</span><span class="op">)</span>,</span>
<span>  prop_total_unsuit_in_quad3 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>    <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html" class="external-link">label_percent</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">(</span><span class="va">global_regional_risk_shift</span><span class="op">[</span><span class="fl">3</span>, <span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="va">global_regional_risk_shift</span><span class="op">[</span><span class="fl">2</span>, <span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html" class="external-link">label_percent</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="op">(</span><span class="va">global_regional_risk_shift</span><span class="op">[</span><span class="fl">6</span>, <span class="fl">5</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="va">global_regional_risk_shift</span><span class="op">[</span><span class="fl">5</span>, <span class="fl">5</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># number and proportion of IVRs shifting with CC</span></span>
<span><span class="co">#global_regional_risk_shift_summary &lt;- tibble(</span></span>
<span><span class="co">##  "risk_shift" = c("global_unsuit_shift_1995_2055", "quad3_high_shift_diff_1995_2055"),</span></span>
<span><span class="co">#  "IVR_region_change_count" = c(</span></span>
<span><span class="co">#    as.numeric(global_regional_risk_shift[2, 5]) - as.numeric(global_regional_risk_shift[5, 5]),</span></span>
<span><span class="co">#    as.numeric(global_regional_risk_shift[3, 5]) - as.numeric(global_regional_risk_shift[6, 5])</span></span>
<span><span class="co">#  ),</span></span>
<span><span class="co">#  "IVR_region_change_prop" = c(</span></span>
<span><span class="co">#    as.numeric(global_regional_risk_shift[2, 6]) - as.numeric(global_regional_risk_shift[5, 6]),</span></span>
<span><span class="co">#    as.numeric(global_regional_risk_shift[3, 6]) - as.numeric(global_regional_risk_shift[6, 6])</span></span>
<span><span class="co">#  )</span></span>
<span><span class="co">#) %&gt;%</span></span>
<span>  <span class="co"># make percentages and change signs</span></span>
<span><span class="co">#  mutate(</span></span>
<span><span class="co">#    IVR_region_change_count = abs(IVR_region_change_count),</span></span>
<span> <span class="co">#   IVR_region_change_prop = scales::label_percent(accuracy = 0.01) (abs(IVR_region_change_prop))</span></span>
<span><span class="co">#    )</span></span></code></pre></div>
<p>With this analysis, I found that currently, 65.2% of the global IVRs
are low risk according to the global model. However, 26% of the total
IVRs are specifically in quadrant 3 (high risk). This means that the
global model alone would label 693 of the 1074 IVRs as low risk, when in
actuality 287 or about 41.4% of these are at high risk for SLF
establishment (above the MTSS threshold) when we spatially segment the
presence data into an ensemble of regional-scale models. After climate
change, 893 of the 1063 IVRs (82%) would be unsuitable if the global
model alone were used to describe the risk of SLF. However, 341 or 39.1%
of these unsuitable IVRs are still suitable in regional_scale models and
thus would be missed by an analysis of risk using only a global-scale
model.</p>
<p>This means that our regional-scale ensemble is adding resolution and
nuance to our estimation of risk for SLF establishment.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add %</span></span>
<span><span class="va">global_regional_risk_shift</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">global_regional_risk_shift</span>, IVR_region_prop <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="fu"><a href="https://scales.r-lib.org/reference/label_percent.html" class="external-link">label_percent</a></span><span class="op">(</span>accuracy <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span> <span class="op">(</span><span class="va">IVR_region_prop</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># make kable</span></span>
<span><span class="va">global_regional_risk_shift</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">global_regional_risk_shift</span>, <span class="st">"html"</span>, escape <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/kable_styling.html" class="external-link">kable_styling</a></span><span class="op">(</span>bootstrap_options <span class="op">=</span> <span class="st">"striped"</span>, full_width <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># standardize col width</span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/column_spec.html" class="external-link">column_spec</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span>, width_min <span class="op">=</span> <span class="st">'4cm'</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/add_header_above.html" class="external-link">add_header_above</a></span><span class="op">(</span><span class="va">.</span>, header <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"IVR risk plot quadrant proportions"</span> <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>, bold <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># save as .html</span></span>
<span><span class="fu">kableExtra</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kableExtra/man/save_kable.html" class="external-link">save_kable</a></span><span class="op">(</span></span>
<span>  <span class="va">global_regional_risk_shift</span>, </span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"figures"</span>, <span class="st">"IVR_risk_plot_quadrant_props.html"</span><span class="op">)</span>,</span>
<span>  self_contained <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># initialize webshot by </span></span>
<span><span class="co"># webshot::install_phantomjs()</span></span>
<span><span class="co"># convert to pdf</span></span>
<span><span class="fu">webshot</span><span class="fu">::</span><span class="fu"><a href="http://wch.github.io/webshot/reference/webshot.html" class="external-link">webshot</a></span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"figures"</span>, <span class="st">"IVR_risk_plot_quadrant_props.html"</span><span class="op">)</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"figures"</span>, <span class="st">"IVR_risk_plot_quadrant_props.jpg"</span><span class="op">)</span>,</span>
<span>  zoom <span class="op">=</span> <span class="fl">2</span></span>
<span><span class="op">)</span></span>
<span>  </span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"figures"</span>, <span class="st">"IVR_risk_plot_quadrant_props.html"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="save-wineries-with-pred-suitability">6. Save wineries with pred suitability<a class="anchor" aria-label="anchor" href="#save-wineries-with-pred-suitability"></a>
</h2>
<p>I will now join the risk levels dataset I have created with the
original <code>wineries_tidied</code> dataset and save this. I will also
add a count of the risk levels so they can be compared quantitatively. I
will code extreme risk = 4, high = 3, moderate = 2, and low = 1. Then, I
will subtract the risk level in 1995 from the risk level in 2055 to
quantify the change in risk level over time and calculate summary
stats.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add risk level counts</span></span>
<span><span class="va">wineries_tidied_suit</span> <span class="op">&lt;-</span> <span class="va">IVR_locations_risk</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    risk_1995_count <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">risk_1995</span> <span class="op">==</span> <span class="st">"extreme"</span> <span class="op">~</span> <span class="fl">4</span>,</span>
<span>      <span class="va">risk_1995</span> <span class="op">==</span> <span class="st">"high"</span> <span class="op">~</span> <span class="fl">3</span>,</span>
<span>      <span class="va">risk_1995</span> <span class="op">==</span> <span class="st">"moderate"</span> <span class="op">~</span> <span class="fl">2</span>,</span>
<span>      <span class="va">risk_1995</span> <span class="op">==</span> <span class="st">"low"</span> <span class="op">~</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span>,</span>
<span>    risk_2055_count <span class="op">=</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/case_when.html" class="external-link">case_when</a></span><span class="op">(</span></span>
<span>      <span class="va">risk_2055</span> <span class="op">==</span> <span class="st">"extreme"</span> <span class="op">~</span> <span class="fl">4</span>,</span>
<span>      <span class="va">risk_2055</span> <span class="op">==</span> <span class="st">"high"</span> <span class="op">~</span> <span class="fl">3</span>,</span>
<span>      <span class="va">risk_2055</span> <span class="op">==</span> <span class="st">"moderate"</span> <span class="op">~</span> <span class="fl">2</span>,</span>
<span>      <span class="va">risk_2055</span> <span class="op">==</span> <span class="st">"low"</span> <span class="op">~</span> <span class="fl">1</span></span>
<span>    <span class="op">)</span>,</span>
<span>    risk_shift_count <span class="op">=</span> <span class="va">risk_2055_count</span> <span class="op">-</span> <span class="va">risk_1995_count</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># rename columns</span></span>
<span><span class="va">wineries_tidied_suit</span> <span class="op">&lt;-</span> <span class="va">wineries_tidied_suit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span></span>
<span>    <span class="st">"global_model_suit_hist"</span> <span class="op">=</span> <span class="st">"xy_global_1995_rescaled"</span>,</span>
<span>    <span class="st">"regional_ensemble_model_suit_hist"</span> <span class="op">=</span> <span class="st">"xy_regional_ensemble_1995_rescaled"</span>,</span>
<span>    <span class="st">"global_model_suit_2041-2070"</span> <span class="op">=</span> <span class="st">"xy_global_2055_rescaled"</span>,</span>
<span>    <span class="st">"regional_ensemble_model_suit_2041-2070"</span> <span class="op">=</span> <span class="st">"xy_regional_ensemble_2055_rescaled"</span>,</span>
<span>    <span class="st">"risk_level_hist"</span> <span class="op">=</span> <span class="st">"risk_1995"</span>,</span>
<span>    <span class="st">"risk_level_2041-2070"</span> <span class="op">=</span> <span class="st">"risk_2055"</span>,</span>
<span>    <span class="st">"risk_count_hist"</span> <span class="op">=</span> <span class="st">"risk_1995_count"</span>,</span>
<span>    <span class="st">"risk_count_2041-2070"</span> <span class="op">=</span> <span class="st">"risk_2055_count"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># rearrange columns</span></span>
<span><span class="va">wineries_tidied_suit</span> <span class="op">&lt;-</span> <span class="va">wineries_tidied_suit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">risk_count_hist</span>, .after <span class="op">=</span> <span class="va">risk_level_hist</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">`risk_count_2041-2070`</span>, .after <span class="op">=</span> <span class="va">`risk_level_2041-2070`</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="va">risk_shift_count</span>, .after <span class="op">=</span> <span class="va">risk_shift</span><span class="op">)</span> </span></code></pre></div>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save </span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">wineries_tidied_suit</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"wineries_tidied_with_suit_risk.csv"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">wineries_tidied_suit</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"wineries_tidied_with_suit_risk.rds"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>We now have risk quadrant plots and tables that we can use to assess
the level of SLF establishment risk to viticulture.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Gallien, L., Douzet, R., Pratte, S., Zimmermann, N. E., &amp;
Thuiller, W. (2012). Invasive species distribution models – how
violating the equilibrium assumption can create new insights. Global
Ecology and Biogeography, 21(11), 1126–1136. <a href="https://doi.org/10.1111/j.1466-8238.2012.00768.x" class="external-link uri">https://doi.org/10.1111/j.1466-8238.2012.00768.x</a></p></li>
<li><p>Smith, T. 2021, August 11. Evaluating Invasion Stage with SDMs -
plantarum.ca. <a href="https://plantarum.ca/2021/08/11/invasion-stage/" class="external-link uri">https://plantarum.ca/2021/08/11/invasion-stage/</a>.</p></li>
</ol>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Samuel M. Owens, Matthew R. Helmus.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
