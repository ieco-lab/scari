<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Run global-scale MaxEnt model • scari</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run global-scale MaxEnt model">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">scari</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/scari.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Quantify risk to specific viticultural regions</h6></li>
    <li><a class="dropdown-item" href="../articles/150_create_risk_report.html">Example usage of create_risk_report() to create reports of key viticultural areas</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Initialize scari</h6></li>
    <li><a class="dropdown-item" href="../articles/010_initialize_pkg.html">Initialization of renv package for dependencies</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>1. Retrieve and tidy input data for MaxEnt</h6></li>
    <li><a class="dropdown-item" href="../articles/020_retrieve_bioclim_variables.html">Bioclim variable rasters: CHELSA</a></li>
    <li><a class="dropdown-item" href="../articles/030_retrieve_occurrence_records.html">SLF occurrence records: GBIF, lydemapR, literature</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>2. SDM modeling pipeline</h6></li>
    <li><a class="dropdown-item" href="../articles/040_setup_global_MaxEnt_model.html">Setup for global-scale MaxEnt model</a></li>
    <li><a class="dropdown-item" href="../articles/050_run_global_MaxEnt_model.html">Run global-scale MaxEnt model</a></li>
    <li><a class="dropdown-item" href="../articles/060_setup_regional_MaxEnt_models.html">Setup for regional-scale MaxEnt models</a></li>
    <li><a class="dropdown-item" href="../articles/070_run_regional_invaded_MaxEnt_model.html">Run 'Ri.NAmerica' model trained on SLF invaded region in North America</a></li>
    <li><a class="dropdown-item" href="../articles/080_run_regional_invaded_asian_MaxEnt_model.html">Run 'Ri.Asia' model trained on SLF invaded range in Japan and South Korea</a></li>
    <li><a class="dropdown-item" href="../articles/090_run_regional_native_MaxEnt_model.html">Run 'Rn' model trained on SLF native range in east Asia</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>3. Ensemble Regional-scale SDMs</h6></li>
    <li><a class="dropdown-item" href="../articles/100_run_ExDet_MIC.html">Run an Extrapolation Detection (NT2) analysis and calculate MIC</a></li>
    <li><a class="dropdown-item" href="../articles/110_ensemble_regional_models.html">Ensemble regional-scale models using a weighted mean</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>4. Quantify SLF risk and model fit</h6></li>
    <li><a class="dropdown-item" href="../articles/120_create_suitability_maps.html">Create risk maps of each model scale and intersect predictions</a></li>
    <li><a class="dropdown-item" href="../articles/130_create_suitability_xy_plots_viticultural.html">Plot shift in SLF risk to important viticultural regions under climate change</a></li>
    <li><a class="dropdown-item" href="../articles/131_create_suitability_xy_plots_SLF.html">Infer stability of known SLF populations due climate change effects</a></li>
    <li><a class="dropdown-item" href="../articles/140_plot_response_curves.html">Analyze biological realism of model response curves</a></li>
    <li><a class="dropdown-item" href="../articles/141_plot_AUC_var_cont.html">Check model goodness of fit via AUC, TSS and confusion matrices</a></li>
    <li><a class="dropdown-item" href="../articles/142_calculate_model_fit.html">Calculate model fit using confusion matrices</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ieco-lab/scari/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Run global-scale MaxEnt model</h1>
                        <h4 data-toc-skip class="author">Samuel M.
Owens<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Temple University &lt;a href="http://www.biodiversitycenter.org/" class="external-link"&gt;Center for Biodiversity&lt;/a&gt; &lt;a href="https://www.iecolab.org/" class="external-link"&gt;iEco Lab&lt;/a&gt; &lt;a href="mailto:sam.owens@temple.edu" class="email"&gt;sam.owens@temple.edu&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a>
</h4>
            
            <h4 data-toc-skip class="date">2024-08-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ieco-lab/scari/blob/HEAD/vignettes/050_run_global_MaxEnt_model.Rmd" class="external-link"><code>vignettes/050_run_global_MaxEnt_model.Rmd</code></a></small>
      <div class="d-none name"><code>050_run_global_MaxEnt_model.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In the last vignette, I produced the background point dataset for the
global-scale model. In this vignette, I will start training MaxEnt
models and obtaining the outputs I will need for my analysis! This
vignette will train the global-scale model and the next few vignettes
will train the three regional-scale models. This is the first step
toward my goal of analyzing the realized niche of <em>Lycorma
delicatula</em> at multiple spatial scales. The output from this
global-scale model will be compared directly against the output from an
ensemble of regional-scale models to determine the impact of climate
change on the suitability of SLF in important viticultural regions. I
hypothesize that by creating models at multiple spatial scales, I can
have more confidence in suitability predictions made for specific SLF
populations and important viticultural regions, and can predict the risk
of specific populations spreading now and under climate change. I also
hypothesize that the regional-scale models, once ensembled into a single
prediction, will make more refined predictions than a global-scale model
could.</p>
<p>I begin setup for this model by associating the presence data with
the covariates in a data frame that will be fed into MaxEnt. I also
separate these data into random folds for cross-validation. Once these
are done, I can train the MaxEnt model. Outputs from this model will
include a list of summary statistics, suitability maps and point-wise
suitability values for all SLF presences and for important viticultural
regions. I will also create projected map and suitability outputs for
the 3 CMIP6 scenarios I plan to use in my analysis.</p>
<p>This vignette has 3 subvignettes (051-053) that each outline and
comment the basic workflow for the 3 R functions created for use in this
vignette. These functions include
<code><a href="../reference/compute_MaxEnt_summary_statistics_CV.html">compute_MaxEnt_summary_statistics_CV()</a></code>,
<code><a href="../reference/create_MaxEnt_suitability_maps_CV.html">create_MaxEnt_suitability_maps_CV()</a></code>, and
<code><a href="../reference/predict_xy_suitability_CV.html">predict_xy_suitability_CV()</a></code>. Please see these subvignettes
for a step-by-step guide to the creation of these functions. This
package also has versions of the same functions that are designed for
MaxEnt models without cross-validation. These share the same name but
without the <code>_CV</code> ending and will be used for the regional
models.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p><em>CURRENT MODEL VERSION: v3</em></p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># general tools</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>  <span class="co">#data manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span> <span class="co">#making directory pathways easier on different instances</span></span>
<span><span class="co"># here::here() starts at the root folder of this package.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># SDMtune and dependencies</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://consbiol-unibern.github.io/SDMtune/" class="external-link">SDMtune</a></span><span class="op">)</span> <span class="co"># main package used to run SDMs</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster/sdm/" class="external-link">dismo</a></span><span class="op">)</span> <span class="co"># package underneath SDMtune</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.rforge.net/rJava/" class="external-link">rJava</a></span><span class="op">)</span> <span class="co"># for running MaxEnt</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sachsmc.github.io/plotROC/" class="external-link">plotROC</a></span><span class="op">)</span> <span class="co"># plots ROCs</span></span>
<span></span>
<span><span class="co"># spatial data handling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/rvalavi/blockCV" class="external-link">blockCV</a></span><span class="op">)</span> <span class="co"># appendix, not necessary to run this vignette</span></span></code></pre></div>
<p><strong>Note:</strong> I will be setting the global options of this
document so that only certain code chunks are rendered in the final
.html file. I will set the <code>eval = FALSE</code> so that none of the
code is re-run (preventing files from being overwritten during knitting)
and will simply overwrite this in chunks with plots.</p>
<p><code>SDMtune</code> will run MaxEnt through java via the
<code>rJava</code> package. You will need to ensure that your machine
has the proper version of java installed (x32 or x64) for your operating
system.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/checkMaxentInstallation.html" class="external-link">checkMaxentInstallation</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> <span style="color: #00BB00;">Java</span> is installed.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> The packege <span style="color: #0000BB;">rJava</span> is installed.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔</span> The file <span style="color: #0000BB;">maxent.jar</span> is present in the correct folder.</span></span></code></pre>
<pre><code><span><span class="co">## [1] TRUE</span></span></code></pre>
<p>This chunk sets the java memory allocation (<code>Xmx</code>). I will
increase the memory allocation from 512m (the default) to 2GB of
memory.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># xmx sets java memory allocation</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">options</a></span><span class="op">(</span>java.parameters <span class="op">=</span> <span class="st">"-Xmx2048m"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># xss sets java stack size</span></span>
<span><span class="co"># options(java.parameters = c("-Xss2560k", "-Xmx2048m"))</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="format-data-for-global-model">1. Format Data for Global Model<a class="anchor" aria-label="anchor" href="#format-data-for-global-model"></a>
</h2>
<p>I will load in the datasets I will need for the MaxEnt models. These
are labeled at the beginning of the object name by the parameter they
will be used in the <code><a href="https://consbiol-unibern.github.io/SDMtune/reference/train.html" class="external-link">SDMtune::train()</a></code> function (x, p or a).
I will begin by loading in the covariate data and then by loading in the
points datasets.</p>
<div class="section level3">
<h3 id="import-data">1.1 Import data<a class="anchor" aria-label="anchor" href="#import-data"></a>
</h3>
<p>First, I will load in the SLF presence dataset created in vignette
020 and the background points dataset created in vignette 040.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># slf presences</span></span>
<span><span class="va">p_slf_points</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"slf_all_coords_final_2024-08-05.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">species</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># entire eastern USA background point set</span></span>
<span><span class="va">a_global_background_points</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"global_background_points_v3.rds"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>Next, I will load in and stack the covariates needed for the model,
which were trimmed in vignette 030.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># path to directory</span></span>
<span><span class="va">mypath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     <span class="st">"maxent/historical_climate_rasters/chelsa2.1_30arcsec"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the env covariates used to train the model global</span></span>
<span><span class="va">x_global_hist_env_covariates_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"v1_maxent_10km"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\.asc$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"bio2_1981-2010_global.asc|bio11_1981-2010_global.asc|bio12_1981-2010_global.asc|bio15_1981-2010_global.asc"</span>, <span class="va">.</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>I will load in 3 sets of CMIP6 covariates, 1 per ssp scenario
(126/370/585).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># path to directory</span></span>
<span>  <span class="va">mypath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     <span class="st">"maxent/future_climate_rasters/chelsa2.1_30arcsec"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># SSP126</span></span>
<span><span class="va">x_global_126_env_covariates_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"2041-2070_ssp126_GFDL"</span>, <span class="st">"v1_maxent_10km"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\_global.asc$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># dont include Access to cities</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"atc_2015"</span>, value <span class="op">=</span> <span class="cn">TRUE</span>, invert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># SSP370</span></span>
<span><span class="va">x_global_370_env_covariates_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"2041-2070_ssp370_GFDL"</span>, <span class="st">"v1_maxent_10km"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\_global.asc$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># dont include Access to cities</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"atc_2015"</span>, value <span class="op">=</span> <span class="cn">TRUE</span>, invert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">## SSP585</span></span>
<span><span class="va">x_global_585_env_covariates_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span></span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"2041-2070_ssp585_GFDL"</span>, <span class="st">"v1_maxent_10km"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\_global.asc$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># dont include Access to cities</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"atc_2015"</span>, value <span class="op">=</span> <span class="cn">TRUE</span>, invert <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>I will import rasters of the environmental covariates, stack them and
gather summary statistics. I will also shorten their names and exclude
possible operators from layer names (for example, using the dash symbol
was found to interfere with SDMtune making predictions for tables
downstream).</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># layer name object. Check order of layers first</span></span>
<span><span class="va">env_layer_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"bio11"</span>, <span class="st">"bio12"</span>, <span class="st">"bio15"</span>, <span class="st">"bio2"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stack env covariates</span></span>
<span><span class="va">x_global_hist_env_covariates</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_global_hist_env_covariates_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># attributes</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">x_global_hist_env_covariates</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x_global_hist_env_covariates</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/minmax.html" class="external-link">minmax</a></span><span class="op">(</span><span class="va">x_global_hist_env_covariates</span><span class="op">)</span></span>
<span><span class="co"># ext(x_global_hist_env_covariates)</span></span>
<span><span class="co"># crs(x_global_hist_env_covariates)</span></span>
<span></span>
<span></span>
<span><span class="co"># I will change the name of the variables because they are throwing errors in SDMtune</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x_global_hist_env_covariates</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">env_layer_names</span></span>
<span><span class="co"># confirmed- SDMtune doesnt like dashes in column names (it is read as a mathematical operation)</span></span></code></pre></div>
<p>Now perform the same operation but times 3 for the CMIP6 models.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stack env covariates</span></span>
<span><span class="va">x_global_126_env_covariates</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_global_126_env_covariates_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># attributes</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">x_global_126_env_covariates</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x_global_126_env_covariates</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/minmax.html" class="external-link">minmax</a></span><span class="op">(</span><span class="va">x_global_126_env_covariates</span><span class="op">)</span></span>
<span><span class="co"># ext(x_global_126_env_covariates)</span></span>
<span><span class="co"># crs(x_global_126_env_covariates)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x_global_126_env_covariates</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">env_layer_names</span></span>
<span></span>
<span></span>
<span><span class="co"># stack env covariates</span></span>
<span><span class="va">x_global_370_env_covariates</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_global_370_env_covariates_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># attributes</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">x_global_370_env_covariates</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x_global_370_env_covariates</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/minmax.html" class="external-link">minmax</a></span><span class="op">(</span><span class="va">x_global_370_env_covariates</span><span class="op">)</span></span>
<span><span class="co"># ext(x_global_370_env_covariates)</span></span>
<span><span class="co"># crs(x_global_370_env_covariates)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x_global_370_env_covariates</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">env_layer_names</span></span>
<span></span>
<span></span>
<span><span class="co"># stack env covariates</span></span>
<span><span class="va">x_global_585_env_covariates</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x_global_585_env_covariates_list</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># attributes</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">x_global_585_env_covariates</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x_global_585_env_covariates</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/minmax.html" class="external-link">minmax</a></span><span class="op">(</span><span class="va">x_global_585_env_covariates</span><span class="op">)</span></span>
<span><span class="co"># ext(x_global_585_env_covariates)</span></span>
<span><span class="co"># crs(x_global_585_env_covariates)</span></span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x_global_585_env_covariates</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">env_layer_names</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">x_global_hist_env_covariates_list</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">x_global_126_env_covariates_list</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">x_global_370_env_covariates_list</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">x_global_585_env_covariates_list</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="create-input-data-objects">1.2 create input data objects<a class="anchor" aria-label="anchor" href="#create-input-data-objects"></a>
</h3>
<p>I will need to combine the above covariate, presence and background
point datasets into a single dataset to feed into MaxEnt (an SWD,
samples with data object). This dataset will need to contain point-wise
values for each of the predictor covariates at the presence and
background point coordinates. <code>SDMtune</code> takes an SWD object
for this purpose, containing the presences and background points with
associated covariate data to be fed into the model, so I will create
this now.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">global_SWD</span> <span class="op">&lt;-</span> <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/prepareSWD.html" class="external-link">prepareSWD</a></span><span class="op">(</span></span>
<span>  species <span class="op">=</span> <span class="st">"Lycorma delicatula"</span>,</span>
<span>  env <span class="op">=</span> <span class="va">x_global_hist_env_covariates</span>,</span>
<span>  p <span class="op">=</span> <span class="va">p_slf_points</span>,</span>
<span>  a <span class="op">=</span> <span class="va">a_global_background_points</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># print helpful messages</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="va">global_SWD</span><span class="op">@</span><span class="va">coords</span> <span class="co"># coordinates</span></span>
<span><span class="va">global_SWD</span><span class="op">@</span><span class="va">pa</span> <span class="co"># presence / absence (background counted as absence)</span></span>
<span><span class="va">global_SWD</span><span class="op">@</span><span class="va">data</span> <span class="co"># extracted data from </span></span></code></pre></div>
<p>I usually look at how many records were dropped before I save it,
because SDMtune gives an undefined warning about how many samples were
discarded. In this case, we only lost 2 presence records, so this is
acceptable. I will also save the output to be used later.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/swd2csv.html" class="external-link">swd2csv</a></span><span class="op">(</span>swd <span class="op">=</span> <span class="va">global_SWD</span>, file_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"global_slf_presences_with_data_v3.csv"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"global_background_points_with_data_v3.csv"</span><span class="op">)</span></span>
<span>  <span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="create-training-test-split">Create training / test split<a class="anchor" aria-label="anchor" href="#create-training-test-split"></a>
</h4>
<p>I will randomly split the presences into training and testing, using
80% of the points for training and 20% for testing. I will then use
<code>SDMtune::randomFold()</code> to split the training data into 10
partitions for cross-validation. This method was loosely adapted from
Srivastava et.al, 2021.</p>
<p>In my first attempts, I tried a blocked cross-validation methodology
using the function <code><a href="https://rdrr.io/pkg/blockCV/man/cv_spatial.html" class="external-link">blockCV::cv_spatial()</a></code>. I attempted it
because many papers say that spatially segmenting the k-folds is a more
rigorous method than simple random k-fold. However, this method did not
work for my dataset and left many test folds with 0 presence points. I
believe this is due to both the spatial scale I am working in for this
model (global) and the comparatively narrow species range (limited to
only east Asia and the USA). The block size that reduces autocorrelation
was about 1.5 million meters, but this made the blocks too large for
each block to receive adequate species presences. I also attempted
spatial blocking by distance (<code><a href="https://rdrr.io/pkg/blockCV/man/cv_cluster.html" class="external-link">cv_cluster()</a></code>), but this
yielded similar results. See the Appendix in this file for code.</p>
<p>Let’s create the training/testing data split.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">global_trainTest</span> <span class="op">&lt;-</span>  <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/trainValTest.html" class="external-link">trainValTest</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">global_SWD</span>,</span>
<span>  test <span class="op">=</span> <span class="fl">0.2</span>, <span class="co"># set used for predicting maps and suitability values</span></span>
<span>  only_presence <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># only split presences and recycle bg points</span></span>
<span>  seed <span class="op">=</span> <span class="fl">3</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># separate off training data</span></span>
<span><span class="va">global_train</span> <span class="op">&lt;-</span> <span class="va">global_trainTest</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">global_test</span> <span class="op">&lt;-</span> <span class="va">global_trainTest</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="va">global_train</span><span class="op">@</span><span class="va">coords</span> <span class="co"># coordinates</span></span>
<span><span class="va">global_train</span><span class="op">@</span><span class="va">pa</span> <span class="co"># presence / absence (background counted as absence)</span></span>
<span><span class="va">global_train</span><span class="op">@</span><span class="va">data</span> <span class="co"># extracted data from</span></span></code></pre></div>
<p>Now split the training data for 10-fold random cross validation.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create random folds</span></span>
<span><span class="va">global_trainFolds</span> <span class="op">&lt;-</span> <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/randomFolds.html" class="external-link">randomFolds</a></span><span class="op">(</span></span>
<span>  data <span class="op">=</span> <span class="va">global_train</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">10</span>, <span class="co"># 10 folds</span></span>
<span>  only_presence <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">4</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="train-tune-global-model">2. Train &amp; Tune Global Model<a class="anchor" aria-label="anchor" href="#train-tune-global-model"></a>
</h2>
<p>First, I will train a model with 10 cross-validated replicates. The
model will only be trained on 80% of the SLF presence data, with the
other 20% being held apart and used downstream for analysis. The default
settings will be used for MaxEnt, apart from the following changes:</p>
<ul>
<li>ALL feature types used (l = linear, q = quadratic, p = product, h =
hinge, t = threshold)</li>
<li>replicates = 10</li>
<li>iterations = 5000. This is the max number of iterations for the
optimization algorithm to perform before stopping training. Increasing
this number from the default of 500 allows the algorithm to make more
refined predictions.</li>
</ul>
<p>I will use these hyperparameters to train the initial model, but
these parameters may change based on model tuning, which I will perform
next.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">global_model</span> <span class="op">&lt;-</span> <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/train.html" class="external-link">train</a></span><span class="op">(</span></span>
<span>  method <span class="op">=</span> <span class="st">"Maxent"</span>,</span>
<span>  data <span class="op">=</span> <span class="va">global_train</span>,</span>
<span>  folds <span class="op">=</span> <span class="va">global_trainFolds</span>, <span class="co"># 10 folds for dataset</span></span>
<span>  fc <span class="op">=</span> <span class="st">"lqpht"</span>, <span class="co"># feature classes set to ALL</span></span>
<span>  iter <span class="op">=</span> <span class="fl">5000</span>, <span class="co"># number of iterations</span></span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="tuning-maxent-model">2.1 Tuning MaxEnt Model<a class="anchor" aria-label="anchor" href="#tuning-maxent-model"></a>
</h3>
<p>Next, I will perform model tuning by varying specific
hyperparameters. I selected the hyperparameters that I thought were best
for the model based on numerous papers. However, modeling papers for
other species have made different choices for the parameter selection
that I did not. Luckily, <code>SDMtune</code> makes it easy to select
the best fit set of hyperparameters from a range of possibilities using
the <code><a href="https://consbiol-unibern.github.io/SDMtune/reference/gridSearch.html" class="external-link">gridSearch()</a></code> function. This function trains a different
model for every possible combination of hyperparameters that is listed.
I can then pick the best model based on AUC, TSS or AICc. I selected
these hyperparameters for specific reasons listed in the literature.</p>
<p><strong>Feature classes: h, qpht, lqpht</strong> Feature classes are
important because they govern how your environmental covariates are
transformed by the algorithm (for example, if most presences fall beyond
a specific point on the range of values, the algorithm might determine
that a threshold feature is most appropriate.)</p>
<ul>
<li>Elith et.al, 2011 used only hinge features or all features and
showed that hinge features alone may perform better. They referred to a
MaxEnt model using only hinge features as resembling an additive model,
not unlike a GAM.</li>
<li>The supplemental materials from the same paper demonstrated that
linear features are redundant if also using hinge features.</li>
<li>Most SLF modeling papers, including Huron et.al and others for SLF,
simply use all features.</li>
</ul>
<p><strong>Regularization Multiplier: 0.25, 0.5, 1, 1.5, 2</strong>
Regularization penalizes overfitting in the model. If a model is too fit
to a range of covariate values, to the point that this model could not
be applied to another area with other values, it receives a penalty.</p>
<ul>
<li>Radosavljevic and Anderson 2014 used a range of regularization
multipliers, from 0.25 to 2, to test for the most appropriate value,
which I will adopt.</li>
</ul>
<p>I will compare the models with the highest test AUC and TSS values. I
will also save all of the model variations in a <code>.rds</code>
object.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the arguments that can be tuned later</span></span>
<span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/getTunableArgs.html" class="external-link">getTunableArgs</a></span><span class="op">(</span><span class="va">global_model</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># list of hyperparameters</span></span>
<span><span class="va">hypers</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  reg <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">1</span>, <span class="fl">1.5</span>, <span class="fl">2</span><span class="op">)</span>, <span class="co"># regularization multiplier</span></span>
<span>  fc <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"h"</span>, <span class="st">"qpht"</span>, <span class="st">"lqpht"</span><span class="op">)</span> <span class="co"># feature classes</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># Train a model with all possible combinations of hyperparameters</span></span>
<span>  <span class="va">global_model_tuned_auc</span> <span class="op">&lt;-</span> <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/gridSearch.html" class="external-link">gridSearch</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">global_model</span>, </span>
<span>    hypers <span class="op">=</span> <span class="va">hypers</span>, <span class="co"># hyperparameter list</span></span>
<span>    metric <span class="op">=</span> <span class="st">"auc"</span>,</span>
<span>    save_models <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    interactive <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>    progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># show tuning results</span></span>
<span>  <span class="va">global_model_tuned_auc</span><span class="op">@</span><span class="va">results</span></span>
<span>  <span class="co"># select number of best model</span></span>
<span>  <span class="va">best.model.auc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">global_model_tuned_auc</span><span class="op">@</span><span class="va">results</span><span class="op">$</span><span class="va">test_AUC</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Based on the test AUC metric, the highest value was attributed to the
model with a regularization multiplier of 1.5 and qpht features (model
11). I will also check based on the TSS.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># Train a model with all possible combinations of hyperparameters</span></span>
<span>  <span class="va">global_model_tuned_tss</span> <span class="op">&lt;-</span> <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/gridSearch.html" class="external-link">gridSearch</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">global_model</span>, </span>
<span>    hypers <span class="op">=</span> <span class="va">hypers</span>, <span class="co"># hyperparameter list</span></span>
<span>    metric <span class="op">=</span> <span class="st">"tss"</span>, </span>
<span>    save_models <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    interactive <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>    progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># show tuning results</span></span>
<span>  <span class="va">global_model_tuned_tss</span><span class="op">@</span><span class="va">results</span></span>
<span>  <span class="co"># select number of best model</span></span>
<span>  <span class="va">best.model.tss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.min.html" class="external-link">which.max</a></span><span class="op">(</span><span class="va">global_model_tuned_tss</span><span class="op">@</span><span class="va">results</span><span class="op">$</span><span class="va">test_TSS</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>We get slightly different results based on the test TSS metric. We
see that the highest value was attributed to the model with a
regularization multiplier of 1.5 and lqpht (ALL) features (model
12).</p>
<p>We will need to choose either model 11 or model 12. Since the
difference in test AUC and TSS are incredibly small between both models
(0.002), I will choose model 12 because this model has been consistently
more fit across model versions. These tuned parameters will also be
applied to all future models performed for SLF at the regional
scale.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">global_model</span> <span class="op">&lt;-</span> <span class="va">global_model_tuned_auc</span><span class="op">@</span><span class="va">models</span><span class="op">[[</span><span class="fl">12</span><span class="op">]</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="summary-statistics">2.2 Summary Statistics<a class="anchor" aria-label="anchor" href="#summary-statistics"></a>
</h3>
<p>I will apply my function
<code><a href="../reference/compute_MaxEnt_summary_statistics_CV.html">compute_MaxEnt_summary_statistics_CV()</a></code> to produce all
summary statistics for this model. This list includes marginal and
univariate response curves, jackknife tests, variable importance,
thresholds and confusion matrices, among other statistics. For the
complete and annotated workflow used to create this function, see
<code>vignettes/051_maxent_workflow</code>.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># output directory</span></span>
<span><span class="va">mypath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     <span class="st">"maxent/models/slf_global_v3"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/compute_MaxEnt_summary_statistics_CV.html">compute_MaxEnt_summary_statistics_CV</a></span><span class="op">(</span></span>
<span>  model.obj <span class="op">=</span> <span class="va">global_model</span>, </span>
<span>  model.name <span class="op">=</span> <span class="st">"global"</span>, </span>
<span>  mypath <span class="op">=</span> <span class="va">mypath</span>, </span>
<span>  create.dir <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># create subdirectory</span></span>
<span>  env.covar.obj <span class="op">=</span> <span class="va">x_global_hist_env_covariates</span>, <span class="co"># env covariates raster stacked</span></span>
<span>  train.obj <span class="op">=</span> <span class="va">global_train</span>, <span class="co"># training data used to create model</span></span>
<span>  trainFolds.obj <span class="op">=</span> <span class="va">global_trainFolds</span>,  <span class="co"># k-folds of training data</span></span>
<span>  test.obj <span class="op">=</span> <span class="va">global_test</span>, <span class="co"># data you wish to use to test the model</span></span>
<span>  jk.test.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"train"</span>, <span class="st">"test"</span><span class="op">)</span>, <span class="co"># types of jackknife curves to be created</span></span>
<span>  plot.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cloglog"</span>, <span class="st">"logistic"</span><span class="op">)</span> <span class="co"># types of univariate and marginal response curves to be created</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>I will now save the results from the model tuning that I performed a
few chunks ago, because I have created the directory for these model
results. I will also save the gridded tuning result figures manually
from the Viewer pane to the model directory folder that was created
using <code><a href="../reference/compute_MaxEnt_summary_statistics_CV.html">compute_MaxEnt_summary_statistics_CV()</a></code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save gridsearch interactive tables from Viewer pane</span></span>
<span></span>
<span><span class="co"># save df results of model tuning</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">global_model_tuned_auc</span><span class="op">@</span><span class="va">results</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_model_tuning_auc_results.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">global_model_tuned_tss</span><span class="op">@</span><span class="va">results</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_model_tuning_tss_results.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save tuned models</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span><span class="va">global_model_tuned_auc</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_model_tuned_auc.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span><span class="va">global_model_tuned_tss</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_model_tuned_tss.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="create-outputs-for-analysis">3. Create Outputs for Analysis<a class="anchor" aria-label="anchor" href="#create-outputs-for-analysis"></a>
</h2>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mypath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     <span class="st">"maxent/models/slf_global_v3"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">global_model</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_model.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="create-suitability-maps--mean-and-thresholded">3.1 Create suitability maps- mean and thresholded<a class="anchor" aria-label="anchor" href="#create-suitability-maps--mean-and-thresholded"></a>
</h3>
<p>I will use the <code>SDMtune::predict()</code> function to predict
the suitability for the range of interest. I will threshold the map by
the <code>MTP</code>, <code>MTSS</code> and <code>10_percentile</code>
thresholds. The workflow for this application will use my function
<code><a href="../reference/create_MaxEnt_suitability_maps_CV.html">create_MaxEnt_suitability_maps_CV()</a></code>.</p>
<p>I will take the above map and reclassify it so that areas that aren’t
suitable are more obvious. I will use the <code>MTSS</code> (maximum
training sensitivity plus specificity threshold), as this threshold is
one of the most rigorous available. It maximizes the TSS, a threshold
dependent goodness of fit metric and has been shown to perform well and
produce consistent predictions for presence-only methods (Liu et al,
2013; Liu et al, 2016). I will also use the <code>MTP</code> (minimum
training presence) and <code>10_percentile</code> (10 percentile
training threshold) thresholds. These thresholds represent a continuum
of training data exclusion. The <code>MTP</code> threshold does not
exclude any data and assumes confidence in the validity of the training
data, making the most conservative predictions (the largest suitable
range for invasive species) The <code>10_percentile</code> threshold
excludes the top 10% of suitable training samples, which would be more
appropriate if I have less confidence in my training data. Finally, the
<code>MTSS</code> threshold maximizes the sensitivity (the likelihood of
detecting a true positive) (Maryam Bordkhani (n.d.)).</p>
<p>I will retrieve the specific value for the MTSS threshold for this
model and use it to define a what is considered unsuitable in this
raster. Then, I will reclassify the mean raster so that anything below
this threshold is now “unsuitable”. I will use the mean cloglog
threshold for all iterations. I will create a binary version of the mean
raster, with unsuitable regions (below the MTSS training threshold) as
0, and those above the threshold as 1. Then, I can reclassify averaged
raster of MaxEnt predictions. I will load in the averaged prediction for
this model and reclassify the raster using a temporary raster layer that
I will create. This raster will only have values where the model
predicts the climate to be unsuitable, so that it can be plotted overtop
the averaged raster to mask unsuitable areas.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/create_MaxEnt_suitability_maps_CV.html">create_MaxEnt_suitability_maps_CV</a></span><span class="op">(</span></span>
<span>  model.obj <span class="op">=</span> <span class="va">global_model</span>,</span>
<span>  model.name <span class="op">=</span> <span class="st">"global"</span>, </span>
<span>  mypath <span class="op">=</span> <span class="va">mypath</span>, </span>
<span>  create.dir <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>  env.covar.obj <span class="op">=</span> <span class="va">x_global_hist_env_covariates</span>, </span>
<span>  describe.proj <span class="op">=</span> <span class="st">"globe_1981-2010"</span>, <span class="co"># name of area or time period projected to</span></span>
<span>  clamp.pred <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  thresh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MTP"</span>, <span class="st">"MTSS"</span><span class="op">)</span>,</span>
<span>  map.thresh <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># whether thresholded versions of these maps should be created</span></span>
<span>  map.thresh.extra <span class="op">=</span> <span class="st">"MTP"</span>, <span class="co"># whether an added underlayer threshold should be plotted (MTP plotted under MTSS)</span></span>
<span>  summary.file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_summary_all_iterations.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>I will also create suitability maps for each of the projected
2041-2070 climate change scenarios.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/create_MaxEnt_suitability_maps_CV.html">create_MaxEnt_suitability_maps_CV</a></span><span class="op">(</span></span>
<span>  model.obj <span class="op">=</span> <span class="va">global_model</span>,</span>
<span>  model.name <span class="op">=</span> <span class="st">"global"</span>, </span>
<span>  mypath <span class="op">=</span> <span class="va">mypath</span>, </span>
<span>  create.dir <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>  env.covar.obj <span class="op">=</span> <span class="va">x_global_126_env_covariates</span>, </span>
<span>  describe.proj <span class="op">=</span> <span class="st">"globe_2041-2070_GFDL_ssp126"</span>, <span class="co"># name of area or time period projected to</span></span>
<span>  clamp.pred <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  thresh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MTP"</span>, <span class="st">"MTSS"</span><span class="op">)</span>,</span>
<span>  map.thresh <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># whether thresholded versions of these maps should be created</span></span>
<span>  map.thresh.extra <span class="op">=</span> <span class="st">"MTP"</span>,</span>
<span>  summary.file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_summary_all_iterations.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/create_MaxEnt_suitability_maps_CV.html">create_MaxEnt_suitability_maps_CV</a></span><span class="op">(</span></span>
<span>  model.obj <span class="op">=</span> <span class="va">global_model</span>,</span>
<span>  model.name <span class="op">=</span> <span class="st">"global"</span>, </span>
<span>  mypath <span class="op">=</span> <span class="va">mypath</span>, </span>
<span>  create.dir <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>  env.covar.obj <span class="op">=</span> <span class="va">x_global_370_env_covariates</span>, </span>
<span>  describe.proj <span class="op">=</span> <span class="st">"globe_2041-2070_GFDL_ssp370"</span>, <span class="co"># name of area or time period projected to</span></span>
<span>  clamp.pred <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  thresh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MTP"</span>, <span class="st">"MTSS"</span><span class="op">)</span>,</span>
<span>  map.thresh <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># whether thresholded versions of these maps should be created</span></span>
<span>  map.thresh.extra <span class="op">=</span> <span class="st">"MTP"</span>,</span>
<span>  summary.file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_summary_all_iterations.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/create_MaxEnt_suitability_maps_CV.html">create_MaxEnt_suitability_maps_CV</a></span><span class="op">(</span></span>
<span>  model.obj <span class="op">=</span> <span class="va">global_model</span>,</span>
<span>  model.name <span class="op">=</span> <span class="st">"global"</span>, </span>
<span>  mypath <span class="op">=</span> <span class="va">mypath</span>, </span>
<span>  create.dir <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>  env.covar.obj <span class="op">=</span> <span class="va">x_global_585_env_covariates</span>, </span>
<span>  describe.proj <span class="op">=</span> <span class="st">"globe_2041-2070_GFDL_ssp585"</span>, <span class="co"># name of area or time period projected to</span></span>
<span>  clamp.pred <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  thresh <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"MTP"</span>, <span class="st">"MTSS"</span><span class="op">)</span>,</span>
<span>  map.thresh <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># whether thresholded versions of these maps should be created</span></span>
<span>  map.thresh.extra <span class="op">=</span> <span class="st">"MTP"</span>,</span>
<span>  summary.file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_summary_all_iterations.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="predict-suitability-for-known-slf-presences">3.2 Predict suitability for known SLF presences<a class="anchor" aria-label="anchor" href="#predict-suitability-for-known-slf-presences"></a>
</h3>
<p>I will get projected suitability values, calculated on the cloglog
scale (between 0 and 1) for each of the known SLF populations I used as
input data for my models. These suitability values will be added back to
the original data frame and saved. The workflow for this application
will use my function <code><a href="../reference/predict_xy_suitability_CV.html">predict_xy_suitability_CV()</a></code>. This
function extracts covariate data from each data point and then uses the
model object to predict the suitability for SLF establishment at that
location based on the climate variables. This function has two modes for
predicting the suitability: simple and buffered. I will use simple (the
suitability at that exact point) for the location of SLF
populations.</p>
<p>Later in my analysis, I will use these point-wise suitability
predictions to create a scatter plot in the global vs regional
models.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mypath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     <span class="st">"maxent/models/slf_global_v3"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># slf presence data</span></span>
<span><span class="va">slf_presences</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"slf_all_coords_final_2024-08-05.csv"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">species</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/predict_xy_suitability_CV.html">predict_xy_suitability_CV</a></span><span class="op">(</span></span>
<span>  xy.obj <span class="op">=</span> <span class="va">slf_presences</span>,</span>
<span>  xy.type <span class="op">=</span> <span class="st">"Lycorma delicatula"</span>,</span>
<span>  env.covar.obj <span class="op">=</span> <span class="va">x_global_hist_env_covariates</span>,</span>
<span>  model.obj <span class="op">=</span> <span class="va">global_model</span>,</span>
<span>  mypath <span class="op">=</span> <span class="va">mypath</span>,</span>
<span>  clamp.pred <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># clamp predictions</span></span>
<span>  predict.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cloglog"</span>, <span class="st">"logistic"</span><span class="op">)</span>,</span>
<span>  output.name <span class="op">=</span> <span class="st">"global_slf_all_coords_1981-2010"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>I will repeat the same process for the CMIP6 data.</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/predict_xy_suitability_CV.html">predict_xy_suitability_CV</a></span><span class="op">(</span></span>
<span>  xy.obj <span class="op">=</span> <span class="va">slf_presences</span>,</span>
<span>  xy.type <span class="op">=</span> <span class="st">"Lycorma delicatula"</span>,</span>
<span>  env.covar.obj <span class="op">=</span> <span class="va">x_global_126_env_covariates</span>,</span>
<span>  model.obj <span class="op">=</span> <span class="va">global_model</span>,</span>
<span>  mypath <span class="op">=</span> <span class="va">mypath</span>,</span>
<span>  clamp.pred <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  predict.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cloglog"</span>, <span class="st">"logistic"</span><span class="op">)</span>,</span>
<span>  output.name <span class="op">=</span> <span class="st">"global_slf_all_coords_2041-2070_GFDL_ssp126"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/predict_xy_suitability_CV.html">predict_xy_suitability_CV</a></span><span class="op">(</span></span>
<span>  xy.obj <span class="op">=</span> <span class="va">slf_presences</span>,</span>
<span>  xy.type <span class="op">=</span> <span class="st">"Lycorma delicatula"</span>,</span>
<span>  env.covar.obj <span class="op">=</span> <span class="va">x_global_370_env_covariates</span>,</span>
<span>  model.obj <span class="op">=</span> <span class="va">global_model</span>,</span>
<span>  mypath <span class="op">=</span> <span class="va">mypath</span>,</span>
<span>  clamp.pred <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  predict.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cloglog"</span>, <span class="st">"logistic"</span><span class="op">)</span>,</span>
<span>  output.name <span class="op">=</span> <span class="st">"global_slf_all_coords_2041-2070_GFDL_ssp370"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/predict_xy_suitability_CV.html">predict_xy_suitability_CV</a></span><span class="op">(</span></span>
<span>  xy.obj <span class="op">=</span> <span class="va">slf_presences</span>,</span>
<span>  xy.type <span class="op">=</span> <span class="st">"Lycorma delicatula"</span>,</span>
<span>  env.covar.obj <span class="op">=</span> <span class="va">x_global_585_env_covariates</span>,</span>
<span>  model.obj <span class="op">=</span> <span class="va">global_model</span>,</span>
<span>  mypath <span class="op">=</span> <span class="va">mypath</span>,</span>
<span>  clamp.pred <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  predict.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cloglog"</span>, <span class="st">"logistic"</span><span class="op">)</span>,</span>
<span>  output.name <span class="op">=</span> <span class="st">"global_slf_all_coords_2041-2070_GFDL_ssp585"</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="predict-suibability-for-ivr-regions">3.3 Predict suibability for IVR regions<a class="anchor" aria-label="anchor" href="#predict-suibability-for-ivr-regions"></a>
</h3>
<p>I will perform the same action as above, but for the locations of
over 1,000 important wineries around the world. I will use the buffered
method of predicting suitability for this application. The buffered
method creates a buffer zone around the point and considers all values
within that buffer for predicting suitability. This is important because
these points represent regions that are important to viticulture and are
not exact geospatial coordinates, but are likely mapped to the centroid
of areas with vast expanses of vineyards. So, using a buffer zone
accounts for this lack of exact coordinates. I will take this maximum
value from this buffer, but the mean, minimum and others can be used as
well. I will use a buffer radial distance of 20,000m (the default, 20km)
because the resolution of the predictions is at 10km, so this distance
considers the two surrounding cells on any side.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mypath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     <span class="st">"maxent/models/slf_global_v3"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load in all IVR points</span></span>
<span><span class="fu"><a href="https://rstudio.github.io/renv/reference/load.html" class="external-link">load</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"wineries.rda"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">IVR_regions</span> <span class="op">&lt;-</span> <span class="va">wineries</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/predict_xy_suitability_CV.html">predict_xy_suitability_CV</a></span><span class="op">(</span></span>
<span>  xy.obj <span class="op">=</span> <span class="va">IVR_regions</span>,</span>
<span>  xy.type <span class="op">=</span> <span class="st">"IVR regions"</span>,</span>
<span>  env.covar.obj <span class="op">=</span> <span class="va">x_global_hist_env_covariates</span>,</span>
<span>  model.obj <span class="op">=</span> <span class="va">global_model</span>,</span>
<span>  mypath <span class="op">=</span> <span class="va">mypath</span>,</span>
<span>  clamp.pred <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  predict.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cloglog"</span>, <span class="st">"logistic"</span><span class="op">)</span>,</span>
<span>  output.name <span class="op">=</span> <span class="st">"global_wineries_1981-2010"</span>,</span>
<span>  <span class="co"># buffer</span></span>
<span>  buffer.pred <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>I will repeat the same process for the CMIP6 data.</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/predict_xy_suitability_CV.html">predict_xy_suitability_CV</a></span><span class="op">(</span></span>
<span>  xy.obj <span class="op">=</span> <span class="va">IVR_regions</span>,</span>
<span>  xy.type <span class="op">=</span> <span class="st">"IVR regions"</span>,</span>
<span>  env.covar.obj <span class="op">=</span> <span class="va">x_global_126_env_covariates</span>,</span>
<span>  model.obj <span class="op">=</span> <span class="va">global_model</span>,</span>
<span>  mypath <span class="op">=</span> <span class="va">mypath</span>,</span>
<span>  clamp.pred <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  predict.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cloglog"</span>, <span class="st">"logistic"</span><span class="op">)</span>,</span>
<span>  output.name <span class="op">=</span> <span class="st">"global_wineries_2041-2070_GFDL_ssp126"</span>,</span>
<span>  buffer.pred <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/predict_xy_suitability_CV.html">predict_xy_suitability_CV</a></span><span class="op">(</span></span>
<span>  xy.obj <span class="op">=</span> <span class="va">IVR_regions</span>,</span>
<span>  xy.type <span class="op">=</span> <span class="st">"IVR regions"</span>,</span>
<span>  env.covar.obj <span class="op">=</span> <span class="va">x_global_370_env_covariates</span>,</span>
<span>  model.obj <span class="op">=</span> <span class="va">global_model</span>,</span>
<span>  mypath <span class="op">=</span> <span class="va">mypath</span>,</span>
<span>  clamp.pred <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  predict.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cloglog"</span>, <span class="st">"logistic"</span><span class="op">)</span>,</span>
<span>  output.name <span class="op">=</span> <span class="st">"global_wineries_2041-2070_GFDL_ssp370"</span>,</span>
<span>  buffer.pred <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">scari</span><span class="fu">::</span><span class="fu"><a href="../reference/predict_xy_suitability_CV.html">predict_xy_suitability_CV</a></span><span class="op">(</span></span>
<span>  xy.obj <span class="op">=</span> <span class="va">IVR_regions</span>,</span>
<span>  xy.type <span class="op">=</span> <span class="st">"IVR regions"</span>,</span>
<span>  env.covar.obj <span class="op">=</span> <span class="va">x_global_585_env_covariates</span>,</span>
<span>  model.obj <span class="op">=</span> <span class="va">global_model</span>,</span>
<span>  mypath <span class="op">=</span> <span class="va">mypath</span>,</span>
<span>  clamp.pred <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  predict.type <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cloglog"</span>, <span class="st">"logistic"</span><span class="op">)</span>,</span>
<span>  output.name <span class="op">=</span> <span class="st">"global_wineries_2041-2070_GFDL_ssp585"</span>,</span>
<span>  buffer.pred <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now I have all of the outputs I need from the global model! These
outputs will be used in comparison with the regional version of their
time period to analyze the realized regional niche for SLF at multiple
spatial scales. These will be used to make inferences about the impacts
of climate change on suitability for SLF.</p>
<p>In the next vignette, I will set up for training each of the 3
regional models.</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary_global</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_summary_all_iterations.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span><span class="va">summary_global</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"global_summary_all_iterations_v3.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="take-mean-of-ssp-scenario-predictions">4. Take mean of ssp scenario predictions<a class="anchor" aria-label="anchor" href="#take-mean-of-ssp-scenario-predictions"></a>
</h2>
<p>I will load the three ssp scenario rasters I just created back into R
and will take a mean of those rasters for my predictions step later
downstream.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ssp 126</span></span>
<span><span class="va">pred_global_2055_126</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_pred_suit_clamped_cloglog_globe_2041-2070_GFDL_ssp126_mean.asc"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># ssp 370</span></span>
<span><span class="va">pred_global_2055_370</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_pred_suit_clamped_cloglog_globe_2041-2070_GFDL_ssp370_mean.asc"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># ssp 585</span></span>
<span><span class="va">pred_global_2055_585</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_pred_suit_clamped_cloglog_globe_2041-2070_GFDL_ssp585_mean.asc"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pred_global_2055_stack</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">pred_global_2055_126</span>, <span class="va">pred_global_2055_370</span>, <span class="va">pred_global_2055_585</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># apply mean between layers</span></span>
<span><span class="va">pred_global_2055_mean</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/app.html" class="external-link">app</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">pred_global_2055_stack</span>,</span>
<span>  fun <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>  filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_pred_suit_clamped_cloglog_globe_2041-2070_GFDL_ssp_averaged.asc"</span><span class="op">)</span>,</span>
<span>  filetype <span class="op">=</span> <span class="st">"AAIGrid"</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Elith, J., Phillips, S. J., Hastie, T., Dudík, M., Chee, Y. E.,
&amp; Yates, C. J. (2011). A statistical explanation of MaxEnt for
ecologists: Statistical explanation of MaxEnt. Diversity and
Distributions, 17(1), 43–57. <a href="https://doi.org/10.1111/j.1472-4642.2010.00725.x" class="external-link uri">https://doi.org/10.1111/j.1472-4642.2010.00725.x</a></p></li>
<li><p>Feng, X. (2022). Shandongfx/nimbios_enm [HTML]. <a href="https://github.com/shandongfx/nimbios_enm" class="external-link uri">https://github.com/shandongfx/nimbios_enm</a> (Original work
published 2018).</p></li>
<li><p>Gallien, L., Douzet, R., Pratte, S., Zimmermann, N. E., &amp;
Thuiller, W. (2012). Invasive species distribution models – how
violating the equilibrium assumption can create new insights. Global
Ecology and Biogeography, 21(11), 1126–1136. <a href="https://doi.org/10.1111/j.1466-8238.2012.00768.x" class="external-link uri">https://doi.org/10.1111/j.1466-8238.2012.00768.x</a></p></li>
<li><p>Liu, C., Newell, G., &amp; White, M. (2016). On the selection of
thresholds for predicting species occurrence with presence-only data.
Ecology and Evolution, 6(1), 337–348. <a href="https://doi.org/10.1002/ece3.1878" class="external-link uri">https://doi.org/10.1002/ece3.1878</a></p></li>
<li><p>Liu, C., White, M., &amp; Newell, G. (2013). Selecting thresholds
for the prediction of species occurrence with presence-only data.
Journal of Biogeography, 40(4), 778–789. <a href="https://doi.org/10.1111/jbi.12058" class="external-link uri">https://doi.org/10.1111/jbi.12058</a></p></li>
<li><p>Maryam Bordkhani. (n.d.). Threshold rule [Online post].</p></li>
<li><p>Radosavljevic, A., &amp; Anderson, R. P. (2014). Making better
Maxent models of species distributions: Complexity, overfitting and
evaluation. Journal of Biogeography, 41(4), 629–643. <a href="https://doi.org/10.1111/jbi.12227" class="external-link uri">https://doi.org/10.1111/jbi.12227</a></p></li>
<li><p>Phillips, S. J., Anderson, R. P., &amp; Schapire, R. E. (2006).
Maximum entropy modeling of species geographic distributions. Ecological
Modelling, 190(3), 231–259. <a href="https://doi.org/10.1016/j.ecolmodel.2005.03.026" class="external-link uri">https://doi.org/10.1016/j.ecolmodel.2005.03.026</a></p></li>
<li><p>Steven Phillips. (2017). A Brief Tutorial on Maxent. <a href="http://biodiversityinformatics.amnh.org/open_source/maxent/" class="external-link uri">http://biodiversityinformatics.amnh.org/open_source/maxent/</a>.</p></li>
<li><p>Steven J. Phillips, Miroslav Dudík, &amp; Robert E. Schapire.
(2023). Maxent software for modeling species niches and distributions
(Version 3.4.3 (Java)) [Computer software]. <a href="http://biodiversityinformatics.amnh.org/open_source/maxent/" class="external-link uri">http://biodiversityinformatics.amnh.org/open_source/maxent/</a>.</p></li>
<li><p>Srivastava, V., Roe, A. D., Keena, M. A., Hamelin, R. C., &amp;
Griess, V. C. (2021). Oh the places they’ll go: Improving species
distribution modelling for invasive forest pests in an uncertain world.
Biological Invasions, 23(1), 297–349. <a href="https://doi.org/10.1007/s10530-020-02372-9" class="external-link uri">https://doi.org/10.1007/s10530-020-02372-9</a></p></li>
<li><p>Valavi, R., Elith, J., Lahoz-Monfort, J. J., &amp;
Guillera-Arroita, G. (2019). blockCV: An r package for generating
spatially or environmentally separated folds for k-fold cross-validation
of species distribution models. Methods in Ecology and Evolution, 10(2),
225–232. <a href="https://doi.org/10.1111/2041-210X.13107" class="external-link uri">https://doi.org/10.1111/2041-210X.13107</a></p></li>
<li><p>VanDerWal, J., Shoo, L. P., Graham, C., &amp; Williams, S. E.
(2009). Selecting pseudo-absence data for presence-only distribution
modeling: How far should you stray from what you know? Ecological
Modelling, 220(4), 589–594. <a href="https://doi.org/10.1016/j.ecolmodel.2008.11.010" class="external-link uri">https://doi.org/10.1016/j.ecolmodel.2008.11.010</a></p></li>
<li><p>Vignali, S., Barras, A. G., Arlettaz, R., &amp; Braunisch, V.
(2020). SDMtune: An R package to tune and evaluate species distribution
models. Ecology and Evolution, 10(20), 11488–11506. <a href="https://doi.org/10.1002/ece3.6786" class="external-link uri">https://doi.org/10.1002/ece3.6786</a></p></li>
</ol>
</div>
<div class="section level2">
<h2 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<div class="section level3">
<h3 id="attempt-at-spatially-and-environmentally-blocked-cross-validation">Attempt at Spatially and environmentally Blocked
Cross-validation<a class="anchor" aria-label="anchor" href="#attempt-at-spatially-and-environmentally-blocked-cross-validation"></a>
</h3>
<p>I attempted this method because of the body of literature that says
blocked cross validation is more rigorous than random CV. Blocked CV
results is more spatially separated training and testing data, which
prevents autocorrelation within the environmental covariates. However,
this method did not work because of the combination of the scale of the
covariates and the comparatively narrow range of SLF presences. The
global scale of analysis means that the block size needs to be quite
large (about 1.5 million meters) to reduce spatial autocorrelation
between the training points. The narrow spread of presence points in
comparison means that not every blocked CV group (out of 10) received
test presences and some had no test points. I also tried this with 5
groups, but point distributions were still not ideal.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#presences</span></span>
<span><span class="va">global_presences_with_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"global_slf_presences_with_data_v3.csv"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># add presence/absence column</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pa <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># background points</span></span>
<span><span class="va">global_background_with_data</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"global_background_points_with_data_v3.csv"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>pa <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># join</span></span>
<span><span class="va">global_all_points_with_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">global_presences_with_data</span>, <span class="va">global_background_with_data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span></code></pre></div>
<p>First, check spatial autocorrelation level. This determines the
appropriate block size to prevent spatial autocorrelation.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set seed for consistency of random sampling</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># take spatial autocorrelation distance</span></span>
<span><span class="va">spatial_autocor</span> <span class="op">&lt;-</span> <span class="fu">blockCV</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/blockCV/man/cv_spatial_autocor.html" class="external-link">cv_spatial_autocor</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">global_all_points_with_data</span>,</span>
<span>  column <span class="op">=</span> <span class="st">"pa"</span>,</span>
<span>  plot <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">spatial_autocor</span><span class="op">$</span><span class="va">range</span></span>
<span><span class="va">spatial_autocor</span><span class="op">$</span><span class="va">plots</span></span>
<span></span>
<span><span class="co"># OLD METHOD</span></span>
<span><span class="co"># convert to a Lambert projection because variograms do not work with lat/long projections</span></span>
<span><span class="co"># using EPSG:9834, Lambert Cylindrical Equal Area (Spherical)</span></span>
<span><span class="co">#global_raster &lt;- terra::project(x = x_global_hist_env_covariates, y = "EPSG:9834", method = "bilinear", threads = TRUE)</span></span>
<span><span class="co"># test for spatial autocorrelation distance</span></span>
<span><span class="co">#spatial_autocor &lt;- blockCV::cv_spatial_autocor(</span></span>
<span><span class="co">#  r = global_raster,</span></span>
<span><span class="co">#  num_sample = 20000, # quadrupled from default due to raster size</span></span>
<span><span class="co">#  plot = TRUE,</span></span>
<span><span class="co">#  progress = TRUE</span></span>
<span><span class="co">#)</span></span></code></pre></div>
<p>The range of spatial autocorrelation is estimated at 2,263,953 meters
for the presence/absence data I am using to build the model. I will also
use an interactive tool to visualize block size based on pa data.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">blockCV</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/blockCV/man/cv_block_size.html" class="external-link">cv_block_size</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">global_all_points_with_data</span>,</span>
<span>  column <span class="op">=</span> <span class="st">"pa"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>I will go ahead and use the 2.25 million meter distance for the
spatial blocks.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">global_folds</span> <span class="op">&lt;-</span> <span class="fu">blockCV</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/blockCV/man/cv_spatial.html" class="external-link">cv_spatial</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">global_all_points_with_data</span>,</span>
<span>  column <span class="op">=</span> <span class="st">"pa"</span>,</span>
<span>  r <span class="op">=</span> <span class="va">x_global_hist_env_covariates</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  size <span class="op">=</span> <span class="fl">2263953</span>,</span>
<span>  hexagon <span class="op">=</span> <span class="cn">FALSE</span>, <span class="co"># I am pretty sure the function used to calculate the autocorrelation distance used square blocks</span></span>
<span>  selection <span class="op">=</span> <span class="st">"random"</span>,</span>
<span>  iteration <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  report <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/View.html" class="external-link">View</a></span><span class="op">(</span><span class="va">global_folds</span><span class="op">$</span><span class="va">folds_list</span><span class="op">)</span></span>
<span><span class="co"># this fold list contains each block </span></span>
<span><span class="va">global_folds</span><span class="op">$</span><span class="va">records</span></span>
<span></span>
<span><span class="fu">blockCV</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/blockCV/man/cv_plot.html" class="external-link">cv_plot</a></span><span class="op">(</span></span>
<span>  cv <span class="op">=</span> <span class="va">global_folds</span>,</span>
<span>  r <span class="op">=</span> <span class="va">x_global_hist_env_covariates</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>This method did not work because about 5 test folds out of 10
received 0 test points. The spread of the presences seems too narrow for
each fold to receive adequate training and test presences. I will also
try a spatial clustering algorithm.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">global_folds</span> <span class="op">&lt;-</span> <span class="fu">blockCV</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/blockCV/man/cv_cluster.html" class="external-link">cv_cluster</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">global_all_points_with_data</span>,</span>
<span>  column <span class="op">=</span> <span class="st">"pa"</span>,</span>
<span>  k <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  r <span class="op">=</span> <span class="va">x_global_hist_env_covariates</span>,</span>
<span>  scale <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  raster_cluster <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  report <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Clustering based on distance also did not put test presences in each
fold (some had 0), so the blocked CV method will not be used and I will
revert to k-fold random CV.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Samuel M. Owens, Matthew R. Helmus.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
