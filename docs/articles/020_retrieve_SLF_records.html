<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>SLF occurrence records: GBIF, lydemapR, literature • slfSpread</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="SLF occurrence records: GBIF, lydemapR, literature"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="default" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">slfSpread</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/slfSpread.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Quantify risk to specific viticultural regions</h6></li>
    <li><a class="dropdown-item" href="../articles/150_create_risk_report.html">Example usage of create_risk_report() to create reports of key viticultural areas</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Initialize slfSpread</h6></li>
    <li><a class="dropdown-item" href="../articles/010_initialize_pkg.html">Initialization of renv package for dependencies</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>1. Retrieve and tidy input data for MaxEnt</h6></li>
    <li><a class="dropdown-item" href="../articles/020_retrieve_SLF_records.html">SLF occurrence records: GBIF, lydemapR, literature</a></li>
    <li><a class="dropdown-item" href="../articles/030_retrieve_bioclim_variables.html">Bioclim variable rasters: CHELSA</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>2. SDM modeling pipeline</h6></li>
    <li><a class="dropdown-item" href="../articles/040_setup_global_MaxEnt_model.html">Setup for global-scale MaxEnt model</a></li>
    <li><a class="dropdown-item" href="../articles/050_run_global_MaxEnt_model.html">Run global-scale MaxEnt model</a></li>
    <li><a class="dropdown-item" href="../articles/060_setup_regional_MaxEnt_models.html">Setup for regional-scale MaxEnt models</a></li>
    <li><a class="dropdown-item" href="../articles/070_run_regional_invaded_MaxEnt_model.html">Run 'Ri.NAmerica' model trained on SLF invaded region in North America</a></li>
    <li><a class="dropdown-item" href="../articles/080_run_regional_invaded_asian_MaxEnt_model.html">Run 'Ri.Asia' model trained on SLF invaded range in Japan and South Korea</a></li>
    <li><a class="dropdown-item" href="../articles/090_run_regional_native_MaxEnt_model.html">Run 'Rn' model trained on SLF native range in east Asia</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>3. Ensemble Regional-scale SDMs</h6></li>
    <li><a class="dropdown-item" href="../articles/100_run_ExDet_MIC.html">Run an Extrapolation Detection (NT2) analysis and calculate MIC</a></li>
    <li><a class="dropdown-item" href="../articles/110_ensemble_regional_models.html">Ensemble regional-scale models using a weighted mean</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>4. Quantify SLF risk and model fit</h6></li>
    <li><a class="dropdown-item" href="../articles/120_create_suitability_maps.html">Create risk maps of each model scale and intersect predictions</a></li>
    <li><a class="dropdown-item" href="../articles/130_create_suitability_xy_plots_viticultural.html">Plot shift in SLF risk to important viticultural regions under climate change</a></li>
    <li><a class="dropdown-item" href="../articles/131_create_suitability_xy_plots_SLF.html">Infer stability of known SLF populations due climate change effects</a></li>
    <li><a class="dropdown-item" href="../articles/140_plot_response_curves.html">Analyze biological realism of model response curves</a></li>
    <li><a class="dropdown-item" href="../articles/141_plot_AUC_var_cont.html">Check model goodness of fit via AUC, TSS and confusion matrices</a></li>
    <li><a class="dropdown-item" href="../articles/142_calculate_model_fit.html">Calculate model fit using confusion matrices</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ieco-lab/slfSpread/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>SLF occurrence records: GBIF, lydemapR, literature</h1>
                        <h4 data-toc-skip class="author">Samuel M.
Owens<a href="#fn1" class="footnote-ref"
id="fnref1"><sup>1</sup></a></h4>
            
            <h4 data-toc-skip class="date">2024-08-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ieco-lab/slfSpread/blob/HEAD/vignettes/020_retrieve_SLF_records.Rmd" class="external-link"><code>vignettes/020_retrieve_SLF_records.Rmd</code></a></small>
      <div class="d-none name"><code>020_retrieve_SLF_records.Rmd</code></div>
    </div>

    
    
<div id="overview" class="section level1">
<h1>Overview</h1>
<p>This vignette will provide instructions to retrieve <em>Lycorma
delicatula</em> (SLF) presence records for the future creation of MaxEnt
models. MaxEnt is a presence-only modeling software, and so it does not
require recorded absence data to predict the suitable area for SLF. Four
categories of data sources will be used in this analysis: <a
href="https://www.gbif.org/">GBIF</a> (Global Biodiversity Information
Facility), <a href="https://github.com/ieco-lab/lydemapr">lydemapR</a>,
various pieces of peer-reviewed literature, and natural history notes.
These data will then be tidied, spatially thinned and compiled into a
single <code>.rds</code> file of SLF presence records that can be loaded
into MaxEnt.</p>
<p>The first step will be to retrieve data from <code>GBIF</code> and
<code>lydemapR</code>. <code>GBIF</code> is an open-access platform for
biodiversity data that gathers from various databases and citizen
science platforms. Data from this source represents globally distributed
presences of SLF. The <code>lyde()</code> function within the
<code>Lydemapr</code> package gives access to nearly one million SLF
presence records within the United States, largely obtained from
biological field surveys by various state and federal departments of
agriculture.</p>
<p>These data will need to be cleaned and tidied during this step. To
get to this tidy dataset, the data will be checked for inconsistent and
false records. The data will also be spatially thinned so that points
are no less than 10km (the resolution of the climate data, 5 arcminutes)
to eliminate the effects of sampling bias.</p>
<p>The second step will be to combine these records with data gathered
from peer-reviewed literature and from natural history notes. A majority
of these records are from established populations of SLF within China,
South Korea and southeast Asia. These records are especially important
because China and southeast Asia represent the native range for SLF, and
there is very little data on the extent of its native range. These
records are also important because MaxEnt correlates presence records
with the local climate; thus, if there is very little characterization
of the native range for this species, it is unlikely that models for SLF
will make realistic predictions for its potential niche elsewhere.</p>
<p>The final step of this analysis will be to organize the different
datasets into a single <code>.rds</code> file that can be loaded into
MaxEnt. MaxEnt requires that input datasets contain only 3 columns, in
this order: <code>species</code> (the scientific name of the species),
<code>x</code> (longitude), and <code>y</code> (latitude). Lastly, the
data will go through a second round of spatial thinning now that the
datasets have been joined.</p>
<p>Note, many of these chunks require high memory allocation or simply
take a long time to run. The chunks that use
<code>humboldt::humboldt.occ.rarefy()</code> for spatial thinning will
take a very long time to run. The chunks that use
<code>spThin::thin()</code> require a high memory allocation.</p>
</div>
<div id="setup" class="section level1">
<h1>Setup</h1>
<p>First, I will load in the necessary packages.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)  <span class="co">#data manipulation</span></span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(here) <span class="co">#making directory pathways easier on different instances</span></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="co"># here() is set at the root folder of this package</span></span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(devtools) <span class="co"># installing packages not from CRAN</span></span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="co"># devtools::install_github(&quot;ieco-lab/lydemapr&quot;, build_vignettes = FALSE)</span></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="fu">library</span>(lydemapr) <span class="co"># field survey data for SLF</span></span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a><span class="fu">library</span>(rgbif) <span class="co">#query gbif and format as a dataframe</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a><span class="fu">library</span>(spThin) <span class="co"># spatial thinning of occurrence points</span></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="co"># remotes::install_github(&quot;jasonleebrown/humboldt&quot;)</span></span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a><span class="co"># library(humboldt) # spatial thinning of points</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a><span class="do">## this package is used but we will be retiring it soon as part of an update, # out for now</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a><span class="fu">library</span>(CoordinateCleaner) <span class="co"># tidying of points</span></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co">#nice plots</span></span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a><span class="fu">library</span>(knitr) <span class="co"># nice rmd tables</span></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a></span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="fu">library</span>(rnaturalearth)</span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a><span class="co"># remotes::install_github(&quot;ropensci/rnaturalearthhires&quot;)</span></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="co"># library(rnaturalearthhires)</span></span></code></pre></div>
<p><strong>Note:</strong> I will be setting the global options of this
document so that only certain code chunks are rendered in the final
.html file. I will set the <code>eval = FALSE</code> so that none of the
code is re-run (preventing files from being overwritten during knitting)
and will simply overwrite this in chunks with plots.</p>
<p>I will also download a world map for plotting the data I download
from GBIF and lydemapR. I will use the <code>rnaturalearth</code>
package to download a world map at a scale of 10m.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="co"># check which types of data are available</span></span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a><span class="co"># these are in the rnaturalearth package</span></span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">data</span>(df_layers_cultural) </span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co"># I will use states_provinces</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co"># get metadata</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a>ne_metadata <span class="ot">&lt;-</span> <span class="fu">ne_find_vector_data</span>(</span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a>  <span class="at">scale =</span> <span class="dv">10</span>,</span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a>  <span class="at">category =</span> <span class="st">&quot;cultural&quot;</span>,</span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a>  <span class="at">getmeta =</span> <span class="cn">TRUE</span></span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(layer <span class="sc">==</span> <span class="st">&quot;admin_0_countries&quot;</span>)</span>
<span id="cb2-13"><a href="#cb2-13" tabindex="-1"></a><span class="co"># URL to open metadata</span></span>
<span id="cb2-14"><a href="#cb2-14" tabindex="-1"></a>utils<span class="sc">::</span><span class="fu">browseURL</span>(ne_metadata[, <span class="dv">3</span>])</span>
<span id="cb2-15"><a href="#cb2-15" tabindex="-1"></a></span>
<span id="cb2-16"><a href="#cb2-16" tabindex="-1"></a><span class="co"># if the file isnt already downloaded, download it</span></span>
<span id="cb2-17"><a href="#cb2-17" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>, <span class="st">&quot;ne_countries&quot;</span>, <span class="st">&quot;ne_10m_admin_0_countries.shp&quot;</span>))) {</span>
<span id="cb2-18"><a href="#cb2-18" tabindex="-1"></a>  </span>
<span id="cb2-19"><a href="#cb2-19" tabindex="-1"></a>  countries_sf <span class="ot">&lt;-</span> rnaturalearth<span class="sc">::</span><span class="fu">ne_download</span>(</span>
<span id="cb2-20"><a href="#cb2-20" tabindex="-1"></a>    <span class="at">scale =</span> <span class="dv">10</span>, <span class="co"># highest resolution</span></span>
<span id="cb2-21"><a href="#cb2-21" tabindex="-1"></a>    <span class="at">type =</span> <span class="st">&quot;admin_0_countries&quot;</span>, <span class="co"># states and provinces</span></span>
<span id="cb2-22"><a href="#cb2-22" tabindex="-1"></a>    <span class="at">category =</span> <span class="st">&quot;cultural&quot;</span>,</span>
<span id="cb2-23"><a href="#cb2-23" tabindex="-1"></a>    <span class="at">destdir =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>, <span class="st">&quot;ne_countries&quot;</span>),</span>
<span id="cb2-24"><a href="#cb2-24" tabindex="-1"></a>    <span class="at">load =</span> <span class="cn">TRUE</span>, <span class="co"># load into environment</span></span>
<span id="cb2-25"><a href="#cb2-25" tabindex="-1"></a>    <span class="at">returnclass =</span> <span class="st">&quot;sf&quot;</span> <span class="co"># shapefile</span></span>
<span id="cb2-26"><a href="#cb2-26" tabindex="-1"></a>  )</span>
<span id="cb2-27"><a href="#cb2-27" tabindex="-1"></a>  </span>
<span id="cb2-28"><a href="#cb2-28" tabindex="-1"></a>  <span class="co"># else, just import</span></span>
<span id="cb2-29"><a href="#cb2-29" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb2-30"><a href="#cb2-30" tabindex="-1"></a>    </span>
<span id="cb2-31"><a href="#cb2-31" tabindex="-1"></a>    countries_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">read_sf</span>(<span class="at">dsn =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>, <span class="st">&quot;ne_countries&quot;</span>, <span class="st">&quot;ne_10m_admin_0_countries.shp&quot;</span>))</span>
<span id="cb2-32"><a href="#cb2-32" tabindex="-1"></a>  </span>
<span id="cb2-33"><a href="#cb2-33" tabindex="-1"></a>}</span></code></pre></div>
<p>Most of this compendium and its functions are built on the
<code>tidyverse</code> language. The <code>here</code> package starts
file pathing from the root folder of my <code>slfSpread</code> package,
allowing easier sharing. The <code>rgbif</code> package will be used to
query records from <code>GBIF</code>, while the <code>lydemapr</code>
package will be used to retrieve field survey data in the United States.
<code>humboldt</code> makes for easy spatial thinning of points, while
<code>spThin</code> is more thorough and evocative for thinning (both
will be used).</p>
</div>
<div id="retrieve-data-from-gbif-and-lydemapr-and-tidy"
class="section level1">
<h1>1. Retrieve data from GBIF and lydemapR and tidy</h1>
<div id="gbif-via-rgbif" class="section level2">
<h2>1.1- GBIF via rgbif</h2>
<p>I will begin by retrieving the GBIF taxonomic ID for Lycorma
delicatula.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>slf_id <span class="ot">&lt;-</span> rgbif<span class="sc">::</span><span class="fu">occ_search</span>(<span class="at">scientificName =</span> <span class="st">&quot;Lycorma delicatula&quot;</span>)[[<span class="st">&quot;data&quot;</span>]]</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>slf_id <span class="ot">&lt;-</span> slf_id <span class="sc">%&gt;%</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(taxonKey) <span class="sc">%&gt;%</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span>() <span class="sc">%&gt;%</span></span>
<span id="cb3-6"><a href="#cb3-6" tabindex="-1"></a>  <span class="fu">as.character</span>()</span></code></pre></div>
<p>I will also perform a few operations specific to rgbif. I will need
to enter my user credentials for gbif; to keep these private, I will
edit the .Renviron and call them from there. Once this chunk is run and
the .Renviron pops up, enter your username, password and email
credentials in the following format on lines 1-3:</p>
<ul>
<li>GBIF_USER=” ”</li>
<li>GBIF_PWD=” ”</li>
<li>GBIF_EMAIL=” ”</li>
</ul>
<p>Save and close the document.</p>
<p>I will also retrieve a list of country abbreviations to tailor the
download. I will be excluding countries in North America (USA, Mexico,
Canada) and Taiwan. Lin and Liao did a comprehensive survey for SLF in
Taiwan to validate SLF presence records in online repositories and found
that these records were likely false (Lin and Liao, 2024).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="co"># edit R environment for user credentials</span></span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a>usethis<span class="sc">::</span><span class="fu">edit_r_environ</span>()</span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co"># get list of countries</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a>rgbif<span class="sc">::</span><span class="fu">enumeration_country</span>(<span class="at">curlopts =</span> <span class="fu">list</span>())</span></code></pre></div>
<div id="retrieve-and-save-records" class="section level3">
<h3>Retrieve and save records</h3>
<p>The retrieved ID is 5157899. This matches the ID for the <a
href="https://www.gbif.org/species/5157899">SLF repository</a> on
GBIF.</p>
<p>Next, retrieve <code>GBIF</code> records using
<code>occ_download()</code>. I will be editing the following GBIF
constraints:</p>
<ul>
<li>hasCoordinate: limit records to only those with coordinate data</li>
<li>year: we will retrieve records between 1981 and 2023. 1981 was
chosen as the earliest date because it corresponds with the earliest
climate data available.</li>
<li>occurrenceStatus: set to only presences, because absence data is not
needed</li>
<li>basisOfRecord: here we include everything except fossil records, to
ensure that records are within the target time period.</li>
<li>hasGeospatialIssue: exclude any records with an issue in the
coordinate data</li>
<li>country: the country of the record</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="co"># initiate download</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>slf_gbif <span class="ot">&lt;-</span> rgbif<span class="sc">::</span><span class="fu">occ_download</span>(</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>  <span class="co"># general formatting</span></span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>  <span class="at">type =</span> <span class="st">&quot;and&quot;</span>,</span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>  <span class="at">format =</span> <span class="st">&quot;SIMPLE_CSV&quot;</span>,</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>  <span class="co"># inclusion rules</span></span>
<span id="cb5-7"><a href="#cb5-7" tabindex="-1"></a>  <span class="fu">pred</span>(<span class="st">&quot;taxonKey&quot;</span>, slf_id), <span class="co"># search by ID, not species name</span></span>
<span id="cb5-8"><a href="#cb5-8" tabindex="-1"></a>  <span class="fu">pred</span>(<span class="st">&quot;hasCoordinate&quot;</span>, <span class="cn">TRUE</span>),</span>
<span id="cb5-9"><a href="#cb5-9" tabindex="-1"></a>  <span class="fu">pred</span>(<span class="st">&quot;hasGeospatialIssue&quot;</span>, <span class="cn">FALSE</span>),</span>
<span id="cb5-10"><a href="#cb5-10" tabindex="-1"></a>  <span class="fu">pred</span>(<span class="st">&quot;occurrenceStatus&quot;</span>, <span class="st">&quot;PRESENT&quot;</span>),</span>
<span id="cb5-11"><a href="#cb5-11" tabindex="-1"></a>  <span class="fu">pred_gte</span>(<span class="st">&quot;year&quot;</span>, <span class="dv">1981</span>), <span class="co"># records from 1981 onwards</span></span>
<span id="cb5-12"><a href="#cb5-12" tabindex="-1"></a>  <span class="co"># exclusion rules</span></span>
<span id="cb5-13"><a href="#cb5-13" tabindex="-1"></a>  <span class="fu">pred_not</span>(<span class="fu">pred_in</span>(<span class="st">&quot;basisOfRecord&quot;</span>, <span class="st">&quot;FOSSIL_SPECIMEN&quot;</span>)), <span class="co"># exclude fossil records</span></span>
<span id="cb5-14"><a href="#cb5-14" tabindex="-1"></a>  <span class="fu">pred_not</span>(<span class="fu">pred_in</span>(<span class="st">&quot;country&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;US&quot;</span>, <span class="st">&quot;MX&quot;</span>, <span class="st">&quot;CA&quot;</span>))), <span class="co"># exclude USA, Canada and mexico</span></span>
<span id="cb5-15"><a href="#cb5-15" tabindex="-1"></a>  <span class="fu">pred_not</span>(<span class="fu">pred_in</span>(<span class="st">&quot;country&quot;</span>, <span class="fu">c</span>(<span class="st">&quot;TW&quot;</span>)))</span>
<span id="cb5-16"><a href="#cb5-16" tabindex="-1"></a>)</span>
<span id="cb5-17"><a href="#cb5-17" tabindex="-1"></a></span>
<span id="cb5-18"><a href="#cb5-18" tabindex="-1"></a><span class="co"># be sure to open slf_gbif and retrieve the download key</span></span>
<span id="cb5-19"><a href="#cb5-19" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" tabindex="-1"></a><span class="co"># check on download status using key</span></span>
<span id="cb5-21"><a href="#cb5-21" tabindex="-1"></a>rgbif<span class="sc">::</span><span class="fu">occ_download_wait</span>(<span class="st">&#39;0049348-240626123714530&#39;</span>)</span></code></pre></div>
<p>The data have been pulled to the gbif server, but now we must
download the data and edit it in a number of ways.</p>
<p>First, I will import the dataset to my working directory. I will also
retrieve the data citation for this download. I will rename the raw
download file. Finally, I will subset the desired columns and save them
as a separate .csv for use in tidying. The raw query and the raw
coordinates will be saved to the <code>data-raw</code> folder. I will
read in the coordinate data saved there afterwards to prepare for data
tidying.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="co"># download the data as a zip to PC</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a>slf_gbif_download <span class="ot">&lt;-</span> rgbif<span class="sc">::</span><span class="fu">occ_download_get</span>(</span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>  <span class="at">key =</span> <span class="st">&#39;0049348-240626123714530&#39;</span>,</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a>  <span class="at">path =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>),</span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>  <span class="co"># overwrite = TRUE</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a>  rgbif<span class="sc">::</span><span class="fu">occ_download_import</span>()</span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co"># .zip file</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co"># unzip</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a>utils<span class="sc">::</span><span class="fu">unzip</span>(</span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a>  <span class="at">zipfile =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>, <span class="st">&quot;0049348-240626123714530.zip&quot;</span>),</span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a>  <span class="at">exdir =</span>  <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>)</span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a>  )</span>
<span id="cb6-16"><a href="#cb6-16" tabindex="-1"></a><span class="co"># rename .csv file</span></span>
<span id="cb6-17"><a href="#cb6-17" tabindex="-1"></a><span class="fu">file.rename</span>(</span>
<span id="cb6-18"><a href="#cb6-18" tabindex="-1"></a>  <span class="at">from =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>, <span class="st">&quot;0049348-240626123714530.csv&quot;</span>),</span>
<span id="cb6-19"><a href="#cb6-19" tabindex="-1"></a>  <span class="at">to =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;slf_gbif_raw_query_&quot;</span>, <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">&quot;%Y-%m-%d&quot;</span>), <span class="st">&quot;.csv&quot;</span>))</span>
<span id="cb6-20"><a href="#cb6-20" tabindex="-1"></a>  )</span>
<span id="cb6-21"><a href="#cb6-21" tabindex="-1"></a><span class="co"># delete original zip</span></span>
<span id="cb6-22"><a href="#cb6-22" tabindex="-1"></a><span class="fu">file.remove</span>(<span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>, <span class="st">&quot;0049348-240626123714530.zip&quot;</span>))</span>
<span id="cb6-23"><a href="#cb6-23" tabindex="-1"></a></span>
<span id="cb6-24"><a href="#cb6-24" tabindex="-1"></a></span>
<span id="cb6-25"><a href="#cb6-25" tabindex="-1"></a></span>
<span id="cb6-26"><a href="#cb6-26" tabindex="-1"></a><span class="co"># simplify download into more useable .csv</span></span>
<span id="cb6-27"><a href="#cb6-27" tabindex="-1"></a>slf_gbif_download_simple <span class="ot">&lt;-</span> slf_gbif_download <span class="sc">%&gt;%</span></span>
<span id="cb6-28"><a href="#cb6-28" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">prov =</span> <span class="st">&quot;gbif&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb6-29"><a href="#cb6-29" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="fu">c</span>(<span class="st">&quot;species&quot;</span>, <span class="st">&quot;decimalLongitude&quot;</span>, <span class="st">&quot;decimalLatitude&quot;</span>, <span class="st">&quot;countryCode&quot;</span>, <span class="st">&quot;prov&quot;</span>, <span class="st">&quot;year&quot;</span>, <span class="st">&quot;gbifID&quot;</span>)) <span class="sc">%&gt;%</span> <span class="co"># select desired columns</span></span>
<span id="cb6-30"><a href="#cb6-30" tabindex="-1"></a>  <span class="co"># rename for consistency with rest of vignette</span></span>
<span id="cb6-31"><a href="#cb6-31" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;name&quot;</span> <span class="ot">=</span> <span class="st">&quot;species&quot;</span>,</span>
<span id="cb6-32"><a href="#cb6-32" tabindex="-1"></a>         <span class="st">&quot;longitude&quot;</span> <span class="ot">=</span> <span class="st">&quot;decimalLongitude&quot;</span>, </span>
<span id="cb6-33"><a href="#cb6-33" tabindex="-1"></a>         <span class="st">&quot;latitude&quot;</span> <span class="ot">=</span> <span class="st">&quot;decimalLatitude&quot;</span>,</span>
<span id="cb6-34"><a href="#cb6-34" tabindex="-1"></a>         <span class="st">&quot;key&quot;</span> <span class="ot">=</span> <span class="st">&quot;gbifID&quot;</span></span>
<span id="cb6-35"><a href="#cb6-35" tabindex="-1"></a>  )</span>
<span id="cb6-36"><a href="#cb6-36" tabindex="-1"></a></span>
<span id="cb6-37"><a href="#cb6-37" tabindex="-1"></a><span class="co"># save .csv output for use</span></span>
<span id="cb6-38"><a href="#cb6-38" tabindex="-1"></a><span class="fu">write_csv</span>(<span class="at">x =</span> slf_gbif_download_simple, </span>
<span id="cb6-39"><a href="#cb6-39" tabindex="-1"></a>          <span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;slf_gbif_raw_coords_&quot;</span>, <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">&quot;%Y-%m-%d&quot;</span>), <span class="st">&quot;.csv&quot;</span>))</span>
<span id="cb6-40"><a href="#cb6-40" tabindex="-1"></a>)</span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>rgbif<span class="sc">::</span><span class="fu">gbif_citation</span>(<span class="st">&#39;0049348-240626123714530&#39;</span>)</span></code></pre></div>
<p>Here is the data citation: “GBIF Occurrence Download <a
href="https://doi.org/10.15468/dl.59gndc"
class="uri">https://doi.org/10.15468/dl.59gndc</a> Accessed from R via
rgbif (<a href="https://github.com/ropensci/rgbif"
class="uri">https://github.com/ropensci/rgbif</a>) on 2024-08-05”</p>
</div>
<div id="coordinate-veracity" class="section level3">
<h3>Coordinate veracity</h3>
<p>First, we want to check the coordinate veracity using the
<code>CoordinateCleaner</code> package. We will be more picky and apply
more tests to the GBIF data points than those from the other datasets
because they are usually less accurate than field survey data.</p>
<ul>
<li>valid and likely coordinates</li>
<li>points set to the centroid of a country or province</li>
<li>coordinates that fall into the ocean</li>
<li>duplicates</li>
<li>points with equal lat / lon</li>
<li>points near the GBIF HQ</li>
<li>points near biodiv institutions</li>
<li>points near whole lat / lon numbers</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="co"># read in data</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>slf_gbif_coords1 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>, <span class="st">&quot;slf_gbif_raw_coords_2024-08-05.csv&quot;</span>))</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co"># coordinate cleaner</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a>slf_gbif_report <span class="ot">&lt;-</span> CoordinateCleaner<span class="sc">::</span><span class="fu">clean_coordinates</span>(</span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a>  <span class="at">x =</span> slf_gbif_coords1, </span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a>  <span class="at">lon =</span> <span class="st">&quot;longitude&quot;</span>,</span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a>  <span class="at">lat =</span> <span class="st">&quot;latitude&quot;</span>,</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a>  <span class="at">species =</span> <span class="st">&quot;name&quot;</span>,</span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a>  <span class="at">tests =</span> <span class="fu">c</span>(<span class="st">&quot;centroids&quot;</span>, <span class="st">&quot;duplicates&quot;</span>, <span class="st">&quot;equal&quot;</span>, <span class="st">&quot;gbif&quot;</span>, <span class="st">&quot;institutions&quot;</span>, <span class="st">&quot;seas&quot;</span>, <span class="st">&quot;zeros&quot;</span>),</span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a>  <span class="co"># test details</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a>  <span class="at">seas_scale =</span> <span class="dv">110</span>,</span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a>  <span class="at">centroids_detail =</span> <span class="st">&quot;both&quot;</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span></code></pre></div>
<p>It seems like the most records were removed for duplicate records,
followed by for records flagged as being in the ocean or other bodies of
water. We also did find a few records that were attributed to
biodiversity institutions and country / province centroids.</p>
<p>Next, I will filter out problematic points and ensure the species
naming is consistent.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># remove flagged records</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>slf_gbif_coords1 <span class="ot">&lt;-</span> slf_gbif_report <span class="sc">%&gt;%</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.summary <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="co"># FALSE records are potentially problematic</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co"># check species name</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="fu">unique</span>(slf_gbif_coords1<span class="sc">$</span>name)</span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a></span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a><span class="co"># there is only one naming convention</span></span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a></span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a><span class="co"># rename species name</span></span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a><span class="co">#slf_gbif_coords1$name &lt;- &quot;Lycorma delicatula&quot;</span></span></code></pre></div>
<p>Next, we will use <code>humboldt::humboldt.occ.rarefy()</code> to
spatially thin the occurrence data. The <code>Humboldt</code> package
was chosen to perform the initial thinning because it preserves
non-coordinate data in its output. So, we can save a spatially thinned
version of the data with other information (such as unique keys or
dates) that might be useful later.</p>
<p>In <code>humboldt::humboldt.occ.rarefy()</code>, The data will be
rarefied to 10km over 10 passes. This will be done once more on the
final dataset. Spatial thinning should reduce autocorrelation and
sampling bias. I have programmed this function to rarefy at 10km. The
resolution of the climate data we will use from <code>CHELSA</code> (30
arc-seconds, roughly 1km at the equator), but we will be aggregating it
at 10km and taking the mean value per cell. This way, no more than one
occurrence will be left per grid cell.</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">997</span>)</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>slf_gbif_coords2 <span class="ot">&lt;-</span> humboldt<span class="sc">::</span><span class="fu">humboldt.occ.rarefy</span>(</span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a>  <span class="at">in.pts =</span> slf_gbif_coords1, </span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>  <span class="at">colxy =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>, <span class="co"># coordinate columns</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a>  <span class="at">rarefy.dist =</span> <span class="dv">10</span>, </span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a>  <span class="at">rarefy.units =</span> <span class="st">&quot;km&quot;</span>, </span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a>  <span class="at">run.silent.rar =</span> F <span class="co"># display progress bars</span></span>
<span id="cb10-9"><a href="#cb10-9" tabindex="-1"></a>  ) </span></code></pre></div>
<p>Spatial thinning left 505 of 1,489 observations.</p>
<p>We will save the results of the cleaning we just performed so they
can be referenced or called later in our analysis. Later in this
vignette, we will be combining these records with those from other data
sources into a final dataset that is prepared for MaxEnt.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="cf">if</span>(<span class="cn">FALSE</span>){</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>  </span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="fu">write_csv</span>(slf_gbif_coords2, <span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;vignette-outputs&quot;</span>, <span class="st">&quot;data-tables&quot;</span>, <span class="st">&quot;slf_gbif_cleaned_coords_2024-08-05.csv&quot;</span>))</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>  </span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a>  <span class="co"># also save as a .rds file</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a>  <span class="fu">write_rds</span>(slf_gbif_coords2, <span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data&quot;</span>, <span class="st">&quot;slf_gbif_cleaned_coords_2024-08-05.rds&quot;</span>))</span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>  </span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>}</span></code></pre></div>
</div>
</div>
<div id="lydemapr" class="section level2">
<h2>1.2- LydemapR</h2>
<div id="retrieve-and-save-lydemapr-records" class="section level3">
<h3>Retrieve and save lydemapR records</h3>
<p>Next, we will retrieve data from the lydemapR package and save it as
a <code>.csv</code>. I will repeat the spatial thinning and cleaning
process outlined above.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>slf_lyde <span class="ot">&lt;-</span> lydemapr<span class="sc">::</span>lyde</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="fu">write_csv</span>(<span class="at">x =</span> slf_lyde, </span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>          <span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;slf_lyde_raw_coords_&quot;</span>, <span class="fu">format</span>(<span class="fu">Sys.Date</span>(), <span class="st">&quot;%Y-%m-%d&quot;</span>), <span class="st">&quot;.csv&quot;</span>)))</span></code></pre></div>
<p>The next chunk is an import from an unpublished version of the
lydemapr dataset. This version will be published on the package soon,
but for now we will use this . This file was named
“slf_lyde_raw_coords_2024-07-29.csv” for consistency with previous file
naming. It contains about 900,000 published SLF records and includes the
years 2022 and 2023.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="cf">if</span> (<span class="cn">FALSE</span>) {</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  </span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a>  slf_lyde_raw <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>, <span class="st">&quot;slf_lyde_raw_coords_2024-07-29.csv&quot;</span>))</span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a>  <span class="co"># tidy</span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a>  slf_lyde_raw <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">select</span>(slf_lyde_raw, <span class="sc">-</span>survey) </span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a>  </span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a>  <span class="co"># overwrite save original version</span></span>
<span id="cb13-9"><a href="#cb13-9" tabindex="-1"></a>  <span class="fu">write_csv</span>(<span class="at">x =</span> slf_lyde_raw, <span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>, <span class="st">&quot;slf_lyde_raw_coords_2024-07-29.csv&quot;</span>))</span>
<span id="cb13-10"><a href="#cb13-10" tabindex="-1"></a>  </span>
<span id="cb13-11"><a href="#cb13-11" tabindex="-1"></a>}</span></code></pre></div>
<p>The raw dataset is composed of over 658,000 records of SLF in the USA
alone. Most of these records are concentrated in the mid-atlantic region
where the invasion front is progressing. This dataset will also need a
run of spatial thinning. First, we will need to narrow these records to
fit our needs. At the time of writing this, I am only interested in
records that were collected during field surveys, but this can be tuned
to the needs of the analysis. So, I will set the collection method equal
to the value of “field_survey/management”. Obviously, I am also
interested in presence records only.</p>
<p>Lastly, I will pull records only from areas where SLF have
established a population. LydemapR defines an established population as
either 2+ adults or the presence of 1 egg mass.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># read in data</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>slf_lyde <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>, <span class="st">&quot;slf_lyde_raw_coords_2024-07-29.csv&quot;</span>))</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co"># unique values for collection method</span></span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a><span class="fu">unique</span>(slf_lyde<span class="sc">$</span>collection_method)</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a></span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>slf_lyde1 <span class="ot">&lt;-</span> slf_lyde <span class="sc">%&gt;%</span></span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(lyde_present <span class="sc">==</span> <span class="st">&quot;TRUE&quot;</span>, <span class="co"># only select presences</span></span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>         collection_method <span class="sc">==</span> <span class="st">&quot;field_survey/management&quot;</span>, <span class="co"># collection method = &quot;field_survey/management&quot;</span></span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>         lyde_established <span class="sc">==</span> <span class="st">&quot;TRUE&quot;</span>) <span class="sc">%&gt;%</span> <span class="co"># only select areas records that are from established populations</span></span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>  <span class="co"># add species column</span></span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">species =</span> <span class="st">&quot;Lycorma delicatula&quot;</span>)</span></code></pre></div>
<p>The data that fit our needs are about 39,000 records total.</p>
</div>
<div id="coordinate-veracity-1" class="section level3">
<h3>Coordinate veracity</h3>
<p>Here we will run through the same data cleaning process that we
performed for the <code>GBIF</code> data.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># coordinate cleaner</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>slf_lyde_report <span class="ot">&lt;-</span> CoordinateCleaner<span class="sc">::</span><span class="fu">clean_coordinates</span>(</span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  <span class="at">x =</span> slf_lyde1, </span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  <span class="at">lon =</span> <span class="st">&quot;longitude&quot;</span>,</span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  <span class="at">lat =</span> <span class="st">&quot;latitude&quot;</span>,</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>  <span class="at">species =</span> <span class="st">&quot;species&quot;</span>,</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>  <span class="at">tests =</span> <span class="fu">c</span>(<span class="st">&quot;centroids&quot;</span>, <span class="st">&quot;duplicates&quot;</span>, <span class="st">&quot;equal&quot;</span>, <span class="st">&quot;gbif&quot;</span>, <span class="st">&quot;institutions&quot;</span>, <span class="st">&quot;seas&quot;</span>, <span class="st">&quot;zeros&quot;</span>),</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>  <span class="co"># test details</span></span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>  <span class="at">seas_scale =</span> <span class="dv">110</span>,</span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>  <span class="at">centroids_detail =</span> <span class="st">&quot;both&quot;</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a><span class="co"># remove flagged records</span></span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a>slf_lyde1 <span class="ot">&lt;-</span> slf_lyde_report <span class="sc">%&gt;%</span></span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.summary <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="co"># FALSE records are potentially problematic</span></span></code></pre></div>
<p>Again, the majority were duplicates, followed by those that fell into
bodies of water.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">998</span>)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>slf_lyde2 <span class="ot">&lt;-</span> humboldt<span class="sc">::</span><span class="fu">humboldt.occ.rarefy</span>(</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>  <span class="at">in.pts =</span> slf_lyde1, </span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a>  <span class="at">colxy =</span> <span class="dv">4</span><span class="sc">:</span><span class="dv">5</span>, <span class="co"># coordinate columns</span></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a>  <span class="at">rarefy.dist =</span> <span class="dv">10</span>, </span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>  <span class="at">rarefy.units =</span> <span class="st">&quot;km&quot;</span>, </span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>  <span class="at">run.silent.rar =</span> F <span class="co"># display progress bars</span></span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>  ) </span></code></pre></div>
<p>Spatial thinning for the <code>lyde</code> dataset left 366 points
out of the 39,000 points that fit our needs.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="fu">write_csv</span>(slf_lyde2, <span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;vignette-outputs&quot;</span>, <span class="st">&quot;data-tables&quot;</span>, <span class="st">&quot;slf_lyde_cleaned_coords_2024-07-29.csv&quot;</span>))</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a><span class="co"># also save as a .rds file</span></span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="fu">write_rds</span>(slf_lyde2, <span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data&quot;</span>, <span class="st">&quot;slf_lyde_cleaned_coords_2024-07-29.rds&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="visualize-slf-distributions" class="section level2">
<h2>1.3- Visualize SLF distributions</h2>
<p>We want to visualize the difference between the raw coordinates that
were pulled from GBIF and the cleaned, spatially thinned version. This
is to ensure proper geospatial coverage and the success of the spatial
thinning runs.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a><span class="co"># raw data</span></span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>gbif_raw <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>, <span class="st">&quot;slf_gbif_raw_coords_2024-08-05.csv&quot;</span>))</span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="co"># thinned data</span></span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>gbif_thinned <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;vignette-outputs&quot;</span>, <span class="st">&quot;data-tables&quot;</span>, <span class="st">&quot;slf_gbif_cleaned_coords_2024-08-05.csv&quot;</span>))</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a></span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a><span class="co"># plot world map</span></span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>map_gbif_thinned <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>  <span class="co"># basemap</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> countries_sf, <span class="fu">aes</span>(<span class="at">geometry =</span> geometry), <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> gbif_raw, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> gbif_thinned, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude), <span class="at">color =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="at">shape =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">164.5</span>, <span class="fl">163.5</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">55</span>, <span class="dv">85</span>)) <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;SLF GBIF records- </span><span class="sc">\n</span><span class="st"> raw (blue) vs thinned (darkorange)&quot;</span>) <span class="sc">+</span></span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a></span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a><span class="co"># plot map of Asia</span></span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a>map_gbif_thinned_Asia <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb18-23"><a href="#cb18-23" tabindex="-1"></a>  <span class="co"># basemao</span></span>
<span id="cb18-24"><a href="#cb18-24" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> countries_sf, <span class="fu">aes</span>(<span class="at">geometry =</span> geometry), <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb18-25"><a href="#cb18-25" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> gbif_raw, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb18-26"><a href="#cb18-26" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> gbif_thinned, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude), <span class="at">color =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="at">shape =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb18-27"><a href="#cb18-27" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">140</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">20</span>, <span class="dv">50</span>)) <span class="sc">+</span></span>
<span id="cb18-28"><a href="#cb18-28" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;SLF GBIF records in Asia-</span><span class="sc">\n</span><span class="st">raw (blue) vs thinned (darkorange)&quot;</span>) <span class="sc">+</span></span>
<span id="cb18-29"><a href="#cb18-29" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb18-30"><a href="#cb18-30" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb18-31"><a href="#cb18-31" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb18-32"><a href="#cb18-32" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb18-33"><a href="#cb18-33" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb18-34"><a href="#cb18-34" tabindex="-1"></a>  </span>
<span id="cb18-35"><a href="#cb18-35" tabindex="-1"></a><span class="co"># patchwork display of plots</span></span>
<span id="cb18-36"><a href="#cb18-36" tabindex="-1"></a>map_gbif_thinned <span class="sc">+</span> map_gbif_thinned_Asia <span class="sc">+</span></span>
<span id="cb18-37"><a href="#cb18-37" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="020_retrieve_SLF_records_files/figure-html/visualize%20raw%20and%20thinned%20GBIF%20records-1.png" width="700" /></p>
<p>From the mapping, it seems that the spatial thinning reduced the GBIF
records, while preserving the same spatial extent. We also zoom in on
the invaded range, and indeed every blue point is paired with at least 1
darkorange point. So, our goal was met! We will do the same for the
LydemapR data to ensure spatial thinning success.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a><span class="co"># raw data</span></span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>lyde_raw <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>, <span class="st">&quot;slf_lyde_raw_coords_2024-07-29.csv&quot;</span>))</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a></span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co"># thinned data</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>lyde_thinned <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;vignette-outputs&quot;</span>, <span class="st">&quot;data-tables&quot;</span>, <span class="st">&quot;slf_lyde_cleaned_coords_2024-07-29.csv&quot;</span>))</span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co"># ensure data points represent presences</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a>lyde_raw <span class="ot">&lt;-</span> lyde_raw <span class="sc">%&gt;%</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a>  <span class="fu">filter</span>(lyde_present <span class="sc">==</span> <span class="st">&quot;TRUE&quot;</span>) </span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="co"># plot map of NAmerica</span></span>
<span id="cb19-12"><a href="#cb19-12" tabindex="-1"></a>map_lyde_allRecords <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb19-13"><a href="#cb19-13" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> countries_sf, <span class="fu">aes</span>(<span class="at">geometry =</span> geometry), <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb19-14"><a href="#cb19-14" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> lyde_raw, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb19-15"><a href="#cb19-15" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> lyde_thinned, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude), <span class="at">color =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="at">shape =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb19-16"><a href="#cb19-16" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">133.593750</span>, <span class="sc">-</span><span class="fl">52.294922</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">25.085599</span>, <span class="fl">55.304138</span>)) <span class="sc">+</span></span>
<span id="cb19-17"><a href="#cb19-17" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;SLF lydemapR records- </span><span class="sc">\n</span><span class="st">all records (blue)</span><span class="sc">\n</span><span class="st">vs thinned (darkorange)&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-18"><a href="#cb19-18" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-19"><a href="#cb19-19" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-20"><a href="#cb19-20" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb19-21"><a href="#cb19-21" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb19-22"><a href="#cb19-22" tabindex="-1"></a>  </span>
<span id="cb19-23"><a href="#cb19-23" tabindex="-1"></a></span>
<span id="cb19-24"><a href="#cb19-24" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" tabindex="-1"></a></span>
<span id="cb19-26"><a href="#cb19-26" tabindex="-1"></a><span class="co"># include only established records </span></span>
<span id="cb19-27"><a href="#cb19-27" tabindex="-1"></a>lyde_raw1 <span class="ot">&lt;-</span> lyde_raw <span class="sc">%&gt;%</span></span>
<span id="cb19-28"><a href="#cb19-28" tabindex="-1"></a>  <span class="fu">filter</span>(lyde_established <span class="sc">==</span> <span class="st">&quot;TRUE&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-29"><a href="#cb19-29" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">species =</span> <span class="st">&quot;Lycorma delicatula&quot;</span>)</span>
<span id="cb19-30"><a href="#cb19-30" tabindex="-1"></a></span>
<span id="cb19-31"><a href="#cb19-31" tabindex="-1"></a></span>
<span id="cb19-32"><a href="#cb19-32" tabindex="-1"></a><span class="co"># plot map including only established records</span></span>
<span id="cb19-33"><a href="#cb19-33" tabindex="-1"></a>map_lyde_estab <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb19-34"><a href="#cb19-34" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> countries_sf, <span class="fu">aes</span>(<span class="at">geometry =</span> geometry), <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb19-35"><a href="#cb19-35" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> lyde_raw1, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude), <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb19-36"><a href="#cb19-36" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> lyde_thinned, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude), <span class="at">color =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="at">shape =</span> <span class="dv">2</span>) <span class="sc">+</span></span>
<span id="cb19-37"><a href="#cb19-37" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">90</span>, <span class="sc">-</span><span class="dv">70</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">35</span>, <span class="dv">45</span>)) <span class="sc">+</span></span>
<span id="cb19-38"><a href="#cb19-38" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;SLF lydemapR records- </span><span class="sc">\n</span><span class="st">all records estab populations (blue)</span><span class="sc">\n</span><span class="st">vs thinned (darkorange)&quot;</span>) <span class="sc">+</span></span>
<span id="cb19-39"><a href="#cb19-39" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-40"><a href="#cb19-40" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb19-41"><a href="#cb19-41" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb19-42"><a href="#cb19-42" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span>
<span id="cb19-43"><a href="#cb19-43" tabindex="-1"></a></span>
<span id="cb19-44"><a href="#cb19-44" tabindex="-1"></a><span class="co"># patchwork display of plots</span></span>
<span id="cb19-45"><a href="#cb19-45" tabindex="-1"></a> map_lyde_allRecords <span class="sc">+</span> map_lyde_estab <span class="sc">+</span></span>
<span id="cb19-46"><a href="#cb19-46" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="020_retrieve_SLF_records_files/figure-html/visualize%20raw%20and%20thinned%20lydemapr%20records-1.png" width="700" /></p>
<p>The spatial thinning was successful! However, the first plot does not
help us to understand what data were eliminated by the spatial thinning.
It would be an issue if we lost spatial extent for removing certain
types of data. I believe this is likely due to our preference for
records that represent established populations and for excluding
regulatory incidents and unconfirmed populations, so I will plot the
reduced raw dataset vs our thinned dataset. Indeed, regulatory incidents
and unconfirmed populations account for most of the populations that we
excluded (we want this).</p>
</div>
</div>
<div id="combine-records" class="section level1">
<h1>2. Combine records</h1>
<div id="slf-data-from-published-sources" class="section level2">
<h2>2.1- SLF data from published sources</h2>
<p>In this step, I will combine the records obtained from GBIF and
LydemapR with data taken from the literature. I will begin by loading in
records taken from the published literature. There are a total of 165
records from China, southeast Asia, Japan, SK and the USA. Most of these
records were obtained from genetic studies and represent samples taken
from established populations of SLF. Data is scarce for established
populations of SLF within its native range (China and southeast Asia),
so these records are especially important. These records were taken from
both peer-reviewed literature and natural history notes:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a><span class="co"># read in .csv of papers</span></span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>slf_published_papers <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>, <span class="st">&quot;slf_publishedOccurrenceRecords_papers.csv&quot;</span>))</span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a></span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a><span class="co"># kable table</span></span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>slf_published_papers <span class="sc">%&gt;%</span></span>
<span id="cb20-7"><a href="#cb20-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">!</span>Notes) <span class="sc">%&gt;%</span></span>
<span id="cb20-8"><a href="#cb20-8" tabindex="-1"></a>  knitr<span class="sc">::</span><span class="fu">kable</span>(<span class="at">format =</span> <span class="st">&quot;pipe&quot;</span>)</span></code></pre></div>
<table>
<colgroup>
<col width="20%" />
<col width="6%" />
<col width="32%" />
<col width="41%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">Author</th>
<th align="right">Year</th>
<th align="left">Spatial Extent of Records</th>
<th align="left">DOI</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Du et al</td>
<td align="right">2021</td>
<td align="left">China, Japan, SK, USA</td>
<td align="left">10.1111/eva.13170</td>
</tr>
<tr class="even">
<td align="left">Fennah</td>
<td align="right">1953</td>
<td align="left">China</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">Han et al</td>
<td align="right">2008</td>
<td align="left">SK</td>
<td align="left">10.1111/j.1748-5967.2008.00188.x</td>
</tr>
<tr class="even">
<td align="left">Kim et al</td>
<td align="right">2013</td>
<td align="left">China, Japan, SK</td>
<td align="left">10.1016/j.aspen.2013.07.003</td>
</tr>
<tr class="odd">
<td align="left">Kim et al</td>
<td align="right">2021</td>
<td align="left">China, Japan, SK</td>
<td align="left">10.3390/insects12060539</td>
</tr>
<tr class="even">
<td align="left">Manzoor et al</td>
<td align="right">2021</td>
<td align="left">China</td>
<td align="left">10.1111/aab.12674</td>
</tr>
<tr class="odd">
<td align="left">Nakashita et al</td>
<td align="right">2022</td>
<td align="left">China, Japan, SK, USA</td>
<td align="left">10.1038/s41598-022-05541-z</td>
</tr>
<tr class="even">
<td align="left">Suzuki</td>
<td align="right">2023</td>
<td align="left">Japan</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">Xin et al</td>
<td align="right">2020</td>
<td align="left">China</td>
<td align="left">10.1093/ee/nvaa137</td>
</tr>
<tr class="even">
<td align="left">Yang et al</td>
<td align="right">2015</td>
<td align="left">China</td>
<td align="left">10.11865/zs.20150305</td>
</tr>
<tr class="odd">
<td align="left">Zhang et al</td>
<td align="right">2019</td>
<td align="left">China</td>
<td align="left">10.3390/insects10100312</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>slf_published_papers</span></code></pre></div>
<pre><code>## [38;5;246m# A tibble: 11 × 5[39m
##    Author           Year `Spatial Extent of Records` DOI                   Notes
##    [3m[38;5;246m&lt;chr&gt;[39m[23m           [3m[38;5;246m&lt;dbl&gt;[39m[23m [3m[38;5;246m&lt;chr&gt;[39m[23m                       [3m[38;5;246m&lt;chr&gt;[39m[23m                 [3m[38;5;246m&lt;chr&gt;[39m[23m
## [38;5;250m 1[39m Du et al         [4m2[24m021 China, Japan, SK, USA       10.1111/eva.13170     [31mNA[39m   
## [38;5;250m 2[39m Fennah           [4m1[24m953 China                       [31mNA[39m                    repr…
## [38;5;250m 3[39m Han et al        [4m2[24m008 SK                          10.1111/j.1748-5967.… [31mNA[39m   
## [38;5;250m 4[39m Kim et al        [4m2[24m013 China, Japan, SK            10.1016/j.aspen.2013… [31mNA[39m   
## [38;5;250m 5[39m Kim et al        [4m2[24m021 China, Japan, SK            10.3390/insects12060… [31mNA[39m   
## [38;5;250m 6[39m Manzoor et al    [4m2[24m021 China                       10.1111/aab.12674     repr…
## [38;5;250m 7[39m Nakashita et al  [4m2[24m022 China, Japan, SK, USA       10.1038/s41598-022-0… [31mNA[39m   
## [38;5;250m 8[39m Suzuki           [4m2[24m023 Japan                       [31mNA[39m                    [31mNA[39m   
## [38;5;250m 9[39m Xin et al        [4m2[24m020 China                       10.1093/ee/nvaa137    [31mNA[39m   
## [38;5;250m10[39m Yang et al       [4m2[24m015 China                       10.11865/zs.20150305  repr…
## [38;5;250m11[39m Zhang et al      [4m2[24m019 China                       10.3390/insects10100… [31mNA[39m</code></pre>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>slf_published <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data-raw&quot;</span>, <span class="st">&quot;slf_publishedOccurrenceRecords_v2.csv&quot;</span>))</span></code></pre></div>
<pre><code>## [1mRows: [22m[34m177[39m [1mColumns: [22m[34m10[39m
## [36m──[39m [1mColumn specification[22m [36m────────────────────────────────────────────────────────[39m
## [1mDelimiter:[22m &quot;,&quot;
## [31mchr[39m (7): name, key, country, stateProvince, publishingArticle, accessionNum_...
## [32mdbl[39m (3): longitude, latitude, year
## 
## [36mℹ[39m Use `spec()` to retrieve the full column specification for this data.
## [36mℹ[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co"># save as .rds before proceeding</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a><span class="fu">write_rds</span>(<span class="at">x =</span> slf_published, <span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data&quot;</span>, <span class="st">&quot;slf_publishedOccurrenceRecords_v2.rds&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>map_published_Asia <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a>  <span class="co"># basemap</span></span>
<span id="cb26-3"><a href="#cb26-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> countries_sf, <span class="fu">aes</span>(<span class="at">geometry =</span> geometry), <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> slf_published, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude), <span class="at">color =</span> <span class="st">&quot;darkorange&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">100</span>, <span class="dv">140</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">45</span>)) <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;SLF data from published sources </span><span class="sc">\n</span><span class="st"> in China&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-7"><a href="#cb26-7" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-8"><a href="#cb26-8" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-9"><a href="#cb26-9" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb26-10"><a href="#cb26-10" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb26-11"><a href="#cb26-11" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb26-12"><a href="#cb26-12" tabindex="-1"></a></span>
<span id="cb26-13"><a href="#cb26-13" tabindex="-1"></a>map_published_NAmerica <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb26-14"><a href="#cb26-14" tabindex="-1"></a>  <span class="co"># basemap</span></span>
<span id="cb26-15"><a href="#cb26-15" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> countries_sf, <span class="fu">aes</span>(<span class="at">geometry =</span> geometry), <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb26-16"><a href="#cb26-16" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data =</span> slf_published, <span class="fu">aes</span>(<span class="at">x =</span> longitude, <span class="at">y =</span> latitude), <span class="at">color =</span> <span class="st">&quot;darkorange&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-17"><a href="#cb26-17" tabindex="-1"></a>  <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">133.593750</span>, <span class="sc">-</span><span class="fl">52.294922</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">25.085599</span>, <span class="fl">55.304138</span>)) <span class="sc">+</span></span>
<span id="cb26-18"><a href="#cb26-18" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;SLF data from published sources </span><span class="sc">\n</span><span class="st"> in N America&quot;</span>) <span class="sc">+</span></span>
<span id="cb26-19"><a href="#cb26-19" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-20"><a href="#cb26-20" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb26-21"><a href="#cb26-21" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb26-22"><a href="#cb26-22" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb26-23"><a href="#cb26-23" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb26-24"><a href="#cb26-24" tabindex="-1"></a></span>
<span id="cb26-25"><a href="#cb26-25" tabindex="-1"></a><span class="co"># bounding box coords found at: </span></span>
<span id="cb26-26"><a href="#cb26-26" tabindex="-1"></a><span class="co"># http://bboxfinder.com/#0.000000,0.000000,0.000000,0.000000</span></span>
<span id="cb26-27"><a href="#cb26-27" tabindex="-1"></a></span>
<span id="cb26-28"><a href="#cb26-28" tabindex="-1"></a><span class="co"># patchwork</span></span>
<span id="cb26-29"><a href="#cb26-29" tabindex="-1"></a>map_published_Asia <span class="sc">+</span> map_published_NAmerica <span class="sc">+</span></span>
<span id="cb26-30"><a href="#cb26-30" tabindex="-1"></a>  <span class="fu">plot_layout</span>(<span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="020_retrieve_SLF_records_files/figure-html/map%20of%20data%20from%20published%20sources-1.png" width="700" /></p>
<p>The map above shows that the occurrence data from the literature
provide good coverage of the native range that we might not otherwise
get.</p>
</div>
<div id="tidy-and-join-datasets" class="section level2">
<h2>2.2- Tidy and join datasets</h2>
<p>Now, I will load in the cleaned coordinates from GBIF and LydemapR
that we produced earlier.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>slf_gbif_coords3 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;vignette-outputs&quot;</span>, <span class="st">&quot;data-tables&quot;</span>, <span class="st">&quot;slf_gbif_cleaned_coords_2024-08-05.csv&quot;</span>))</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a>slf_lyde3 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;vignette-outputs&quot;</span>, <span class="st">&quot;data-tables&quot;</span>, <span class="st">&quot;slf_lyde_cleaned_coords_2024-07-29.csv&quot;</span>))</span></code></pre></div>
<p>First, I will tidy the data for joining. We will keep only the
species names, coordinates and unique key ID. We will also add a column
that states which data source each point is from.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a><span class="co"># tidy gbif data</span></span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>slf_gbif_coords3 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name<span class="sc">:</span>latitude, key, prov) <span class="sc">%&gt;%</span></span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;data_source&quot;</span> <span class="ot">=</span> <span class="st">&quot;prov&quot;</span>,</span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a>         <span class="st">&quot;species&quot;</span> <span class="ot">=</span> <span class="st">&quot;name&quot;</span>)</span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a><span class="co"># tidy lyde data</span></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a>slf_lyde3 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb28-9"><a href="#cb28-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(species, longitude, latitude, pointID) <span class="sc">%&gt;%</span></span>
<span id="cb28-10"><a href="#cb28-10" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;key&quot;</span> <span class="ot">=</span> <span class="st">&quot;pointID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb28-11"><a href="#cb28-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">data_source =</span> <span class="st">&quot;lyde&quot;</span>)</span>
<span id="cb28-12"><a href="#cb28-12" tabindex="-1"></a>  </span>
<span id="cb28-13"><a href="#cb28-13" tabindex="-1"></a><span class="co"># published data</span></span>
<span id="cb28-14"><a href="#cb28-14" tabindex="-1"></a>slf_published <span class="sc">%&lt;&gt;%</span></span>
<span id="cb28-15"><a href="#cb28-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(name<span class="sc">:</span>key, publishingArticle) <span class="sc">%&gt;%</span></span>
<span id="cb28-16"><a href="#cb28-16" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;species&quot;</span> <span class="ot">=</span> <span class="st">&quot;name&quot;</span>,</span>
<span id="cb28-17"><a href="#cb28-17" tabindex="-1"></a>         <span class="st">&quot;data_source&quot;</span> <span class="ot">=</span> <span class="st">&quot;publishingArticle&quot;</span>)</span>
<span id="cb28-18"><a href="#cb28-18" tabindex="-1"></a></span>
<span id="cb28-19"><a href="#cb28-19" tabindex="-1"></a><span class="co"># the publishing data source column needs to be tidied further. I will take out commas and substitute spaces for underscores</span></span>
<span id="cb28-20"><a href="#cb28-20" tabindex="-1"></a>slf_published<span class="sc">$</span>data_source <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">&quot; &quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;_&quot;</span>, <span class="at">x =</span> slf_published<span class="sc">$</span>data_source) </span>
<span id="cb28-21"><a href="#cb28-21" tabindex="-1"></a>slf_published<span class="sc">$</span>data_source <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="at">pattern =</span> <span class="st">&quot;,&quot;</span>, <span class="at">replacement =</span> <span class="st">&quot;&quot;</span>, <span class="at">x =</span> slf_published<span class="sc">$</span>data_source)</span>
<span id="cb28-22"><a href="#cb28-22" tabindex="-1"></a></span>
<span id="cb28-23"><a href="#cb28-23" tabindex="-1"></a><span class="co"># Finally, use head() to check coltypes are the same</span></span>
<span id="cb28-24"><a href="#cb28-24" tabindex="-1"></a><span class="fu">head</span>(slf_lyde3)</span>
<span id="cb28-25"><a href="#cb28-25" tabindex="-1"></a><span class="fu">head</span>(slf_gbif_coords3)</span>
<span id="cb28-26"><a href="#cb28-26" tabindex="-1"></a><span class="fu">head</span>(slf_published)</span>
<span id="cb28-27"><a href="#cb28-27" tabindex="-1"></a></span>
<span id="cb28-28"><a href="#cb28-28" tabindex="-1"></a><span class="co"># we see that the key column in the GBIF dataset is a double, while the key columns in the other 2 are characters. We will change this:</span></span>
<span id="cb28-29"><a href="#cb28-29" tabindex="-1"></a>slf_gbif_coords3<span class="sc">$</span>key <span class="ot">&lt;-</span>  <span class="fu">as.character</span>(slf_gbif_coords3<span class="sc">$</span>key)</span>
<span id="cb28-30"><a href="#cb28-30" tabindex="-1"></a></span>
<span id="cb28-31"><a href="#cb28-31" tabindex="-1"></a><span class="fu">head</span>(slf_gbif_coords3)</span>
<span id="cb28-32"><a href="#cb28-32" tabindex="-1"></a></span>
<span id="cb28-33"><a href="#cb28-33" tabindex="-1"></a><span class="co"># the conversion worked</span></span></code></pre></div>
</div>
</div>
<div id="final-data-tidying" class="section level1">
<h1>3. Final Data Tidying</h1>
<p>Now the data are in a format that is easier to join. We will join the
data and save the cleaned coordinates.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>slf_all_coords <span class="ot">&lt;-</span> slf_gbif_coords3 <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a>  <span class="fu">full_join</span>(., slf_lyde3) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="#cb29-3" tabindex="-1"></a>  <span class="fu">full_join</span>(., slf_published)</span></code></pre></div>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a><span class="fu">write_csv</span>(<span class="at">x =</span> slf_all_coords, <span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;vignette-outputs&quot;</span>, <span class="st">&quot;data-tables&quot;</span>, <span class="st">&quot;slf_all_coords_2024-08-05.csv&quot;</span>))</span></code></pre></div>
<div id="final-spatial-thinning" class="section level2">
<h2>3.1- Final spatial thinning</h2>
<p>The last step of tidying these data is to perform a second round of
spatial thinning. We need to do this again because after joining 3
different datasets together, some of the points may be within 1km of
each other. We will still use <code>CoordinateCleaner</code>, but this
time we will ditch <code>Humboldt</code> and use
<code>spThin::thin</code> to spatially thin the occurrence data.
<code>spThin::thin</code> has a more refined process for spatial
thinning and tools for analyzing the output.</p>
<p>The data will be rarefied to 10km over 10 passes. This will be done
once more on the final dataset. Spatial thinning should reduce
autocorrelation and sampling bias. Again, we will thin to a minimum of
1km distance between points. The results of the run should return the
thinned dataset and a text log file of the thinning run.</p>
<p>Both files will be written to the <code>vignettes-outputs</code>
folder, which holds intermediate data objects that are not the final
versions of the data.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" tabindex="-1"></a>slf_all_coords <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;vignette-outputs&quot;</span>, <span class="st">&quot;data-tables&quot;</span>, <span class="st">&quot;slf_all_coords_2024-08-05.csv&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" tabindex="-1"></a>slf_all_coords2 <span class="ot">&lt;-</span> spThin<span class="sc">::</span><span class="fu">thin</span>(</span>
<span id="cb32-2"><a href="#cb32-2" tabindex="-1"></a>  <span class="at">loc.data =</span> slf_all_coords, </span>
<span id="cb32-3"><a href="#cb32-3" tabindex="-1"></a>  <span class="at">lat.col =</span> <span class="st">&quot;latitude&quot;</span>, <span class="at">long.col =</span> <span class="st">&quot;longitude&quot;</span>,</span>
<span id="cb32-4"><a href="#cb32-4" tabindex="-1"></a>  <span class="at">spec.col =</span> <span class="st">&quot;species&quot;</span>,</span>
<span id="cb32-5"><a href="#cb32-5" tabindex="-1"></a>  <span class="at">thin.par =</span> <span class="dv">10</span>,</span>
<span id="cb32-6"><a href="#cb32-6" tabindex="-1"></a>  <span class="at">reps =</span> <span class="dv">10</span>, <span class="co"># number of passes</span></span>
<span id="cb32-7"><a href="#cb32-7" tabindex="-1"></a>  <span class="co"># line below returns a list of data frames with the locations were preserved</span></span>
<span id="cb32-8"><a href="#cb32-8" tabindex="-1"></a>  <span class="at">locs.thinned.list.return =</span> <span class="cn">TRUE</span>, </span>
<span id="cb32-9"><a href="#cb32-9" tabindex="-1"></a>  <span class="at">write.files =</span> <span class="cn">TRUE</span>, <span class="co"># returns list of thinned data as a separate .csv file</span></span>
<span id="cb32-10"><a href="#cb32-10" tabindex="-1"></a>  <span class="co"># next, create a file that logs the thinning run, write the path to and name of the log file</span></span>
<span id="cb32-11"><a href="#cb32-11" tabindex="-1"></a>  <span class="at">write.log.file =</span> <span class="cn">TRUE</span>, </span>
<span id="cb32-12"><a href="#cb32-12" tabindex="-1"></a>  <span class="at">log.file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;vignette-outputs&quot;</span>, <span class="st">&quot;data-tables&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;slf_all_coords_cleaned_thinning_log_2024-08-05.txt&quot;</span>)),</span>
<span id="cb32-13"><a href="#cb32-13" tabindex="-1"></a>  <span class="co"># finally, tell it where to write the new files and what to call the thinned dataset</span></span>
<span id="cb32-14"><a href="#cb32-14" tabindex="-1"></a>  <span class="at">out.dir =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;vignette-outputs&quot;</span>, <span class="st">&quot;data-tables&quot;</span>),</span>
<span id="cb32-15"><a href="#cb32-15" tabindex="-1"></a>  <span class="at">out.base =</span> <span class="fu">paste0</span>(<span class="st">&quot;slf_all_coords_cleaned_2024-08-05&quot;</span>),</span>
<span id="cb32-16"><a href="#cb32-16" tabindex="-1"></a>  <span class="at">verbose =</span> <span class="cn">TRUE</span> <span class="co"># give details of run in the console</span></span>
<span id="cb32-17"><a href="#cb32-17" tabindex="-1"></a>  )</span></code></pre></div>
<p>Basically, this function thins the data 10 different times and writes
the rep that was able to retain the most data points to a .csv file. The
resulting object is a list of the retained coordinates per run. These
data could be examined closer if there was a large difference in the
records kept per run or some other disparity.</p>
<p>Now that the data have been thinned, we will use
<code>spThin::plotThin</code> to plot the results of the run and check
its quality. Note, we will be plotting the actual data points in step
1.3; this function shows whether 10 is the optimal number of reps to
thin this dataset. It will plot the number of records retained vs the
number of reps.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" tabindex="-1"></a>spThin<span class="sc">::</span><span class="fu">plotThin</span>(<span class="at">thinned =</span> slf_all_coords2)</span></code></pre></div>
<p>It seems from plot 3 that 803 records were retained during more of
the reps. However, this is not very different from the maximum, so we
will keep the maximum of 805</p>
<p>Now, lets load in the final thinned dataset for a final round of
cleaning.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" tabindex="-1"></a>slf_all_coords2 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;vignette-outputs&quot;</span>, <span class="st">&quot;data-tables&quot;</span>, <span class="st">&quot;slf_all_coords_cleaned_2024-08-05_thin1.csv&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" tabindex="-1"></a><span class="co"># coordinate cleaner</span></span>
<span id="cb35-2"><a href="#cb35-2" tabindex="-1"></a>slf_all_coords_report <span class="ot">&lt;-</span> CoordinateCleaner<span class="sc">::</span><span class="fu">clean_coordinates</span>(</span>
<span id="cb35-3"><a href="#cb35-3" tabindex="-1"></a>  <span class="at">x =</span> slf_all_coords2, </span>
<span id="cb35-4"><a href="#cb35-4" tabindex="-1"></a>  <span class="at">lon =</span> <span class="st">&quot;longitude&quot;</span>,</span>
<span id="cb35-5"><a href="#cb35-5" tabindex="-1"></a>  <span class="at">lat =</span> <span class="st">&quot;latitude&quot;</span>,</span>
<span id="cb35-6"><a href="#cb35-6" tabindex="-1"></a>  <span class="at">species =</span> <span class="st">&quot;species&quot;</span>,</span>
<span id="cb35-7"><a href="#cb35-7" tabindex="-1"></a>  <span class="at">tests =</span> <span class="st">&quot;duplicates&quot;</span></span>
<span id="cb35-8"><a href="#cb35-8" tabindex="-1"></a>) <span class="sc">%&gt;%</span></span>
<span id="cb35-9"><a href="#cb35-9" tabindex="-1"></a>  <span class="fu">as.data.frame</span>()</span>
<span id="cb35-10"><a href="#cb35-10" tabindex="-1"></a></span>
<span id="cb35-11"><a href="#cb35-11" tabindex="-1"></a><span class="co"># no duplicates!</span></span>
<span id="cb35-12"><a href="#cb35-12" tabindex="-1"></a></span>
<span id="cb35-13"><a href="#cb35-13" tabindex="-1"></a><span class="co"># remove flagged records</span></span>
<span id="cb35-14"><a href="#cb35-14" tabindex="-1"></a>slf_all_coords2 <span class="ot">&lt;-</span> slf_all_coords_report <span class="sc">%&gt;%</span></span>
<span id="cb35-15"><a href="#cb35-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(.summary <span class="sc">==</span> <span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> <span class="co"># FALSE records are potentially problematic</span></span>
<span id="cb35-16"><a href="#cb35-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(species<span class="sc">:</span>latitude)</span></code></pre></div>
</div>
<div id="save-output-for-maxent" class="section level2">
<h2>3.2- Save output for MaxEnt</h2>
<p>We will finally convert the slf coordinates to the format that will
be used by MaxEnt and save it. That is, the first column “species” must
be the species name, the second column “x” must be the longitude, and
the third column “y” must be the latitude.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" tabindex="-1"></a><span class="co"># rename columns</span></span>
<span id="cb36-2"><a href="#cb36-2" tabindex="-1"></a>slf_all_coords3 <span class="ot">&lt;-</span> slf_all_coords2 <span class="sc">%&gt;%</span></span>
<span id="cb36-3"><a href="#cb36-3" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="st">&quot;x&quot;</span> <span class="ot">=</span> <span class="st">&quot;longitude&quot;</span>,</span>
<span id="cb36-4"><a href="#cb36-4" tabindex="-1"></a>         <span class="st">&quot;y&quot;</span> <span class="ot">=</span> <span class="st">&quot;latitude&quot;</span>)</span>
<span id="cb36-5"><a href="#cb36-5" tabindex="-1"></a></span>
<span id="cb36-6"><a href="#cb36-6" tabindex="-1"></a></span>
<span id="cb36-7"><a href="#cb36-7" tabindex="-1"></a><span class="co"># save</span></span>
<span id="cb36-8"><a href="#cb36-8" tabindex="-1"></a><span class="fu">write_csv</span>(<span class="at">x =</span> slf_all_coords3, <span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;vignette-outputs&quot;</span>, <span class="st">&quot;data-tables&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;slf_all_coords_final_2024-08-05.csv&quot;</span>)))</span>
<span id="cb36-9"><a href="#cb36-9" tabindex="-1"></a></span>
<span id="cb36-10"><a href="#cb36-10" tabindex="-1"></a><span class="co"># also save as a .rds file</span></span>
<span id="cb36-11"><a href="#cb36-11" tabindex="-1"></a><span class="fu">write_rds</span>(slf_all_coords3, <span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;data&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;slf_all_coords_final_2024-08-05.rds&quot;</span>)))</span></code></pre></div>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" tabindex="-1"></a>slf_all_coords3 <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="at">file =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;vignette-outputs&quot;</span>, <span class="st">&quot;data-tables&quot;</span>, <span class="st">&quot;slf_all_coords_final_2024-08-05.csv&quot;</span>))</span></code></pre></div>
<pre><code>## [1mRows: [22m[34m805[39m [1mColumns: [22m[34m3[39m
## [36m──[39m [1mColumn specification[22m [36m────────────────────────────────────────────────────────[39m
## [1mDelimiter:[22m &quot;,&quot;
## [31mchr[39m (1): species
## [32mdbl[39m (2): x, y
## 
## [36mℹ[39m Use `spec()` to retrieve the full column specification for this data.
## [36mℹ[39m Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" tabindex="-1"></a> map_all <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb39-2"><a href="#cb39-2" tabindex="-1"></a>    <span class="co"># basemap</span></span>
<span id="cb39-3"><a href="#cb39-3" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> countries_sf, <span class="fu">aes</span>(<span class="at">geometry =</span> geometry), <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb39-4"><a href="#cb39-4" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> slf_all_coords3, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">color =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb39-5"><a href="#cb39-5" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">164.5</span>, <span class="fl">163.5</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">55</span>, <span class="dv">85</span>)) <span class="sc">+</span></span>
<span id="cb39-6"><a href="#cb39-6" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;All SLF presences&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-7"><a href="#cb39-7" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-8"><a href="#cb39-8" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-9"><a href="#cb39-9" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb39-10"><a href="#cb39-10" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb39-11"><a href="#cb39-11" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb39-12"><a href="#cb39-12" tabindex="-1"></a></span>
<span id="cb39-13"><a href="#cb39-13" tabindex="-1"></a> map_all_NAmerica <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb39-14"><a href="#cb39-14" tabindex="-1"></a>    <span class="co"># basemap</span></span>
<span id="cb39-15"><a href="#cb39-15" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> countries_sf, <span class="fu">aes</span>(<span class="at">geometry =</span> geometry), <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb39-16"><a href="#cb39-16" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> slf_all_coords3, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">color =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb39-17"><a href="#cb39-17" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">133.593750</span>, <span class="sc">-</span><span class="fl">52.294922</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">25.085599</span>, <span class="fl">55.304138</span>)) <span class="sc">+</span></span>
<span id="cb39-18"><a href="#cb39-18" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;SLF presences N America&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-19"><a href="#cb39-19" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-20"><a href="#cb39-20" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-21"><a href="#cb39-21" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb39-22"><a href="#cb39-22" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb39-23"><a href="#cb39-23" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb39-24"><a href="#cb39-24" tabindex="-1"></a> </span>
<span id="cb39-25"><a href="#cb39-25" tabindex="-1"></a>  map_all_Asia <span class="ot">&lt;-</span> <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb39-26"><a href="#cb39-26" tabindex="-1"></a>    <span class="co"># basemap</span></span>
<span id="cb39-27"><a href="#cb39-27" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="at">data =</span> countries_sf, <span class="fu">aes</span>(<span class="at">geometry =</span> geometry), <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="fl">0.15</span>) <span class="sc">+</span></span>
<span id="cb39-28"><a href="#cb39-28" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">data =</span> slf_all_coords3, <span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y), <span class="at">color =</span> <span class="st">&quot;darkorange&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb39-29"><a href="#cb39-29" tabindex="-1"></a>    <span class="fu">coord_sf</span>(<span class="at">xlim =</span> <span class="fu">c</span>(<span class="fl">68.906250</span>, <span class="fl">152.534180</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="fl">8.928487</span>, <span class="fl">45.920587</span>)) <span class="sc">+</span></span>
<span id="cb39-30"><a href="#cb39-30" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;SLF presences Asia&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-31"><a href="#cb39-31" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-32"><a href="#cb39-32" tabindex="-1"></a>          <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb39-33"><a href="#cb39-33" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span></span>
<span id="cb39-34"><a href="#cb39-34" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb39-35"><a href="#cb39-35" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.title =</span> <span class="fu">element_blank</span>())</span>
<span id="cb39-36"><a href="#cb39-36" tabindex="-1"></a></span>
<span id="cb39-37"><a href="#cb39-37" tabindex="-1"></a><span class="co"># patchwork</span></span>
<span id="cb39-38"><a href="#cb39-38" tabindex="-1"></a>map_all_NAmerica <span class="sc">+</span> map_all_Asia <span class="sc">+</span></span>
<span id="cb39-39"><a href="#cb39-39" tabindex="-1"></a><span class="fu">plot_layout</span>(<span class="at">nrow =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="020_retrieve_SLF_records_files/figure-html/map%20all%20points-1.png" width="700" /></p>
<p>From the map, we can see the final points that were selected. We have
a good spread across the native range and better spread than before in
the invaded range. This version of the total dataset included newer data
from lydemapr, so we now have better coverage in the invaded range. I
will also check the number of points in the native vs the invaded
range.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" tabindex="-1"></a>SLF_by_longitude <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> slf_all_coords3) <span class="sc">+</span></span>
<span id="cb40-2"><a href="#cb40-2" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">x =</span> x)) <span class="sc">+</span></span>
<span id="cb40-3"><a href="#cb40-3" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;count of SLF presence records invaded vs native range&quot;</span>) <span class="sc">+</span></span>
<span id="cb40-4"><a href="#cb40-4" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">caption =</span> <span class="st">&quot;the longitudinal range between the two dashed lines represents the native range for SLF&quot;</span>) <span class="sc">+</span></span>
<span id="cb40-5"><a href="#cb40-5" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;longitude&quot;</span>) <span class="sc">+</span></span>
<span id="cb40-6"><a href="#cb40-6" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;count of SLF presences&quot;</span>) <span class="sc">+</span></span>
<span id="cb40-7"><a href="#cb40-7" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">73.37</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb40-8"><a href="#cb40-8" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fl">124.06</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb40-9"><a href="#cb40-9" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span>
<span id="cb40-10"><a href="#cb40-10" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" tabindex="-1"></a>SLF_by_longitude</span></code></pre></div>
<p><img src="020_retrieve_SLF_records_files/figure-html/number%20points%20invaded%20vs%20native%20range-1.png" width="700" /></p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" tabindex="-1"></a><span class="co"># save output</span></span>
<span id="cb41-2"><a href="#cb41-2" tabindex="-1"></a><span class="fu">ggsave</span>(</span>
<span id="cb41-3"><a href="#cb41-3" tabindex="-1"></a>  SLF_by_longitude, <span class="at">filename =</span> <span class="fu">file.path</span>(here<span class="sc">::</span><span class="fu">here</span>(), <span class="st">&quot;vignette-outputs&quot;</span>, <span class="st">&quot;figures&quot;</span>, <span class="st">&quot;SLF_all_coords_final_by_longitude.jpg&quot;</span>),</span>
<span id="cb41-4"><a href="#cb41-4" tabindex="-1"></a>  <span class="at">height =</span> <span class="dv">8</span>, </span>
<span id="cb41-5"><a href="#cb41-5" tabindex="-1"></a>  <span class="at">width =</span> <span class="dv">10</span>,</span>
<span id="cb41-6"><a href="#cb41-6" tabindex="-1"></a>  <span class="at">device =</span> jpeg,</span>
<span id="cb41-7"><a href="#cb41-7" tabindex="-1"></a>  <span class="at">dpi =</span> <span class="dv">500</span></span>
<span id="cb41-8"><a href="#cb41-8" tabindex="-1"></a>  )</span></code></pre></div>
<p>The native range includes longitudes between 35 and 105. We can see
that most of the SLF presence data are from the invaded ranges of Japan,
South Korea or the United States. This is a weakness in the data
available and we have given our best effort to account for it by
including presence data for China from the literature.</p>
<p>We now have half of the data we need to perform SDM! In the next
vignette, we will download historical and projected climate and human
impact data, which are the basis of our methods for predicting
suitability for Lycorma delicatula.</p>
</div>
</div>
<div id="references" class="section level1">
<h1>References</h1>
<ol style="list-style-type: decimal">
<li><p>De Bona, S., Barringer, L., Kurtz, P., Losiewicz, J., Parra, G.
R., &amp; Helmus, M. R. (2023). lydemapr: An R package to track the
spread of the invasive spotted lanternfly (Lycorma delicatula, White
1845) (Hemiptera, Fulgoridae) in the United States. NeoBiota, 86,
151–168. <a href="https://doi.org/10.3897/neobiota.86.101471"
class="uri">https://doi.org/10.3897/neobiota.86.101471</a></p></li>
<li><p>GBIF Occurrence Download <a
href="https://doi.org/10.15468/dl.59gndc"
class="uri">https://doi.org/10.15468/dl.59gndc</a> Accessed from R via
rgbif (<a href="https://github.com/ropensci/rgbif"
class="uri">https://github.com/ropensci/rgbif</a>) on
2024-08-05</p></li>
<li><p>Huron, N. A., Behm, J. E., &amp; Helmus, M. R. (2022).
Paninvasion severity assessment of a U.S. grape pest to disrupt the
global wine market. Communications Biology, 5(1), 655. <a
href="https://doi.org/10.1038/s42003-022-03580-w"
class="uri">https://doi.org/10.1038/s42003-022-03580-w</a></p></li>
<li><p>Lin, Y.-S., &amp; Liao, J.-R. (2024). Multifaceted Investigation
into the Absence and Potential Invasion of Spotted Lanternfly (Lycorma
delicatula) in Taiwan. Research Square. <a
href="https://doi.org/10.21203/rs.3.rs-4832573/v1"
class="uri">https://doi.org/10.21203/rs.3.rs-4832573/v1</a></p></li>
</ol>
<!--

# Appendix 

## Visualize changes in GBIF records over time


``` r
# new data
slf_new <- readr::read_csv(file = file.path(here::here(), "data-raw", "data-old", "slf_gbif_cleaned_2024-08-05.csv"))

# old data
slf_old <- readr::read_csv(file = file.path(here::here(), "vignette-outputs", "data-tables", "slf_gbif_cleaned_2024-01-05.csv"))

# plot SLF
map_slf <- ggplot() +
  # basemap
  geom_sf(data = countries_sf, aes(geometry = geometry), fill = NA, color = "black", lwd = 0.15) +
  geom_point(data = slf_new, aes(x = longitude, y = latitude), color = "darkorange", size = 2) +
  geom_point(data = slf_old, aes(x = x, y = y), color = "blue", shape = 2) +
  coord_sf(xlim = c(-164.5, 163.5), ylim = c(-55, 85)) +
  ggtitle("SLF new points (darkorange) vs old (blue)") +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        panel.background = element_blank()) +
  theme_bw()

# The old points are in blue and the new points are in darkorange
```

-->
</div>
<div class="footnotes footnotes-end-of-document">
<hr />
<ol>
<li id="fn1"><p>Temple University <a
href="http://www.biodiversitycenter.org/">Center for Biodiversity</a> <a
href="https://www.iecolab.org/">iEco Lab</a> <a
href="mailto:sam.owens@temple.edu"
class="email">sam.owens@temple.edu</a><a href="#fnref1"
class="footnote-back">↩︎</a></p></li>
</ol>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Samuel M. Owens, Matthew R. Helmus.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>
