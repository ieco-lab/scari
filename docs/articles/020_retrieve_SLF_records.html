<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Retrieve SLF records from various sources and tidy them for MaxEnt modeling • slfSpread</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Retrieve SLF records from various sources and tidy them for MaxEnt modeling">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">slfSpread</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/slfSpread.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Quantify risk to specific viticultural regions</h6></li>
    <li><a class="dropdown-item" href="../articles/150_create_risk_report.html">Example usage of create_risk_report.R to create reports of key viticultural areas</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Initialize slfSpread</h6></li>
    <li><a class="dropdown-item" href="../articles/010_initialize_pkg.html">Initialization of renv package for dependencies</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>1. Retrieve and tidy input data for MaxEnt</h6></li>
    <li><a class="dropdown-item" href="../articles/020_retrieve_SLF_records.html">Retrieve SLF records from various sources and tidy them for MaxEnt modeling</a></li>
    <li><a class="dropdown-item" href="../articles/030_retrieve_bioclim_variables.html">Retrieve bioclim rasters from CHELSA and tidy them for MaxEnt modeling</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>2. SDM modeling pipeline</h6></li>
    <li><a class="dropdown-item" href="../articles/040_setup_global_MaxEnt_model.html">Setup for global-scale MaxEnt model</a></li>
    <li><a class="dropdown-item" href="../articles/050_run_global_MaxEnt_model.html">Run global-scale MaxEnt model</a></li>
    <li><a class="dropdown-item" href="../articles/060_setup_regional_MaxEnt_models.html">Setup for regional-scale MaxEnt models</a></li>
    <li><a class="dropdown-item" href="../articles/070_run_regional_invaded_MaxEnt_model.html">Run 'Ri.NAmerica' model trained on SLF invaded region in North America</a></li>
    <li><a class="dropdown-item" href="../articles/080_run_regional_invaded_asian_MaxEnt_model.html">Run 'Ri.Asia' model trained on SLF invaded range in Japan and South Korea</a></li>
    <li><a class="dropdown-item" href="../articles/090_run_regional_native_MaxEnt_model.html">Run 'Rn' model trained on SLF native range in east Asia</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>3. Ensemble Regional-scale SDMs</h6></li>
    <li><a class="dropdown-item" href="../articles/100_run_ExDet_MIC.html">Run an Extrapolation Detection (NT2) analysis and calculate MIC</a></li>
    <li><a class="dropdown-item" href="../articles/110_ensemble_regional_models.html">Ensemble regional-scale models into a single prediction</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>4. Quantify SLF risk and model fit</h6></li>
    <li><a class="dropdown-item" href="../articles/120_create_suitability_maps.html">Map regional ensemble predictions and intercept with global model</a></li>
    <li><a class="dropdown-item" href="../articles/130_create_suitability_xy_plots_viticultural.html">Plot shift in SLF suitability for important viticultural regions under climate change</a></li>
    <li><a class="dropdown-item" href="../articles/131_create_suitability_xy_plots_SLF.html">Plot stability of known SLF populations due climate change effects</a></li>
    <li><a class="dropdown-item" href="../articles/140_plot_response_curves.html">Plot response curves</a></li>
    <li><a class="dropdown-item" href="../articles/141_plot_AUC_var_cont.html">Plot AUC curves and variable contribution graphs</a></li>
    <li><a class="dropdown-item" href="../articles/142_calculate_model_fit.html">Calculate model fit statistics</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ieco-lab/slfSpread/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Retrieve SLF records from various sources and tidy them for MaxEnt modeling</h1>
                        <h4 data-toc-skip class="author">Samuel M.
Owens<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Temple University, &lt;a href="mailto:sam.owens@temple.edu" class="email"&gt;sam.owens@temple.edu&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a>
</h4>
            
            <h4 data-toc-skip class="date">2024-08-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ieco-lab/slfSpread/blob/HEAD/vignettes/020_retrieve_SLF_records.Rmd" class="external-link"><code>vignettes/020_retrieve_SLF_records.Rmd</code></a></small>
      <div class="d-none name"><code>020_retrieve_SLF_records.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette will provide instructions to retrieve <em>Lycorma
delicatula</em> (SLF) presence records for the future creation of MaxEnt
models. MaxEnt is a presence-only modeling software, and so it does not
require recorded absence data to predict the suitable area for SLF. Four
categories of data sources will be used in this analysis: <a href="https://www.gbif.org/" class="external-link">GBIF</a> (Global Biodiversity Information
Facility), <a href="https://github.com/ieco-lab/lydemapr" class="external-link">lydemapR</a>,
various pieces of peer-reviewed literature, and natural history notes.
These data will then be tidied, spatially thinned and compiled into a
single <code>.rds</code> file of SLF presence records that can be loaded
into MaxEnt.</p>
<p>The first step will be to retrieve data from <code>GBIF</code> and
<code>lydemapR</code>. <code>GBIF</code> is an open-access platform for
biodiversity data that gathers from various databases and citizen
science platforms. Data from this source represents globally distributed
presences of SLF. The <code>lyde()</code> function within the
<code>Lydemapr</code> package gives access to nearly one million SLF
presence records within the United States, largely obtained from
biological field surveys by various state and federal departments of
agriculture.</p>
<p>These data will need to be cleaned and tidied during this step. To
get to this tidy dataset, the data will be checked for inconsistent and
false records. The data will also be spatially thinned so that points
are no less than 10km (the resolution of the climate data, 5 arcminutes)
to eliminate the effects of sampling bias.</p>
<p>The second step will be to combine these records with data gathered
from peer-reviewed literature and from natural history notes. A majority
of these records are from established populations of SLF within China,
South Korea and southeast Asia. These records are especially important
because China and southeast Asia represent the native range for SLF, and
there is very little data on the extent of its native range. These
records are also important because MaxEnt correlates presence records
with the local climate; thus, if there is very little characterization
of the native range for this species, it is unlikely that models for SLF
will make realistic predictions for its potential niche elsewhere.</p>
<p>The final step of this analysis will be to organize the different
datasets into a single <code>.rds</code> file that can be loaded into
MaxEnt. MaxEnt requires that input datasets contain only 3 columns, in
this order: <code>species</code> (the scientific name of the species),
<code>x</code> (longitude), and <code>y</code> (latitude). Lastly, the
data will go through a second round of spatial thinning now that the
datasets have been joined.</p>
<p>Note, many of these chunks require high memory allocation or simply
take a long time to run. The chunks that use
<code><a href="https://rdrr.io/pkg/humboldt/man/humboldt.occ.rarefy.html" class="external-link">humboldt::humboldt.occ.rarefy()</a></code> for spatial thinning will
take a very long time to run. The chunks that use
<code><a href="https://rdrr.io/pkg/spThin/man/thin.html" class="external-link">spThin::thin()</a></code> require a high memory allocation.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>First, I will load in the necessary packages.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>  <span class="co">#data manipulation</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span> <span class="co">#making directory pathways easier on different instances</span></span>
<span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "C:/Users/tun83449/Documents/GitHub/slfSpread"</span></span></code></pre>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># here() is set at the root folder of this package</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span> <span class="co"># installing packages not from CRAN</span></span>
<span><span class="co"># devtools::install_github("ieco-lab/lydemapr", build_vignettes = FALSE)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ieco-lab/lydemapr" class="external-link">lydemapr</a></span><span class="op">)</span> <span class="co"># field survey data for SLF</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/taxize/" class="external-link">taxize</a></span><span class="op">)</span> <span class="co"># get taxonomic ids</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rgbif" class="external-link">rgbif</a></span><span class="op">)</span> <span class="co">#query gbif and format as a dataframe</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">spThin</span><span class="op">)</span> <span class="co"># spatial thinning of occurrence points</span></span>
<span><span class="co"># install_github("jasonleebrown/humboldt")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">humboldt</span><span class="op">)</span> <span class="co"># spatial thinning of points</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ropensci.github.io/CoordinateCleaner/" class="external-link">CoordinateCleaner</a></span><span class="op">)</span> <span class="co"># tidying of points</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span> <span class="co">#nice plots</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span> <span class="co"># nice rmd tables</span></span></code></pre></div>
<p><strong>Note:</strong> I will be setting the global options of this
document so that only certain code chunks are rendered in the final
.html file. I will set the <code>eval = FALSE</code> so that none of the
code is re-run (preventing files from being overwritten during knitting)
and will simply overwrite this in chunks with plots.</p>
<p>Most of this compendium and its functions are built on the
<code>tidyverse</code> language. The <code>here</code> package starts
file pathing from the root folder of my <code>slfSpread</code> package,
allowing easier sharing. The <code>rgbif</code> package will be used to
query records from <code>GBIF</code>, while the <code>lydemapr</code>
package will be used to retrieve field survey data in the United States.
<code>humboldt</code> makes for easy spatial thinning of points, while
<code>spThin</code> is more thorough and evocative for thinning (both
will be used). Package <code>taxize</code> will allow the retrieval of
taxonomic IDs within <code>GBIF</code>.</p>
</div>
<div class="section level2">
<h2 id="retrieve-data-from-gbif-and-lydemapr-and-tidy">1. Retrieve data from GBIF and lydemapR and tidy<a class="anchor" aria-label="anchor" href="#retrieve-data-from-gbif-and-lydemapr-and-tidy"></a>
</h2>
<div class="section level3">
<h3 id="gbif-via-rgbif">1.1- GBIF via rgbif<a class="anchor" aria-label="anchor" href="#gbif-via-rgbif"></a>
</h3>
<p>I will begin by retrieving the GBIF taxonomic ID for Lycorma
delicatula.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get species ID from gbif database</span></span>
<span><span class="va">ids</span> <span class="op">&lt;-</span> <span class="fu">taxize</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/taxize/reference/get_ids.html" class="external-link">get_ids</a></span><span class="op">(</span>sci_com <span class="op">=</span> <span class="st">"Lycorma delicatula"</span>, db <span class="op">=</span> <span class="st">"gbif"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #0000BB;">══</span>  db: gbif <span style="color: #0000BB;">═════════════════</span></span></span>
<span><span class="co">## <span style="color: #0000BB;">══</span>  1 queries  <span style="color: #0000BB;">═══════════════</span></span></span></code></pre>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Retrieving data for taxon 'Lycorma delicatula'</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #00BB00;">✔  Found: </span> Lycorma delicatula</span></span>
<span><span class="co">## <span style="color: #B2B2B2;">══</span>  Results  <span style="color: #B2B2B2;">═════════════════</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## • Total: <span style="color: #00BB00;">1</span> </span></span>
<span><span class="co">## • Found: <span style="color: #00BB00;">1</span> </span></span>
<span><span class="co">## • Not Found: <span style="color: #00BB00;">0</span></span></span></code></pre>
<p>I will also perform a few operations specific to rgbif. I will need
to enter my user credentials for gbif; to keep these private, I will
edit the .Renviron and call them from there. Once this chunk is run and
the .Renviron pops up, enter your username, password and email
credentials in the following format on lines 1-3:</p>
<ul>
<li>GBIF_USER=” ”</li>
<li>GBIF_PWD=” ”</li>
<li>GBIF_EMAIL=” ”</li>
</ul>
<p>Save and close the document.</p>
<p>I will also retrieve a list of country abbreviations to tailor the
download. I will be excluding countries in North America (USA, Mexico,
Canada) and Taiwan. Lin and Liao did a comprehensive survey for SLF in
Taiwan to validate SLF presence records in online repositories and found
that these records were likely false (Lin and Liao, 2024).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># edit R environment for user credentials</span></span>
<span><span class="fu">usethis</span><span class="fu">::</span><span class="fu"><a href="https://usethis.r-lib.org/reference/edit.html" class="external-link">edit_r_environ</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #BB0000;">☐</span> Edit <span style="color: #0000BB;">C:/Users/tun83449/Documents/.Renviron</span>.</span></span></code></pre>
<pre><code><span><span class="co">## <span style="color: #BB0000;">☐</span> Restart R for changes to take effect.</span></span></code></pre>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get list of countries</span></span>
<span><span class="fu">rgbif</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/enumeration.html" class="external-link">enumeration_country</a></span><span class="op">(</span>curlopts <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     iso2 iso3 isoNumerical                                                title</span></span>
<span><span class="co">## 1     AF  AFG            4                                          Afghanistan</span></span>
<span><span class="co">## 2     AX  ALA          248                                        Åland Islands</span></span>
<span><span class="co">## 3     AL  ALB            8                                              Albania</span></span>
<span><span class="co">## 4     DZ  DZA           12                                              Algeria</span></span>
<span><span class="co">## 5     AS  ASM           16                                       American Samoa</span></span>
<span><span class="co">## 6     AD  AND           20                                              Andorra</span></span>
<span><span class="co">## 7     AO  AGO           24                                               Angola</span></span>
<span><span class="co">## 8     AI  AIA          660                                             Anguilla</span></span>
<span><span class="co">## 9     AQ  ATA           10                                           Antarctica</span></span>
<span><span class="co">## 10    AG  ATG           28                                  Antigua and Barbuda</span></span>
<span><span class="co">## 11    AR  ARG           32                                            Argentina</span></span>
<span><span class="co">## 12    AM  ARM           51                                              Armenia</span></span>
<span><span class="co">## 13    AW  ABW          533                                                Aruba</span></span>
<span><span class="co">## 14    AU  AUS           36                                            Australia</span></span>
<span><span class="co">## 15    AT  AUT           40                                              Austria</span></span>
<span><span class="co">## 16    AZ  AZE           31                                           Azerbaijan</span></span>
<span><span class="co">## 17    BS  BHS           44                                              Bahamas</span></span>
<span><span class="co">## 18    BH  BHR           48                                              Bahrain</span></span>
<span><span class="co">## 19    BD  BGD           50                                           Bangladesh</span></span>
<span><span class="co">## 20    BB  BRB           52                                             Barbados</span></span>
<span><span class="co">## 21    BY  BLR          112                                              Belarus</span></span>
<span><span class="co">## 22    BE  BEL           56                                              Belgium</span></span>
<span><span class="co">## 23    BZ  BLZ           84                                               Belize</span></span>
<span><span class="co">## 24    BJ  BEN          204                                                Benin</span></span>
<span><span class="co">## 25    BM  BMU           60                                              Bermuda</span></span>
<span><span class="co">## 26    BT  BTN           64                                               Bhutan</span></span>
<span><span class="co">## 27    BO  BOL           68                     Bolivia (Plurinational State of)</span></span>
<span><span class="co">## 28    BQ  BES          535                     Bonaire, Sint Eustatius and Saba</span></span>
<span><span class="co">## 29    BA  BIH           70                               Bosnia and Herzegovina</span></span>
<span><span class="co">## 30    BW  BWA           72                                             Botswana</span></span>
<span><span class="co">## 31    BV  BVT           74                                        Bouvet Island</span></span>
<span><span class="co">## 32    BR  BRA           76                                               Brazil</span></span>
<span><span class="co">## 33    IO  IOT           86                       British Indian Ocean Territory</span></span>
<span><span class="co">## 34    BN  BRN           96                                    Brunei Darussalam</span></span>
<span><span class="co">## 35    BG  BGR          100                                             Bulgaria</span></span>
<span><span class="co">## 36    BF  BFA          854                                         Burkina Faso</span></span>
<span><span class="co">## 37    BI  BDI          108                                              Burundi</span></span>
<span><span class="co">## 38    KH  KHM          116                                             Cambodia</span></span>
<span><span class="co">## 39    CM  CMR          120                                             Cameroon</span></span>
<span><span class="co">## 40    CA  CAN          124                                               Canada</span></span>
<span><span class="co">## 41    CV  CPV          132                                           Cabo Verde</span></span>
<span><span class="co">## 42    KY  CYM          136                                       Cayman Islands</span></span>
<span><span class="co">## 43    CF  CAF          140                             Central African Republic</span></span>
<span><span class="co">## 44    TD  TCD          148                                                 Chad</span></span>
<span><span class="co">## 45    CL  CHL          152                                                Chile</span></span>
<span><span class="co">## 46    CN  CHN          156                                                China</span></span>
<span><span class="co">## 47    CX  CXR          162                                     Christmas Island</span></span>
<span><span class="co">## 48    CC  CCK          166                              Cocos (Keeling) Islands</span></span>
<span><span class="co">## 49    CO  COL          170                                             Colombia</span></span>
<span><span class="co">## 50    KM  COM          174                                              Comoros</span></span>
<span><span class="co">## 51    CD  COD          180                    Congo, Democratic Republic of the</span></span>
<span><span class="co">## 52    CG  COG          178                                                Congo</span></span>
<span><span class="co">## 53    CK  COK          184                                         Cook Islands</span></span>
<span><span class="co">## 54    CR  CRI          188                                           Costa Rica</span></span>
<span><span class="co">## 55    CI  CIV          384                                        Côte d’Ivoire</span></span>
<span><span class="co">## 56    HR  HRV          191                                              Croatia</span></span>
<span><span class="co">## 57    CU  CUB          192                                                 Cuba</span></span>
<span><span class="co">## 58    CW  CUW          531                                              Curaçao</span></span>
<span><span class="co">## 59    CY  CYP          196                                               Cyprus</span></span>
<span><span class="co">## 60    CZ  CZE          203                                              Czechia</span></span>
<span><span class="co">## 61    DK  DNK          208                                              Denmark</span></span>
<span><span class="co">## 62    DJ  DJI          262                                             Djibouti</span></span>
<span><span class="co">## 63    DM  DMA          212                                             Dominica</span></span>
<span><span class="co">## 64    DO  DOM          214                                   Dominican Republic</span></span>
<span><span class="co">## 65    EC  ECU          218                                              Ecuador</span></span>
<span><span class="co">## 66    EG  EGY          818                                                Egypt</span></span>
<span><span class="co">## 67    SV  SLV          222                                          El Salvador</span></span>
<span><span class="co">## 68    GQ  GNQ          226                                    Equatorial Guinea</span></span>
<span><span class="co">## 69    ER  ERI          232                                              Eritrea</span></span>
<span><span class="co">## 70    EE  EST          233                                              Estonia</span></span>
<span><span class="co">## 71    ET  ETH          231                                             Ethiopia</span></span>
<span><span class="co">## 72    FK  FLK          238                          Falkland Islands (Malvinas)</span></span>
<span><span class="co">## 73    FO  FRO          234                                        Faroe Islands</span></span>
<span><span class="co">## 74    FJ  FJI          242                                                 Fiji</span></span>
<span><span class="co">## 75    FI  FIN          246                                              Finland</span></span>
<span><span class="co">## 76    FR  FRA          250                                               France</span></span>
<span><span class="co">## 77    GF  GUF          254                                        French Guiana</span></span>
<span><span class="co">## 78    PF  PYF          258                                     French Polynesia</span></span>
<span><span class="co">## 79    TF  ATF          260                          French Southern Territories</span></span>
<span><span class="co">## 80    GA  GAB          266                                                Gabon</span></span>
<span><span class="co">## 81    GM  GMB          270                                               Gambia</span></span>
<span><span class="co">## 82    GE  GEO          268                                              Georgia</span></span>
<span><span class="co">## 83    DE  DEU          276                                              Germany</span></span>
<span><span class="co">## 84    GH  GHA          288                                                Ghana</span></span>
<span><span class="co">## 85    GI  GIB          292                                            Gibraltar</span></span>
<span><span class="co">## 86    GR  GRC          300                                               Greece</span></span>
<span><span class="co">## 87    GL  GRL          304                                            Greenland</span></span>
<span><span class="co">## 88    GD  GRD          308                                              Grenada</span></span>
<span><span class="co">## 89    GP  GLP          312                                           Guadeloupe</span></span>
<span><span class="co">## 90    GU  GUM          316                                                 Guam</span></span>
<span><span class="co">## 91    GT  GTM          320                                            Guatemala</span></span>
<span><span class="co">## 92    GG  GGY          831                                             Guernsey</span></span>
<span><span class="co">## 93    GN  GIN          324                                               Guinea</span></span>
<span><span class="co">## 94    GW  GNB          624                                        Guinea-Bissau</span></span>
<span><span class="co">## 95    GY  GUY          328                                               Guyana</span></span>
<span><span class="co">## 96    HT  HTI          332                                                Haiti</span></span>
<span><span class="co">## 97    HM  HMD          334                    Heard Island and McDonald Islands</span></span>
<span><span class="co">## 98    VA  VAT          336                                             Holy See</span></span>
<span><span class="co">## 99    HN  HND          340                                             Honduras</span></span>
<span><span class="co">## 100   HK  HKG          344                                            Hong Kong</span></span>
<span><span class="co">## 101   HU  HUN          348                                              Hungary</span></span>
<span><span class="co">## 102   IS  ISL          352                                              Iceland</span></span>
<span><span class="co">## 103   IN  IND          356                                                India</span></span>
<span><span class="co">## 104   ID  IDN          360                                            Indonesia</span></span>
<span><span class="co">## 105   IR  IRN          364                           Iran (Islamic Republic of)</span></span>
<span><span class="co">## 106   IQ  IRQ          368                                                 Iraq</span></span>
<span><span class="co">## 107   IE  IRL          372                                              Ireland</span></span>
<span><span class="co">## 108   IM  IMN          833                                          Isle of Man</span></span>
<span><span class="co">## 109   IL  ISR          376                                               Israel</span></span>
<span><span class="co">## 110   IT  ITA          380                                                Italy</span></span>
<span><span class="co">## 111   JM  JAM          388                                              Jamaica</span></span>
<span><span class="co">## 112   JP  JPN          392                                                Japan</span></span>
<span><span class="co">## 113   JE  JEY          832                                               Jersey</span></span>
<span><span class="co">## 114   JO  JOR          400                                               Jordan</span></span>
<span><span class="co">## 115   KZ  KAZ          398                                           Kazakhstan</span></span>
<span><span class="co">## 116   KE  KEN          404                                                Kenya</span></span>
<span><span class="co">## 117   KI  KIR          296                                             Kiribati</span></span>
<span><span class="co">## 118   KP  PRK          408              Korea (Democratic People’s Republic of)</span></span>
<span><span class="co">## 119   KR  KOR          410                                   Korea, Republic of</span></span>
<span><span class="co">## 120   KW  KWT          414                                               Kuwait</span></span>
<span><span class="co">## 121   KG  KGZ          417                                           Kyrgyzstan</span></span>
<span><span class="co">## 122   LA  LAO          418                     Lao People’s Democratic Republic</span></span>
<span><span class="co">## 123   LV  LVA          428                                               Latvia</span></span>
<span><span class="co">## 124   LB  LBN          422                                              Lebanon</span></span>
<span><span class="co">## 125   LS  LSO          426                                              Lesotho</span></span>
<span><span class="co">## 126   LR  LBR          430                                              Liberia</span></span>
<span><span class="co">## 127   LY  LBY          434                                                Libya</span></span>
<span><span class="co">## 128   LI  LIE          438                                        Liechtenstein</span></span>
<span><span class="co">## 129   LT  LTU          440                                            Lithuania</span></span>
<span><span class="co">## 130   LU  LUX          442                                           Luxembourg</span></span>
<span><span class="co">## 131   MO  MAC          446                                                Macao</span></span>
<span><span class="co">## 132   MK  MKD          807                                      North Macedonia</span></span>
<span><span class="co">## 133   MG  MDG          450                                           Madagascar</span></span>
<span><span class="co">## 134   MW  MWI          454                                               Malawi</span></span>
<span><span class="co">## 135   MY  MYS          458                                             Malaysia</span></span>
<span><span class="co">## 136   MV  MDV          462                                             Maldives</span></span>
<span><span class="co">## 137   ML  MLI          466                                                 Mali</span></span>
<span><span class="co">## 138   MT  MLT          470                                                Malta</span></span>
<span><span class="co">## 139   MH  MHL          584                                     Marshall Islands</span></span>
<span><span class="co">## 140   MQ  MTQ          474                                           Martinique</span></span>
<span><span class="co">## 141   MR  MRT          478                                           Mauritania</span></span>
<span><span class="co">## 142   MU  MUS          480                                            Mauritius</span></span>
<span><span class="co">## 143   YT  MYT          175                                              Mayotte</span></span>
<span><span class="co">## 144   MX  MEX          484                                               Mexico</span></span>
<span><span class="co">## 145   FM  FSM          583                     Micronesia (Federated States of)</span></span>
<span><span class="co">## 146   MD  MDA          498                                 Moldova, Republic of</span></span>
<span><span class="co">## 147   MC  MCO          492                                               Monaco</span></span>
<span><span class="co">## 148   MN  MNG          496                                             Mongolia</span></span>
<span><span class="co">## 149   ME  MNE          499                                           Montenegro</span></span>
<span><span class="co">## 150   MS  MSR          500                                           Montserrat</span></span>
<span><span class="co">## 151   MA  MAR          504                                              Morocco</span></span>
<span><span class="co">## 152   MZ  MOZ          508                                           Mozambique</span></span>
<span><span class="co">## 153   MM  MMR          104                                              Myanmar</span></span>
<span><span class="co">## 154   NA  NAM          516                                              Namibia</span></span>
<span><span class="co">## 155   NR  NRU          520                                                Nauru</span></span>
<span><span class="co">## 156   NP  NPL          524                                                Nepal</span></span>
<span><span class="co">## 157   NL  NLD          528                                          Netherlands</span></span>
<span><span class="co">## 158   NC  NCL          540                                        New Caledonia</span></span>
<span><span class="co">## 159   NZ  NZL          554                                          New Zealand</span></span>
<span><span class="co">## 160   NI  NIC          558                                            Nicaragua</span></span>
<span><span class="co">## 161   NE  NER          562                                                Niger</span></span>
<span><span class="co">## 162   NG  NGA          566                                              Nigeria</span></span>
<span><span class="co">## 163   NU  NIU          570                                                 Niue</span></span>
<span><span class="co">## 164   NF  NFK          574                                       Norfolk Island</span></span>
<span><span class="co">## 165   MP  MNP          580                             Northern Mariana Islands</span></span>
<span><span class="co">## 166   NO  NOR          578                                               Norway</span></span>
<span><span class="co">## 167   OM  OMN          512                                                 Oman</span></span>
<span><span class="co">## 168   PK  PAK          586                                             Pakistan</span></span>
<span><span class="co">## 169   PW  PLW          585                                                Palau</span></span>
<span><span class="co">## 170   PS  PSE          275                                  Palestine, State of</span></span>
<span><span class="co">## 171   PA  PAN          591                                               Panama</span></span>
<span><span class="co">## 172   PG  PNG          598                                     Papua New Guinea</span></span>
<span><span class="co">## 173   PY  PRY          600                                             Paraguay</span></span>
<span><span class="co">## 174   PE  PER          604                                                 Peru</span></span>
<span><span class="co">## 175   PH  PHL          608                                          Philippines</span></span>
<span><span class="co">## 176   PN  PCN          612                                             Pitcairn</span></span>
<span><span class="co">## 177   PL  POL          616                                               Poland</span></span>
<span><span class="co">## 178   PT  PRT          620                                             Portugal</span></span>
<span><span class="co">## 179   PR  PRI          630                                          Puerto Rico</span></span>
<span><span class="co">## 180   QA  QAT          634                                                Qatar</span></span>
<span><span class="co">## 181   RE  REU          638                                              Réunion</span></span>
<span><span class="co">## 182   RO  ROU          642                                              Romania</span></span>
<span><span class="co">## 183   RU  RUS          643                                   Russian Federation</span></span>
<span><span class="co">## 184   RW  RWA          646                                               Rwanda</span></span>
<span><span class="co">## 185   BL  BLM          652                                     Saint Barthélemy</span></span>
<span><span class="co">## 186   SH  SHN          654         Saint Helena, Ascension and Tristan da Cunha</span></span>
<span><span class="co">## 187   KN  KNA          659                                Saint Kitts and Nevis</span></span>
<span><span class="co">## 188   LC  LCA          662                                          Saint Lucia</span></span>
<span><span class="co">## 189   MF  MAF          663                           Saint Martin (French part)</span></span>
<span><span class="co">## 190   PM  SPM          666                            Saint Pierre and Miquelon</span></span>
<span><span class="co">## 191   VC  VCT          670                     Saint Vincent and the Grenadines</span></span>
<span><span class="co">## 192   WS  WSM          882                                                Samoa</span></span>
<span><span class="co">## 193   SM  SMR          674                                           San Marino</span></span>
<span><span class="co">## 194   ST  STP          678                                Sao Tome and Principe</span></span>
<span><span class="co">## 195   SA  SAU          682                                         Saudi Arabia</span></span>
<span><span class="co">## 196   SN  SEN          686                                              Senegal</span></span>
<span><span class="co">## 197   RS  SRB          688                                               Serbia</span></span>
<span><span class="co">## 198   SC  SYC          690                                           Seychelles</span></span>
<span><span class="co">## 199   SL  SLE          694                                         Sierra Leone</span></span>
<span><span class="co">## 200   SG  SGP          702                                            Singapore</span></span>
<span><span class="co">## 201   SX  SXM          534                            Sint Maarten (Dutch part)</span></span>
<span><span class="co">## 202   SK  SVK          703                                             Slovakia</span></span>
<span><span class="co">## 203   SI  SVN          705                                             Slovenia</span></span>
<span><span class="co">## 204   SB  SLB           90                                      Solomon Islands</span></span>
<span><span class="co">## 205   SO  SOM          706                                              Somalia</span></span>
<span><span class="co">## 206   ZA  ZAF          710                                         South Africa</span></span>
<span><span class="co">## 207   GS  SGS          239         South Georgia and the South Sandwich Islands</span></span>
<span><span class="co">## 208   SS  SSD          728                                          South Sudan</span></span>
<span><span class="co">## 209   ES  ESP          724                                                Spain</span></span>
<span><span class="co">## 210   LK  LKA          144                                            Sri Lanka</span></span>
<span><span class="co">## 211   SD  SDN          729                                                Sudan</span></span>
<span><span class="co">## 212   SR  SUR          740                                             Suriname</span></span>
<span><span class="co">## 213   SJ  SJM          744                               Svalbard and Jan Mayen</span></span>
<span><span class="co">## 214   SZ  SWZ          748                                             Eswatini</span></span>
<span><span class="co">## 215   SE  SWE          752                                               Sweden</span></span>
<span><span class="co">## 216   CH  CHE          756                                          Switzerland</span></span>
<span><span class="co">## 217   SY  SYR          760                                 Syrian Arab Republic</span></span>
<span><span class="co">## 218   TW  TWN          158                                       Chinese Taipei</span></span>
<span><span class="co">## 219   TJ  TJK          762                                           Tajikistan</span></span>
<span><span class="co">## 220   TZ  TZA          834                         Tanzania, United Republic of</span></span>
<span><span class="co">## 221   TH  THA          764                                             Thailand</span></span>
<span><span class="co">## 222   TL  TLS          626                                          Timor-Leste</span></span>
<span><span class="co">## 223   TG  TGO          768                                                 Togo</span></span>
<span><span class="co">## 224   TK  TKL          772                                              Tokelau</span></span>
<span><span class="co">## 225   TO  TON          776                                                Tonga</span></span>
<span><span class="co">## 226   TT  TTO          780                                  Trinidad and Tobago</span></span>
<span><span class="co">## 227   TN  TUN          788                                              Tunisia</span></span>
<span><span class="co">## 228   TR  TUR          792                                              Türkiye</span></span>
<span><span class="co">## 229   TM  TKM          795                                         Turkmenistan</span></span>
<span><span class="co">## 230   TC  TCA          796                             Turks and Caicos Islands</span></span>
<span><span class="co">## 231   TV  TUV          798                                               Tuvalu</span></span>
<span><span class="co">## 232   UG  UGA          800                                               Uganda</span></span>
<span><span class="co">## 233   UA  UKR          804                                              Ukraine</span></span>
<span><span class="co">## 234   AE  ARE          784                                 United Arab Emirates</span></span>
<span><span class="co">## 235   GB  GBR          826 United Kingdom of Great Britain and Northern Ireland</span></span>
<span><span class="co">## 236   US  USA          840                             United States of America</span></span>
<span><span class="co">## 237   UM  UMI          581                 United States Minor Outlying Islands</span></span>
<span><span class="co">## 238   UY  URY          858                                              Uruguay</span></span>
<span><span class="co">## 239   UZ  UZB          860                                           Uzbekistan</span></span>
<span><span class="co">## 240   VU  VUT          548                                              Vanuatu</span></span>
<span><span class="co">## 241   VE  VEN          862                   Venezuela (Bolivarian Republic of)</span></span>
<span><span class="co">## 242   VN  VNM          704                                             Viet Nam</span></span>
<span><span class="co">## 243   VG  VGB           92                             Virgin Islands (British)</span></span>
<span><span class="co">## 244   VI  VIR          850                                Virgin Islands (U.S.)</span></span>
<span><span class="co">## 245   WF  WLF          876                                    Wallis and Futuna</span></span>
<span><span class="co">## 246   EH  ESH          732                                       Western Sahara</span></span>
<span><span class="co">## 247   YE  YEM          887                                                Yemen</span></span>
<span><span class="co">## 248   ZM  ZMB          894                                               Zambia</span></span>
<span><span class="co">## 249   ZW  ZWE          716                                             Zimbabwe</span></span>
<span><span class="co">## 250   XK  XKX          902                                               Kosovo</span></span>
<span><span class="co">##        gbifRegion                                enumName</span></span>
<span><span class="co">## 1            ASIA                             AFGHANISTAN</span></span>
<span><span class="co">## 2          EUROPE                           ALAND_ISLANDS</span></span>
<span><span class="co">## 3          EUROPE                                 ALBANIA</span></span>
<span><span class="co">## 4          AFRICA                                 ALGERIA</span></span>
<span><span class="co">## 5         OCEANIA                          AMERICAN_SAMOA</span></span>
<span><span class="co">## 6          EUROPE                                 ANDORRA</span></span>
<span><span class="co">## 7          AFRICA                                  ANGOLA</span></span>
<span><span class="co">## 8   LATIN_AMERICA                                ANGUILLA</span></span>
<span><span class="co">## 9      ANTARCTICA                              ANTARCTICA</span></span>
<span><span class="co">## 10  LATIN_AMERICA                         ANTIGUA_BARBUDA</span></span>
<span><span class="co">## 11  LATIN_AMERICA                               ARGENTINA</span></span>
<span><span class="co">## 12         EUROPE                                 ARMENIA</span></span>
<span><span class="co">## 13  LATIN_AMERICA                                   ARUBA</span></span>
<span><span class="co">## 14        OCEANIA                               AUSTRALIA</span></span>
<span><span class="co">## 15         EUROPE                                 AUSTRIA</span></span>
<span><span class="co">## 16         EUROPE                              AZERBAIJAN</span></span>
<span><span class="co">## 17  LATIN_AMERICA                                 BAHAMAS</span></span>
<span><span class="co">## 18           ASIA                                 BAHRAIN</span></span>
<span><span class="co">## 19           ASIA                              BANGLADESH</span></span>
<span><span class="co">## 20  LATIN_AMERICA                                BARBADOS</span></span>
<span><span class="co">## 21         EUROPE                                 BELARUS</span></span>
<span><span class="co">## 22         EUROPE                                 BELGIUM</span></span>
<span><span class="co">## 23  LATIN_AMERICA                                  BELIZE</span></span>
<span><span class="co">## 24         AFRICA                                   BENIN</span></span>
<span><span class="co">## 25  LATIN_AMERICA                                 BERMUDA</span></span>
<span><span class="co">## 26           ASIA                                  BHUTAN</span></span>
<span><span class="co">## 27  LATIN_AMERICA                                 BOLIVIA</span></span>
<span><span class="co">## 28  LATIN_AMERICA             BONAIRE_SINT_EUSTATIUS_SABA</span></span>
<span><span class="co">## 29         EUROPE                      BOSNIA_HERZEGOVINA</span></span>
<span><span class="co">## 30         AFRICA                                BOTSWANA</span></span>
<span><span class="co">## 31     ANTARCTICA                           BOUVET_ISLAND</span></span>
<span><span class="co">## 32  LATIN_AMERICA                                  BRAZIL</span></span>
<span><span class="co">## 33           ASIA          BRITISH_INDIAN_OCEAN_TERRITORY</span></span>
<span><span class="co">## 34           ASIA                       BRUNEI_DARUSSALAM</span></span>
<span><span class="co">## 35         EUROPE                                BULGARIA</span></span>
<span><span class="co">## 36         AFRICA                            BURKINA_FASO</span></span>
<span><span class="co">## 37         AFRICA                                 BURUNDI</span></span>
<span><span class="co">## 38           ASIA                                CAMBODIA</span></span>
<span><span class="co">## 39         AFRICA                                CAMEROON</span></span>
<span><span class="co">## 40  NORTH_AMERICA                                  CANADA</span></span>
<span><span class="co">## 41         AFRICA                              CAPE_VERDE</span></span>
<span><span class="co">## 42  LATIN_AMERICA                          CAYMAN_ISLANDS</span></span>
<span><span class="co">## 43         AFRICA                CENTRAL_AFRICAN_REPUBLIC</span></span>
<span><span class="co">## 44         AFRICA                                    CHAD</span></span>
<span><span class="co">## 45  LATIN_AMERICA                                   CHILE</span></span>
<span><span class="co">## 46           ASIA                                   CHINA</span></span>
<span><span class="co">## 47           ASIA                        CHRISTMAS_ISLAND</span></span>
<span><span class="co">## 48           ASIA                           COCOS_ISLANDS</span></span>
<span><span class="co">## 49  LATIN_AMERICA                                COLOMBIA</span></span>
<span><span class="co">## 50         AFRICA                                 COMOROS</span></span>
<span><span class="co">## 51         AFRICA               CONGO_DEMOCRATIC_REPUBLIC</span></span>
<span><span class="co">## 52         AFRICA                                   CONGO</span></span>
<span><span class="co">## 53        OCEANIA                            COOK_ISLANDS</span></span>
<span><span class="co">## 54  LATIN_AMERICA                              COSTA_RICA</span></span>
<span><span class="co">## 55         AFRICA                            CÔTE_DIVOIRE</span></span>
<span><span class="co">## 56         EUROPE                                 CROATIA</span></span>
<span><span class="co">## 57  LATIN_AMERICA                                    CUBA</span></span>
<span><span class="co">## 58  LATIN_AMERICA                                 CURAÇAO</span></span>
<span><span class="co">## 59         EUROPE                                  CYPRUS</span></span>
<span><span class="co">## 60         EUROPE                          CZECH_REPUBLIC</span></span>
<span><span class="co">## 61         EUROPE                                 DENMARK</span></span>
<span><span class="co">## 62         AFRICA                                DJIBOUTI</span></span>
<span><span class="co">## 63  LATIN_AMERICA                                DOMINICA</span></span>
<span><span class="co">## 64  LATIN_AMERICA                      DOMINICAN_REPUBLIC</span></span>
<span><span class="co">## 65  LATIN_AMERICA                                 ECUADOR</span></span>
<span><span class="co">## 66         AFRICA                                   EGYPT</span></span>
<span><span class="co">## 67  LATIN_AMERICA                             EL_SALVADOR</span></span>
<span><span class="co">## 68         AFRICA                       EQUATORIAL_GUINEA</span></span>
<span><span class="co">## 69         AFRICA                                 ERITREA</span></span>
<span><span class="co">## 70         EUROPE                                 ESTONIA</span></span>
<span><span class="co">## 71         AFRICA                                ETHIOPIA</span></span>
<span><span class="co">## 72  LATIN_AMERICA                        FALKLAND_ISLANDS</span></span>
<span><span class="co">## 73         EUROPE                           FAROE_ISLANDS</span></span>
<span><span class="co">## 74        OCEANIA                                    FIJI</span></span>
<span><span class="co">## 75         EUROPE                                 FINLAND</span></span>
<span><span class="co">## 76         EUROPE                                  FRANCE</span></span>
<span><span class="co">## 77  LATIN_AMERICA                           FRENCH_GUIANA</span></span>
<span><span class="co">## 78        OCEANIA                        FRENCH_POLYNESIA</span></span>
<span><span class="co">## 79     ANTARCTICA             FRENCH_SOUTHERN_TERRITORIES</span></span>
<span><span class="co">## 80         AFRICA                                   GABON</span></span>
<span><span class="co">## 81         AFRICA                                  GAMBIA</span></span>
<span><span class="co">## 82         EUROPE                                 GEORGIA</span></span>
<span><span class="co">## 83         EUROPE                                 GERMANY</span></span>
<span><span class="co">## 84         AFRICA                                   GHANA</span></span>
<span><span class="co">## 85         EUROPE                               GIBRALTAR</span></span>
<span><span class="co">## 86         EUROPE                                  GREECE</span></span>
<span><span class="co">## 87  NORTH_AMERICA                               GREENLAND</span></span>
<span><span class="co">## 88  LATIN_AMERICA                                 GRENADA</span></span>
<span><span class="co">## 89  LATIN_AMERICA                              GUADELOUPE</span></span>
<span><span class="co">## 90        OCEANIA                                    GUAM</span></span>
<span><span class="co">## 91  LATIN_AMERICA                               GUATEMALA</span></span>
<span><span class="co">## 92         EUROPE                                GUERNSEY</span></span>
<span><span class="co">## 93         AFRICA                                  GUINEA</span></span>
<span><span class="co">## 94         AFRICA                           GUINEA_BISSAU</span></span>
<span><span class="co">## 95  LATIN_AMERICA                                  GUYANA</span></span>
<span><span class="co">## 96  LATIN_AMERICA                                   HAITI</span></span>
<span><span class="co">## 97     ANTARCTICA                  HEARD_MCDONALD_ISLANDS</span></span>
<span><span class="co">## 98         EUROPE                                 VATICAN</span></span>
<span><span class="co">## 99  LATIN_AMERICA                                HONDURAS</span></span>
<span><span class="co">## 100          ASIA                               HONG_KONG</span></span>
<span><span class="co">## 101        EUROPE                                 HUNGARY</span></span>
<span><span class="co">## 102        EUROPE                                 ICELAND</span></span>
<span><span class="co">## 103          ASIA                                   INDIA</span></span>
<span><span class="co">## 104          ASIA                               INDONESIA</span></span>
<span><span class="co">## 105          ASIA                                    IRAN</span></span>
<span><span class="co">## 106          ASIA                                    IRAQ</span></span>
<span><span class="co">## 107        EUROPE                                 IRELAND</span></span>
<span><span class="co">## 108        EUROPE                             ISLE_OF_MAN</span></span>
<span><span class="co">## 109        EUROPE                                  ISRAEL</span></span>
<span><span class="co">## 110        EUROPE                                   ITALY</span></span>
<span><span class="co">## 111 LATIN_AMERICA                                 JAMAICA</span></span>
<span><span class="co">## 112          ASIA                                   JAPAN</span></span>
<span><span class="co">## 113        EUROPE                                  JERSEY</span></span>
<span><span class="co">## 114          ASIA                                  JORDAN</span></span>
<span><span class="co">## 115        EUROPE                              KAZAKHSTAN</span></span>
<span><span class="co">## 116        AFRICA                                   KENYA</span></span>
<span><span class="co">## 117       OCEANIA                                KIRIBATI</span></span>
<span><span class="co">## 118          ASIA                             KOREA_NORTH</span></span>
<span><span class="co">## 119          ASIA                             KOREA_SOUTH</span></span>
<span><span class="co">## 120          ASIA                                  KUWAIT</span></span>
<span><span class="co">## 121        EUROPE                              KYRGYZSTAN</span></span>
<span><span class="co">## 122          ASIA                                     LAO</span></span>
<span><span class="co">## 123        EUROPE                                  LATVIA</span></span>
<span><span class="co">## 124          ASIA                                 LEBANON</span></span>
<span><span class="co">## 125        AFRICA                                 LESOTHO</span></span>
<span><span class="co">## 126        AFRICA                                 LIBERIA</span></span>
<span><span class="co">## 127        AFRICA                                   LIBYA</span></span>
<span><span class="co">## 128        EUROPE                           LIECHTENSTEIN</span></span>
<span><span class="co">## 129        EUROPE                               LITHUANIA</span></span>
<span><span class="co">## 130        EUROPE                              LUXEMBOURG</span></span>
<span><span class="co">## 131          ASIA                                   MACAO</span></span>
<span><span class="co">## 132        EUROPE                               MACEDONIA</span></span>
<span><span class="co">## 133        AFRICA                              MADAGASCAR</span></span>
<span><span class="co">## 134        AFRICA                                  MALAWI</span></span>
<span><span class="co">## 135          ASIA                                MALAYSIA</span></span>
<span><span class="co">## 136          ASIA                                MALDIVES</span></span>
<span><span class="co">## 137        AFRICA                                    MALI</span></span>
<span><span class="co">## 138        EUROPE                                   MALTA</span></span>
<span><span class="co">## 139       OCEANIA                        MARSHALL_ISLANDS</span></span>
<span><span class="co">## 140 LATIN_AMERICA                              MARTINIQUE</span></span>
<span><span class="co">## 141        AFRICA                              MAURITANIA</span></span>
<span><span class="co">## 142        AFRICA                               MAURITIUS</span></span>
<span><span class="co">## 143        AFRICA                                 MAYOTTE</span></span>
<span><span class="co">## 144 LATIN_AMERICA                                  MEXICO</span></span>
<span><span class="co">## 145       OCEANIA                              MICRONESIA</span></span>
<span><span class="co">## 146        EUROPE                                 MOLDOVA</span></span>
<span><span class="co">## 147        EUROPE                                  MONACO</span></span>
<span><span class="co">## 148          ASIA                                MONGOLIA</span></span>
<span><span class="co">## 149        EUROPE                              MONTENEGRO</span></span>
<span><span class="co">## 150 LATIN_AMERICA                              MONTSERRAT</span></span>
<span><span class="co">## 151        AFRICA                                 MOROCCO</span></span>
<span><span class="co">## 152        AFRICA                              MOZAMBIQUE</span></span>
<span><span class="co">## 153          ASIA                                 MYANMAR</span></span>
<span><span class="co">## 154        AFRICA                                 NAMIBIA</span></span>
<span><span class="co">## 155       OCEANIA                                   NAURU</span></span>
<span><span class="co">## 156          ASIA                                   NEPAL</span></span>
<span><span class="co">## 157        EUROPE                             NETHERLANDS</span></span>
<span><span class="co">## 158       OCEANIA                           NEW_CALEDONIA</span></span>
<span><span class="co">## 159       OCEANIA                             NEW_ZEALAND</span></span>
<span><span class="co">## 160 LATIN_AMERICA                               NICARAGUA</span></span>
<span><span class="co">## 161        AFRICA                                   NIGER</span></span>
<span><span class="co">## 162        AFRICA                                 NIGERIA</span></span>
<span><span class="co">## 163       OCEANIA                                    NIUE</span></span>
<span><span class="co">## 164       OCEANIA                          NORFOLK_ISLAND</span></span>
<span><span class="co">## 165       OCEANIA                NORTHERN_MARIANA_ISLANDS</span></span>
<span><span class="co">## 166        EUROPE                                  NORWAY</span></span>
<span><span class="co">## 167          ASIA                                    OMAN</span></span>
<span><span class="co">## 168          ASIA                                PAKISTAN</span></span>
<span><span class="co">## 169       OCEANIA                                   PALAU</span></span>
<span><span class="co">## 170          ASIA                   PALESTINIAN_TERRITORY</span></span>
<span><span class="co">## 171 LATIN_AMERICA                                  PANAMA</span></span>
<span><span class="co">## 172       OCEANIA                        PAPUA_NEW_GUINEA</span></span>
<span><span class="co">## 173 LATIN_AMERICA                                PARAGUAY</span></span>
<span><span class="co">## 174 LATIN_AMERICA                                    PERU</span></span>
<span><span class="co">## 175          ASIA                             PHILIPPINES</span></span>
<span><span class="co">## 176       OCEANIA                                PITCAIRN</span></span>
<span><span class="co">## 177        EUROPE                                  POLAND</span></span>
<span><span class="co">## 178        EUROPE                                PORTUGAL</span></span>
<span><span class="co">## 179 LATIN_AMERICA                             PUERTO_RICO</span></span>
<span><span class="co">## 180          ASIA                                   QATAR</span></span>
<span><span class="co">## 181        AFRICA                                 RÉUNION</span></span>
<span><span class="co">## 182        EUROPE                                 ROMANIA</span></span>
<span><span class="co">## 183        EUROPE                      RUSSIAN_FEDERATION</span></span>
<span><span class="co">## 184        AFRICA                                  RWANDA</span></span>
<span><span class="co">## 185 LATIN_AMERICA                        SAINT_BARTHÉLEMY</span></span>
<span><span class="co">## 186        AFRICA SAINT_HELENA_ASCENSION_TRISTAN_DA_CUNHA</span></span>
<span><span class="co">## 187 LATIN_AMERICA                       SAINT_KITTS_NEVIS</span></span>
<span><span class="co">## 188 LATIN_AMERICA                             SAINT_LUCIA</span></span>
<span><span class="co">## 189 LATIN_AMERICA                     SAINT_MARTIN_FRENCH</span></span>
<span><span class="co">## 190 NORTH_AMERICA                   SAINT_PIERRE_MIQUELON</span></span>
<span><span class="co">## 191 LATIN_AMERICA                SAINT_VINCENT_GRENADINES</span></span>
<span><span class="co">## 192       OCEANIA                                   SAMOA</span></span>
<span><span class="co">## 193        EUROPE                              SAN_MARINO</span></span>
<span><span class="co">## 194        AFRICA                       SAO_TOME_PRINCIPE</span></span>
<span><span class="co">## 195          ASIA                            SAUDI_ARABIA</span></span>
<span><span class="co">## 196        AFRICA                                 SENEGAL</span></span>
<span><span class="co">## 197        EUROPE                                  SERBIA</span></span>
<span><span class="co">## 198        AFRICA                              SEYCHELLES</span></span>
<span><span class="co">## 199        AFRICA                            SIERRA_LEONE</span></span>
<span><span class="co">## 200          ASIA                               SINGAPORE</span></span>
<span><span class="co">## 201 LATIN_AMERICA                            SINT_MAARTEN</span></span>
<span><span class="co">## 202        EUROPE                                SLOVAKIA</span></span>
<span><span class="co">## 203        EUROPE                                SLOVENIA</span></span>
<span><span class="co">## 204       OCEANIA                         SOLOMON_ISLANDS</span></span>
<span><span class="co">## 205        AFRICA                                 SOMALIA</span></span>
<span><span class="co">## 206        AFRICA                            SOUTH_AFRICA</span></span>
<span><span class="co">## 207    ANTARCTICA          SOUTH_GEORGIA_SANDWICH_ISLANDS</span></span>
<span><span class="co">## 208        AFRICA                             SOUTH_SUDAN</span></span>
<span><span class="co">## 209        EUROPE                                   SPAIN</span></span>
<span><span class="co">## 210          ASIA                               SRI_LANKA</span></span>
<span><span class="co">## 211        AFRICA                                   SUDAN</span></span>
<span><span class="co">## 212 LATIN_AMERICA                                SURINAME</span></span>
<span><span class="co">## 213        EUROPE                      SVALBARD_JAN_MAYEN</span></span>
<span><span class="co">## 214        AFRICA                               SWAZILAND</span></span>
<span><span class="co">## 215        EUROPE                                  SWEDEN</span></span>
<span><span class="co">## 216        EUROPE                             SWITZERLAND</span></span>
<span><span class="co">## 217          ASIA                                   SYRIA</span></span>
<span><span class="co">## 218          ASIA                                  TAIWAN</span></span>
<span><span class="co">## 219        EUROPE                              TAJIKISTAN</span></span>
<span><span class="co">## 220        AFRICA                                TANZANIA</span></span>
<span><span class="co">## 221          ASIA                                THAILAND</span></span>
<span><span class="co">## 222          ASIA                             TIMOR_LESTE</span></span>
<span><span class="co">## 223        AFRICA                                    TOGO</span></span>
<span><span class="co">## 224       OCEANIA                                 TOKELAU</span></span>
<span><span class="co">## 225       OCEANIA                                   TONGA</span></span>
<span><span class="co">## 226 LATIN_AMERICA                         TRINIDAD_TOBAGO</span></span>
<span><span class="co">## 227        AFRICA                                 TUNISIA</span></span>
<span><span class="co">## 228        EUROPE                                  TURKEY</span></span>
<span><span class="co">## 229        EUROPE                            TURKMENISTAN</span></span>
<span><span class="co">## 230 LATIN_AMERICA                    TURKS_CAICOS_ISLANDS</span></span>
<span><span class="co">## 231       OCEANIA                                  TUVALU</span></span>
<span><span class="co">## 232        AFRICA                                  UGANDA</span></span>
<span><span class="co">## 233        EUROPE                                 UKRAINE</span></span>
<span><span class="co">## 234          ASIA                    UNITED_ARAB_EMIRATES</span></span>
<span><span class="co">## 235        EUROPE                          UNITED_KINGDOM</span></span>
<span><span class="co">## 236 NORTH_AMERICA                           UNITED_STATES</span></span>
<span><span class="co">## 237       OCEANIA          UNITED_STATES_OUTLYING_ISLANDS</span></span>
<span><span class="co">## 238 LATIN_AMERICA                                 URUGUAY</span></span>
<span><span class="co">## 239        EUROPE                              UZBEKISTAN</span></span>
<span><span class="co">## 240       OCEANIA                                 VANUATU</span></span>
<span><span class="co">## 241 LATIN_AMERICA                               VENEZUELA</span></span>
<span><span class="co">## 242          ASIA                                 VIETNAM</span></span>
<span><span class="co">## 243 LATIN_AMERICA                  VIRGIN_ISLANDS_BRITISH</span></span>
<span><span class="co">## 244 LATIN_AMERICA                          VIRGIN_ISLANDS</span></span>
<span><span class="co">## 245       OCEANIA                           WALLIS_FUTUNA</span></span>
<span><span class="co">## 246        AFRICA                          WESTERN_SAHARA</span></span>
<span><span class="co">## 247          ASIA                                   YEMEN</span></span>
<span><span class="co">## 248        AFRICA                                  ZAMBIA</span></span>
<span><span class="co">## 249        AFRICA                                ZIMBABWE</span></span>
<span><span class="co">## 250        EUROPE                                  KOSOVO</span></span></code></pre>
<div class="section level4">
<h4 id="retrieve-and-save-records">Retrieve and save records<a class="anchor" aria-label="anchor" href="#retrieve-and-save-records"></a>
</h4>
<p>The retrieved ID is 5157899. This matches the ID for the <a href="https://www.gbif.org/species/5157899" class="external-link">SLF repository</a> on
GBIF.</p>
<p>Next, retrieve <code>GBIF</code> records using
<code><a href="https://docs.ropensci.org/rgbif/reference/occ_download.html" class="external-link">occ_download()</a></code>. I will be editing the following GBIF
constraints:</p>
<ul>
<li>hasCoordinate: limit records to only those with coordinate data</li>
<li>year: we will retrieve records between 1981 and 2023. 1981 was
chosen as the earliest date because it corresponds with the earliest
climate data available.</li>
<li>occurrenceStatus: set to only presences, because absence data is not
needed</li>
<li>basisOfRecord: here we include everything except fossil records, to
ensure that records are within the target time period.</li>
<li>hasGeospatialIssue: exclude any records with an issue in the
coordinate data</li>
<li>country: the country of the record</li>
</ul>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># initiate download</span></span>
<span><span class="va">slf_gbif</span> <span class="op">&lt;-</span> <span class="fu">rgbif</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_download.html" class="external-link">occ_download</a></span><span class="op">(</span></span>
<span>  <span class="co"># general formatting</span></span>
<span>  type <span class="op">=</span> <span class="st">"and"</span>,</span>
<span>  format <span class="op">=</span> <span class="st">"SIMPLE_CSV"</span>,</span>
<span>  <span class="co"># inclusion rules</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/download_predicate_dsl.html" class="external-link">pred</a></span><span class="op">(</span><span class="st">"taxonKey"</span>, <span class="va">ids</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, <span class="co"># search by ID, not species name</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/download_predicate_dsl.html" class="external-link">pred</a></span><span class="op">(</span><span class="st">"hasCoordinate"</span>, <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/download_predicate_dsl.html" class="external-link">pred</a></span><span class="op">(</span><span class="st">"hasGeospatialIssue"</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/download_predicate_dsl.html" class="external-link">pred</a></span><span class="op">(</span><span class="st">"occurrenceStatus"</span>, <span class="st">"PRESENT"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/download_predicate_dsl.html" class="external-link">pred_gte</a></span><span class="op">(</span><span class="st">"year"</span>, <span class="fl">1981</span><span class="op">)</span>, <span class="co"># records from 1981 onwards</span></span>
<span>  <span class="co"># exclusion rules</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/download_predicate_dsl.html" class="external-link">pred_not</a></span><span class="op">(</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/download_predicate_dsl.html" class="external-link">pred_in</a></span><span class="op">(</span><span class="st">"basisOfRecord"</span>, <span class="st">"FOSSIL_SPECIMEN"</span><span class="op">)</span><span class="op">)</span>, <span class="co"># exclude fossil records</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/download_predicate_dsl.html" class="external-link">pred_not</a></span><span class="op">(</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/download_predicate_dsl.html" class="external-link">pred_in</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"US"</span>, <span class="st">"MX"</span>, <span class="st">"CA"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="co"># exclude USA, Canada and mexico</span></span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/download_predicate_dsl.html" class="external-link">pred_not</a></span><span class="op">(</span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/download_predicate_dsl.html" class="external-link">pred_in</a></span><span class="op">(</span><span class="st">"country"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"TW"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># be sure to open slf_gbif and retrieve the download key</span></span>
<span></span>
<span><span class="co"># check on download status using key</span></span>
<span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_download_wait.html" class="external-link">occ_download_wait</a></span><span class="op">(</span><span class="st">'0049348-240626123714530'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## status: succeeded</span></span></code></pre>
<pre><code><span><span class="co">## download is done, status: succeeded</span></span></code></pre>
<pre><code><span><span class="co">## &lt;&lt;gbif download metadata&gt;&gt;</span></span>
<span><span class="co">##   Status: SUCCEEDED</span></span>
<span><span class="co">##   DOI: 10.15468/dl.59gndc</span></span>
<span><span class="co">##   Format: SIMPLE_CSV</span></span>
<span><span class="co">##   Download key: 0049348-240626123714530</span></span>
<span><span class="co">##   Created: 2024-08-05T15:55:28.927+00:00</span></span>
<span><span class="co">##   Modified: 2024-08-05T15:56:11.546+00:00</span></span>
<span><span class="co">##   Download link: https://api.gbif.org/v1/occurrence/download/request/0049348-240626123714530.zip</span></span>
<span><span class="co">##   Total records: 1498</span></span></code></pre>
<p>The data have been pulled to the gbif server, but now we must
download the data and edit it in a number of ways.</p>
<p>First, I will import the dataset to my working directory. I will also
retrieve the data citation for this download. I will rename the raw
download file. Finally, I will subset the desired columns and save them
as a separate .csv for use in tidying. The raw query and the raw
coordinates will be saved to the <code>data-raw</code> folder. I will
read in the coordinate data saved there afterwards to prepare for data
tidying.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># download the data as a zip to PC</span></span>
<span><span class="va">slf_gbif_download</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_download_get.html" class="external-link">occ_download_get</a></span><span class="op">(</span></span>
<span>  key <span class="op">=</span> <span class="st">'0049348-240626123714530'</span>,</span>
<span>  path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span><span class="op">)</span>,</span>
<span>  <span class="co"># overwrite = TRUE</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/occ_download_import.html" class="external-link">occ_download_import</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># .zip file</span></span>
<span><span class="co"># unzip</span></span>
<span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/unzip.html" class="external-link">unzip</a></span><span class="op">(</span></span>
<span>  zipfile <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"0049348-240626123714530.zip"</span><span class="op">)</span>,</span>
<span>  exdir <span class="op">=</span>  <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co"># rename .csv file</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.rename</a></span><span class="op">(</span></span>
<span>  from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"0049348-240626123714530.csv"</span><span class="op">)</span>,</span>
<span>  to <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"slf_gbif_raw_query_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>, <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co"># delete original zip</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.remove</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"0049348-240626123714530.zip"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># simplify download into more useable .csv</span></span>
<span><span class="va">slf_gbif_download_simple</span> <span class="op">&lt;-</span> <span class="va">slf_gbif_download</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>prov <span class="op">=</span> <span class="st">"gbif"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"species"</span>, <span class="st">"decimalLongitude"</span>, <span class="st">"decimalLatitude"</span>, <span class="st">"countryCode"</span>, <span class="st">"prov"</span>, <span class="st">"year"</span>, <span class="st">"gbifID"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># select desired columns</span></span>
<span>  <span class="co"># rename for consistency with rest of vignette</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"name"</span> <span class="op">=</span> <span class="st">"species"</span>,</span>
<span>         <span class="st">"longitude"</span> <span class="op">=</span> <span class="st">"decimalLongitude"</span>, </span>
<span>         <span class="st">"latitude"</span> <span class="op">=</span> <span class="st">"decimalLatitude"</span>,</span>
<span>         <span class="st">"key"</span> <span class="op">=</span> <span class="st">"gbifID"</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># save .csv output for use</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">slf_gbif_download_simple</span>, </span>
<span>          file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"slf_gbif_raw_coords_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>, <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://docs.ropensci.org/rgbif/reference/gbif_citation.html" class="external-link">gbif_citation</a></span><span class="op">(</span><span class="st">'0049348-240626123714530'</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $download</span></span>
<span><span class="co">## [1] "GBIF Occurrence Download https://doi.org/10.15468/dl.59gndc Accessed from R via rgbif (https://github.com/ropensci/rgbif) on 2024-08-05"</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $datasets</span></span>
<span><span class="co">## NULL</span></span></code></pre>
<p>Here is the data citation: “GBIF Occurrence Download <a href="https://doi.org/10.15468/dl.59gndc" class="external-link uri">https://doi.org/10.15468/dl.59gndc</a> Accessed from R via
rgbif (<a href="https://github.com/ropensci/rgbif" class="external-link uri">https://github.com/ropensci/rgbif</a>) on 2024-08-05”</p>
</div>
<div class="section level4">
<h4 id="coordinate-veracity">Coordinate veracity<a class="anchor" aria-label="anchor" href="#coordinate-veracity"></a>
</h4>
<p>First, we want to check the coordinate veracity using the
<code>CoordinateCleaner</code> package. We will be more picky and apply
more tests to the GBIF data points than those from the other datasets
because they are usually less accurate than field survey data.</p>
<ul>
<li>valid and likely coordinates</li>
<li>points set to the centroid of a country or province</li>
<li>coordinates that fall into the ocean</li>
<li>duplicates</li>
<li>points with equal lat / lon</li>
<li>points near the GBIF HQ</li>
<li>points near biodiv institutions</li>
<li>points near whole lat / lon numbers</li>
</ul>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read in data</span></span>
<span><span class="va">slf_gbif_coords1</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"slf_gbif_raw_coords_2024-08-05.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># coordinate cleaner</span></span>
<span><span class="va">slf_gbif_report</span> <span class="op">&lt;-</span> <span class="fu">CoordinateCleaner</span><span class="fu">::</span><span class="fu"><a href="https://ropensci.github.io/CoordinateCleaner/reference/clean_coordinates.html" class="external-link">clean_coordinates</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">slf_gbif_coords1</span>, </span>
<span>  lon <span class="op">=</span> <span class="st">"longitude"</span>,</span>
<span>  lat <span class="op">=</span> <span class="st">"latitude"</span>,</span>
<span>  species <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>  tests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"centroids"</span>, <span class="st">"duplicates"</span>, <span class="st">"equal"</span>, <span class="st">"gbif"</span>, <span class="st">"institutions"</span>, <span class="st">"seas"</span>, <span class="st">"zeros"</span><span class="op">)</span>,</span>
<span>  <span class="co"># test details</span></span>
<span>  seas_scale <span class="op">=</span> <span class="fl">110</span>,</span>
<span>  centroids_detail <span class="op">=</span> <span class="st">"both"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>It seems like the most records were removed for duplicate records,
followed by for records flagged as being in the ocean or other bodies of
water. We also did find a few records that were attributed to
biodiversity institutions and country / province centroids.</p>
<p>Next, I will filter out problematic points and ensure the species
naming is consistent.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># remove flagged records</span></span>
<span><span class="va">slf_gbif_coords1</span> <span class="op">&lt;-</span> <span class="va">slf_gbif_report</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.summary</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># FALSE records are potentially problematic</span></span>
<span></span>
<span><span class="co"># check species name</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">slf_gbif_coords1</span><span class="op">$</span><span class="va">name</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># there is only one naming convention</span></span>
<span></span>
<span><span class="co"># rename species name</span></span>
<span><span class="co">#slf_gbif_coords1$name &lt;- "Lycorma delicatula"</span></span></code></pre></div>
<p>Next, we will use <code><a href="https://rdrr.io/pkg/humboldt/man/humboldt.occ.rarefy.html" class="external-link">humboldt::humboldt.occ.rarefy()</a></code> to
spatially thin the occurrence data. The <code>Humboldt</code> package
was chosen to perform the initial thinning because it preserves
non-coordinate data in its output. So, we can save a spatially thinned
version of the data with other information (such as unique keys or
dates) that might be useful later.</p>
<p>In <code><a href="https://rdrr.io/pkg/humboldt/man/humboldt.occ.rarefy.html" class="external-link">humboldt::humboldt.occ.rarefy()</a></code>, The data will be
rarefied to 10km over 10 passes. This will be done once more on the
final dataset. Spatial thinning should reduce autocorrelation and
sampling bias. I have programmed this function to rarefy at 10km. The
resolution of the climate data we will use from <code>CHELSA</code> (30
arc-seconds, roughly 1km at the equator), but we will be aggregating it
at 10km and taking the mean value per cell. This way, no more than one
occurrence will be left per grid cell.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">997</span><span class="op">)</span></span>
<span></span>
<span><span class="va">slf_gbif_coords2</span> <span class="op">&lt;-</span> <span class="fu">humboldt</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/humboldt/man/humboldt.occ.rarefy.html" class="external-link">humboldt.occ.rarefy</a></span><span class="op">(</span></span>
<span>  in.pts <span class="op">=</span> <span class="va">slf_gbif_coords1</span>, </span>
<span>  colxy <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">3</span>, <span class="co"># coordinate columns</span></span>
<span>  rarefy.dist <span class="op">=</span> <span class="fl">10</span>, </span>
<span>  rarefy.units <span class="op">=</span> <span class="st">"km"</span>, </span>
<span>  run.silent.rar <span class="op">=</span> <span class="cn">F</span> <span class="co"># display progress bars</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<p>Spatial thinning left 505 of 1,489 observations.</p>
<p>We will save the results of the cleaning we just performed so they
can be referenced or called later in our analysis. Later in this
vignette, we will be combining these records with those from other data
sources into a final dataset that is prepared for MaxEnt.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">slf_gbif_coords2</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"slf_gbif_cleaned_coords_2024-08-05.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># also save as a .rds file</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span><span class="va">slf_gbif_coords2</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"slf_gbif_cleaned_coords_2024-08-05.rds"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="lydemapr">1.2- LydemapR<a class="anchor" aria-label="anchor" href="#lydemapr"></a>
</h3>
<div class="section level4">
<h4 id="retrieve-and-save-lydemapr-records">Retrieve and save lydemapR records<a class="anchor" aria-label="anchor" href="#retrieve-and-save-lydemapr-records"></a>
</h4>
<p>Next, we will retrieve data from the lydemapR package and save it as
a <code>.csv</code>. I will repeat the spatial thinning and cleaning
process outlined above.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slf_lyde</span> <span class="op">&lt;-</span> <span class="fu">lydemapr</span><span class="fu">::</span><span class="va"><a href="https://ieco-lab.github.io/lydemapr/reference/lyde.html" class="external-link">lyde</a></span></span>
<span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">slf_lyde</span>, </span>
<span>          file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"slf_lyde_raw_coords_"</span>, <span class="fu"><a href="https://rdrr.io/r/base/format.html" class="external-link">format</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/Sys.time.html" class="external-link">Sys.Date</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"%Y-%m-%d"</span><span class="op">)</span>, <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The next chunk is an import from an unpublished version of the
lydemapr dataset. This version will be published on the package soon,
but for now we will use this . This file was named
“slf_lyde_raw_coords_2024-07-29.csv” for consistency with previous file
naming. It contains about 900,000 published SLF records and includes the
years 2022 and 2023.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">slf_lyde_raw</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"slf_lyde_raw_coords_2024-07-29.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># tidy</span></span>
<span>  <span class="va">slf_lyde_raw</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">slf_lyde_raw</span>, <span class="op">-</span><span class="va">survey</span><span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co"># overwrite save original version</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">slf_lyde_raw</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"slf_lyde_raw_coords_2024-07-29.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>The raw dataset is composed of over 658,000 records of SLF in the USA
alone. Most of these records are concentrated in the mid-atlantic region
where the invasion front is progressing. This dataset will also need a
run of spatial thinning. First, we will need to narrow these records to
fit our needs. At the time of writing this, I am only interested in
records that were collected during field surveys, but this can be tuned
to the needs of the analysis. So, I will set the collection method equal
to the value of “field_survey/management”. Obviously, I am also
interested in presence records only.</p>
<p>Lastly, I will pull records only from areas where SLF have
established a population. LydemapR defines an established population as
either 2+ adults or the presence of 1 egg mass.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read in data</span></span>
<span><span class="va">slf_lyde</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"slf_lyde_raw_coords_2024-07-29.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># unique values for collection method</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">slf_lyde</span><span class="op">$</span><span class="va">collection_method</span><span class="op">)</span></span>
<span></span>
<span><span class="va">slf_lyde1</span> <span class="op">&lt;-</span> <span class="va">slf_lyde</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">lyde_present</span> <span class="op">==</span> <span class="st">"TRUE"</span>, <span class="co"># only select presences</span></span>
<span>         <span class="va">collection_method</span> <span class="op">==</span> <span class="st">"field_survey/management"</span>, <span class="co"># collection method = "field_survey/management"</span></span>
<span>         <span class="va">lyde_established</span> <span class="op">==</span> <span class="st">"TRUE"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># only select areas records that are from established populations</span></span>
<span>  <span class="co"># add species column</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Lycorma delicatula"</span><span class="op">)</span></span></code></pre></div>
<p>The data that fit our needs are about 39,000 records total.</p>
</div>
<div class="section level4">
<h4 id="coordinate-veracity-1">Coordinate veracity<a class="anchor" aria-label="anchor" href="#coordinate-veracity-1"></a>
</h4>
<p>Here we will run through the same data cleaning process that we
performed for the <code>GBIF</code> data.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># coordinate cleaner</span></span>
<span><span class="va">slf_lyde_report</span> <span class="op">&lt;-</span> <span class="fu">CoordinateCleaner</span><span class="fu">::</span><span class="fu"><a href="https://ropensci.github.io/CoordinateCleaner/reference/clean_coordinates.html" class="external-link">clean_coordinates</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">slf_lyde1</span>, </span>
<span>  lon <span class="op">=</span> <span class="st">"longitude"</span>,</span>
<span>  lat <span class="op">=</span> <span class="st">"latitude"</span>,</span>
<span>  species <span class="op">=</span> <span class="st">"species"</span>,</span>
<span>  tests <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"centroids"</span>, <span class="st">"duplicates"</span>, <span class="st">"equal"</span>, <span class="st">"gbif"</span>, <span class="st">"institutions"</span>, <span class="st">"seas"</span>, <span class="st">"zeros"</span><span class="op">)</span>,</span>
<span>  <span class="co"># test details</span></span>
<span>  seas_scale <span class="op">=</span> <span class="fl">110</span>,</span>
<span>  centroids_detail <span class="op">=</span> <span class="st">"both"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># remove flagged records</span></span>
<span><span class="va">slf_lyde1</span> <span class="op">&lt;-</span> <span class="va">slf_lyde_report</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.summary</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># FALSE records are potentially problematic</span></span></code></pre></div>
<p>Again, the majority were duplicates, followed by those that fell into
bodies of water.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">998</span><span class="op">)</span></span>
<span></span>
<span><span class="va">slf_lyde2</span> <span class="op">&lt;-</span> <span class="fu">humboldt</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/humboldt/man/humboldt.occ.rarefy.html" class="external-link">humboldt.occ.rarefy</a></span><span class="op">(</span></span>
<span>  in.pts <span class="op">=</span> <span class="va">slf_lyde1</span>, </span>
<span>  colxy <span class="op">=</span> <span class="fl">4</span><span class="op">:</span><span class="fl">5</span>, <span class="co"># coordinate columns</span></span>
<span>  rarefy.dist <span class="op">=</span> <span class="fl">10</span>, </span>
<span>  rarefy.units <span class="op">=</span> <span class="st">"km"</span>, </span>
<span>  run.silent.rar <span class="op">=</span> <span class="cn">F</span> <span class="co"># display progress bars</span></span>
<span>  <span class="op">)</span> </span></code></pre></div>
<p>Spatial thinning for the <code>lyde</code> dataset left 366 points
out of the 39,000 points that fit our needs.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span><span class="va">slf_lyde2</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"slf_lyde_cleaned_coords_2024-07-29.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># also save as a .rds file</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span><span class="va">slf_lyde2</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"slf_lyde_cleaned_coords_2024-07-29.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level3">
<h3 id="visualize-slf-distributions">1.3- Visualize SLF distributions<a class="anchor" aria-label="anchor" href="#visualize-slf-distributions"></a>
</h3>
<p>We want to visualize the difference between the raw coordinates that
were pulled from GBIF and the cleaned, spatially thinned version. This
is to ensure proper geospatial coverage and the success of the spatial
thinning runs.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># raw data</span></span>
<span><span class="va">gbif_raw</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"slf_gbif_raw_coords_2024-08-05.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">1498</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">7</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (3): name, countryCode, prov</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (4): longitude, latitude, year, key</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># thinned data</span></span>
<span><span class="va">gbif_thinned</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"slf_gbif_cleaned_coords_2024-08-05.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">488</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">15</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (2): name, prov</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (4): longitude, latitude, year, key</span></span>
<span><span class="co">## <span style="color: #BBBB00;">lgl</span> (9): .val, .equ, .zer, .cen, .sea, .gbf, .inst, .dpl, .summary</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot world map</span></span>
<span><span class="va">map_gbif_thinned</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># the second line is a basemap from ggplot2</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">'world'</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">gbif_raw</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">gbif_thinned</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkorange"</span>, shape <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_quickmap</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">164.5</span>, <span class="fl">163.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">55</span>, <span class="fl">85</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"SLF GBIF records- \n raw (blue) vs thinned (darkorange)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot map of Asia</span></span>
<span><span class="va">map_gbif_thinned_Asia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># the second line is a basemap from ggplot2</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">'world'</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">gbif_raw</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">gbif_thinned</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkorange"</span>, shape <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_quickmap</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">140</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">50</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"SLF GBIF records in Asia-\nraw (blue) vs thinned (darkorange)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># patchwork display of plots</span></span>
<span><span class="va">map_gbif_thinned</span> <span class="op">+</span> <span class="va">map_gbif_thinned_Asia</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="020_retrieve_SLF_records_files/figure-html/visualize%20raw%20and%20thinned%20GBIF%20records-1.png" width="700"></p>
<p>From the mapping, it seems that the spatial thinning reduced the GBIF
records, while preserving the same spatial extent. We also zoom in on
the invaded range, and indeed every blue point is paired with at least 1
darkorange point. So, our goal was met! We will do the same for the
LydemapR data to ensure spatial thinning success.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># raw data</span></span>
<span><span class="va">lyde_raw</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"slf_lyde_raw_coords_2024-07-29.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">931259</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">14</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (6): source, state, lyde_density, source_agency, collection_method, pointID</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (6): year, bio_year, latitude, longitude, rounded_longitude_10k, rounded...</span></span>
<span><span class="co">## <span style="color: #BBBB00;">lgl</span> (2): lyde_present, lyde_established</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># thinned data</span></span>
<span><span class="va">lyde_thinned</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"slf_lyde_cleaned_coords_2024-07-29.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">366</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">24</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span>  (7): source, state, lyde_density, source_agency, collection_method, poi...</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span>  (6): year, bio_year, latitude, longitude, rounded_longitude_10k, rounde...</span></span>
<span><span class="co">## <span style="color: #BBBB00;">lgl</span> (11): lyde_present, lyde_established, .val, .equ, .zer, .cen, .sea, .gbf...</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># ensure data points represent presences</span></span>
<span><span class="va">lyde_raw</span> <span class="op">&lt;-</span> <span class="va">lyde_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">lyde_present</span> <span class="op">==</span> <span class="st">"TRUE"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># plot map of NAmerica</span></span>
<span><span class="va">map_lyde_allRecords</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># this plots a basemap of the USA because data here are exclusively from the USA</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">'state'</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">lyde_raw</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">lyde_thinned</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkorange"</span>, shape <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_quickmap</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">133.593750</span>, <span class="op">-</span><span class="fl">52.294922</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25.085599</span>, <span class="fl">55.304138</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"SLF lydemapR records- \nall records (blue)\nvs thinned (darkorange)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  </span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># include only established records </span></span>
<span><span class="va">lyde_raw1</span> <span class="op">&lt;-</span> <span class="va">lyde_raw</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">lyde_established</span> <span class="op">==</span> <span class="st">"TRUE"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>species <span class="op">=</span> <span class="st">"Lycorma delicatula"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># plot map including only established records</span></span>
<span><span class="va">map_lyde_estab</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># this plots a basemap of the USA because data here are exclusively from the USA</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">'state'</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">lyde_raw1</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">lyde_thinned</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkorange"</span>, shape <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_quickmap</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">90</span>, <span class="op">-</span><span class="fl">70</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">35</span>, <span class="fl">45</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"SLF lydemapR records- \nall records estab populations (blue)\nvs thinned (darkorange)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># patchwork display of plots</span></span>
<span> <span class="va">map_lyde_allRecords</span> <span class="op">+</span> <span class="va">map_lyde_estab</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="020_retrieve_SLF_records_files/figure-html/visualize%20raw%20and%20thinned%20lydemapr%20records-1.png" width="700"></p>
<p>The spatial thinning was successful! However, the first plot does not
help us to understand what data were eliminated by the spatial thinning.
It would be an issue if we lost spatial extent for removing certain
types of data. I believe this is likely due to our preference for
records that represent established populations and for excluding
regulatory incidents and unconfirmed populations, so I will plot the
reduced raw dataset vs our thinned dataset. Indeed, regulatory incidents
and unconfirmed populations account for most of the populations that we
excluded (we want this).</p>
</div>
</div>
<div class="section level2">
<h2 id="combine-records">2. Combine records<a class="anchor" aria-label="anchor" href="#combine-records"></a>
</h2>
<div class="section level3">
<h3 id="slf-data-from-published-sources">2.1- SLF data from published sources<a class="anchor" aria-label="anchor" href="#slf-data-from-published-sources"></a>
</h3>
<p>In this step, I will combine the records obtained from GBIF and
LydemapR with data taken from the literature. I will begin by loading in
records taken from the published literature. There are a total of 165
records from China, southeast Asia, Japan, SK and the USA. Most of these
records were obtained from genetic studies and represent samples taken
from established populations of SLF. Data is scarce for established
populations of SLF within its native range (China and southeast Asia),
so these records are especially important. These records were taken from
both peer-reviewed literature and natural history notes:</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># read in .csv of papers</span></span>
<span><span class="va">slf_published_papers</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"slf_publishedOccurrenceRecords_papers.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">11</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">5</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (4): Author, Spatial Extent of Records, DOI, Notes</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (1): Year</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># kable table</span></span>
<span></span>
<span><span class="va">slf_published_papers</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">!</span><span class="va">Notes</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span>format <span class="op">=</span> <span class="st">"pipe"</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="20%">
<col width="6%">
<col width="32%">
<col width="41%">
</colgroup>
<thead><tr class="header">
<th align="left">Author</th>
<th align="right">Year</th>
<th align="left">Spatial Extent of Records</th>
<th align="left">DOI</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Du et al</td>
<td align="right">2021</td>
<td align="left">China, Japan, SK, USA</td>
<td align="left">10.1111/eva.13170</td>
</tr>
<tr class="even">
<td align="left">Fennah</td>
<td align="right">1953</td>
<td align="left">China</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">Han et al</td>
<td align="right">2008</td>
<td align="left">SK</td>
<td align="left">10.1111/j.1748-5967.2008.00188.x</td>
</tr>
<tr class="even">
<td align="left">Kim et al</td>
<td align="right">2013</td>
<td align="left">China, Japan, SK</td>
<td align="left">10.1016/j.aspen.2013.07.003</td>
</tr>
<tr class="odd">
<td align="left">Kim et al</td>
<td align="right">2021</td>
<td align="left">China, Japan, SK</td>
<td align="left">10.3390/insects12060539</td>
</tr>
<tr class="even">
<td align="left">Manzoor et al</td>
<td align="right">2021</td>
<td align="left">China</td>
<td align="left">10.1111/aab.12674</td>
</tr>
<tr class="odd">
<td align="left">Nakashita et al</td>
<td align="right">2022</td>
<td align="left">China, Japan, SK, USA</td>
<td align="left">10.1038/s41598-022-05541-z</td>
</tr>
<tr class="even">
<td align="left">Suzuki</td>
<td align="right">2023</td>
<td align="left">Japan</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">Xin et al</td>
<td align="right">2020</td>
<td align="left">China</td>
<td align="left">10.1093/ee/nvaa137</td>
</tr>
<tr class="even">
<td align="left">Yang et al</td>
<td align="right">2015</td>
<td align="left">China</td>
<td align="left">10.11865/zs.20150305</td>
</tr>
<tr class="odd">
<td align="left">Zhang et al</td>
<td align="right">2019</td>
<td align="left">China</td>
<td align="left">10.3390/insects10100312</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slf_published</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"slf_publishedOccurrenceRecords_v2.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">177</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">10</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (7): name, key, country, stateProvince, publishingArticle, accessionNum_...</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (3): longitude, latitude, year</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save as .rds before proceeding</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">slf_published</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"slf_publishedOccurrenceRecords_v2.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_published_Asia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># this plots a basemap of the USA because data here are exclusively from the USA</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">'world'</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">slf_published</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkorange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_quickmap</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">140</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">10</span>, <span class="fl">45</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"SLF data from published sources \n in China"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">map_published_NAmerica</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># this plots a basemap of the USA because data here are exclusively from the USA</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">'world'</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">slf_published</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkorange"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_quickmap</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">133.593750</span>, <span class="op">-</span><span class="fl">52.294922</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25.085599</span>, <span class="fl">55.304138</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"SLF data from published sources \n in N America"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># bounding box coords found at: </span></span>
<span><span class="co"># http://bboxfinder.com/#0.000000,0.000000,0.000000,0.000000</span></span>
<span></span>
<span><span class="co"># patchwork</span></span>
<span><span class="va">map_published_Asia</span> <span class="op">+</span> <span class="va">map_published_NAmerica</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="020_retrieve_SLF_records_files/figure-html/map%20of%20data%20from%20published%20sources-1.png" width="700"></p>
<p>The map above shows that the occurrence data from the literature
provide good coverage of the native range that we might not otherwise
get.</p>
</div>
<div class="section level3">
<h3 id="tidy-and-join-datasets">2.2- Tidy and join datasets<a class="anchor" aria-label="anchor" href="#tidy-and-join-datasets"></a>
</h3>
<p>Now, I will load in the cleaned coordinates from GBIF and LydemapR
that we produced earlier.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slf_gbif_coords3</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"slf_gbif_cleaned_coords_2024-08-05.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">slf_lyde3</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"slf_lyde_cleaned_coords_2024-07-29.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>First, I will tidy the data for joining. We will keep only the
species names, coordinates and unique key ID. We will also add a column
that states which data source each point is from.</p>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># tidy gbif data</span></span>
<span><span class="va">slf_gbif_coords3</span> <span class="op">%&lt;&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span><span class="op">:</span><span class="va">latitude</span>, <span class="va">key</span>, <span class="va">prov</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"data_source"</span> <span class="op">=</span> <span class="st">"prov"</span>,</span>
<span>         <span class="st">"species"</span> <span class="op">=</span> <span class="st">"name"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># tidy lyde data</span></span>
<span><span class="va">slf_lyde3</span> <span class="op">%&lt;&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">longitude</span>, <span class="va">latitude</span>, <span class="va">pointID</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"key"</span> <span class="op">=</span> <span class="st">"pointID"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>data_source <span class="op">=</span> <span class="st">"lyde"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># published data</span></span>
<span><span class="va">slf_published</span> <span class="op">%&lt;&gt;%</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span><span class="op">:</span><span class="va">key</span>, <span class="va">publishingArticle</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"species"</span> <span class="op">=</span> <span class="st">"name"</span>,</span>
<span>         <span class="st">"data_source"</span> <span class="op">=</span> <span class="st">"publishingArticle"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the publishing data source column needs to be tidied further. I will take out commas and substitute spaces for underscores</span></span>
<span><span class="va">slf_published</span><span class="op">$</span><span class="va">data_source</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">" "</span>, replacement <span class="op">=</span> <span class="st">"_"</span>, x <span class="op">=</span> <span class="va">slf_published</span><span class="op">$</span><span class="va">data_source</span><span class="op">)</span> </span>
<span><span class="va">slf_published</span><span class="op">$</span><span class="va">data_source</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">","</span>, replacement <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="va">slf_published</span><span class="op">$</span><span class="va">data_source</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Finally, use head() to check coltypes are the same</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">slf_lyde3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">slf_gbif_coords3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">slf_published</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we see that the key column in the GBIF dataset is a double, while the key columns in the other 2 are characters. We will change this:</span></span>
<span><span class="va">slf_gbif_coords3</span><span class="op">$</span><span class="va">key</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">slf_gbif_coords3</span><span class="op">$</span><span class="va">key</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">slf_gbif_coords3</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the conversion worked</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="final-data-tidying">3. Final Data Tidying<a class="anchor" aria-label="anchor" href="#final-data-tidying"></a>
</h2>
<p>Now the data are in a format that is easier to join. We will join the
data and save the cleaned coordinates.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slf_all_coords</span> <span class="op">&lt;-</span> <span class="va">slf_gbif_coords3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">slf_lyde3</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">full_join</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">slf_published</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">slf_all_coords</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"slf_all_coords_2024-08-05.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="final-spatial-thinning">3.1- Final spatial thinning<a class="anchor" aria-label="anchor" href="#final-spatial-thinning"></a>
</h3>
<p>The last step of tidying these data is to perform a second round of
spatial thinning. We need to do this again because after joining 3
different datasets together, some of the points may be within 1km of
each other. We will still use <code>CoordinateCleaner</code>, but this
time we will ditch <code>Humboldt</code> and use
<code><a href="https://rdrr.io/pkg/spThin/man/thin.html" class="external-link">spThin::thin</a></code> to spatially thin the occurrence data.
<code><a href="https://rdrr.io/pkg/spThin/man/thin.html" class="external-link">spThin::thin</a></code> has a more refined process for spatial
thinning and tools for analyzing the output.</p>
<p>The data will be rarefied to 10km over 10 passes. This will be done
once more on the final dataset. Spatial thinning should reduce
autocorrelation and sampling bias. Again, we will thin to a minimum of
1km distance between points. The results of the run should return the
thinned dataset and a text log file of the thinning run.</p>
<p>Both files will be written to the <code>vignettes-outputs</code>
folder, which holds intermediate data objects that are not the final
versions of the data.</p>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slf_all_coords</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"slf_all_coords_2024-08-05.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slf_all_coords2</span> <span class="op">&lt;-</span> <span class="fu">spThin</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spThin/man/thin.html" class="external-link">thin</a></span><span class="op">(</span></span>
<span>  loc.data <span class="op">=</span> <span class="va">slf_all_coords</span>, </span>
<span>  lat.col <span class="op">=</span> <span class="st">"latitude"</span>, long.col <span class="op">=</span> <span class="st">"longitude"</span>,</span>
<span>  spec.col <span class="op">=</span> <span class="st">"species"</span>,</span>
<span>  thin.par <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  reps <span class="op">=</span> <span class="fl">10</span>, <span class="co"># number of passes</span></span>
<span>  <span class="co"># line below returns a list of data frames with the locations were preserved</span></span>
<span>  locs.thinned.list.return <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  write.files <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># returns list of thinned data as a separate .csv file</span></span>
<span>  <span class="co"># next, create a file that logs the thinning run, write the path to and name of the log file</span></span>
<span>  write.log.file <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>  log.file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"slf_all_coords_cleaned_thinning_log_2024-08-05.txt"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="co"># finally, tell it where to write the new files and what to call the thinned dataset</span></span>
<span>  out.dir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span><span class="op">)</span>,</span>
<span>  out.base <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"slf_all_coords_cleaned_2024-08-05"</span><span class="op">)</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">TRUE</span> <span class="co"># give details of run in the console</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Basically, this function thins the data 10 different times and writes
the rep that was able to retain the most data points to a .csv file. The
resulting object is a list of the retained coordinates per run. These
data could be examined closer if there was a large difference in the
records kept per run or some other disparity.</p>
<p>Now that the data have been thinned, we will use
<code><a href="https://rdrr.io/pkg/spThin/man/plotThin.html" class="external-link">spThin::plotThin</a></code> to plot the results of the run and check
its quality. Note, we will be plotting the actual data points in step
1.3; this function shows whether 10 is the optimal number of reps to
thin this dataset. It will plot the number of records retained vs the
number of reps.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">spThin</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/spThin/man/plotThin.html" class="external-link">plotThin</a></span><span class="op">(</span>thinned <span class="op">=</span> <span class="va">slf_all_coords2</span><span class="op">)</span></span></code></pre></div>
<p>It seems from plot 3 that 803 records were retained during more of
the reps. However, this is not very different from the maximum, so we
will keep the maximum of 805</p>
<p>Now, lets load in the final thinned dataset for a final round of
cleaning.</p>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slf_all_coords2</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"slf_all_coords_cleaned_2024-08-05_thin1.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># coordinate cleaner</span></span>
<span><span class="va">slf_all_coords_report</span> <span class="op">&lt;-</span> <span class="fu">CoordinateCleaner</span><span class="fu">::</span><span class="fu"><a href="https://ropensci.github.io/CoordinateCleaner/reference/clean_coordinates.html" class="external-link">clean_coordinates</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">slf_all_coords2</span>, </span>
<span>  lon <span class="op">=</span> <span class="st">"longitude"</span>,</span>
<span>  lat <span class="op">=</span> <span class="st">"latitude"</span>,</span>
<span>  species <span class="op">=</span> <span class="st">"species"</span>,</span>
<span>  tests <span class="op">=</span> <span class="st">"duplicates"</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># no duplicates!</span></span>
<span></span>
<span><span class="co"># remove flagged records</span></span>
<span><span class="va">slf_all_coords2</span> <span class="op">&lt;-</span> <span class="va">slf_all_coords_report</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">.summary</span> <span class="op">==</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># FALSE records are potentially problematic</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">species</span><span class="op">:</span><span class="va">latitude</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="save-output-for-maxent">3.2- Save output for MaxEnt<a class="anchor" aria-label="anchor" href="#save-output-for-maxent"></a>
</h2>
<p>We will finally convert the slf coordinates to the format that will
be used by MaxEnt and save it. That is, the first column “species” must
be the species name, the second column “x” must be the longitude, and
the third column “y” must be the latitude.</p>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># rename columns</span></span>
<span><span class="va">slf_all_coords3</span> <span class="op">&lt;-</span> <span class="va">slf_all_coords2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"x"</span> <span class="op">=</span> <span class="st">"longitude"</span>,</span>
<span>         <span class="st">"y"</span> <span class="op">=</span> <span class="st">"latitude"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># save</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">slf_all_coords3</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"slf_all_coords_final_2024-08-05.csv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># also save as a .rds file</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span><span class="va">slf_all_coords3</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"slf_all_coords_final_2024-08-05.rds"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">slf_all_coords3</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"slf_all_coords_final_2024-08-05.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">805</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">3</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #BB0000;">chr</span> (1): species</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (2): x, y</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span></code></pre>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span> <span class="va">map_all</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">'world'</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">slf_all_coords3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkorange"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_quickmap</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">164.5</span>, <span class="fl">163.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">55</span>, <span class="fl">85</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"All SLF presences"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span> <span class="va">map_all_NAmerica</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">'world'</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">slf_all_coords3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkorange"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_quickmap</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">133.593750</span>, <span class="op">-</span><span class="fl">52.294922</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">25.085599</span>, <span class="fl">55.304138</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"SLF presences N America"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span> </span>
<span>  <span class="va">map_all_Asia</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">'world'</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">slf_all_coords3</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkorange"</span>, size <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_quickmap</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">68.906250</span>, <span class="fl">152.534180</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">8.928487</span>, <span class="fl">45.920587</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"SLF presences Asia"</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>          panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="co"># patchwork</span></span>
<span>  <span class="va">map_all_NAmerica</span> <span class="op">+</span> <span class="va">map_all_Asia</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://patchwork.data-imaginist.com/reference/plot_layout.html" class="external-link">plot_layout</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="020_retrieve_SLF_records_files/figure-html/map%20all%20points-1.png" width="700"></p>
<p>From the map, we can see the final points that were selected. We have
a good spread across the native range and better spread than before in
the invaded range. This version of the total dataset included newer data
from lydemapr, so we now have better coverage in the invaded range. I
will also check the number of points in the native vs the invaded
range.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">SLF_by_longitude</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">slf_all_coords3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_histogram.html" class="external-link">geom_histogram</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"count of SLF presence records invaded vs native range"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>caption <span class="op">=</span> <span class="st">"the longitudinal range between the two dashed lines represents the native range for SLF"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"count of SLF presences"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">73.37</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_abline.html" class="external-link">geom_vline</a></span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">124.06</span>, linetype <span class="op">=</span> <span class="st">"dashed"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save output</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="va">SLF_by_longitude</span>, filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"figures"</span>, <span class="st">"SLF_all_coords_final_by_longitude.jpg"</span><span class="op">)</span>,</span>
<span>       height <span class="op">=</span> <span class="fl">8</span>, </span>
<span>       width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>       device <span class="op">=</span> <span class="st">"jpeg"</span>,</span>
<span>       dpi <span class="op">=</span> <span class="st">"retina"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.</span></span></code></pre>
<p>The native range includes longitudes between 35 and 105. We can see
that most of the SLF presence data are from the invaded ranges of Japan,
South Korea or the United States. This is a weakness in the data
available and we have given our best effort to account for it by
including presence data for China from the literature.</p>
<p>We now have half of the data we need to perform SDM! In the next
vignette, we will download historical and projected climate and human
impact data, which are the basis of our methods for predicting
suitability for Lycorma delicatula.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>De Bona, S., Barringer, L., Kurtz, P., Losiewicz, J., Parra, G.
R., &amp; Helmus, M. R. (2023). lydemapr: An R package to track the
spread of the invasive spotted lanternfly (Lycorma delicatula, White
1845) (Hemiptera, Fulgoridae) in the United States. NeoBiota, 86,
151–168. <a href="https://doi.org/10.3897/neobiota.86.101471" class="external-link uri">https://doi.org/10.3897/neobiota.86.101471</a></p></li>
<li><p>GBIF Occurrence Download <a href="https://doi.org/10.15468/dl.59gndc" class="external-link uri">https://doi.org/10.15468/dl.59gndc</a> Accessed from R via
rgbif (<a href="https://github.com/ropensci/rgbif" class="external-link uri">https://github.com/ropensci/rgbif</a>) on
2024-08-05</p></li>
<li><p>Huron, N. A., Behm, J. E., &amp; Helmus, M. R. (2022).
Paninvasion severity assessment of a U.S. grape pest to disrupt the
global wine market. Communications Biology, 5(1), 655. <a href="https://doi.org/10.1038/s42003-022-03580-w" class="external-link uri">https://doi.org/10.1038/s42003-022-03580-w</a></p></li>
<li><p>Lin, Y.-S., &amp; Liao, J.-R. (2024). Multifaceted Investigation
into the Absence and Potential Invasion of Spotted Lanternfly (Lycorma
delicatula) in Taiwan. Research Square. <a href="https://doi.org/10.21203/rs.3.rs-4832573/v1" class="external-link uri">https://doi.org/10.21203/rs.3.rs-4832573/v1</a></p></li>
</ol>
</div>
<div class="section level2">
<h2 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<div class="section level3">
<h3 id="visualize-changes-in-gbif-records-over-time">Visualize changes in GBIF records over time<a class="anchor" aria-label="anchor" href="#visualize-changes-in-gbif-records-over-time"></a>
</h3>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># new data</span></span>
<span><span class="va">slf_new</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"data-old"</span>, <span class="st">"slf_gbif_cleaned_2024-08-05.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># old data</span></span>
<span><span class="va">slf_old</span> <span class="op">&lt;-</span> <span class="fu">readr</span><span class="fu">::</span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"slf_gbif_cleaned_2024-01-05.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot SLF</span></span>
<span><span class="va">map_slf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_polygon.html" class="external-link">geom_polygon</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/map_data.html" class="external-link">map_data</a></span><span class="op">(</span><span class="st">'world'</span><span class="op">)</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">long</span>, y <span class="op">=</span> <span class="va">lat</span>, group <span class="op">=</span> <span class="va">group</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.15</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">slf_new</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">longitude</span>, y <span class="op">=</span> <span class="va">latitude</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"darkorange"</span>, size <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">slf_old</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"blue"</span>, shape <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_quickmap</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">164.5</span>, <span class="fl">163.5</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">55</span>, <span class="fl">85</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"SLF new points (darkorange) vs old (blue)"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.grid.major <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.grid.minor <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The old points are in blue and the new points are in darkorange</span></span></code></pre></div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Samuel M. Owens, Matthew R. Helmus.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
