<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Setup for regional-scale MaxEnt models • scarifSDM</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Setup for regional-scale MaxEnt models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">scarifSDM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/scarifSDM.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Quantify risk to specific viticultural regions</h6></li>
    <li><a class="dropdown-item" href="../articles/150_create_risk_report.html">Example usage of create_risk_report() to create reports of key viticultural areas</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Initialize scarifSDM</h6></li>
    <li><a class="dropdown-item" href="../articles/010_initialize_pkg.html">Initialization of renv package for dependencies</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>1. Retrieve and tidy input data for MaxEnt</h6></li>
    <li><a class="dropdown-item" href="../articles/020_retrieve_bioclim_variables.html">Bioclim variable rasters: CHELSA</a></li>
    <li><a class="dropdown-item" href="../articles/030_retrieve_occurrence_records.html">SLF occurrence records: GBIF, lydemapR, literature</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>2. SDM modeling pipeline</h6></li>
    <li><a class="dropdown-item" href="../articles/040_setup_global_MaxEnt_model.html">Setup for global-scale MaxEnt model</a></li>
    <li><a class="dropdown-item" href="../articles/050_run_global_MaxEnt_model.html">Run global-scale MaxEnt model</a></li>
    <li><a class="dropdown-item" href="../articles/060_setup_regional_MaxEnt_models.html">Setup for regional-scale MaxEnt models</a></li>
    <li><a class="dropdown-item" href="../articles/070_run_regional_invaded_MaxEnt_model.html">Run 'Ri.NAmerica' model trained on SLF invaded region in North America</a></li>
    <li><a class="dropdown-item" href="../articles/080_run_regional_invaded_asian_MaxEnt_model.html">Run 'Ri.Asia' model trained on SLF invaded range in Japan and South Korea</a></li>
    <li><a class="dropdown-item" href="../articles/090_run_regional_native_MaxEnt_model.html">Run 'Rn' model trained on SLF native range in east Asia</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>3. Ensemble Regional-scale SDMs</h6></li>
    <li><a class="dropdown-item" href="../articles/100_run_ExDet_MIC.html">Run an Extrapolation Detection (NT2) analysis and calculate MIC</a></li>
    <li><a class="dropdown-item" href="../articles/110_ensemble_regional_models.html">Ensemble regional-scale models using a weighted mean</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>4. Quantify SLF risk and model fit</h6></li>
    <li><a class="dropdown-item" href="../articles/120_create_suitability_maps.html">Create risk maps of each model scale and intersect predictions</a></li>
    <li><a class="dropdown-item" href="../articles/130_create_suitability_xy_plots_viticultural.html">Plot shift in SLF risk to important viticultural regions under climate change</a></li>
    <li><a class="dropdown-item" href="../articles/131_create_suitability_xy_plots_SLF.html">Infer stability of known SLF populations due climate change effects</a></li>
    <li><a class="dropdown-item" href="../articles/140_plot_response_curves.html">Analyze biological realism of model response curves</a></li>
    <li><a class="dropdown-item" href="../articles/141_plot_AUC_var_cont.html">Check model goodness of fit via AUC, TSS and confusion matrices</a></li>
    <li><a class="dropdown-item" href="../articles/142_calculate_model_fit.html">Calculate model fit using confusion matrices</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ieco-lab/scarifSDM/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">



<script src="060_setup_regional_MaxEnt_models_files/kePrint-0.0.1/kePrint.js"></script><link href="060_setup_regional_MaxEnt_models_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Setup for regional-scale MaxEnt models</h1>
                        <h4 data-toc-skip class="author">Samuel M.
Owens<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Temple University &lt;a href="http://www.biodiversitycenter.org/" class="external-link"&gt;Center for Biodiversity&lt;/a&gt; &lt;a href="https://www.iecolab.org/" class="external-link"&gt;iEco Lab&lt;/a&gt; &lt;a href="mailto:sam.owens@temple.edu" class="email"&gt;sam.owens@temple.edu&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a>
</h4>
            
            <h4 data-toc-skip class="date">2024-10-07</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ieco-lab/scarifSDM/blob/HEAD/vignettes/060_setup_regional_MaxEnt_models.Rmd" class="external-link"><code>vignettes/060_setup_regional_MaxEnt_models.Rmd</code></a></small>
      <div class="d-none name"><code>060_setup_regional_MaxEnt_models.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>In the previous vignette, I ran the global model, which was the first
step to examine suitability for SLF at multiple spatial scales. In this
vignette, I will set up to run three regional-scale models, one for each
geographical region where SLF is found. I will run a model based on SLF
presence data from the native range (China), the invaded region in Asia
(Japan and South Korea), and the invaded region in North America. I
hypothesize that by creating models at multiple spatial scales, I can
have more confidence in suitability predictions made for specific SLF
populations and important viticultural regions, and can predict the risk
of specific populations spreading now and under climate change. I also
hypothesize that the regional-scale models, once ensembled into a single
prediction, will make more refined predictions than a global-scale model
could.</p>
<p>This vignette will set up for these regional-scale models in a
similar fashion to the setup I created for the global model in vignette
040, but with some additional steps. First, I will use geopolitical
boundaries or bounding boxes to select a broad area for each regional
model’s background points. I will choose a much broader area than SLF
currently occupies in each area so that I can further reduce this area
based on climate. I will then narrow this area for each model using the
<a href="https://koeppen-geiger.vu-wien.ac.at/" class="external-link">Koppen-Geiger climate
zones</a>. If a presence point within each region intersects with a
zone, that zone will be included in the area used to choose background
points.</p>
<p>For each regional-scale model, I will:</p>
<ol style="list-style-type: decimal">
<li>Select the countries or bounding box that will represent that
regional-scale model area</li>
<li>Select the SLF presences that fall into that region. These will be
used to train the model.</li>
<li>Intersect these SLF presences with the K-G climate zones</li>
<li>Keep the zones that intersect, combine their area and use this area
to crop the bioclim layers we tidied in vignette 020</li>
<li>Use the masked bioclim layers to select the background points</li>
<li>Choose the test/validation presences, which will come from a
different region than the training points</li>
<li>Plot the chosen training and test presence per model.</li>
</ol>
<p>Here is a table summarizing the model structures:</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>I will prepare for this vignette by loading the necessary packages to
run this script. I will also be creating maps during this analysis, so I
will create a list object containing a standardized map style that I
will continue to use.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># general tools</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>  <span class="co">#data manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span> <span class="co">#making directory pathways easier on different instances</span></span>
<span><span class="co"># here() starts at the root folder of this package.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster/sdm/" class="external-link">dismo</a></span><span class="op">)</span> <span class="co"># generate random background points</span></span>
<span></span>
<span><span class="co"># spatial data handling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster" class="external-link">raster</a></span><span class="op">)</span> </span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># spatial data sources</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearth/" class="external-link">rnaturalearth</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://docs.ropensci.org/rnaturalearthhires" class="external-link">rnaturalearthhires</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">kgc</span><span class="op">)</span> <span class="co"># koppen climate rasters</span></span>
<span></span>
<span><span class="co"># aesthetics</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://wch.github.io/webshot/" class="external-link">webshot</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rstudio.github.io/webshot2/" class="external-link">webshot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span></code></pre></div>
<p><strong>Note:</strong> I will be setting the global options of this
document so that only certain code chunks are rendered in the final
.html file. I will set the <code>eval = FALSE</code> so that none of the
code is re-run (preventing files from being overwritten during knitting)
and will simply overwrite this in chunks with plots.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_style</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"lightblue2"</span>,</span>
<span>                                        colour <span class="op">=</span> <span class="st">"lightblue2"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="download-countries-shapefile">Download countries shapefile<a class="anchor" aria-label="anchor" href="#download-countries-shapefile"></a>
</h3>
<p>I will need a shapefile of world countries for parts of this
analysis, which I will retrieve from <a href="https://www.naturalearthdata.com/" class="external-link">naturalearthdata</a> using
their R package called <code>rnaturalearth</code>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># check which types of data are available</span></span>
<span><span class="co"># these are in the rnaturalearth package</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">df_layers_cultural</span><span class="op">)</span> </span>
<span><span class="co"># I will use states_provinces</span></span>
<span></span>
<span><span class="co"># get metadata</span></span>
<span><span class="va">ne_metadata</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_find_vector_data.html" class="external-link">ne_find_vector_data</a></span><span class="op">(</span></span>
<span>  scale <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  category <span class="op">=</span> <span class="st">"cultural"</span>,</span>
<span>  getmeta <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">layer</span> <span class="op">==</span> <span class="st">"admin_0_countries"</span><span class="op">)</span></span>
<span><span class="co"># URL to open metadata</span></span>
<span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/browseURL.html" class="external-link">browseURL</a></span><span class="op">(</span><span class="va">ne_metadata</span><span class="op">[</span>, <span class="fl">3</span><span class="op">]</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># if the file isnt already downloaded, download it</span></span>
<span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/files.html" class="external-link">file.exists</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"ne_countries"</span>, <span class="st">"ne_10m_admin_0_countries.shp"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">countries_sf</span> <span class="op">&lt;-</span> <span class="fu">rnaturalearth</span><span class="fu">::</span><span class="fu"><a href="https://docs.ropensci.org/rnaturalearth/reference/ne_download.html" class="external-link">ne_download</a></span><span class="op">(</span></span>
<span>    scale <span class="op">=</span> <span class="fl">10</span>, <span class="co"># highest resolution</span></span>
<span>    type <span class="op">=</span> <span class="st">"admin_0_countries"</span>, <span class="co"># states and provinces</span></span>
<span>    category <span class="op">=</span> <span class="st">"cultural"</span>,</span>
<span>    destdir <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"ne_countries"</span><span class="op">)</span>,</span>
<span>    load <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># load into environment</span></span>
<span>    returnclass <span class="op">=</span> <span class="st">"sf"</span> <span class="co"># shapefile</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># else, just import</span></span>
<span>  <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">countries_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"ne_countries"</span>, <span class="st">"ne_10m_admin_0_countries.shp"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="retrieve-k-g-climate-zones">1. Retrieve K-G climate zones<a class="anchor" aria-label="anchor" href="#retrieve-k-g-climate-zones"></a>
</h2>
<p>First, I will use the <a href="https://cran.r-project.org/web/packages/kgc/index.html" class="external-link">kgc</a>
package to retrieve a global raster of the Koppen-Geiger climate
zones.</p>
<p>I need to set up a path to my directory and the necessary bioclimatic
raster layers.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># path to directory</span></span>
<span>  <span class="va">mypath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     <span class="st">"maxent"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># lists of target files in the directory</span></span>
<span><span class="co"># load in bioclim layers to be cropped- the 10km .asc files</span></span>
<span><span class="va">env.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"historical_climate_rasters"</span>, <span class="st">"chelsa2.1_30arcsec"</span>, <span class="st">"v1_maxent_10km"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\.asc$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># extract the 4 bioclim layers I will be using in my models. </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"atc_2015_global.asc|bio2_1981-2010_global.asc|bio11_1981-2010_global.asc|bio12_1981-2010_global.asc|bio15_1981-2010_global.asc"</span>, <span class="va">.</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>Now I will download the Koppen-Geiger climate zones, which I will use
to clip the bioclim layers.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># get data</span></span>
<span><span class="va">kmz_data</span> <span class="op">&lt;-</span> <span class="fu">kgc</span><span class="fu">::</span><span class="va"><a href="https://rdrr.io/pkg/kgc/man/kmz.html" class="external-link">kmz</a></span></span>
<span></span>
<span><span class="co"># generate coordinates</span></span>
<span><span class="va">kmz_lat</span> <span class="op">&lt;-</span> <span class="fu">kgc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kgc/man/genCoords.html" class="external-link">genCoords</a></span><span class="op">(</span>latlon <span class="op">=</span> <span class="st">"lat"</span>, full <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">kmz_lon</span> <span class="op">&lt;-</span> <span class="fu">kgc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kgc/man/genCoords.html" class="external-link">genCoords</a></span><span class="op">(</span>latlon <span class="op">=</span> <span class="st">"lon"</span>, full <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># join data and coordinates</span></span>
<span><span class="va">kmz_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">kmz_lat</span>, <span class="va">kmz_lon</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">.</span>, <span class="va">kmz_data</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># relocate column</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">kmz_lon</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># convert to raster</span></span>
<span><span class="va">kmz_data_rast</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">kmz_data</span>,</span>
<span>  type <span class="op">=</span> <span class="st">"xyz"</span>,</span>
<span>  crs <span class="op">=</span> <span class="st">"EPSG:4326"</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co"># change name of layer</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">kmz_data_rast</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">"Koeppen_climate_zone"</span></span>
<span></span>
<span><span class="co"># validity- minmax should range between 0-32</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/minmax.html" class="external-link">minmax</a></span><span class="op">(</span><span class="va">kmz_data_rast</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># retrieve names of zones</span></span>
<span><span class="va">kmz_names</span> <span class="op">&lt;-</span> <span class="fu">kgc</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/kgc/man/getZone.html" class="external-link">getZone</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">32</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create naming object for later</span></span>
<span><span class="va">kmz_names_labels</span> <span class="op">&lt;-</span> <span class="va">kmz_names</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"zone_name"</span> <span class="op">=</span> <span class="st">"."</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>zone_number <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">32</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># this naming object will be used for the KG climate map</span></span>
<span><span class="va">kmz_names_factor</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">kmz_names</span>,</span>
<span>  levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html" class="external-link">unique</a></span><span class="op">(</span><span class="va">kmz_names</span><span class="op">)</span>,</span>
<span>  ordered <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>I will need to tidy these data by aggregating them to spatial scale I
use for the bioclim variables. I will do this using the mode, because
this variable is a set of numbers representing a categorical, so I do
not want to average or take the median.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># layer used to aggregate raster</span></span>
<span><span class="va">agg_layer</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"historical_climate_rasters"</span>, <span class="st">"chelsa2.1_30arcsec"</span>, <span class="st">"v1_maxent_10km"</span>, <span class="st">"atc_2015_global.asc"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># raster stats</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/origin.html" class="external-link">origin</a></span><span class="op">(</span><span class="va">agg_layer</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">agg_layer</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># resample</span></span>
<span><span class="va">koppen_zones_rast</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/resample.html" class="external-link">resample</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">kmz_data_rast</span>,</span>
<span>  y <span class="op">=</span> <span class="va">agg_layer</span>, <span class="co"># aggregate to this origin and resolution</span></span>
<span>  method <span class="op">=</span> <span class="st">"mode"</span>,</span>
<span>  threads <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"models"</span>, <span class="st">"working_dir"</span>, <span class="st">"koeppen_climate_zones.asc"</span><span class="op">)</span>,</span>
<span>  filetype <span class="op">=</span> <span class="st">"AAIGrid"</span>, </span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span></code></pre></div>
<p>Now lets plot those zones to make sure this worked.</p>
<p><strong>NOTE</strong> At some point after I updated R, it stopped
automatically encoding UTF-8 special characters. So, I had to replace
the umalot “o” with its css code.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">koeppen_zones_rast</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"models"</span>, <span class="st">"working_dir"</span>, <span class="st">"koeppen_climate_zones.asc"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># convert to df</span></span>
<span><span class="va">koeppen_zones_rast_plot_layer</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">koeppen_zones_rast</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># join plot layer with names</span></span>
<span><span class="va">koeppen_zones_rast_plot_layer</span> <span class="op">&lt;-</span> <span class="va">koeppen_zones_rast_plot_layer</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">kmz_names_labels</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">koeppen_climate_zones</span> <span class="op">==</span> <span class="va">zone_number</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot main layer as example</span></span>
<span><span class="va">KG_climate_map</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># change scale of plots to be standard across figures</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">koeppen_zones_rast_plot_layer</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">koeppen_climate_zones</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>      title <span class="op">=</span> <span class="st">"K\U00F6ppen-Geiger Climate Zones"</span>, </span>
<span>      fill <span class="op">=</span> <span class="st">"K-G climate\nzone"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span></span>
<span>    discrete <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    aesthetics <span class="op">=</span> <span class="st">"fill"</span>,</span>
<span>    option <span class="op">=</span> <span class="st">"H"</span>,</span>
<span>    direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>,</span>
<span>    labels <span class="op">=</span> <span class="va">kmz_names_factor</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fl">3</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>    axis.title <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.text <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>    axis.ticks <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_blank</a></span><span class="op">(</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">KG_climate_map</span></span></code></pre></div>
<p><img src="060_setup_regional_MaxEnt_models_files/figure-html/visualize-1.png" width="700"></p>
<p>I will also write this raster to a shapefile for easy selection of
climate zones.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># next, convert raster to polygon</span></span>
<span><span class="va">KG_zones_invaded_poly</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.polygons.html" class="external-link">as.polygons</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">koeppen_zones_rast</span>,</span>
<span>  aggregate <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># combine cells with the same value into one area</span></span>
<span>  values <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># include cell values as attributes</span></span>
<span>  crs <span class="op">=</span> <span class="st">"EPSG:4326"</span></span>
<span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/gdal.html" class="external-link">gdal</a></span><span class="op">(</span>drivers <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write to shapefile</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeVector.html" class="external-link">writeVector</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">KG_zones_invaded_poly</span>,</span>
<span>  filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"models"</span>, <span class="st">"working_dir"</span>, <span class="st">"shapefiles"</span>, <span class="st">"koeppen_climate_zones.shp"</span><span class="op">)</span>,</span>
<span>  filetype <span class="op">=</span> <span class="st">"ESRI Shapefile"</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">koeppen_zones_rast</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"models"</span>, <span class="st">"working_dir"</span>, <span class="st">"koeppen_climate_zones.asc"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">slf_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"slf_all_coords_final_2024-08-05.csv"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">species</span><span class="op">)</span> </span></code></pre></div>
</div>
<div class="section level2">
<h2 id="trim-bioclim-layers">2. Trim bioclim layers<a class="anchor" aria-label="anchor" href="#trim-bioclim-layers"></a>
</h2>
<div class="section level3">
<h3 id="invaded-region-in-north-america-ri-namerica-model">2.1 invaded region in North America (Ri.NAmerica model)<a class="anchor" aria-label="anchor" href="#invaded-region-in-north-america-ri-namerica-model"></a>
</h3>
<p>First, I will overlay SLF presence points and use these to select
which climate regions to keep. I will use these to create a reference
layer. Then, I will use this layer to mask the layers that have already
been cropped to N America.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extent object for North America</span></span>
<span><span class="va">ext.obj</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="op">-</span><span class="fl">140.976563</span>, <span class="op">-</span><span class="fl">51.064453</span>, <span class="fl">15.182421</span>, <span class="fl">60.586967</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert to vector</span></span>
<span><span class="va">slf_points_vect</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">slf_points</span>, geom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># crop by extent area of interest</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">.</span>, y <span class="op">=</span> <span class="va">ext.obj</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># convert to geom, which gets coordinates of a spatVector</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/geometry.html" class="external-link">geom</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># convert back to data frame</span></span>
<span><span class="va">slf_points_invaded</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">slf_points_vect</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">geom</span>, <span class="va">part</span>, <span class="va">hole</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># will not need this object again</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">slf_points_vect</span><span class="op">)</span></span></code></pre></div>
<p>Now we will intersect the points with the shapefile. I need to crop
the shapefile to the the same extent as the presences and then intersect
them to keep the climate zones that contain presences. The resulting
shapefile will be used to crop the bioclim data and choose background
points for that specific model.</p>
<div class="section level4">
<h4 id="intersect-points-and-kg-zones">Intersect points and KG zones<a class="anchor" aria-label="anchor" href="#intersect-points-and-kg-zones"></a>
</h4>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load in shapefile again</span></span>
<span><span class="va">KG_zones_invaded_poly</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"models"</span>, <span class="st">"working_dir"</span>, <span class="st">"shapefiles"</span>, <span class="st">"koeppen_climate_zones.shp"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"koeppen_climate_zones"</span> <span class="op">=</span> <span class="st">"koeppen_cl"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># bounding box for cropping</span></span>
<span><span class="va">ext.obj.vect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="op">-</span><span class="fl">140.976563</span>, ymin <span class="op">=</span> <span class="fl">15.182421</span>, xmax <span class="op">=</span> <span class="op">-</span><span class="fl">51.064453</span>, ymax <span class="op">=</span> <span class="fl">60.586967</span><span class="op">)</span></span>
<span><span class="co"># first, crop K-G raster to N America</span></span>
<span><span class="va">KG_zones_invaded_poly</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop</a></span><span class="op">(</span><span class="va">KG_zones_invaded_poly</span>, y <span class="op">=</span> <span class="va">ext.obj.vect</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># also get rid of ocean</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">koeppen_climate_zones</span> <span class="op">!=</span> <span class="fl">32</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># intersect</span></span>
<span><span class="va">regional_invaded_withSLF</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_filter</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">KG_zones_invaded_poly</span>, y <span class="op">=</span> <span class="va">slf_points_invaded</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write to file</span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span></span>
<span>  obj <span class="op">=</span> <span class="va">regional_invaded_withSLF</span>, </span>
<span>  dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"shapefiles"</span>, <span class="st">"SLF_regional_invaded_extent.shp"</span><span class="op">)</span>,</span>
<span>  driver <span class="op">=</span> <span class="st">"ESRI Shapefile"</span>,</span>
<span>  append <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regional_invaded_withSLF</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"shapefiles"</span>, <span class="st">"SLF_regional_invaded_extent.shp"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"koeppen_climate_zones"</span> <span class="op">=</span> <span class="st">"kppn_c_"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get extent</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">regional_invaded_withSLF</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">##       xmin       ymin       xmax       ymax </span></span>
<span><span class="co">## -138.66681   19.12534  -52.58347   60.83319</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># add zone nums to shapefile</span></span>
<span><span class="va">regional_invaded_withSLF</span> <span class="op">&lt;-</span> <span class="va">regional_invaded_withSLF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">kmz_names_labels</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">koeppen_climate_zones</span> <span class="op">==</span> <span class="va">zone_number</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now lets plot it for a sanity check.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regional_invaded_withSLF_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># world map</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">countries_sf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"azure4"</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># slf native range shapefile</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">regional_invaded_withSLF</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">koeppen_climate_zones</span><span class="op">)</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># scales</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"K\U00F6ppen-Geiger climate zones as background selection area\nfor 'Ri.NAmerica' model"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"K-G zones selected if containing SLF presences"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"longitude"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"latitude"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"K-G climate\nzone"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># scales</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Paired"</span>, labels <span class="op">=</span> <span class="va">regional_invaded_withSLF</span><span class="op">$</span><span class="va">zone_name</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># theme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">138.66681</span>, <span class="op">-</span><span class="fl">52.58347</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">19.12534</span>, <span class="fl">60.83319</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">regional_invaded_withSLF_plot</span></span></code></pre></div>
<p><img src="060_setup_regional_MaxEnt_models_files/figure-html/plot%20K-G%20zones%20in%20N%20America-1.png" width="700"></p>
<p>So when we mask the bioclim layers, we should see something similar
to this.</p>
</div>
<div class="section level4">
<h4 id="mask-bioclim-layers">Mask bioclim layers<a class="anchor" aria-label="anchor" href="#mask-bioclim-layers"></a>
</h4>
<p>I will start the masking process by importing the bioclim layers and
reference layer I need. I will also crop this layer to only N America,
so I will need a bounding box for that.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># import layers</span></span>
<span><span class="va">env.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"historical_climate_rasters"</span>, <span class="st">"chelsa2.1_30arcsec"</span>, <span class="st">"v1_maxent_10km"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\_NAmerica.asc$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># output file names</span></span>
<span><span class="va">output.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"historical_climate_rasters"</span>, <span class="st">"chelsa2.1_30arcsec"</span>, <span class="st">"v1_maxent_10km"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\_NAmerica.asc$"</span>, full.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"NAmerica"</span>, replacement <span class="op">=</span> <span class="st">"regional_invaded_KG"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># also load shapefile again</span></span>
<span><span class="va">regional_invaded_withSLF</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"shapefiles"</span>, <span class="st">"SLF_regional_invaded_extent.shp"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># bbox for cropping</span></span>
<span><span class="va">ext.obj.crop</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="op">-</span><span class="fl">138.66681</span>, <span class="fl">19.12534</span>, <span class="op">-</span><span class="fl">52.58347</span>, <span class="fl">60.83319</span> , xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>I will now mask these rasters using the shapefile created above.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loop to crop extent for all files</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co"># load in first raster</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># mask new rasters using shapefile</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, mask <span class="op">=</span> <span class="va">regional_invaded_withSLF</span>, overwrite <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>      <span class="co"># crop to extent as well</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, y <span class="op">=</span> <span class="va">ext.obj.crop</span>, overwrite <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#write out the new resampled rasters!</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">rast.hold</span>, </span>
<span>    filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"historical_climate_rasters"</span>, <span class="st">"chelsa2.1_30arcsec"</span>, <span class="st">"v1_maxent_10km"</span>, <span class="va">output.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    filetype <span class="op">=</span> <span class="st">"AAIGrid"</span>, </span>
<span>    overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># remove object once its done</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">rast.hold</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="co"># I am pretty sure this method resets the raster cell numbers, which might be annoying downstream....</span></span></code></pre></div>
<p>Lets plot one of the new layers to make sure the cropping worked.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bio11_df</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"historical_climate_rasters"</span>, <span class="st">"chelsa2.1_30arcsec"</span>, <span class="st">"v1_maxent_10km"</span>, <span class="st">"bio11_1981-2010_regional_invaded_KG.asc"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># convert to df</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot main layer as example</span></span>
<span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># empty world map to force same aspect ratio</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">countries_sf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># change scale of plots to be standard across figures</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bio11_df</span>, </span>
<span>            <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">`CHELSA_bio11_1981-2010_V.2.1`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">138.66681</span>, <span class="op">-</span><span class="fl">52.58347</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">19.12534</span>, <span class="fl">60.83319</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="060_setup_regional_MaxEnt_models_files/figure-html/plot%20to%20ensure%20cropping%20worked-1.png" width="700"></p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the cropping worked</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">ext.obj</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">ext.obj.vect</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">ext.obj.crop</span><span class="op">)</span></span></code></pre></div>
<p>Now that the bioclim layers have been trimmed, I can use these
rasters downstream to choose the background points for this model. I
will repeat this process for the other two regional models.</p>
</div>
</div>
<div class="section level3">
<h3 id="invaded-region-in-south-korea-and-japan-ri-asia-model">2.2 Invaded region in South Korea and Japan (Ri.Asia model)<a class="anchor" aria-label="anchor" href="#invaded-region-in-south-korea-and-japan-ri-asia-model"></a>
</h3>
<p>I need to find a way to clip the climate zones by native vs invaded
region, because the same climate zones are likely present in Japan and
Korea as in the native range. However, I want to segment the data by
region. I would normally use the country administrative borders, but
there are many contested islands that would be left out. So, I will
obtain the bounding box for Japan and South Korea and use that to
geographically segment the KG climate zones before masking.</p>
<div class="section level4">
<h4 id="intersect-points-and-kg-zones-1">Intersect points and KG zones<a class="anchor" aria-label="anchor" href="#intersect-points-and-kg-zones-1"></a>
</h4>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">koeppen_zones_rast</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"models"</span>, <span class="st">"working_dir"</span>, <span class="st">"koeppen_climate_zones.asc"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">slf_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"slf_all_coords_final_2024-08-05.csv"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">species</span><span class="op">)</span> </span></code></pre></div>
<p>I just want the presences from the invaded east asian range. I will
manually filter out some points that accidentally got into both the
native and Ri.Asia models.</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extent object for Japan and SK</span></span>
<span><span class="va">ext.obj</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="fl">122.93816</span>, <span class="fl">153.98561</span>, <span class="fl">24.21210</span>, <span class="fl">45.52041</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert to vector</span></span>
<span><span class="va">slf_points_vect</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">slf_points</span>, geom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># crop by extent area of interest</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">.</span>, y <span class="op">=</span> <span class="va">ext.obj</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># convert to geom, which gets coordinates of a spatVector</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/geometry.html" class="external-link">geom</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># convert to sf object</span></span>
<span><span class="va">slf_points_invaded_asian</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">slf_points_vect</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">geom</span>, <span class="va">part</span>, <span class="va">hole</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># filter out specific points that were showing up in both native and invaded_regional model</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">125</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># convert to sf object</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># will not need this object again</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">slf_points_vect</span><span class="op">)</span></span></code></pre></div>
<p>Now we will intersect the points with the shapefile. I need to crop
the shapefile to the the same extent as the presences and then intersect
them to keep the climate zones that contain presences. The resulting
shapefile will be used to crop the bioclim data and choose background
points for that specific model.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load in shapefile again</span></span>
<span><span class="va">KG_zones_invaded_asian_poly</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"models"</span>, <span class="st">"working_dir"</span>, <span class="st">"shapefiles"</span>, <span class="st">"koeppen_climate_zones.shp"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"koeppen_climate_zones"</span> <span class="op">=</span> <span class="st">"koeppen_cl"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># bounding box for cropping</span></span>
<span><span class="va">ext.obj.vect</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="fl">122.93816</span>, ymin <span class="op">=</span> <span class="fl">24.21210</span>, xmax <span class="op">=</span> <span class="fl">153.98561</span>, ymax <span class="op">=</span> <span class="fl">45.52041</span><span class="op">)</span></span>
<span><span class="co"># first, crop K-G raster to SK and Japan</span></span>
<span><span class="va">KG_zones_invaded_asian_poly</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop</a></span><span class="op">(</span><span class="va">KG_zones_invaded_asian_poly</span>, y <span class="op">=</span> <span class="va">ext.obj.vect</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># also get rid of ocean</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">koeppen_climate_zones</span> <span class="op">!=</span> <span class="fl">32</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># intersect</span></span>
<span><span class="va">regional_invaded_asian_withSLF</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_filter</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">KG_zones_invaded_asian_poly</span>, y <span class="op">=</span> <span class="va">slf_points_invaded_asian</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write to file</span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span></span>
<span>  obj <span class="op">=</span> <span class="va">regional_invaded_asian_withSLF</span>, </span>
<span>  dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"shapefiles"</span>, <span class="st">"SLF_regional_invaded_asian_extent.shp"</span><span class="op">)</span>,</span>
<span>  driver <span class="op">=</span> <span class="st">"ESRI Shapefile"</span>,</span>
<span>  append <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regional_invaded_asian_withSLF</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"shapefiles"</span>, <span class="st">"SLF_regional_invaded_asian_extent.shp"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"koeppen_climate_zones"</span> <span class="op">=</span> <span class="st">"kppn_c_"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get extent</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">regional_invaded_asian_withSLF</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">##      xmin      ymin      xmax      ymax </span></span>
<span><span class="co">## 122.93816  30.49986 149.74986  46.58424</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regional_invaded_asian_withSLF</span> <span class="op">&lt;-</span> <span class="va">regional_invaded_asian_withSLF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">kmz_names_labels</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">koeppen_climate_zones</span> <span class="op">==</span> <span class="va">zone_number</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now lets plot it for a sanity check.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regional_invaded_asian_withSLF_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># world map</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">countries_sf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"azure4"</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># slf native range shapefile</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">regional_invaded_asian_withSLF</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">koeppen_climate_zones</span><span class="op">)</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># scales</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"K\U00F6ppen-Geiger climate zones as background selection area\nfor 'Ri.Asia' model"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"K-G zones selected if containing SLF presences"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"longitude"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"latitude"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"K-G climate\nzone"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># scales</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Paired"</span>, labels <span class="op">=</span> <span class="va">regional_invaded_asian_withSLF</span><span class="op">$</span><span class="va">zone_name</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># theme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">122.93816</span>, <span class="fl">149.74986</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30.49986</span>, <span class="fl">46.58424</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">regional_invaded_asian_withSLF_plot</span></span></code></pre></div>
<p><img src="060_setup_regional_MaxEnt_models_files/figure-html/plot%20invaded_asian%20range-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="mask-bioclim-layers-1">Mask bioclim layers<a class="anchor" aria-label="anchor" href="#mask-bioclim-layers-1"></a>
</h4>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># bioclim layers</span></span>
<span><span class="va">env.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"historical_climate_rasters"</span>, <span class="st">"chelsa2.1_30arcsec"</span>, <span class="st">"v1_maxent_10km"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\_global.asc$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># set naming for rasters</span></span>
<span><span class="va">output.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"historical_climate_rasters"</span>, <span class="st">"chelsa2.1_30arcsec"</span>, <span class="st">"v1_maxent_10km"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\_global.asc$"</span>, full.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"global"</span>, replacement <span class="op">=</span> <span class="st">"regional_invaded_asian_KG"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span></span>
<span><span class="co"># load in shapefile as spatVector </span></span>
<span><span class="va">regional_invaded_asian_withSLF</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"shapefiles"</span>, <span class="st">"SLF_regional_invaded_asian_extent.shp"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># for cropping</span></span>
<span><span class="va">ext.obj.crop</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="fl">122.93816</span>, <span class="fl">30.49986</span>, <span class="fl">149.74986</span>, <span class="fl">46.58424</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loop to crop extent for all files</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co">#ensure that the CRS is consistent</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># crop new rasters to extent</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, mask <span class="op">=</span> <span class="va">regional_invaded_asian_withSLF</span><span class="op">)</span></span>
<span>  <span class="co"># crop to extent as well</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, y <span class="op">=</span> <span class="va">ext.obj.crop</span>, overwrite <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># write out the new resampled rasters!</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">rast.hold</span>, </span>
<span>    filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"historical_climate_rasters"</span>, <span class="st">"chelsa2.1_30arcsec"</span>, <span class="st">"v1_maxent_10km"</span>, <span class="va">output.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    filetype <span class="op">=</span> <span class="st">"AAIGrid"</span>, </span>
<span>    overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># remove object once its done</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">rast.hold</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bio11_invaded_asian</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"historical_climate_rasters"</span>, <span class="st">"chelsa2.1_30arcsec"</span>, <span class="st">"v1_maxent_10km"</span>, <span class="st">"bio11_1981-2010_regional_invaded_asian_KG.asc"</span><span class="op">)</span></span>
<span>  <span class="op">)</span> </span>
<span></span>
<span><span class="co"># convert to df</span></span>
<span><span class="va">bio11_invaded_asian</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">bio11_invaded_asian</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot main layer as example</span></span>
<span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># empty world map to force same aspect ratio</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">countries_sf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># change scale of plots to be standard across figures</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bio11_invaded_asian</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">`CHELSA_bio11_1981-2010_V.2.1`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">122.93816</span>, <span class="fl">149.74986</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">30.49986</span>, <span class="fl">46.58424</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="060_setup_regional_MaxEnt_models_files/figure-html/plot%20for%20check-1.png" width="700"></p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the cropping worked</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">ext.obj</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">ext.obj.vect</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">ext.obj.crop</span><span class="op">)</span></span></code></pre></div>
<p>Looks good!</p>
</div>
</div>
<div class="section level3">
<h3 id="native-region-in-southeast-asia-rn-model">2.3 Native region in Southeast Asia (Rn model)<a class="anchor" aria-label="anchor" href="#native-region-in-southeast-asia-rn-model"></a>
</h3>
<p>The native range for China will be defined as anywhere within
Southeast asia that contains the same climate zones that SLF are found
in within east and southeast Asia. We will use the
<code>ne_countries</code> shapefile to clip our KG climate zones
shapefile. Then, we will use that final shapefile to clip the bioclim
rasters.</p>
<div class="section level4">
<h4 id="get-shapefile-for-native-range">Get shapefile for native range<a class="anchor" aria-label="anchor" href="#get-shapefile-for-native-range"></a>
</h4>
<p>We will use the <code>ne_countries</code> shapefile downloaded
earlier to cut out the parts we want. We can treat the shapefile like
any other data table and simply retrieve the countries we want. We will
keep all countries in southeast Asia, plus countries in south Asia
excluding Pakistan and Afghanistan and east Asia excluding the invaded
range in Asia (Japan, SK, NK) (Wikipedia, see references). We are using
a much larger extent because there is a lot of conjecture about the true
native range of SLF, and we want those climate zones to be
considered.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># re-load the shapefile downloaded earlier</span></span>
<span><span class="va">asia_sf</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"ne_countries"</span>, <span class="st">"ne_10m_admin_0_countries.shp"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># southeast asia shapefile</span></span>
<span><span class="va">asia_sf</span> <span class="op">&lt;-</span> <span class="va">asia_sf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># filter all countries in southeast asia</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span></span>
<span>    <span class="va">NAME</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>      <span class="co"># southeast asia</span></span>
<span>      <span class="st">"Brunei"</span>, <span class="st">"East Timor"</span>, <span class="st">"Indonesia"</span>, <span class="st">"Laos"</span>, <span class="st">"Malaysia"</span>, <span class="st">"Myanmar"</span>, <span class="st">"Philippines"</span>, <span class="st">"Singapore"</span>, <span class="st">"Thailand"</span>, <span class="st">"Vietnam"</span>, </span>
<span>      <span class="co"># east asia</span></span>
<span>      <span class="st">"China"</span>, <span class="st">"Hong Kong"</span>, <span class="st">"Macau"</span>, <span class="st">"Mongolia"</span>, <span class="st">"Taiwan"</span>, </span>
<span>      <span class="co"># south asia</span></span>
<span>      <span class="st">"Bangladesh"</span>, <span class="st">"Bhutan"</span>, <span class="st">"India"</span>, <span class="st">"Maldives"</span>, <span class="st">"Nepal"</span>, <span class="st">"Sri Lanka"</span><span class="op">)</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># set crs</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">.</span>, dst <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># save</span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span></span>
<span>  obj <span class="op">=</span> <span class="va">asia_sf</span>, </span>
<span>  dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"shapefiles"</span>, <span class="st">"asia_admin.shp"</span><span class="op">)</span>,</span>
<span>  driver <span class="op">=</span> <span class="st">"ESRI Shapefile"</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<p>Macau and Hong Kong did not show up in the original dataset, but were
likely considered part of a larger country (in the case of Hong Kong,
China).</p>
<p>We will use this shapefile to cut out the KG climate zones, then will
intersect the result with the SLF points dataset</p>
</div>
<div class="section level4">
<h4 id="select-kg-regions">Select KG regions<a class="anchor" aria-label="anchor" href="#select-kg-regions"></a>
</h4>
<p>I will import the SLF presences and KG shapefile first.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># slf presences</span></span>
<span><span class="va">slf_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"slf_all_coords_final_2024-08-05.csv"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">species</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># load in KG shapefile </span></span>
<span><span class="va">koeppen_zones_rast</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"models"</span>, <span class="st">"working_dir"</span>, <span class="st">"koeppen_climate_zones.asc"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># re-load asia admin shapefile</span></span>
<span><span class="va">asia_vect</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"shapefiles"</span>, <span class="st">"asia_admin.shp"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Next, I will crop the SLF presences and the KG shapefile datasets
using the Asian range shapefile.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># temp mask layer</span></span>
<span><span class="va">mask_layer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="va">asia_sf</span><span class="op">)</span></span>
<span><span class="co"># convert to vector</span></span>
<span><span class="va">slf_points_masked</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">slf_points</span>, geom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="co"># crop by extent area of interest</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="va">.</span>, mask <span class="op">=</span> <span class="va">mask_layer</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="co"># convert to geom, which gets coordinates of a spatVector</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/geometry.html" class="external-link">geom</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># convert back to data frame</span></span>
<span><span class="va">slf_points_native</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">slf_points_masked</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">geom</span>, <span class="va">part</span>, <span class="va">hole</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span>coords <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># will not need these objects again</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">slf_points_masked</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">mask_layer</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># first, mask K-G raster by asian countries</span></span>
<span><span class="va">koeppen_zones_rast_native</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="va">koeppen_zones_rast</span>, mask <span class="op">=</span> <span class="va">asia_vect</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># next, convert raster to polygon</span></span>
<span><span class="va">KG_zones_native_poly</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.polygons.html" class="external-link">as.polygons</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">koeppen_zones_rast_native</span>,</span>
<span>  aggregate <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  values <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  crs <span class="op">=</span> <span class="st">"EPSG:4326"</span></span>
<span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># write to shapefile</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeVector.html" class="external-link">writeVector</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">KG_zones_native_poly</span>,</span>
<span>  filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"models"</span>, <span class="st">"working_dir"</span>, <span class="st">"shapefiles"</span>, <span class="st">"asia_admin_KG.shp"</span><span class="op">)</span>,</span>
<span>  filetype <span class="op">=</span> <span class="st">"ESRI Shapefile"</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load back in as shapefile</span></span>
<span><span class="va">KG_zones_native_poly</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"models"</span>, <span class="st">"working_dir"</span>, <span class="st">"shapefiles"</span>, <span class="st">"asia_admin_KG.shp"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># rename</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"koeppen_climate_zones"</span> <span class="op">=</span> <span class="st">"koeppen_cl"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># also get rid of ocean</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">koeppen_climate_zones</span> <span class="op">!=</span> <span class="fl">32</span><span class="op">)</span> </span>
<span>  </span>
<span><span class="co"># intersect</span></span>
<span><span class="va">regional_native_withSLF</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_join.html" class="external-link">st_filter</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">KG_zones_native_poly</span>, y <span class="op">=</span> <span class="va">slf_points_native</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># write to file</span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_write.html" class="external-link">st_write</a></span><span class="op">(</span></span>
<span>  obj <span class="op">=</span> <span class="va">regional_native_withSLF</span>, </span>
<span>  dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"shapefiles"</span>, <span class="st">"SLF_regional_native_extent.shp"</span><span class="op">)</span>,</span>
<span>  driver <span class="op">=</span> <span class="st">"ESRI Shapefile"</span>,</span>
<span>  append <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regional_native_withSLF</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_read.html" class="external-link">read_sf</a></span><span class="op">(</span>dsn <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"shapefiles"</span>, <span class="st">"SLF_regional_native_extent.shp"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"koeppen_climate_zones"</span> <span class="op">=</span> <span class="st">"kppn_c_"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># get extent</span></span>
<span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="va">regional_native_withSLF</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">##       xmin       ymin       xmax       ymax </span></span>
<span><span class="co">##  72.666527  -9.666806 140.999860  53.249861</span></span></code></pre>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regional_native_withSLF</span> <span class="op">&lt;-</span> <span class="va">regional_native_withSLF</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">kmz_names_labels</span>, <span class="fu"><a href="https://dplyr.tidyverse.org/reference/join_by.html" class="external-link">join_by</a></span><span class="op">(</span><span class="va">koeppen_climate_zones</span> <span class="op">==</span> <span class="va">zone_number</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now lets plot it for a sanity check.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regional_native_withSLF_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># world map</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">countries_sf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">"azure4"</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># slf native range shapefile</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">regional_native_withSLF</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">as.factor</a></span><span class="op">(</span><span class="va">koeppen_climate_zones</span><span class="op">)</span><span class="op">)</span>, color <span class="op">=</span> <span class="st">"black"</span>, lwd <span class="op">=</span> <span class="fl">0.25</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># scales</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"K\U00F6ppen climate zones as background selection area for 'Rn' model"</span>,</span>
<span>    caption <span class="op">=</span> <span class="st">"K-G zones selected if containing SLF presences"</span>,</span>
<span>    x <span class="op">=</span> <span class="st">"longitude"</span>,</span>
<span>    y <span class="op">=</span> <span class="st">"latitude"</span>,</span>
<span>    fill <span class="op">=</span> <span class="st">"K-G climate\nzone"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># scales</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_brewer</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Paired"</span>, labels <span class="op">=</span> <span class="va">regional_native_withSLF</span><span class="op">$</span><span class="va">zone_name</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_x_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>expand <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># theme</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"right"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">72.666527</span>, <span class="fl">140.999860</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">9.666806</span>, <span class="fl">53.249861</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="mask-bioclim-layers-2">Mask bioclim layers<a class="anchor" aria-label="anchor" href="#mask-bioclim-layers-2"></a>
</h4>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># import layers</span></span>
<span><span class="va">env.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"historical_climate_rasters"</span>, <span class="st">"chelsa2.1_30arcsec"</span>, <span class="st">"v1_maxent_10km"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\_global.asc$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># output file names</span></span>
<span><span class="va">output.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"historical_climate_rasters"</span>, <span class="st">"chelsa2.1_30arcsec"</span>, <span class="st">"v1_maxent_10km"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\_global.asc$"</span>, full.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"global"</span>, replacement <span class="op">=</span> <span class="st">"regional_native_KG"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># also load shapefile again</span></span>
<span><span class="va">regional_native_withSLF</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"shapefiles"</span>, <span class="st">"SLF_regional_native_extent.shp"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">ext.obj.crop</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="fl">72.666527</span>, <span class="op">-</span><span class="fl">9.666806</span>, <span class="fl">140.999860</span>, <span class="fl">53.249861</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>I will now mask these rasters using the shapefile created above</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loop to crop extent for all files</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span></span>
<span>  <span class="co">#ensure that the CRS is consistent</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># mask new rasters using shapefile</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, mask <span class="op">=</span> <span class="va">regional_native_withSLF</span>, overwrite <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  <span class="co"># crop to extent as well</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, y <span class="op">=</span> <span class="va">ext.obj.crop</span>, overwrite <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#write out the new resampled rasters!</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">rast.hold</span>, </span>
<span>    filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"historical_climate_rasters"</span>, <span class="st">"chelsa2.1_30arcsec"</span>, <span class="st">"v1_maxent_10km"</span>, <span class="va">output.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    filetype <span class="op">=</span> <span class="st">"AAIGrid"</span>, </span>
<span>    overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># remove object once its done</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">rast.hold</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span>
<span><span class="co"># I am pretty sure this method resets the raster cell numbers, which might be annoying downstream....</span></span></code></pre></div>
<p>Lets plot one of the new layers to make sure the cropping worked.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bio11_native</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"historical_climate_rasters"</span>, <span class="st">"chelsa2.1_30arcsec"</span>, <span class="st">"v1_maxent_10km"</span>, <span class="st">"bio11_1981-2010_regional_native_KG.asc"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># convert to df</span></span>
<span><span class="va">bio11_native</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">bio11_native</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot main layer as example</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># empty world map to force same aspect ratio</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">countries_sf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>geometry <span class="op">=</span> <span class="va">geometry</span><span class="op">)</span>, fill <span class="op">=</span> <span class="cn">NA</span>, color <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="co"># change scale of plots to be standard across figures</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_raster</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bio11_native</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">`CHELSA_bio11_1981-2010_V.2.1`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">coord_sf</a></span><span class="op">(</span>xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">72.666527</span>, <span class="fl">140.999860</span><span class="op">)</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">9.666806</span>, <span class="fl">53.249861</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="060_setup_regional_MaxEnt_models_files/figure-html/plot%20main_layer%20to%20ensure%20cropping%20worked-1.png" width="700"></p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># the cropping worked</span></span></code></pre></div>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">ext.obj.crop</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="choose-background-points-from-selection-areas">3. Choose background points from selection areas<a class="anchor" aria-label="anchor" href="#choose-background-points-from-selection-areas"></a>
</h2>
<p>Now, I need to use the rasters I just created to choose the
background points, which are used by MaxEnt to sample the climate and
compare that sample with known SLF presences. The background points
should be randomized because they are a stand-in for true absences, so I
will generate them using <code><a href="https://rdrr.io/pkg/dismo/man/randomPoints.html" class="external-link">dismo::randomPoints()</a></code>.</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mypath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   <span class="st">"maxent/historical_climate_rasters/chelsa2.1_30arcsec/v1_maxent_10km"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">global_bio11_df</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"bio11_1981-2010_global.asc"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="invaded-region-of-north-america-ri-namerica-model">3.1 invaded region of North America (Ri.NAmerica model)<a class="anchor" aria-label="anchor" href="#invaded-region-of-north-america-ri-namerica-model"></a>
</h3>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load in raster to choose points from</span></span>
<span><span class="va">regional_invaded_bio11</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"bio11_1981-2010_regional_invaded_KG.asc"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># load in slf points to intersect</span></span>
<span><span class="va">slf_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"slf_all_coords_final_2024-08-05.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>Create 10,000 random background points. These will be corrected for
the latitudinal stretching and will not be selected from presence
locations, like with the global model.</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set seed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># generate random points </span></span>
<span><span class="va">regional_invaded_background</span> <span class="op">&lt;-</span> <span class="fu">dismo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dismo/man/randomPoints.html" class="external-link">randomPoints</a></span><span class="op">(</span></span>
<span>  mask <span class="op">=</span> <span class="va">regional_invaded_bio11</span>, </span>
<span>  n <span class="op">=</span> <span class="fl">10000</span>, <span class="co"># default number used by maxent</span></span>
<span>  p <span class="op">=</span> <span class="va">slf_points</span>,</span>
<span>  excludep <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># exclude cells where slf has been found</span></span>
<span>  lonlatCorrection <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># weight samples by latitude because cell size is larger closer to equator</span></span>
<span>  warn <span class="op">=</span> <span class="fl">2</span> <span class="co"># higher number gives most warnings, including if sample size not reached</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save as csv</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">regional_invaded_background</span>, </span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"regional_invaded_background_points_v7.csv"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co"># save as rds file</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span></span>
<span>  <span class="va">regional_invaded_background</span>, </span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"regional_invaded_background_points_v7.rds"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now lets visualize the result.</p>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># rasters</span></span>
<span><span class="co"># bg raster</span></span>
<span><span class="va">regional_invaded_bio11_df</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"bio11_1981-2010_regional_invaded_KG.asc"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># re-read background points </span></span>
<span><span class="va">regional_invaded_background</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"regional_invaded_background_points_v7.csv"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## Coordinate system already present. Adding new coordinate system, which will</span></span>
<span><span class="co">## replace the existing one.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span>
<span><span class="co">## Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span>
<span><span class="co">## Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span></code></pre>
<p><img src="060_setup_regional_MaxEnt_models_files/figure-html/plot%20Ri.NAmerica%20background-1.png" width="700"></p>
<p>We can see that the background points are isolated to the area
selected using the K-G climate zones in North America, so our operation
was successful.</p>
<p>Now, I will repeat this process for the next two models.</p>
</div>
<div class="section level3">
<h3 id="invaded-region-of-asia-south-korea-and-japan-ri-asia-model">3.2 invaded region of Asia (South Korea and Japan, Ri.Asia
model)<a class="anchor" aria-label="anchor" href="#invaded-region-of-asia-south-korea-and-japan-ri-asia-model"></a>
</h3>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load in raster to choose points from</span></span>
<span><span class="va">invaded_asian_bio11</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"bio11_1981-2010_regional_invaded_asian_KG.asc"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># load in slf points to intersect</span></span>
<span><span class="va">slf_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"slf_all_coords_final_2024-08-05.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set seed</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">7</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># generate random points </span></span>
<span><span class="va">regional_invaded_asian_points</span> <span class="op">&lt;-</span> <span class="fu">dismo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dismo/man/randomPoints.html" class="external-link">randomPoints</a></span><span class="op">(</span></span>
<span>  mask <span class="op">=</span> <span class="va">invaded_asian_bio11</span>, <span class="co"># cropped to regional_invaded_asian range</span></span>
<span>  n <span class="op">=</span> <span class="fl">10000</span>, <span class="co"># default number used by maxent</span></span>
<span>  p <span class="op">=</span> <span class="va">slf_points</span>,</span>
<span>  excludep <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># exclude cells where slf has been found</span></span>
<span>  lonlatCorrection <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># weight samples by latitude because cell size is larger closer to equator</span></span>
<span>  warn <span class="op">=</span> <span class="fl">2</span> <span class="co"># higher number gives most warnings, including if sample size not reached</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save as csv</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">regional_invaded_asian_points</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"regional_invaded_asian_background_points_v2.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># save as rds file</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span><span class="va">regional_invaded_asian_points</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"regional_invaded_asian_background_points_v2.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>Now lets visualize the result.</p>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># background raster</span></span>
<span><span class="va">invaded_asian_bio11_df</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"bio11_1981-2010_regional_invaded_asian_KG.asc"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># bg points</span></span>
<span><span class="va">regional_invaded_asian_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"regional_invaded_asian_background_points_v2.csv"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## Coordinate system already present. Adding new coordinate system, which will</span></span>
<span><span class="co">## replace the existing one.</span></span>
<span><span class="co">## Scale for <span style="color: #00BB00;">x</span> is already present.</span></span>
<span><span class="co">## Adding another scale for <span style="color: #00BB00;">x</span>, which will replace the existing scale.</span></span>
<span><span class="co">## Scale for <span style="color: #00BB00;">y</span> is already present.</span></span>
<span><span class="co">## Adding another scale for <span style="color: #00BB00;">y</span>, which will replace the existing scale.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span>
<span><span class="co">## Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 2258200 rows containing missing values or values outside the scale</span></span>
<span><span class="co">## range (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 52 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<p><img src="060_setup_regional_MaxEnt_models_files/figure-html/plot%20Ri.Asia%20bg-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="native-region-rn-model">3.3 Native region (Rn model)<a class="anchor" aria-label="anchor" href="#native-region-rn-model"></a>
</h3>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># mask layer I will use</span></span>
<span><span class="va">regional_native_bio2</span> <span class="op">&lt;-</span> <span class="fu">raster</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/raster/man/raster.html" class="external-link">raster</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"bio2_1981-2010_regional_native_KG.asc"</span><span class="op">)</span><span class="op">)</span> <span class="co"># %&gt;%</span></span>
<span>  <span class="co">#!is.na()</span></span>
<span></span>
<span><span class="co"># also get ext</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">regional_native_bio2</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co"># load in slf points to intersect</span></span>
<span><span class="va">slf_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"slf_all_coords_final_2024-08-05.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">species</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set seed so that the random points for this dataset are the same the next time this code is run</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">6</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># generate random points </span></span>
<span><span class="va">regional_native_points</span> <span class="op">&lt;-</span> <span class="fu">dismo</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/dismo/man/randomPoints.html" class="external-link">randomPoints</a></span><span class="op">(</span></span>
<span>  mask <span class="op">=</span> <span class="va">regional_native_bio2</span>, </span>
<span>  n <span class="op">=</span> <span class="fl">10000</span>, <span class="co"># default number used by maxent</span></span>
<span>  p <span class="op">=</span> <span class="va">slf_points</span>,</span>
<span>  excludep <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># exclude cells where slf has been found</span></span>
<span>  lonlatCorrection <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># weight samples by latitude because cell size is larger closer to equator</span></span>
<span>  warn <span class="op">=</span> <span class="fl">2</span> <span class="co"># higher number gives most warnings, including if sample size not reached</span></span>
<span>  <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save as csv</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">regional_native_points</span>, </span>
<span>          file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"regional_native_background_points_v3.csv"</span><span class="op">)</span></span>
<span>          <span class="op">)</span></span>
<span><span class="co"># save as rds file</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">write_rds</a></span><span class="op">(</span><span class="va">regional_native_points</span>, </span>
<span>          file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"regional_native_background_points_v3.rds"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">regional_native_bio2_df</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"bio2_1981-2010_regional_native_KG.asc"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="va">regional_native_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"regional_native_background_points_v3.csv"</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<pre><code><span><span class="co">## Coordinate system already present. Adding new coordinate system, which will</span></span>
<span><span class="co">## replace the existing one.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span>
<span><span class="co">## Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span>
<span><span class="co">## Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span></code></pre>
<p><img src="060_setup_regional_MaxEnt_models_files/figure-html/plot%20points-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="choose-and-plot-training-points">4. Choose and plot training points<a class="anchor" aria-label="anchor" href="#choose-and-plot-training-points"></a>
</h2>
<p>Next, I will use bounding boxes to isolate SLF presences from each
major region. This would not normally be sufficient to select the
correct points, but each region is isolated from the others in a fashion
that a bounding box easily separates the points by region in this
case.</p>
<div class="sourceCode" id="cb68"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mypath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                     <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                   <span class="st">"maxent"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># background raster for plotting will be same as in last section</span></span>
<span></span>
<span><span class="co"># load in slf points to intersect</span></span>
<span><span class="va">slf_points</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_rds.html" class="external-link">read_rds</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data"</span>, <span class="st">"slf_all_coords_final_2024-08-05.rds"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">species</span><span class="op">)</span> </span></code></pre></div>
<div class="section level3">
<h3 id="invaded-region-of-north-america-ri-namerica-model-1">4.1 Invaded region of North America (Ri.NAmerica model)<a class="anchor" aria-label="anchor" href="#invaded-region-of-north-america-ri-namerica-model-1"></a>
</h3>
<p>I will convert the SLF points dataset to a spatial vector object so
that it can be filtered using a bounding box, then transform it back to
a dataframe.</p>
<div class="sourceCode" id="cb70"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># extent object for N America</span></span>
<span><span class="va">ext.obj</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="op">-</span><span class="fl">96.503906</span>, <span class="op">-</span><span class="fl">59.589844</span>, <span class="fl">23.5</span>, <span class="fl">47.457809</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert to vector</span></span>
<span><span class="va">slf_points_vect</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">slf_points</span>, geom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># crop by extent area of interest</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span><span class="va">.</span>, y <span class="op">=</span> <span class="va">ext.obj</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># convert to geom, which gets coordinates of a spatVector</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/geometry.html" class="external-link">geom</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># convert back to data frame</span></span>
<span><span class="va">slf_points_invaded</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">slf_points_vect</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">geom</span>, <span class="va">part</span>, <span class="va">hole</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># will not need this object again</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">slf_points_vect</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">slf_points_invaded</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"regional_invaded_train_slf_presences_v7.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now I will plot these points on the raster to ensure that the
bounding box worked.</p>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">338</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">2</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (2): x, y</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">## Coordinate system already present. Adding new coordinate system, which will</span></span>
<span><span class="co">## replace the existing one.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span>
<span><span class="co">## Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span>
<span><span class="co">## Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span></code></pre>
<p><img src="060_setup_regional_MaxEnt_models_files/figure-html/plot%20model%20presences-%20Ri.NAmerica-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="invaded-regional-south-korea-and-japan">4.2 Invaded Regional (South Korea and Japan)<a class="anchor" aria-label="anchor" href="#invaded-regional-south-korea-and-japan"></a>
</h3>
<div class="sourceCode" id="cb74"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># native range extent shapefile used to select slf presences</span></span>
<span><span class="va">mask_layer</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"shapefiles"</span>, <span class="st">"SLF_regional_invaded_asian_extent.shp"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert to vector</span></span>
<span><span class="va">slf_points_masked</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">slf_points</span>, geom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="co"># crop by extent area of interest</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="va">.</span>, mask <span class="op">=</span> <span class="va">mask_layer</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="co"># convert to geom, which gets coordinates of a spatVector</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/geometry.html" class="external-link">geom</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># convert back to data frame</span></span>
<span><span class="va">slf_points_invaded_asian</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">slf_points_masked</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">geom</span>, <span class="va">part</span>, <span class="va">hole</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&gt;</span> <span class="fl">125</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># will not need this object again</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">slf_points_masked</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">slf_points_invaded_asian</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"regional_invaded_asian_train_slf_presences_v2.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">197</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">2</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (2): x, y</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">## Coordinate system already present. Adding new coordinate system, which will</span></span>
<span><span class="co">## replace the existing one.</span></span>
<span><span class="co">## Scale for <span style="color: #00BB00;">x</span> is already present.</span></span>
<span><span class="co">## Adding another scale for <span style="color: #00BB00;">x</span>, which will replace the existing scale.</span></span>
<span><span class="co">## Scale for <span style="color: #00BB00;">y</span> is already present.</span></span>
<span><span class="co">## Adding another scale for <span style="color: #00BB00;">y</span>, which will replace the existing scale.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span>
<span><span class="co">## Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 2258200 rows containing missing values or values outside the scale</span></span>
<span><span class="co">## range (`geom_raster()`).</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Removed 52 rows containing missing values or values outside the scale range</span></span>
<span><span class="co">## (`geom_raster()`).</span></span></code></pre>
<p><img src="060_setup_regional_MaxEnt_models_files/figure-html/plot%20model%20presences-%20Ri.Asia-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="native-regional">4.3 Native Regional<a class="anchor" aria-label="anchor" href="#native-regional"></a>
</h3>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># native range extent shapefile used to select slf presences</span></span>
<span><span class="va">mask_layer</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"shapefiles"</span>, <span class="st">"SLF_native_range_extent.shp"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># convert to vector</span></span>
<span><span class="va">slf_points_masked</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/vect.html" class="external-link">vect</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">slf_points</span>, geom <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"x"</span>, <span class="st">"y"</span><span class="op">)</span>, crs <span class="op">=</span> <span class="st">"EPSG:4326"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="co"># crop by extent area of interest</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span><span class="va">.</span>, mask <span class="op">=</span> <span class="va">mask_layer</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span><span class="co"># convert to geom, which gets coordinates of a spatVector</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/geometry.html" class="external-link">geom</a></span><span class="op">(</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># convert back to data frame</span></span>
<span><span class="va">slf_points_native</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">slf_points_masked</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">geom</span>, <span class="va">part</span>, <span class="va">hole</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span><span class="co"># will not need this object again</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">slf_points_masked</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">mask_layer</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb81"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">slf_points_native</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"regional_native_train_slf_presences_v3.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="font-weight: bold;">Rows: </span><span style="color: #0000BB;">269</span> <span style="font-weight: bold;">Columns: </span><span style="color: #0000BB;">2</span></span></span>
<span><span class="co">## <span style="color: #00BBBB;">──</span> <span style="font-weight: bold;">Column specification</span> <span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span></span>
<span><span class="co">## <span style="font-weight: bold;">Delimiter:</span> ","</span></span>
<span><span class="co">## <span style="color: #00BB00;">dbl</span> (2): x, y</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Use `spec()` to retrieve the full column specification for this data.</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Specify the column types or set `show_col_types = FALSE` to quiet this message.</span></span>
<span><span class="co">## Coordinate system already present. Adding new coordinate system, which will</span></span>
<span><span class="co">## replace the existing one.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span>
<span><span class="co">## Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span>
<span><span class="co">## Raster pixels are placed at uneven horizontal intervals and will be shifted</span></span>
<span><span class="co">## <span style="color: #00BBBB;">ℹ</span> Consider using `geom_tile()` instead.</span></span></code></pre>
<p><img src="060_setup_regional_MaxEnt_models_files/figure-html/plot%20model%20presences-%20Rn-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="choose-validation-points">5. Choose validation points<a class="anchor" aria-label="anchor" href="#choose-validation-points"></a>
</h2>
I will train each regional-scale on all of its regional slf presences
and test based on another region’s points. Here are the models and their
training / validation (test) regions:
<table class="table table table-striped" style="width: auto !important; margin-left: auto; margin-right: auto;">
<thead><tr>
<th style="text-align:left;">
model
</th>
<th style="text-align:left;">
train_region
</th>
<th style="text-align:right;">
train_presences
</th>
<th style="text-align:left;">
test_region
</th>
<th style="text-align:right;">
test_presences
</th>
<th style="text-align:left;">
background_points
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Rn
</td>
<td style="text-align:left;">
east Asia native region
</td>
<td style="text-align:right;">
269
</td>
<td style="text-align:left;">
N. America invaded region
</td>
<td style="text-align:right;">
54
</td>
<td style="text-align:left;">
10,000
</td>
</tr>
<tr>
<td style="text-align:left;">
Ri.NAmerica
</td>
<td style="text-align:left;">
N. America invaded region
</td>
<td style="text-align:right;">
338
</td>
<td style="text-align:left;">
east Asia invaded region (Koreas &amp; Japan)
</td>
<td style="text-align:right;">
68
</td>
<td style="text-align:left;">
10,000
</td>
</tr>
<tr>
<td style="text-align:left;">
Ri.Asia
</td>
<td style="text-align:left;">
east Asia invaded region (Koreas &amp; Japan)
</td>
<td style="text-align:right;">
200
</td>
<td style="text-align:left;">
N. America invaded region
</td>
<td style="text-align:right;">
40
</td>
<td style="text-align:left;">
10,000
</td>
</tr>
</tbody>
</table>
<p>The training and test points should be geographically separated, but
this creates an issue of the proper ratios being kept between the
training and test points if I were to use the entire dataset from
training one model to test another model. So, I will randomly sample a
subset of each model’s training region as the test points for another
model.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># this model is trained on N American presences and tested on invaded asian presences</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">8</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># randomly select subset of rows for testing</span></span>
<span><span class="va">slf_points_invaded_test_rows</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">slf_points_invaded_asian</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">68</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># no replacement</span></span>
<span><span class="co"># filter</span></span>
<span><span class="va">slf_points_invaded_test</span> <span class="op">&lt;-</span> <span class="va">slf_points_invaded_asian</span><span class="op">[</span><span class="va">slf_points_invaded_test_rows</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># write to csv</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">slf_points_invaded_test</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"regional_invaded_test_slf_presences_v7.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># this model is trained on invaded asian presences and tested on invaded N American presences</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">9</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># randomly select subset of rows for testing</span></span>
<span><span class="va">slf_points_invaded_asian_test_rows</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">slf_points_invaded</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">40</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># no replacement</span></span>
<span><span class="co"># filter</span></span>
<span><span class="va">slf_points_invaded_asian_test</span> <span class="op">&lt;-</span> <span class="va">slf_points_invaded</span><span class="op">[</span><span class="va">slf_points_invaded_asian_test_rows</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># write to csv</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">slf_points_invaded_asian_test</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"regional_invaded_asian_test_slf_presences_v2.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># this model is trained on Asian native presences and tested on invaded N. American presences</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">10</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># randomly select subset of rows for testing</span></span>
<span><span class="va">slf_points_native_test_rows</span> <span class="op">&lt;-</span>  <span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">slf_points_invaded</span><span class="op">)</span>, size <span class="op">=</span> <span class="fl">54</span>, replace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="co"># no replacement</span></span>
<span><span class="co"># filter</span></span>
<span><span class="va">slf_points_native_test</span> <span class="op">&lt;-</span> <span class="va">slf_points_invaded</span><span class="op">[</span><span class="va">slf_points_native_test_rows</span>, <span class="op">]</span></span>
<span></span>
<span><span class="co"># write to csv</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span></span>
<span>  x <span class="op">=</span> <span class="va">slf_points_native_test</span>,</span>
<span>  file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"regional_native_test_slf_presences_v3.csv"</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>Now we are ready to run all 3 regional models!</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Calvin, D. D., Rost, J., Keller, J., Crawford, S., Walsh, B.,
Bosold, M., &amp; Urban, J. (2023). Seasonal activity of spotted
lanternfly (Hemiptera: Fulgoridae), in Southeast Pennsylvania.
Environmental Entomology, 52(6), 1108–1125. <a href="https://doi.org/10.1093/ee/nvad093" class="external-link uri">https://doi.org/10.1093/ee/nvad093</a></p></li>
<li><p>Du, Z., Wu, Y., Chen, Z., Cao, L., Ishikawa, T., Kamitani, S.,
Sota, T., Song, F., Tian, L., Cai, W., &amp; Li, H. (2021). Global
phylogeography and invasion history of the spotted lanternfly revealed
by mitochondrial phylogenomics. Evolutionary Applications. <a href="https://doi.org/10.1111/eva.13170" class="external-link uri">https://doi.org/10.1111/eva.13170</a></p></li>
<li><p>Gallien, L., Douzet, R., Pratte, S., Zimmermann, N. E., &amp;
Thuiller, W. (2012). Invasive species distribution models – how
violating the equilibrium assumption can create new insights. Global
Ecology and Biogeography, 21(11), 1126–1136. <a href="https://doi.org/10.1111/j.1466-8238.2012.00768.x" class="external-link uri">https://doi.org/10.1111/j.1466-8238.2012.00768.x</a></p></li>
<li><p>Lewkiewicz, S. M., De Bona, S., Helmus, M. R., &amp; Seibold, B.
(2022). Temperature sensitivity of pest reproductive numbers in
age-structured PDE models, with a focus on the invasive spotted
lanternfly. Journal of Mathematical Biology, 85(3), 29. <a href="https://doi.org/10.1007/s00285-022-01800-9" class="external-link uri">https://doi.org/10.1007/s00285-022-01800-9</a></p></li>
<li><p>Santana Jr, P. A., Kumar, L., Da Silva, R. S., Pereira, J. L.,
&amp; Picanço, M. C. (2019). Assessing the impact of climate change on
the worldwide distribution of Dalbulus maidis (DeLong) using MaxEnt.
Pest Management Science, 75(10), 2706–2715. <a href="https://doi.org/10.1002/ps.5379" class="external-link uri">https://doi.org/10.1002/ps.5379</a></p></li>
<li><p>East Asia. 2024, March 6. Wikipedia.</p></li>
<li><p>South Asia. 2024, March 27. Wikipedia.</p></li>
<li><p>Southeast Asia. 2024, March 27. Wikipedia.</p></li>
<li><p>Xin, B., Zhang, Y., Wang, X., Cao, L., Hoelmer, K. A., Broadley,
H. J., &amp; Gould, J. R. (2020). Exploratory survey of spotted
lanternfly (Hemiptera: Fulgoridae) and its natural enemies in China.
Environmental Entomology, 50(1), 36–45. <a href="https://doi.org/10.1093/ee/nvaa137" class="external-link uri">https://doi.org/10.1093/ee/nvaa137</a></p></li>
</ol>
<!--

# Appendix 

## Patchwork together figures for publication


``` r
mypath <- file.path(here::here() %>% 
                     dirname(),
                   "maxent/historical_climate_rasters/chelsa2.1_30arcsec/v1_maxent_10km")


# reference layer for background of test plots
global_bio11_df <- terra::rast(x = file.path(mypath, "bio11_1981-2010_global.asc")) %>%
  terra::as.data.frame(., xy = TRUE)
```

### Ri.NAmerica model

These chunks will splice together the plots from above as summary plots.


``` r
# validation dataset
slf_points_invaded_test <- read.csv(
  file = file.path(here::here(), "vignette-outputs", "data-tables", "regional_invaded_test_slf_presences_v7.csv")
  )

# raster for the validation plot
invaded_asian_df <- terra::rast(x = file.path(mypath, "atc_2015_regional_invaded_asian_KG.asc")) %>%
  terra::as.data.frame(., xy = TRUE)
```


``` r
regional_invaded_test_plot <- ggplot() +
  map_style +
  # empty world map to force same aspect ratio
  geom_sf(data = countries_sf, aes(geometry = geometry), fill = NA, color = NA) +
  geom_raster(data = global_bio11_df, aes(x = x, y = y), fill = "azure4") +
  geom_raster(data = invaded_asian_df, aes(x = x, y = y), fill = "azure1") +
  geom_point(data = slf_points_invaded_test, aes(x = x, y = y), color = "darkorange", size = 1) +
  labs(title = "'Ri.NAmerica' model validation (test) presences") +
  coord_sf() +
  scale_x_continuous(limits = c(122.93816, 149.74986), expand = c(0, 0)) +
  scale_y_continuous(limits = c(30.49986, 46.58424), expand = c(0, 0))
```


``` r
# labels
x_scale_labels <- seq(from = -120, to = -60, by = 20)
y_scale_labels <- seq(from = 20, to = 60, by = 5)

# background selection area
regional_invaded_withSLF_plot <- regional_invaded_withSLF_plot + 
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(
    tag = "C",
    fill = "zone"
    ) +
  scale_x_continuous(labels = x_scale_labels, breaks = x_scale_labels, expand = c(0, 0)) +
  scale_y_continuous(labels = y_scale_labels, breaks = y_scale_labels, expand = c(0, 0)) +
  theme(
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.1),
    plot.tag = element_text(face = "bold", size = 25)
  )


# background points
regional_invaded_background_plot <- regional_invaded_background_plot + 
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "B") +
  scale_x_continuous(labels = x_scale_labels, breaks = x_scale_labels, expand = c(0, 0)) +
  scale_y_continuous(labels = y_scale_labels, breaks = y_scale_labels, expand = c(0, 0)) +
  theme(
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.1),
    plot.tag = element_text(face = "bold", size = 25)
  )


# training presences
regional_invaded_slf_plot  <- regional_invaded_slf_plot +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "A") +
  scale_x_continuous(labels = x_scale_labels, breaks = x_scale_labels, expand = c(0, 0)) +
  scale_y_continuous(labels = y_scale_labels, breaks = y_scale_labels, expand = c(0, 0)) +
  theme(
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.1),
    plot.tag = element_text(face = "bold", size = 25)
  )


# new labels
x_scale_labels <- seq(from = 125, to = 145, by = 5)
y_scale_labels <- seq(from = 32, to = 46, by = 2)

# test/validation presences
regional_invaded_test_plot <- regional_invaded_test_plot +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "D") +
  scale_x_continuous(limits = c(122.93816, 149.74986), labels = x_scale_labels, breaks = x_scale_labels, expand = c(0, 0)) +
  scale_y_continuous(limits = c(30.49986, 46.58424), labels = y_scale_labels, breaks = y_scale_labels, expand = c(0, 0)) +
  theme(
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.1),
    plot.tag = element_text(face = "bold", size = 25)
  )

# patchwork plot
regional_invaded_patchwork <- (
  (regional_invaded_slf_plot + regional_invaded_background_plot) / 
  (regional_invaded_withSLF_plot + regional_invaded_test_plot) 
  ) +
  plot_annotation(
    title = "'Ri.NAmerica' model elements",
    subtitle = "(A) training presences (B) background points (C) background selection area (D) test presences"
    ) 
```


``` r
ggsave(
  regional_invaded_patchwork, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "regional_invaded_model_v7_summary.jpg"),
  height = 10, 
  width = 14,
  device = jpeg,
  dpi = 500
  )
```

### Ri.Asia Model


``` r
# validation dataset
slf_points_invaded_asian_test <- read.csv(
  file = file.path(here::here(), "vignette-outputs", "data-tables", "regional_invaded_asian_test_slf_presences_v2.csv")
  )

# load in raster for validation plot
regional_invaded <- terra::rast(
  x = file.path(mypath, "atc_2015_regional_invaded_KG.asc")
  ) %>%
  terra::as.data.frame(., xy = TRUE)
```


``` r
regional_invaded_asian_test_plot <- ggplot() +
  map_style +
  # empty world map to force same aspect ratio
  geom_sf(data = countries_sf, aes(geometry = geometry), fill = NA, color = NA) +
  geom_raster(data = global_bio11_df, aes(x = x, y = y), fill = "azure4") +
  geom_raster(data = regional_invaded_df, aes(x = x, y = y), fill = "azure1") +
  geom_point(data = slf_points_invaded_asian_test, aes(x = x, y = y), color = "darkorange", size = 1) +
  labs(title = "'Ri.Asia' model test presences") +
  coord_sf(xlim = c(-138.66681, -52.58347), ylim = c(19.12534, 60.83319))
```


``` r
# labels
x_scale_labels <- seq(from = 125, to = 145, by = 5)
y_scale_labels <- seq(from = 32, to = 46, by = 2)

# background selection area
regional_invaded_asian_withSLF_plot <- regional_invaded_asian_withSLF_plot + 
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(
    tag = "C",
    fill = "zone"
    ) +
  scale_x_continuous(limits = c(122.93816, 149.74986), labels = x_scale_labels, breaks = x_scale_labels, expand = c(0, 0)) +
  scale_y_continuous(limits = c(30.49986, 46.58424), labels = y_scale_labels, breaks = y_scale_labels, expand = c(0, 0)) +
  theme(
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.1),
    plot.tag = element_text(face = "bold", size = 25)
  )


# background points
regional_invaded_asian_points_plot <- regional_invaded_asian_points_plot + 
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "B") +
  scale_x_continuous(limits = c(122.93816, 149.74986), labels = x_scale_labels, breaks = x_scale_labels, expand = c(0, 0)) +
  scale_y_continuous(limits = c(30.49986, 46.58424), labels = y_scale_labels, breaks = y_scale_labels, expand = c(0, 0)) +
  theme(
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.1),
    plot.tag = element_text(face = "bold", size = 25)
  )


# training presences
regional_invaded_asian_slf_plot  <- regional_invaded_asian_slf_plot +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "A") +
  scale_x_continuous(limits = c(122.93816, 149.74986), labels = x_scale_labels, breaks = x_scale_labels, expand = c(0, 0)) +
  scale_y_continuous(limits = c(30.49986, 46.58424), labels = y_scale_labels, breaks = y_scale_labels, expand = c(0, 0)) +
  theme(
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.1),
    plot.tag = element_text(face = "bold", size = 25)
  )

# labels
x_scale_labels <- seq(from = -120, to = -60, by = 20)
y_scale_labels <- seq(from = 20, to = 60, by = 5)


# test presences
regional_invaded_asian_test_plot <- regional_invaded_asian_test_plot + 
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "D") +
  scale_x_continuous(labels = x_scale_labels, breaks = x_scale_labels, expand = c(0, 0)) +
  scale_y_continuous(labels = y_scale_labels, breaks = y_scale_labels, expand = c(0, 0)) +
  theme(
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.1),
    plot.tag = element_text(face = "bold", size = 25)
  )



regional_invaded_asian_patchwork <- (
  (regional_invaded_asian_slf_plot + regional_invaded_asian_points_plot) / 
  (regional_invaded_asian_withSLF_plot + regional_invaded_asian_test_plot) 
  ) +
  plot_annotation(
    title = "'Ri.Asia' model elements",
    subtitle = "(A) training presences (B) background points (C) background selection area (D) test presences"
    )
```


``` r
ggsave(
  regional_invaded_asian_patchwork, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "regional_invaded_asian_model_v2_summary.jpg"),
  height = 10, 
  width = 12,
  device = jpeg,
  dpi = 500
  )
```

### Rn model


``` r
# validation dataset
slf_points_native_test <- read.csv(
  file = file.path(here::here(), "vignette-outputs", "data-tables", "regional_native_test_slf_presences_v3.csv")
  ) 

# load in raster for validation plot
regional_invaded <- terra::rast(
  x = file.path(mypath, "atc_2015_regional_invaded_KG.asc")
  ) %>%
  terra::as.data.frame(., xy = TRUE)
```


``` r
regional_native_test_plot <- ggplot() +
  map_style +
  # empty world map to force same aspect ratio
  geom_sf(data = countries_sf, aes(geometry = geometry), fill = NA, color = NA) +
  geom_raster(data = global_bio11_df, aes(x = x, y = y), fill = "azure4") +
  geom_raster(data = regional_invaded_df, aes(x = x, y = y), fill = "azure1") +
  geom_point(data = slf_points_native_test, aes(x = x, y = y), color = "darkorange", size = 1) +
  labs(title = "'Rn' model test presences") +
  coord_sf(xlim = c(-138.66681, -52.58347), ylim = c(19.12534, 60.83319))
```

Patchwork


``` r
x_scale_labels <- seq(from = 80, to = 140, by = 10)
y_scale_labels <- seq(from = 0, to = 50, by = 10)

# background selection area
regional_native_withSLF_plot <- regional_native_withSLF_plot + 
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    plot.tag.location = "panel",
    plot.tag.position = c(0.1, 0.1),
    plot.tag = element_text(face = "bold", size = 25)
    ) +
  labs(
    tag = "C",
    fill = "zone"
    ) +
  scale_x_continuous(labels = x_scale_labels, breaks = x_scale_labels, expand = c(0, 0)) +
  scale_y_continuous(labels = y_scale_labels, breaks = y_scale_labels, expand = c(0, 0)) 


# background points
regional_native_points_plot <- regional_native_points_plot + 
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    plot.tag.location = "panel",
    plot.tag.position = c(0.1, 0.1),
    plot.tag = element_text(face = "bold", size = 25)
    ) +
  labs(tag = "B") +
  scale_x_continuous(labels = x_scale_labels, breaks = x_scale_labels, expand = c(0, 0)) +
  scale_y_continuous(labels = y_scale_labels, breaks = y_scale_labels, expand = c(0, 0)) 

  
# training presences
regional_native_slf_plot  <- regional_native_slf_plot +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    plot.tag.location = "panel",
    plot.tag.position = c(0.1, 0.1),
    plot.tag = element_text(face = "bold", size = 25)
    ) +
  labs(tag = "A") +
  scale_x_continuous(labels = x_scale_labels, breaks = x_scale_labels, expand = c(0, 0)) +
  scale_y_continuous(labels = y_scale_labels, breaks = y_scale_labels, expand = c(0, 0)) 



# labels
x_scale_labels <- seq(from = -120, to = -60, by = 20)
y_scale_labels <- seq(from = 20, to = 60, by = 5)

# testing presences
regional_native_test_plot <- regional_native_test_plot + 
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "D") +
  scale_x_continuous(labels = x_scale_labels, breaks = x_scale_labels, expand = c(0, 0)) +
  scale_y_continuous(labels = y_scale_labels, breaks = y_scale_labels, expand = c(0, 0)) +
  theme(
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.1),
    plot.tag = element_text(face = "bold", size = 25)
  )


regional_native_patchwork <- (
  (regional_native_slf_plot | regional_native_points_plot) / 
  (regional_native_withSLF_plot | regional_native_test_plot)
   ) +
  plot_annotation(
    title = "'Rn' model elements",
    subtitle = "(A) training presences (B) background points (C) background selection area (D) test presences"
    ) +
  plot_layout(widths = unit(20, "cm")) 
```


``` r
ggsave(
  regional_native_patchwork, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "regional_native_model_v3_summary.jpg"),
  height = 8, 
  width = 10,
  device = jpeg,
  dpi = 500
  )
```

-->
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Samuel M. Owens, Matthew R. Helmus.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
