<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Workflow for the functions 'compute_MaxEnt_summary_statistics()' • scari</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Workflow for the functions 'compute_MaxEnt_summary_statistics()'">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">scari</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/scari.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Quantify risk to specific viticultural regions</h6></li>
    <li><a class="dropdown-item" href="../articles/150_create_risk_report.html">Example usage of create_risk_report() to create reports of key viticultural areas</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Initialize scari</h6></li>
    <li><a class="dropdown-item" href="../articles/010_initialize_pkg.html">Initialization of renv package for dependencies</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>1. Retrieve and tidy input data for MaxEnt</h6></li>
    <li><a class="dropdown-item" href="../articles/020_retrieve_bioclim_variables.html">Bioclim variable rasters: CHELSA</a></li>
    <li><a class="dropdown-item" href="../articles/030_retrieve_occurrence_records.html">SLF occurrence records: GBIF, lydemapR, literature</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>2. SDM modeling pipeline</h6></li>
    <li><a class="dropdown-item" href="../articles/040_setup_global_MaxEnt_model.html">Setup for global-scale MaxEnt model</a></li>
    <li><a class="dropdown-item" href="../articles/050_run_global_MaxEnt_model.html">Run global-scale MaxEnt model</a></li>
    <li><a class="dropdown-item" href="../articles/060_setup_regional_MaxEnt_models.html">Setup for regional-scale MaxEnt models</a></li>
    <li><a class="dropdown-item" href="../articles/070_run_regional_invaded_MaxEnt_model.html">Run 'Ri.NAmerica' model trained on SLF invaded region in North America</a></li>
    <li><a class="dropdown-item" href="../articles/080_run_regional_invaded_asian_MaxEnt_model.html">Run 'Ri.Asia' model trained on SLF invaded range in Japan and South Korea</a></li>
    <li><a class="dropdown-item" href="../articles/090_run_regional_native_MaxEnt_model.html">Run 'Rn' model trained on SLF native range in east Asia</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>3. Ensemble Regional-scale SDMs</h6></li>
    <li><a class="dropdown-item" href="../articles/100_run_ExDet_MIC.html">Run an Extrapolation Detection (NT2) analysis and calculate MIC</a></li>
    <li><a class="dropdown-item" href="../articles/110_ensemble_regional_models.html">Ensemble regional-scale models using a weighted mean</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>4. Quantify SLF risk and model fit</h6></li>
    <li><a class="dropdown-item" href="../articles/120_create_suitability_maps.html">Create risk maps of each model scale and intersect predictions</a></li>
    <li><a class="dropdown-item" href="../articles/130_create_suitability_xy_plots_viticultural.html">Plot shift in SLF risk to important viticultural regions under climate change</a></li>
    <li><a class="dropdown-item" href="../articles/131_create_suitability_xy_plots_SLF.html">Infer stability of known SLF populations due climate change effects</a></li>
    <li><a class="dropdown-item" href="../articles/140_plot_response_curves.html">Analyze biological realism of model response curves</a></li>
    <li><a class="dropdown-item" href="../articles/141_plot_AUC_var_cont.html">Check model goodness of fit via AUC, TSS and confusion matrices</a></li>
    <li><a class="dropdown-item" href="../articles/142_calculate_model_fit.html">Calculate model fit using confusion matrices</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ieco-lab/scari/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Workflow for the functions 'compute_MaxEnt_summary_statistics()'</h1>
                        <h4 data-toc-skip class="author">Samuel M.
Owens<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Temple University &lt;a href="http://www.biodiversitycenter.org/" class="external-link"&gt;Center for Biodiversity&lt;/a&gt; &lt;a href="https://www.iecolab.org/" class="external-link"&gt;iEco Lab&lt;/a&gt; &lt;a href="mailto:sam.owens@temple.edu" class="email"&gt;sam.owens@temple.edu&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a>
</h4>
            
            <h4 data-toc-skip class="date">2024-08-27</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ieco-lab/scari/blob/HEAD/vignettes/051_compute_MaxEnt_summary_statistics_workflow.Rmd" class="external-link"><code>vignettes/051_compute_MaxEnt_summary_statistics_workflow.Rmd</code></a></small>
      <div class="d-none name"><code>051_compute_MaxEnt_summary_statistics_workflow.Rmd</code></div>
    </div>

    
    
<p><em>Note</em> This vignette is an example of the workflow for the
function within this package called
<code><a href="../reference/compute_MaxEnt_summary_statistics.html">compute_MaxEnt_summary_statistics()</a></code>, which is used in
vignette 050 to obtain the final results. This vignette does not need to
be run to obtain the final results of the workflow.</p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette gives an example of the workflow for producing a MaxEnt
model in R and all of its associated outputs. Chunks 1-10 share the same
formatting as with vignette 050, which is the parent of this vignette.
This vignette was created to isolate the entire workflow for creating a
model. Some processes in this vignette are not used for all models
produced, such as a rasterized predictions of suitability.</p>
<p>The workflow depends heavily on the R package <a href="https://consbiol-unibern.github.io/SDMtune/" class="external-link">SDMtune</a>. This
workflow can be used for any dataset to train a maxent model, extract
the summary statistics and make predictions for pointwise species
presence data or entire areas (both are exemplified in this workflow).
Here is a list of the outputs and summary statistics that will be
obtained from the models produced by this vignette:</p>
<ul>
<li>.RDS file of the MaxEnt model</li>
<li>Presence data used to train and test the model</li>
<li>suitability map projected to the area of interest</li>
<li>presence/absence map generated using the Maximum Sensitivity plus
specificity threshold produced by the model</li>
<li>point-wise predictions for species presence data</li>
</ul>
<ul>
<li>AUC</li>
<li>ROC plot</li>
<li>TSS</li>
<li>Suitability thresholds (including minimum training presence, 10%
training presence, etc)</li>
<li>Marginal response curves</li>
<li>Uni-variate response curves</li>
<li>Variable permutation importance</li>
<li>Jackknife leave-one-out test and plot</li>
<li>Other model settings</li>
</ul>
<p>Most of these can also be obtained using a function in this package
called <code><a href="../reference/compute_MaxEnt_summary_statistics.html">compute_MaxEnt_summary_statistics()</a></code>, which creates
outputs of the summary statistics, writes the .RDS file and records the
presence data used to train and test the model (so it does NOT create a
suitability map, presence/absence map or point-wise predictions).</p>
<p>To run this vignette, first run up until step 2 of vig 050. This will
create the necessary files and objects to run this vignette.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p><strong>Note:</strong> I will be setting the global options of this
document so that only certain code chunks are rendered in the final
.html file. I will set the <code>eval = FALSE</code> so that none of the
code is re-run (preventing files from being overwritten during knitting)
and will simply overwrite this in chunks with plots.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>  <span class="co">#data manipulation</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span> <span class="co">#making directory pathways easier on different instances</span></span>
<span><span class="co"># here() starts at the root folder of this package.</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://www.rforge.net/rJava/" class="external-link">rJava</a></span><span class="op">)</span> <span class="co"># for running MaxEnt</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/raster/sdm/" class="external-link">dismo</a></span><span class="op">)</span> <span class="co"># package underneath SDMtune</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://consbiol-unibern.github.io/SDMtune/" class="external-link">SDMtune</a></span><span class="op">)</span> <span class="co"># main package used to run SDMs</span></span>
<span></span>
<span><span class="co"># dependencies of SDMtune</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="http://haozhu233.github.io/kableExtra/" class="external-link">kableExtra</a></span><span class="op">)</span> <span class="co"># required for producing model reports</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sachsmc.github.io/plotROC/" class="external-link">plotROC</a></span><span class="op">)</span> <span class="co"># plots ROCs</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://oscarperpinan.github.io/rastervis/" class="external-link">rasterVis</a></span><span class="op">)</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sjmgarnier.github.io/viridis/" class="external-link">viridis</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># spatial data handling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span> </span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://xrobin.github.io/pROC/" class="external-link">pROC</a></span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">map_style</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span>,</span>
<span>        panel.background <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/element.html" class="external-link">element_rect</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="st">"lightblue"</span>,</span>
<span>                                colour <span class="op">=</span> <span class="st">"lightblue"</span><span class="op">)</span></span>
<span>        <span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span><span class="op">)</span> </span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mypath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     <span class="st">"maxent/models"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create directory for model</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_global_v3_TEST"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"slf_global_v3_TEST"</span>, <span class="st">"plots"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><em>NOTE</em> the output created from this point to the end of the
vignette can be created using the function
<code><a href="../reference/compute_MaxEnt_summary_statistics.html">scari::compute_MaxEnt_summary_statistics()</a></code>. This does not
include the ending appendix or the chunks that create an output using
<code>SDMtune::predict()</code>.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mypath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                     <span class="st">"maxent/models/slf_global_v3_TEST"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># save model </span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">saveRDS</a></span><span class="op">(</span>object <span class="op">=</span> <span class="va">global_model</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_model.rds"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>From here::here, the analysis is performed in <code>SDMtune</code>.
If you wanted to perform your analysis in <code>dismo</code>, the
function <code><a href="https://consbiol-unibern.github.io/SDMtune/reference/SDMmodel2MaxEnt.html" class="external-link">SDMtune::SDMmodel2MaxEnt()</a></code> will convert the above
model object into a MaxEnt object in the dismo package.</p>
</div>
<div class="section level2">
<h2 id="get-auc-tss-and-variable-contributions">Get AUC, TSS, and variable contributions<a class="anchor" aria-label="anchor" href="#get-auc-tss-and-variable-contributions"></a>
</h2>
<p>I will retrieve AUC and TSS values for both training and test data
and save this output as a .csv.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># vector of AUC values</span></span>
<span><span class="va">AUC</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="co"># get training AUC value</span></span>
<span>  <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/auc.html" class="external-link">auc</a></span><span class="op">(</span><span class="va">global_model</span><span class="op">)</span>,</span>
<span>  <span class="co"># get test AUC value</span></span>
<span>  <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/auc.html" class="external-link">auc</a></span><span class="op">(</span><span class="va">global_model</span>, test <span class="op">=</span> <span class="va">global_test</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># vector of TSS values</span></span>
<span><span class="va">TSS</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>   <span class="co"># get training TSS value</span></span>
<span>  <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/tss.html" class="external-link">tss</a></span><span class="op">(</span><span class="va">global_model</span><span class="op">)</span>,</span>
<span>  <span class="co"># get test TSS value</span></span>
<span>  <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/tss.html" class="external-link">tss</a></span><span class="op">(</span><span class="va">global_model</span>, test <span class="op">=</span> <span class="va">global_test</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># compile to data frame</span></span>
<span><span class="va">auc_tss</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">AUC</span>, <span class="va">TSS</span>, row.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Training"</span>, <span class="st">"Test"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write csv</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">auc_tss</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_model_auc_tss.csv"</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The relative contribution and permutation importance of each
environmental covariate is also available via the
<code><a href="https://consbiol-unibern.github.io/SDMtune/reference/maxentVarImp.html" class="external-link">SDMtune::maxentVarImp()</a></code> function. These will be put into a
table.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># variable importance</span></span>
<span><span class="va">var_imp</span> <span class="op">&lt;-</span> <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/maxentVarImp.html" class="external-link">maxentVarImp</a></span><span class="op">(</span><span class="va">global_model</span><span class="op">)</span></span>
<span><span class="co"># write to csv</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span><span class="va">var_imp</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_model_var_contrib.csv"</span><span class="op">)</span>, row.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="plot-roc-univariate-and-marginal-response-curves">Plot ROC, univariate and marginal response curves<a class="anchor" aria-label="anchor" href="#plot-roc-univariate-and-marginal-response-curves"></a>
</h2>
<p>First, I will plot the ROC curves, which show the true positive vs
false positive rates. This will be done for each iteration of the model.
An AUC of 0.5 or better is desirable.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loop that plots an ROC curve for each model iteration</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">global_model</span><span class="op">@</span><span class="va">models</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># load in temp plot object </span></span>
<span>  <span class="va">plot.ROC</span> <span class="op">&lt;-</span> <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/plotROC.html" class="external-link">plotROC</a></span><span class="op">(</span><span class="va">global_model</span><span class="op">@</span><span class="va">models</span><span class="op">[[</span><span class="va">a</span><span class="op">]</span><span class="op">]</span>, test <span class="op">=</span> <span class="va">global_test</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># add title</span></span>
<span>  <span class="va">plot.ROC</span> <span class="op">&lt;-</span> <span class="va">plot.ROC</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"ROC curve (sensitivity  vs 1 - Specificity) for"</span>, <span class="st">"global_model"</span>, <span class="st">"iteration"</span>, <span class="va">a</span><span class="op">)</span><span class="op">)</span>  </span>
<span>  </span>
<span>  <span class="co"># save output</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="va">plot.ROC</span>, </span>
<span>         filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"plots"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"global_model_"</span>, <span class="st">"iter"</span>, <span class="va">a</span>, <span class="st">"_ROC.jpg"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         height <span class="op">=</span> <span class="fl">8</span>, </span>
<span>         width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>         device <span class="op">=</span> <span class="st">"jpeg"</span>,</span>
<span>         dpi <span class="op">=</span> <span class="st">"retina"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># remove temp object </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">plot.ROC</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Next, I will plot both the univariate and marginal response
curves.</p>
<p>According to the MaxEnt output, the univariate response curves
“represent a different model, namely, a Maxent model created using only
the corresponding variable” (Phillips et.al, 2006). These models were
trained with each variable alone, to show how that variable affects the
probability of presence.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">threshold.types</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cloglog"</span>, <span class="st">"logistic"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># for each variable used in the model, create a response curve</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x_env_covariates</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># load in temp plot object </span></span>
<span>  <span class="va">plot.univar</span> <span class="op">&lt;-</span> <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/plotResponse.html" class="external-link">plotResponse</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">global_model</span>,</span>
<span>    var <span class="op">=</span> <span class="va">a</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"cloglog"</span>,</span>
<span>    fun <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>    rug <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># add title</span></span>
<span>  <span class="va">plot.univar</span> <span class="op">&lt;-</span> <span class="va">plot.univar</span> <span class="op">+</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"global_model"</span>, <span class="va">a</span>, <span class="st">"univariate response curve- cloglog output"</span><span class="op">)</span><span class="op">)</span>  </span>
<span>  </span>
<span>  <span class="co"># save output</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="va">plot.univar</span>, </span>
<span>         filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"plots"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"global_model_"</span>, <span class="va">a</span>, <span class="st">"_univar_resp_curve_cloglog"</span>, <span class="st">".jpg"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>         height <span class="op">=</span> <span class="fl">8</span>, </span>
<span>         width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>         device <span class="op">=</span> <span class="st">"jpeg"</span>,</span>
<span>         dpi <span class="op">=</span> <span class="st">"retina"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># remove temp object </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">plot.univar</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Meanwhile, the marginal response curves “show how each environmental
variable affects the Maxent prediction. The curves show how the
predicted probability of presence changes as each environmental variable
is varied, keeping all other environmental variables at their average
sample value” (Phillips et.al, 2006). The marginal response curves show
the effects of changing that variable.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># for each variable used in the model, create a response curve</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">x_env_covariates</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># for each threshold type, plot a response curve</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="va">threshold.types</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>    <span class="co"># load in temp plot object </span></span>
<span>    <span class="va">plot.response</span> <span class="op">&lt;-</span> <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/plotResponse.html" class="external-link">plotResponse</a></span><span class="op">(</span></span>
<span>      model <span class="op">=</span> <span class="va">global_model</span>,</span>
<span>      var <span class="op">=</span> <span class="va">a</span>,</span>
<span>      type <span class="op">=</span> <span class="va">b</span>,</span>
<span>      marginal <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>      fun <span class="op">=</span> <span class="st">"mean"</span>,</span>
<span>      rug <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>      <span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># add title</span></span>
<span>    <span class="va">plot.response</span> <span class="op">&lt;-</span> <span class="va">plot.response</span> <span class="op">+</span></span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"global_model"</span>, <span class="va">a</span>, <span class="st">"marginal response curve-"</span>, <span class="va">b</span>, <span class="st">"output"</span><span class="op">)</span><span class="op">)</span>  </span>
<span>    </span>
<span>    <span class="co"># save output</span></span>
<span>    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="va">plot.response</span>, </span>
<span>           filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"plots"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"global_model_"</span>, <span class="va">a</span>, <span class="st">"_marg_resp_curve_"</span>, <span class="va">b</span>, <span class="st">".jpg"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>           height <span class="op">=</span> <span class="fl">8</span>, </span>
<span>           width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>           device <span class="op">=</span> <span class="st">"jpeg"</span>,</span>
<span>           dpi <span class="op">=</span> <span class="st">"retina"</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="co"># remove temp object </span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">plot.response</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="extract-summary-statistics">Extract summary statistics<a class="anchor" aria-label="anchor" href="#extract-summary-statistics"></a>
</h2>
<p>Next, I will extract the summary statistics from each model that
include the presence/absence thresholds, training statistics and other
useful metrics. Specifically, I am interested in extracting particular
thresholds (minimum training presence, 10 percentile training presence
and maximum training sensitivity plus specificity) so that I can create
presence/absence maps based on these. I will save each of the individual
tables. I will also extract the results of each model iteration into a
table, take the mean of those statistics, and save it.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create empty date frame for joining</span></span>
<span><span class="va">empty.table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">global_model</span><span class="op">@</span><span class="va">models</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">model</span><span class="op">@</span><span class="va">results</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>statistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">global_model</span><span class="op">@</span><span class="va">models</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">model</span><span class="op">@</span><span class="va">results</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># add column of statistic names</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">statistic</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># loop to write summary statistics for each iteration of the model</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">global_model</span><span class="op">@</span><span class="va">models</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># load in temp object </span></span>
<span>  <span class="va">data.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">global_model</span><span class="op">@</span><span class="va">models</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">model</span><span class="op">@</span><span class="va">results</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># change colname</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">data.obj</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"iter_"</span>, <span class="va">i</span>, <span class="st">"_summary"</span><span class="op">)</span></span>
<span>  <span class="co"># write to csv</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">data.obj</span>, </span>
<span>    file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"global_model_summary_iter"</span>, <span class="va">i</span>, <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    row.names <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># add column name to data object</span></span>
<span>  <span class="va">data.obj</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">data.obj</span>, statistic <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">global_model</span><span class="op">@</span><span class="va">models</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">@</span><span class="va">model</span><span class="op">@</span><span class="va">results</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># while i has not reached the length of the model replicates, append the summary statistics to the empty table</span></span>
<span>  <span class="kw">while</span> <span class="op">(</span><span class="va">i</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">global_model</span><span class="op">@</span><span class="va">models</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="co"># join data.obj temporary object to empty table</span></span>
<span>    <span class="va">empty.table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">right_join</a></span><span class="op">(</span><span class="va">empty.table</span>, <span class="va">data.obj</span>, by <span class="op">=</span> <span class="st">"statistic"</span><span class="op">)</span></span>
<span>    </span>
<span>    <span class="kw">break</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># if i has reached the length of the model replicates, compute a mean and write the final table to .csv</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">global_model</span><span class="op">@</span><span class="va">models</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>     <span class="co"># compute the mean of the 5 columns     </span></span>
<span>     <span class="va">empty.table</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">empty.table</span>, mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="va">empty.table</span><span class="op">[</span>, <span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="co"># write to csv</span></span>
<span>     <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span></span>
<span>       x <span class="op">=</span> <span class="va">empty.table</span>, </span>
<span>       file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"global_model_summary_all_iterations.csv"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>       row.names <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>       <span class="op">)</span></span>
<span>      </span>
<span>    <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># remove temp object</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">data.obj</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="write-training-and-testing-data-to-file">Write training and testing data to file<a class="anchor" aria-label="anchor" href="#write-training-and-testing-data-to-file"></a>
</h2>
<p>It is always a good idea to have the exact data used to train and
test a model on hand, so I will write these to the same directory.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># write training data to csv</span></span>
<span><span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/swd2csv.html" class="external-link">swd2csv</a></span><span class="op">(</span>swd <span class="op">=</span> <span class="va">global_train</span>, file_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_train_Kfold.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># load csv in again</span></span>
<span><span class="va">global_train_Folds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_train_Kfold.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># bind training data with folds</span></span>
<span><span class="va">global_train_Folds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">global_train_Folds</span>, <span class="va">global_trainFolds</span><span class="op">)</span></span>
<span><span class="co"># overwrite csv for training </span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">global_train_Folds</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_train_Kfold.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># write testing data to csv</span></span>
<span><span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/swd2csv.html" class="external-link">swd2csv</a></span><span class="op">(</span>swd <span class="op">=</span> <span class="va">global_test</span>, file_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_test.csv"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="jackknife-test-for-variable-importance">Jackknife test for variable importance<a class="anchor" aria-label="anchor" href="#jackknife-test-for-variable-importance"></a>
</h2>
<p>The jackknife test is a leave-one-out test that iteratively leaves
out each predictor variable and produces a model with all other
variables. It also has the option to create a model for that predictor
variable alone. It then records the gain or loss in AUC value. This is
very informative test and is designed to test variable importance. I
will perform a jackknife for the entire model’s training data alone. I
will also create one for each model iteration using both training and
testing data.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># jackknife</span></span>
<span><span class="va">global_JK</span> <span class="op">&lt;-</span> <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/doJk.html" class="external-link">doJk</a></span><span class="op">(</span></span>
<span>  model <span class="op">=</span> <span class="va">global_model</span>,</span>
<span>  <span class="co"># test = global_test, # not used for models with replicates</span></span>
<span>  metric <span class="op">=</span> <span class="st">"auc"</span>,</span>
<span>  with_only <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># also run test for each variable alone</span></span>
<span>  progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># write raw data to csv</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">global_JK</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_model_jackknife_all_iterations_training.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot jackknife</span></span>
<span><span class="va">global_JK_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/plotJk.html" class="external-link">plotJk</a></span><span class="op">(</span>jk <span class="op">=</span> <span class="va">global_JK</span>, type <span class="op">=</span> <span class="st">"train"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">global_JK_plot</span> <span class="op">&lt;-</span> <span class="va">global_JK_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"global_entire- jackknife test"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"all iterations, training data"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="va">global_JK_plot</span>, </span>
<span>           filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"plots"</span>, <span class="st">"global_model_jackknife_all_iterations_training.jpg"</span><span class="op">)</span>,</span>
<span>           height <span class="op">=</span> <span class="fl">8</span>, </span>
<span>           width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>           device <span class="op">=</span> <span class="st">"jpeg"</span>,</span>
<span>           dpi <span class="op">=</span> <span class="st">"retina"</span><span class="op">)</span></span></code></pre></div>
<p>I will also perform a jackknife for each of the model iterations,
based on training and test data.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">plot.types</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"train"</span>, <span class="st">"test"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># for loop to output csv file of jackknife test, one per model iteration</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">global_model</span><span class="op">@</span><span class="va">models</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># jackknife</span></span>
<span>  <span class="va">jk.obj</span> <span class="op">&lt;-</span> <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/doJk.html" class="external-link">doJk</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">global_model</span><span class="op">@</span><span class="va">models</span><span class="op">[[</span><span class="va">a</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    test <span class="op">=</span> <span class="va">global_test</span>, </span>
<span>    metric <span class="op">=</span> <span class="st">"auc"</span>,</span>
<span>    with_only <span class="op">=</span> <span class="cn">TRUE</span>, <span class="co"># also run test for each variable alone</span></span>
<span>    progress <span class="op">=</span> <span class="cn">TRUE</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># write raw data to csv</span></span>
<span>  <span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">jk.obj</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"global_model_jackknife_iter"</span>, <span class="va">a</span>, <span class="st">"_training_testing.csv"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="co"># sub-loop to output 2 types of plots per test, training and testing</span></span>
<span>    <span class="kw">for</span><span class="op">(</span><span class="va">b</span> <span class="kw">in</span> <span class="va">plot.types</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>      <span class="co"># plot training jackknife</span></span>
<span>      <span class="va">jk.obj_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/plotJk.html" class="external-link">plotJk</a></span><span class="op">(</span>jk <span class="op">=</span> <span class="va">jk.obj</span>, type <span class="op">=</span> <span class="va">b</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="co"># modify objects to add titles and subtitles</span></span>
<span>      <span class="va">jk.obj_plot</span> <span class="op">&lt;-</span> <span class="va">jk.obj_plot</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="st">"global_entire- jackknife test"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>        <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>subtitle <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"iter "</span>, <span class="va">a</span>, <span class="st">", "</span>, <span class="va">b</span>, <span class="st">"ing data"</span><span class="op">)</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="va">jk.obj_plot</span>, </span>
<span>             filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"plots"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"global_model_jackknife_iter"</span>, <span class="va">a</span>, <span class="st">"_"</span>, <span class="va">b</span>, <span class="st">"ing.jpg"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             height <span class="op">=</span> <span class="fl">8</span>, </span>
<span>             width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>             device <span class="op">=</span> <span class="st">"jpeg"</span>,</span>
<span>             dpi <span class="op">=</span> <span class="st">"retina"</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="co"># remove temp object </span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">jk.obj_plot</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co"># remove temp object </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">jk.obj</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="variable-importance">Variable importance<a class="anchor" aria-label="anchor" href="#variable-importance"></a>
</h2>
<p>Lastly, the variable importance will be calculated as a percentage
probability.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># calculate variable importance</span></span>
<span><span class="va">var_imp</span> <span class="op">&lt;-</span> <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/varImp.html" class="external-link">varImp</a></span><span class="op">(</span>model <span class="op">=</span> <span class="va">global_model</span>, progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># write to csv</span></span>
<span><span class="fu"><a href="https://readr.tidyverse.org/reference/write_delim.html" class="external-link">write_csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">var_imp</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_model_variable_importance.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plot</span></span>
<span><span class="va">var_imp_plot</span> <span class="op">&lt;-</span> <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/plotVarImp.html" class="external-link">plotVarImp</a></span><span class="op">(</span>df <span class="op">=</span> <span class="va">var_imp</span><span class="op">)</span></span>
<span></span>
<span><span class="va">var_imp_plot</span> <span class="op">&lt;-</span> <span class="va">var_imp_plot</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ggtitle</a></span><span class="op">(</span><span class="st">"Variable importance for global_model"</span><span class="op">)</span>  </span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span><span class="va">var_imp_plot</span>, </span>
<span>       filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"plots"</span>, <span class="st">"global_model_variable_importance.jpg"</span><span class="op">)</span>,</span>
<span>       height <span class="op">=</span> <span class="fl">8</span>, </span>
<span>       width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>       device <span class="op">=</span> <span class="st">"jpeg"</span>,</span>
<span>       dpi <span class="op">=</span> <span class="st">"retina"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="confusion-matrix-for-common-threshold-values">Confusion Matrix for common threshold values<a class="anchor" aria-label="anchor" href="#confusion-matrix-for-common-threshold-values"></a>
</h2>
<p>Lastly, I will pick out the mean cloglog threshold values for each
type of threshold used in the model and run a confusion matrix for each
value. A confusion matrix will show the number of true positives, false
positives, true negatives and false negatives per threshold value and
will help to determine which threshold makes the most sense, given our
data. I will need to create a vector of these values, which can be found
in the model_summary_all_iterations file created by this workflow.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load in summary file and slice the threshold values</span></span>
<span><span class="va">conf.matr.data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"global_model_summary_all_iterations.csv"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">24</span>, <span class="fl">28</span>, <span class="fl">32</span>, <span class="fl">36</span>, <span class="fl">40</span>, <span class="fl">44</span>, <span class="fl">48</span>, <span class="fl">52</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create empty table with threshold labels</span></span>
<span>  <span class="va">conf.matr.output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">conf.matr.data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"hold_type"</span> <span class="op">=</span> <span class="st">"conf.matr.data[, 1]"</span><span class="op">)</span></span>
<span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">global_model</span><span class="op">@</span><span class="va">models</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">conf.matr.hold</span> <span class="op">&lt;-</span> <span class="fu">SDMtune</span><span class="fu">::</span><span class="fu"><a href="https://consbiol-unibern.github.io/SDMtune/reference/confMatrix.html" class="external-link">confMatrix</a></span><span class="op">(</span></span>
<span>    model <span class="op">=</span> <span class="va">global_model</span><span class="op">@</span><span class="va">models</span><span class="op">[[</span><span class="va">a</span><span class="op">]</span><span class="op">]</span>,</span>
<span>    test <span class="op">=</span> <span class="va">global_test</span>,</span>
<span>    type <span class="op">=</span> <span class="st">"cloglog"</span>,</span>
<span>    th <span class="op">=</span> <span class="va">conf.matr.data</span><span class="op">[</span>, <span class="fl">6</span><span class="op">]</span> <span class="co"># the mean value for all cloglog thresholds</span></span>
<span>    <span class="op">)</span> </span>
<span>  </span>
<span>  <span class="co"># bind threshold names</span></span>
<span>  <span class="va">conf.matr.hold</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">conf.matr.hold</span>, <span class="va">conf.matr.data</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"hold_type"</span> <span class="op">=</span> <span class="st">"conf.matr.data[, 1]"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">hold_type</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># write individual run results to file</span></span>
<span>   <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.table</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">conf.matr.hold</span>, </span>
<span>    sep <span class="op">=</span> <span class="st">","</span>,</span>
<span>    file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"global_model_thresh_confusion_matrix_iter"</span>, <span class="va">a</span>, <span class="st">".csv"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    row.names <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>    col.names <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"threshold_type"</span>, <span class="st">"threshold_value"</span>, <span class="st">"tp"</span>, <span class="st">"fp"</span>, <span class="st">"fn"</span>, <span class="st">"tn"</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>   <span class="co"># before all model iterations have been summarized, append to empty table</span></span>
<span>   <span class="kw">while</span> <span class="op">(</span><span class="va">a</span> <span class="op">&lt;</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">global_model</span><span class="op">@</span><span class="va">models</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># join conf.matr.hold temporary object to empty table</span></span>
<span>      <span class="va">conf.matr.output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">right_join</a></span><span class="op">(</span><span class="va">conf.matr.output</span>, <span class="va">conf.matr.hold</span>, by <span class="op">=</span> <span class="st">"hold_type"</span><span class="op">)</span></span>
<span>      </span>
<span>      <span class="kw">break</span></span>
<span>      </span>
<span>      <span class="op">}</span></span>
<span>    </span>
<span>     <span class="co"># when all model iterations have been appended, take the mean threshold value and write to csv</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">a</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">global_model</span><span class="op">@</span><span class="va">models</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co"># compute the mean of the 5 columns     </span></span>
<span>      <span class="va">conf.matr.output</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span><span class="va">conf.matr.output</span>, </span>
<span>                                 tp_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"tp"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="co"># compute the average of all "tp" columns</span></span>
<span>                                 fp_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"fp"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                 fn_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"fn"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                 tn_mean <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"tn"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                 th <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">rowMeans</a></span><span class="op">(</span><span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/across.html" class="external-link">across</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">contains</a></span><span class="op">(</span><span class="st">"th"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>                                 <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">hold_type</span>, <span class="va">th</span>, <span class="va">tp_mean</span>, <span class="va">fp_mean</span>, <span class="va">fn_mean</span>, <span class="va">tn_mean</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"threshold_value"</span> <span class="op">=</span> <span class="st">"th"</span>,</span>
<span>               <span class="st">"threshold_type"</span> <span class="op">=</span> <span class="st">"hold_type"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>        <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">threshold_type</span>, <span class="va">threshold_value</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span>     </span>
<span>      <span class="co"># write to csv</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span></span>
<span>        x <span class="op">=</span> <span class="va">conf.matr.output</span>, </span>
<span>        file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"global_model_thresh_confusion_matrix_all_iterations.csv"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>        row.names <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>        <span class="op">)</span></span>
<span>  </span>
<span>       <span class="op">}</span></span>
<span>  </span>
<span>  <span class="co">#remove temp object</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">conf.matr.hold</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Feng, X. (2022). Shandongfx/nimbios_enm [HTML]. <a href="https://github.com/shandongfx/nimbios_enm" class="external-link uri">https://github.com/shandongfx/nimbios_enm</a> (Original work
published 2018).</p></li>
<li><p>Phillips, S. J., Anderson, R. P., &amp; Schapire, R. E. (2006).
Maximum entropy modeling of species geographic distributions. Ecological
Modelling, 190(3), 231–259. <a href="https://doi.org/10.1016/j.ecolmodel.2005.03.026" class="external-link uri">https://doi.org/10.1016/j.ecolmodel.2005.03.026</a></p></li>
<li><p>Srivastava, V., Roe, A. D., Keena, M. A., Hamelin, R. C., &amp;
Griess, V. C. (2021). Oh the places they’ll go: Improving species
distribution modelling for invasive forest pests in an uncertain world.
Biological Invasions, 23(1), 297–349. <a href="https://doi.org/10.1007/s10530-020-02372-9" class="external-link uri">https://doi.org/10.1007/s10530-020-02372-9</a></p></li>
<li><p>Vignali, S., Barras, A. G., Arlettaz, R., &amp; Braunisch, V.
(2020). SDMtune: An R package to tune and evaluate species distribution
models. Ecology and Evolution, 10(20), 11488–11506. <a href="https://doi.org/10.1002/ece3.6786" class="external-link uri">https://doi.org/10.1002/ece3.6786</a></p></li>
</ol>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Samuel M. Owens, Matthew R. Helmus.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
