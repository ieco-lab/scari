<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Bioclim variable rasters: CHELSA • scarifSDM</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Bioclim variable rasters: CHELSA">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">scarifSDM</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../articles/scarifSDM.html">Get started</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Quantify risk to specific viticultural regions</h6></li>
    <li><a class="dropdown-item" href="../articles/150_create_risk_report.html">Example usage of create_risk_report() to create reports of key viticultural areas</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>Initialize scarifSDM</h6></li>
    <li><a class="dropdown-item" href="../articles/010_initialize_pkg.html">Initialization of renv package for dependencies</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>1. Retrieve and tidy input data for MaxEnt</h6></li>
    <li><a class="dropdown-item" href="../articles/020_retrieve_bioclim_variables.html">Bioclim variable rasters: CHELSA</a></li>
    <li><a class="dropdown-item" href="../articles/030_retrieve_occurrence_records.html">SLF occurrence records: GBIF, lydemapR, literature</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>2. SDM modeling pipeline</h6></li>
    <li><a class="dropdown-item" href="../articles/040_setup_global_MaxEnt_model.html">Setup for global-scale MaxEnt model</a></li>
    <li><a class="dropdown-item" href="../articles/050_run_global_MaxEnt_model.html">Run global-scale MaxEnt model</a></li>
    <li><a class="dropdown-item" href="../articles/060_setup_regional_MaxEnt_models.html">Setup for regional-scale MaxEnt models</a></li>
    <li><a class="dropdown-item" href="../articles/070_run_regional_invaded_MaxEnt_model.html">Run 'Ri.NAmerica' model trained on SLF invaded region in North America</a></li>
    <li><a class="dropdown-item" href="../articles/080_run_regional_invaded_asian_MaxEnt_model.html">Run 'Ri.Asia' model trained on SLF invaded range in Japan and South Korea</a></li>
    <li><a class="dropdown-item" href="../articles/090_run_regional_native_MaxEnt_model.html">Run 'Rn' model trained on SLF native range in east Asia</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>3. Ensemble Regional-scale SDMs</h6></li>
    <li><a class="dropdown-item" href="../articles/100_run_ExDet_MIC.html">Run an Extrapolation Detection (NT2) analysis and calculate MIC</a></li>
    <li><a class="dropdown-item" href="../articles/110_ensemble_regional_models.html">Ensemble regional-scale models using a weighted mean</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><h6 class="dropdown-header" data-toc-skip>4. Quantify SLF risk and model fit</h6></li>
    <li><a class="dropdown-item" href="../articles/120_create_suitability_maps.html">Create risk maps of each model scale and intersect predictions</a></li>
    <li><a class="dropdown-item" href="../articles/130_create_suitability_xy_plots_viticultural.html">Plot shift in SLF risk to important viticultural regions under climate change</a></li>
    <li><a class="dropdown-item" href="../articles/131_create_suitability_xy_plots_SLF.html">Infer stability of known SLF populations due climate change effects</a></li>
    <li><a class="dropdown-item" href="../articles/140_plot_response_curves.html">Analyze biological realism of model response curves</a></li>
    <li><a class="dropdown-item" href="../articles/141_plot_AUC_var_cont.html">Check model goodness of fit via AUC, TSS and confusion matrices</a></li>
    <li><a class="dropdown-item" href="../articles/142_calculate_model_fit.html">Calculate model fit using confusion matrices</a></li>
    <li><hr class="dropdown-divider"></li>
    <li><a class="dropdown-item" href="../articles/index.html">More articles...</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ieco-lab/scarifSDM/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Bioclim variable rasters: CHELSA</h1>
                        <h4 data-toc-skip class="author">Samuel M.
Owens<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Temple University &lt;a href="http://www.biodiversitycenter.org/" class="external-link"&gt;Center for Biodiversity&lt;/a&gt; &lt;a href="https://www.iecolab.org/" class="external-link"&gt;iEco Lab&lt;/a&gt; &lt;a href="mailto:sam.owens@temple.edu" class="email"&gt;sam.owens@temple.edu&lt;/a&gt;&lt;/p&gt;'><sup>1</sup></a>
</h4>
            
            <h4 data-toc-skip class="date">2024-10-01</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ieco-lab/scarifSDM/blob/HEAD/vignettes/020_retrieve_bioclim_variables.Rmd" class="external-link"><code>vignettes/020_retrieve_bioclim_variables.Rmd</code></a></small>
      <div class="d-none name"><code>020_retrieve_bioclim_variables.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>This vignette will walk through the process of downloading and
tidying these climate data. We will be downloading the data from <a href="https://chelsa-climate.org/" class="external-link">CHELSA</a>, which is a
high-resolution (30 arc-seconds, ~1km) land surface dataset provided by
the Swiss Federal Institute for Forest, Snow and Landscape Research. The
specific data we are interested in is the suite of 19 “bioclimatic”
variables. These <a href="https://chelsa-climate.org/wp-admin/download-page/CHELSA_tech_specification_V2.pdf" class="external-link">bioclim
variables</a> are biologically relevant climate features derived from
temperature and precipitation. CHELSA also makes the same variables
available as climate change predictions, using a subset of the available
<a href="https://pcmdi.llnl.gov/CMIP6/" class="external-link">CMIP6</a> models. I will use 3
ssp scenarios (126, 370, 585) from the GFDL-ESM4 model (read ahead for
an explanation of these).</p>
<p>First, I will download the data from CHELSA into a local library. I
will then tidy, harmonize and put the datasets in the proper format for
MaxEnt. We will then choose the covariates for our models via an
assessment of the level of co-linearity between the rasters. I will also
consider biological relevance in selecting the final set of
covariates.</p>
<p><strong>Note:</strong> I have added a number of <code>if()</code>
statements throughout my vignettes, usually to prevent data from being
downloaded again unnecessarily. Simply change the <code>FALSE</code>
within the <code>if()</code> statement to <code>TRUE</code> to run a
chunk. This is to prevent re-downloading.</p>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span>  <span class="co">#data manipulation</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/" class="external-link">here</a></span><span class="op">)</span> <span class="co">#making directory pathways easier on different instances</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># spatial</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co"># devtools::install_github("danlwarren/ENMTools")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">ENMTools</span><span class="op">)</span> <span class="co"># env covariates colinearity</span></span>
<span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://patchwork.data-imaginist.com" class="external-link">patchwork</a></span><span class="op">)</span></span></code></pre></div>
<p><strong>Note:</strong> I will be setting the global options of this
document so that only certain code chunks are rendered in the final
.html file. I will set the <code>eval = FALSE</code> so that none of the
code is re-run (preventing files from being overwritten during knitting)
and will simply overwrite this in chunks with plots.</p>
</div>
<div class="section level2">
<h2 id="retrieve-chelsa-bioclim-rasters">1. Retrieve CHELSA bioclim rasters<a class="anchor" aria-label="anchor" href="#retrieve-chelsa-bioclim-rasters"></a>
</h2>
<p>First, I will download the bioclim data into a local directory. I
recommend downloading these data into a separate directory from this
package. Since I am using a directory outside of the immediate package,
I will create an object to define the file path at the beginning of each
chunk. This pathing will still use <code><a href="https://here.r-lib.org//reference/here.html" class="external-link">here::here()</a></code> to start at
the package root folder. First, I will download the historical climate
data from CHELSA. The URLs to the bioclim data that were downloaded from
CHELSA are stored in <code>data-raw/CHELSA</code> within the package
directory. I will be using two different versions of the CHELSA bioclim
variables for my analysis:</p>
<ol style="list-style-type: decimal">
<li>Historical- time period 1981-2010</li>
<li>Climate change predictions- time period 2041-2070, GFDL-ESM4 model,
Ssp scenarios 126, 370, and 585.</li>
</ol>
<p>The CHELSA download directory for each group of <a href="https://envicloud.wsl.ch/#/?prefix=chelsa%2Fchelsa_V2%2FGLOBAL%2F" class="external-link">bioclim
variables</a> also contains 27 other distinct climatologies, available
for both historical datasets and climate change models. The URLs for
these were also downloaded, as some of them might be applicable to this
analysis. For now, we will download the 19 bioclim variables. If you
would like to download any of the additional climatologies available
from CHELSA, see code for this in the Appendix section of this vignette.
Those chunks should be run after the initial run of all chunks before
section 2.2. After running these chunks, continue from chunk “loop to
tidy rasters” in section 2.2.</p>
<div class="section level3">
<h3 id="historical">1.1 Historical<a class="anchor" aria-label="anchor" href="#historical"></a>
</h3>
<p>The best approach I found to download these data was to create a loop
to open each URL in a web browser (be ready, as it literally just opens
whatever URLs are selected from the list in a browser).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># historical data</span></span>
<span>  <span class="va">chelsa_historic_URLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_table.html" class="external-link">read_table</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"CHELSA"</span>, <span class="st">"chelsa_1981-2010_bioclim_URLs.txt"</span><span class="op">)</span>,</span>
<span>                                col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"X1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"URL"</span> <span class="op">=</span> <span class="st">"X1"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># select only URLs I am interested in </span></span>
<span>  <span class="va">chelsa_historic_URLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">chelsa_historic_URLs</span>, <span class="fl">2</span><span class="op">:</span><span class="fl">20</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># loop to download historical URLs- I tried utils::download.files, but it would not work with these data</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">chelsa_historic_URLs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">file.tmp</span> <span class="op">&lt;-</span> <span class="va">chelsa_historic_URLs</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span></span>
<span>    </span>
<span>    <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/browseURL.html" class="external-link">browseURL</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">file.tmp</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>With the current loop construction, these files can only be
downloaded to my PC’s downloads folder, so they will need to be manually
moved to the destination directory (outside of the package root folder
because they are large). These files were stored manually in
<code>maxent/historical_climate_rasters/chelsa2.1_30arcsec/originals</code>.</p>
</div>
<div class="section level3">
<h3 id="cmip6">1.2 CMIP6<a class="anchor" aria-label="anchor" href="#cmip6"></a>
</h3>
<p>Next, I will download data from the provided CMIP6 models. I will be
downloading data for different <a href="https://www.carbonbrief.org/explainer-how-shared-socioeconomic-pathways-explore-future-climate-change/" class="external-link">SSP
scenarios</a> (see link for an explanation of these scenarios). These
ssp scenarios represent different assumptions about global development
and greenhouse gas emissions. I will be using the ssp scenarios 126,
370, and 585. 126 represents a more ideal scenario where all countries
are cooperating to reduce emissions. 370 represents a middle-high
emissions scenario, coupled with an emphasis on regional rivalry and
global conflict (which reduce cooperation and drive up emissions). 585
represents a high greenhouse gas emissions scenario where countries are
cooperating and improving infrastructure, but there is no emphasis on
reducing emissions.</p>
<p>I will use the <a href="https://www.wdc-climate.de/ui/cmip6?input=CMIP6.CMIP.NOAA-GFDL.GFDL-ESM4" class="external-link">GFDL-ESM4</a>
CMIP6 model from NOAA. According to the CHELSA documentation, if all
five available models are not used together, then CMIP6 model usage
should follow the given priority (see documentation linked above). These
climate rasters should be moved to their respective folders within
<code>maxent/future_climate_rasters/chelsa2.1_30arcsec</code> once the
download is complete.</p>
<div class="section level4">
<h4 id="ssp126">SSP126<a class="anchor" aria-label="anchor" href="#ssp126"></a>
</h4>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># ssp370 data</span></span>
<span>  <span class="va">chelsa_126_URLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_table.html" class="external-link">read_table</a></span><span class="op">(</span></span>
<span>    file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"CHELSA"</span>, <span class="st">"chelsa_2041-2070_GFDL-ESM4_ssp126_bioclim_URLs.txt"</span><span class="op">)</span>,</span>
<span>    col_names <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"X1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"URL"</span> <span class="op">=</span> <span class="st">"X1"</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># select only URLs I am interested in </span></span>
<span>  <span class="va">chelsa_126_URLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">chelsa_126_URLs</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># loop to download ssp126 URLs</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">chelsa_126_URLs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">file.tmp</span> <span class="op">&lt;-</span> <span class="va">chelsa_126_URLs</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span></span>
<span>    </span>
<span>    <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/browseURL.html" class="external-link">browseURL</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">file.tmp</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="ssp370">SSP370<a class="anchor" aria-label="anchor" href="#ssp370"></a>
</h4>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># ssp370 data</span></span>
<span>  <span class="va">chelsa_370_URLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_table.html" class="external-link">read_table</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"CHELSA"</span>, <span class="st">"chelsa_2041-2070_GFDL-ESM4_ssp370_bioclim_URLs.txt"</span><span class="op">)</span>,</span>
<span>                                col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"X1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"URL"</span> <span class="op">=</span> <span class="st">"X1"</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># select only URLs I am interested in </span></span>
<span>  <span class="va">chelsa_370_URLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">chelsa_370_URLs</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># loop to download ssp370 URLs</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">chelsa_370_URLs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">file.tmp</span> <span class="op">&lt;-</span> <span class="va">chelsa_370_URLs</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span></span>
<span>    </span>
<span>    <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/browseURL.html" class="external-link">browseURL</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">file.tmp</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="ssp585">SSP585<a class="anchor" aria-label="anchor" href="#ssp585"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># ssp370 data</span></span>
<span>  <span class="va">chelsa_585_URLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_table.html" class="external-link">read_table</a></span><span class="op">(</span></span>
<span>    file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"CHELSA"</span>, <span class="st">"chelsa_2041-2070_GFDL-ESM4_ssp585_bioclim_URLs.txt"</span><span class="op">)</span>,</span>
<span>    col_names <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"X1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"URL"</span> <span class="op">=</span> <span class="st">"X1"</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># select only URLs I am interested in </span></span>
<span>  <span class="va">chelsa_585_URLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">chelsa_585_URLs</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># loop to download ssp370 URLs</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">chelsa_585_URLs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">file.tmp</span> <span class="op">&lt;-</span> <span class="va">chelsa_585_URLs</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span></span>
<span>    </span>
<span>    <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/browseURL.html" class="external-link">browseURL</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">file.tmp</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="tidy-for-maxent">2. Tidy for MaxEnt<a class="anchor" aria-label="anchor" href="#tidy-for-maxent"></a>
</h2>
<p>Next, I need to tidy these rasters for MaxEnt. I will need to mask
any data that is over the oceans or other bodies of water. I will also
need to create downsized versions of these variables that can be used in
step 3 to assess the level of correlation between the different
variables. Lastly, I will rename the files and convert them to the
required <code>.ascii</code> format for MaxEnt.</p>
<p>I will mask the CHELSA bioclim rasters using the worldclim version of
bio1, annual mean temperature (<code>mask</code>). The worldclim version
has the continents already cut out, making it a good choice for the
masking. I will use the chelsa bio1 version (<code>main</code>) as a
reference to resample the new layers after setting the CRS and
extent.</p>
<div class="section level3">
<h3 id="load-in-files">2.1 Load in files<a class="anchor" aria-label="anchor" href="#load-in-files"></a>
</h3>
<p>First, I will load in the reference layers</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># set path to external directory</span></span>
<span><span class="va">mypath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                          <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                        <span class="st">"maxent/historical_climate_rasters/chelsa2.1_30arcsec"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># 1st chelsa bioclim layer as reference</span></span>
<span><span class="va">ref_chelsa_bio1_main</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"originals"</span>, <span class="st">"CHELSA_bio1_1981-2010_V.2.1.tif"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ref_atc_mask</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"originals"</span>, <span class="st">"2015_accessibility_to_cities_v1.0.tif"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We will get a list of the files that I need to modify. We will also
create an object containing the new names assigned to the files to
simplify the naming.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># I will load in the files and then get the new names I would like to give them</span></span>
<span></span>
<span><span class="co"># load in bioclim layers to be cropped- the original .tif files</span></span>
<span><span class="va">env.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"originals"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\.tif$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span>  </span>
<span></span>
<span><span class="co"># output file names</span></span>
<span><span class="va">output.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"originals"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\.tif$"</span>, full.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># get rid of filetype endings</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">".tif"</span>, replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># crop off ending </span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_V.2.1"</span>, replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># more edits to file names</span></span>
<span><span class="va">output.files</span> <span class="op">&lt;-</span> <span class="va">output.files</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"chelsa_"</span>, replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># specifically edit the access to cities naming</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"2015_accessibility_to_cities_v1.0"</span>, replacement <span class="op">=</span> <span class="st">"atc_2015"</span><span class="op">)</span></span></code></pre></div>
<p><em>Note</em> In this version of the vignette, I have isolated only
the variables I selected for the final analysis. If you would like to
tidy and compare all variables, simply skip this next chunk.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">env.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"bio2|bio11|bio12|bio15"</span>, <span class="va">env.files</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"bio2|bio11|bio12|bio15"</span>, <span class="va">output.files</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>Now that we have our files and reference layers loaded in and names
chosen, we can begin reformatting these layers.</p>
</div>
<div class="section level3">
<h3 id="prepare-reference-layers">2.2 Prepare reference layers<a class="anchor" aria-label="anchor" href="#prepare-reference-layers"></a>
</h3>
<p>In this chunk, we will create 2 reference layers.
<code>ref_chelsa_bio1_main</code> will be used for resampling the data,
while <code>ref_atc_mask</code> will be used for masking. First, I will
crop the layers, set their origins, and resample them to the same
resolution. I will also keep the rasters consistently to
<code>EPSG:4326</code> for now.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># resolutions</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="va">ref_chelsa_bio1_main</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">res</a></span><span class="op">(</span><span class="va">ref_atc_mask</span><span class="op">)</span></span>
<span><span class="co"># they are identical</span></span>
<span></span>
<span><span class="co"># ext of the reference layers</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">ref_chelsa_bio1_main</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">ref_atc_mask</span><span class="op">)</span></span>
<span><span class="co"># the extents will need to be corrected</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">ref_chelsa_bio1_main</span>, parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="va">ref_atc_mask</span>, parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co"># crs of reference layers is epsg:4326 so no change needed</span></span>
<span></span>
<span><span class="co"># check origin</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/origin.html" class="external-link">origin</a></span><span class="op">(</span><span class="va">ref_chelsa_bio1_main</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/origin.html" class="external-link">origin</a></span><span class="op">(</span><span class="va">ref_atc_mask</span><span class="op">)</span></span>
<span><span class="co"># the origin of ref_atc_mask will need to be changed to match the others</span></span></code></pre></div>
<p>I will need to change the origin and extent of these reference
layers. I will crop them to the same extent first, then unify their
origins. Their extents will be matched to the smallest,
<code>ref_atc_mask</code>, while their origins will be matched to the
bioclim layer <code>ref_chelsa_bio1_main</code>.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># project </span></span>
<span><span class="co">## UNNECESSARY NOW THAT THE CRS IS CORRECT</span></span>
<span><span class="co"># ref_chelsa_bio1_main &lt;- terra::project(x = ref_chelsa_bio1_main, y = "ESPG:4326", method = "bilinear", threads = TRUE)</span></span>
<span><span class="co"># ref_atc_mask &lt;- terra::project(x = ref_atc_mask, y = "ESPG:4326", method = "bilinear", threads = TRUE)</span></span>
<span></span>
<span><span class="co"># set extent</span></span>
<span><span class="co"># set ext to the smallest whole number shared between the layers</span></span>
<span><span class="va">ext.obj</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="op">-</span><span class="fl">180</span>, <span class="fl">179</span>, <span class="op">-</span><span class="fl">60</span>, <span class="fl">83</span><span class="op">)</span></span>
<span><span class="co"># create main layer for future cropping, crop to new ext</span></span>
<span><span class="va">ref_chelsa_bio1_main</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ref_chelsa_bio1_main</span>, y <span class="op">=</span> <span class="va">ext.obj</span><span class="op">)</span></span>
<span><span class="co"># create a mask layer specifically for the cropping and masking</span></span>
<span><span class="va">ref_atc_mask</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ref_atc_mask</span>, y <span class="op">=</span> <span class="va">ext.obj</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># unify origins</span></span>
<span><span class="co"># set origin of ref_atc_mask</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/origin.html" class="external-link">origin</a></span><span class="op">(</span><span class="va">ref_atc_mask</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.0001396088</span>, <span class="op">-</span><span class="fl">0.0001392488</span><span class="op">)</span></span>
<span><span class="co"># resample mask to origin of main layer- most rasters will already have the origin of the bio1 layer</span></span>
<span><span class="va">ref_atc_mask</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/resample.html" class="external-link">resample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">ref_atc_mask</span>, y <span class="op">=</span> <span class="va">ref_chelsa_bio1_main</span>, method <span class="op">=</span> <span class="st">"bilinear"</span>, threads <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># check</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">ref_chelsa_bio1_main</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/ext.html" class="external-link">ext</a></span><span class="op">(</span><span class="va">ref_atc_mask</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/origin.html" class="external-link">origin</a></span><span class="op">(</span><span class="va">ref_chelsa_bio1_main</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/origin.html" class="external-link">origin</a></span><span class="op">(</span><span class="va">ref_atc_mask</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crs.html" class="external-link">crs</a></span><span class="op">(</span><span class="st">"EPSG:4326"</span>, parse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="tidying-historical-data">2.3 Tidying historical data<a class="anchor" aria-label="anchor" href="#tidying-historical-data"></a>
</h3>
<p>Here is where we get into tidying the data. We will crop the rasters
using the extent object created from the reference layers. We will
follow up the cropping with masking, which will convert cells in
<code>x</code> that do not have a value in <code>global_atc</code> to
<code>NAs</code>. I will also ensure the crs is correct and resample the
rasters. The rasters will be resampled to the resolution of
<code>global_bio1</code> so they have the same resolution. The output
files will be saved in <code>v1</code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mypath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                    <span class="st">"maxent/historical_climate_rasters/chelsa2.1_30arcsec"</span><span class="op">)</span></span></code></pre></div>
<p>In this first chunk, I will:</p>
<ul>
<li>crop the layers to the correct extent</li>
<li>mask the layers to the outlines of the continents</li>
<li>set the CRS to <code>EPSG:4326</code>
</li>
<li>set the origin to match the reference layers</li>
<li>crop the layers again to ensure the aggregation doesn’t increase the
extent</li>
</ul>
<p>This chunk will take a very long time to run… so maybe find a good
book to read.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># view list of filetypes for terra, use .ascii</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/gdal.html" class="external-link">gdal</a></span><span class="op">(</span>drivers <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># loop to crop extent for all files</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># load each raster into temp object</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># begin edits</span></span>
<span>  <span class="co"># crop new rasters to extent</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, y <span class="op">=</span> <span class="va">ext.obj</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># mask the bioclim layers by global_atc</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, mask <span class="op">=</span> <span class="va">ref_atc_mask</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># project crs</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/project.html" class="external-link">project</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, y <span class="op">=</span> <span class="st">"EPSG:4326"</span>, method <span class="op">=</span> <span class="st">"bilinear"</span>, threads <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># set origin</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/origin.html" class="external-link">origin</a></span><span class="op">(</span><span class="va">rast.hold</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.0001396088</span>, <span class="op">-</span><span class="fl">0.0001392488</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#resample to fit the extent/resolution of the main layer global_bio1</span></span>
<span>  <span class="co">#use bilinear interpolation, since values are continuous</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/resample.html" class="external-link">resample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, y <span class="op">=</span> <span class="va">ref_chelsa_bio1_main</span>, method <span class="op">=</span> <span class="st">"bilinear"</span>, threads <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span>  <span class="co">#write out the new resampled rasters!</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">rast.hold</span>, </span>
<span>    filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"v1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span>, <span class="st">"_global"</span>, <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span>, </span>
<span>    filetype <span class="op">=</span> <span class="st">"GTiff"</span>, </span>
<span>    overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># remove object once its done</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">rast.hold</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We will convert the rasters to the <code>.ascii</code> format
required by MaxEnt.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># directory of files to modify</span></span>
<span><span class="va">env.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"v1"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\.tif$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># output file names</span></span>
<span><span class="va">output.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"v1"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\.tif$"</span>, full.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">".tif"</span>, replacement <span class="op">=</span> <span class="st">".asc"</span><span class="op">)</span></span></code></pre></div>
<p><em>Note</em> In this version of the vignette, I have isolated only
the variables I selected for the final analysis. If you would like to
tidy and compare all variables, simply skip this next chunk.</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">env.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"atc_2015_global|bio2_1981-2010_global|bio11_1981-2010_global|bio12_1981-2010_global|bio15_1981-2010_global"</span>, <span class="va">env.files</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"atc_2015_global|bio2_1981-2010_global|bio11_1981-2010_global|bio12_1981-2010_global|bio15_1981-2010_global"</span>, <span class="va">output.files</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loop to convert to .ascii</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># holding object  </span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># write output</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">rast.hold</span>, </span>
<span>    filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"v1_maxent"</span>, <span class="va">output.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    filetype <span class="op">=</span> <span class="st">"AAIGrid"</span>, </span>
<span>    overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># remove object once its done</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">rast.hold</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span></code></pre></div>
<p>Finally, I will aggregate selected rasters to a lower resolution,
with roughly 10km grid cells. We want to aggregate at 10km because we
will be downsampling the resolution of our analysis to account for
survey bias.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loop to aggregate and convert to .ascii</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># holding object  </span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># aggregate to 10km scale. cells are roughly 1km, so aggregate by factor of 10</span></span>
<span>  <span class="co"># the na.rm argument is incredibly important because if any of the cells are NAs, the aggregated cell will  be an NA value.</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, fact <span class="op">=</span> <span class="fl">10</span>, fun <span class="op">=</span> <span class="st">"mean"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, threads <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># crop again to ensure aggregation doesnt increase extent</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, y <span class="op">=</span> <span class="va">ext.obj</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># write output</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">rast.hold</span>, </span>
<span>    filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"v1_maxent_10km"</span>, <span class="va">output.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    filetype <span class="op">=</span> <span class="st">"AAIGrid"</span>, </span>
<span>    overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># remove object once its done</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">rast.hold</span><span class="op">)</span></span>
<span>    </span>
<span><span class="op">}</span></span></code></pre></div>
<p>These data can now be used in a MaxEnt model!</p>
</div>
<div class="section level3">
<h3 id="tidying-cmip6-data">2.4 Tidying CMIP6 data<a class="anchor" aria-label="anchor" href="#tidying-cmip6-data"></a>
</h3>
<p>Here, we will go through all of the above steps in section 2.3 for
the CMIP6 versions of the rasters.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># file path to directory</span></span>
<span><span class="va">mypath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                    <span class="st">"maxent/future_climate_rasters/chelsa2.1_30arcsec"</span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="ssp126-1">SSP126<a class="anchor" aria-label="anchor" href="#ssp126-1"></a>
</h4>
<p>First, I will get the file names and create folders to hold the new
copies per ssp scenario.</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># v1 for tidied rasters</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"2041-2070_ssp126_GFDL"</span>, <span class="st">"v1"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># v1_maxent for the ascii versions</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"2041-2070_ssp126_GFDL"</span>, <span class="st">"v1_maxent"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 10km aggregated versions of ascii</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/files2.html" class="external-link">dir.create</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"2041-2070_ssp126_GFDL"</span>, <span class="st">"v1_maxent_10km"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># I will load in the files and then get the new names I would like to give them</span></span>
<span></span>
<span><span class="co"># load in bioclim layers to be cropped- the original .tif files</span></span>
<span><span class="va">env.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"2041-2070_ssp126_GFDL"</span>, <span class="st">"originals"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\.tif$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># output file names</span></span>
<span><span class="va">output.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"2041-2070_ssp126_GFDL"</span>, <span class="st">"originals"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\.tif$"</span>, full.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># change endings to show these are global raster versions</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_V.2.1.tif"</span>, replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># crop out some detail</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"-esm4_ssp"</span>, replacement <span class="op">=</span> <span class="st">"_"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/chartr.html" class="external-link">tolower</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># more edits to file names</span></span>
<span><span class="va">output.files</span> <span class="op">&lt;-</span> <span class="va">output.files</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"chelsa_"</span>, replacement <span class="op">=</span> <span class="st">""</span><span class="op">)</span> </span></code></pre></div>
<p><em>Note</em> In this version of the vignette, I have isolated only
the variables I selected for the final analysis. If you would like to
tidy and compare all variables, simply skip this next chunk.</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">env.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"bio2|bio11|bio12|bio15"</span>, <span class="va">env.files</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"bio2|bio11|bio12|bio15"</span>, <span class="va">output.files</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level5">
<h5 id="tidy">tidy<a class="anchor" aria-label="anchor" href="#tidy"></a>
</h5>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># view list of filetypes for terra, use .ascii</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/gdal.html" class="external-link">gdal</a></span><span class="op">(</span>drivers <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># loop to crop extent for all files</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># load each raster into temp object</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># begin edits</span></span>
<span>  <span class="co"># crop new rasters to extent</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, y <span class="op">=</span> <span class="va">ext.obj</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># mask the bioclim layer by global_atc</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/mask.html" class="external-link">mask</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, mask <span class="op">=</span> <span class="va">ref_atc_mask</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># set crs</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/project.html" class="external-link">project</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, y <span class="op">=</span> <span class="st">"EPSG:4326"</span>, method <span class="op">=</span> <span class="st">"bilinear"</span>, threads <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># set origin</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/origin.html" class="external-link">origin</a></span><span class="op">(</span><span class="va">rast.hold</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">0.0001396088</span>, <span class="op">-</span><span class="fl">0.0001392488</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co">#resample to fit the extent/resolution of the main layer global_bio1</span></span>
<span>  <span class="co">#use bilinear interpolation, since values are continuous</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/resample.html" class="external-link">resample</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, y <span class="op">=</span> <span class="va">ref_chelsa_bio1_main</span>, method <span class="op">=</span> <span class="st">"bilinear"</span>, threads <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>  </span>
<span>  </span>
<span>  </span>
<span>  <span class="co">#write out the new resampled rasters!</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">rast.hold</span>,</span>
<span>    filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"2041-2070_ssp126_GFDL"</span>, <span class="st">"v1"</span>, <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="va">output.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span>, <span class="st">"_global"</span>, <span class="st">".tif"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    filetype <span class="op">=</span> <span class="st">"GTiff"</span>,</span>
<span>    overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># remove object once its done</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">rast.hold</span><span class="op">)</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># directory of files to modify</span></span>
<span><span class="va">env.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"2041-2070_ssp126_GFDL"</span>, <span class="st">"v1"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\.tif$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># output file names</span></span>
<span><span class="va">output.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"2041-2070_ssp126_GFDL"</span>, <span class="st">"v1"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\.tif$"</span>, full.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">".tif"</span>, replacement <span class="op">=</span> <span class="st">".asc"</span><span class="op">)</span></span></code></pre></div>
<p><em>Note</em> In this version of the vignette, I have isolated only
the variables I selected for the final analysis. If you would like to
tidy and compare all variables, simply skip this next chunk.</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="va">env.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"bio2_2041-2070_gfdl_126_global|bio11_2041-2070_gfdl_126_global|bio12_2041-2070_gfdl_126_global|bio15_2041-2070_gfdl_126_global"</span>, <span class="va">env.files</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">output.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span><span class="st">"bio2_2041-2070_gfdl_126_global|bio11_2041-2070_gfdl_126_global|bio12_2041-2070_gfdl_126_global|bio15_2041-2070_gfdl_126_global"</span>, <span class="va">output.files</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>This code chunk was added later so I will only grab the rasters I
need downstream.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loop to convert to .ascii</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># holding object  </span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># write output</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">rast.hold</span>, </span>
<span>    filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"2041-2070_ssp126_GFDL"</span>, <span class="st">"v1_maxent"</span>, <span class="va">output.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    filetype <span class="op">=</span> <span class="st">"AAIGrid"</span>, </span>
<span>    overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># remove object once its done</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">rast.hold</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># loop to aggregate and convert to .ascii</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># holding object  </span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># aggregate to 10km scale. cells are roughly 1km, so aggregate by factor of 10</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, fact <span class="op">=</span> <span class="fl">10</span>, fun <span class="op">=</span> <span class="st">"mean"</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span>, threads <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># crop again to ensure aggregation doesnt increase extent</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/crop.html" class="external-link">crop</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">rast.hold</span>, y <span class="op">=</span> <span class="va">ext.obj</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># write output</span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/writeRaster.html" class="external-link">writeRaster</a></span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="va">rast.hold</span>, </span>
<span>    filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"2041-2070_ssp126_GFDL"</span>, <span class="st">"v1_maxent_10km"</span>, <span class="va">output.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span>, </span>
<span>    filetype <span class="op">=</span> <span class="st">"AAIGrid"</span>, </span>
<span>    overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># remove object once its done</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">rast.hold</span><span class="op">)</span></span>
<span>    </span>
<span><span class="op">}</span></span></code></pre></div>
<!--

### SSP370


``` r
# v1 for tidied rasters
dir.create(file.path(mypath, "2041-2070_ssp370_GFDL", "v1"))

# v1_maxent for the ascii versions
dir.create(file.path(mypath, "2041-2070_ssp370_GFDL", "v1_maxent"))

# 10km aggregated versions of ascii
dir.create(file.path(mypath, "2041-2070_ssp370_GFDL", "v1_maxent_10km"))
```


``` r
# I will load in the files and then get the new names I would like to give them

# load in bioclim layers to be cropped- the original .tif files
env.files <- list.files(path = file.path(mypath, "2041-2070_ssp370_GFDL", "originals"), pattern = "\\.tif$", full.names = TRUE)

# output file names
output.files <- list.files(path = file.path(mypath, "2041-2070_ssp370_GFDL", "originals"), pattern = "\\.tif$", full.names = FALSE) %>%
  # get rid of endings
  gsub(pattern = "_V.2.1.tif", replacement = "") %>%
  # crop out some detail
  gsub(pattern = "-esm4_ssp", replacement = "_") %>%
  tolower()

# more edits to file names
output.files <- output.files %>%
  gsub(pattern = "chelsa_", replacement = "") 
```

*Note* In this version of the vignette, I have isolated only the variables I selected for the final analysis. If you would like to tidy and compare all variables, simply skip this next chunk.


``` r
if(FALSE) {

  env.files <- grep("bio2|bio11|bio12|bio15", env.files, value = TRUE)
  
  output.files <- grep("bio2|bio11|bio12|bio15", output.files, value = TRUE)
  
}
```

#### tidy


``` r
# view list of filetypes for terra, use .ascii
  terra::gdal(drivers = TRUE)

  # loop to crop extent for all files
  for(a in seq_along(env.files)) {
    
    # load each raster into temp object
    rast.hold <- terra::rast(env.files[a])
    
    
    
    # begin edits
    # crop new rasters to extent
    rast.hold <- terra::crop(x = rast.hold, y = ext.obj)
    
    # mask the bioclim layer by global_atc
    rast.hold <- terra::mask(x = rast.hold, mask = ref_atc_mask)
    
    # set crs
    rast.hold <- terra::project(x = rast.hold, y = "EPSG:4326", method = "bilinear", threads = TRUE)
    
    # set origin
    terra::origin(rast.hold) <- c(-0.0001396088, -0.0001392488)
    
    #resample to fit the extent/resolution of the main layer global_bio1
    #use bilinear interpolation, since values are continuous
    rast.hold <- terra::resample(x = rast.hold, y = ref_chelsa_bio1_main, method = "bilinear", threads = TRUE)
    
    
    
    
    #write out the new resampled rasters!
    terra::writeRaster(
      x = rast.hold,
      filename = file.path(mypath, "2041-2070_ssp370_GFDL", "v1", paste0(output.files[a], "_global", ".tif")), 
      filetype = "GTiff", 
      overwrite = FALSE
      )
    
    # remove object once its done
    rm(rast.hold)

}
```


``` r
# directory of files to modify
env.files <- list.files(path = file.path(mypath, "2041-2070_ssp370_GFDL", "v1"), pattern = "\\.tif$", full.names = TRUE) %>%

# output file names
output.files <- list.files(path = file.path(mypath, "2041-2070_ssp370_GFDL", "v1"), pattern = "\\.tif$", full.names = FALSE) %>%
  gsub(pattern = ".tif", replacement = ".asc")
```

*Note* In this version of the vignette, I have isolated only the variables I selected for the final analysis. If you would like to tidy and compare all variables, simply skip this next chunk.


``` r
if(FALSE) {

  env.files <- grep("bio2_2041-2070_gfdl_370_global|bio11_2041-2070_gfdl_370_global|bio12_2041-2070_gfdl_370_global|bio15_2041-2070_gfdl_370_global", env.files, value = TRUE)
  
  output.files <- grep("bio2_2041-2070_gfdl_370_global|bio11_2041-2070_gfdl_370_global|bio12_2041-2070_gfdl_370_global|bio15_2041-2070_gfdl_370_global", output.files, value = TRUE)
  
}
```


``` r
if(FALSE){
  
  # loop to convert to .ascii
  for(a in seq_along(env.files)) {
    
    # holding object  
    rast.hold <- terra::rast(env.files[a])
    
    # write output
    terra::writeRaster(
      x = rast.hold, 
      filename = file.path(mypath, "2041-2070_ssp370_GFDL", "v1_maxent", output.files[a]),
      filetype = "AAIGrid", 
      overwrite = FALSE
      )
    
    # remove object once its done
    rm(rast.hold)
      
    }
    
}
```


``` r
# loop to aggregate and convert to .ascii
for(a in seq_along(env.files)){
  
  # holding object  
  rast.hold <- terra::rast(env.files[a])
  
  # aggregate to 10km scale. cells are roughly 1km, so aggregate by factor of 10
  rast.hold <- terra::aggregate(x = rast.hold, fact = 10, fun = "mean", na.rm = TRUE, threads = TRUE)
  
  # crop again to ensure aggregation doesnt increase extent
  rast.hold <- terra::crop(x = rast.hold, y = ext.obj)
  
  
  
  # write output
  terra::writeRaster(
    x = rast.hold, 
    filename = file.path(mypath, "2041-2070_ssp370_GFDL", "v1_maxent_10km", output.files[a]), 
    filetype = "AAIGrid", 
    overwrite = FALSE
    )
  
  # remove object once its done
  rm(rast.hold)
    
}
```

### SSP585


``` r
# v1 for tidied rasters
dir.create(file.path(mypath, "2041-2070_ssp585_GFDL", "v1"))

# v1_maxent for the ascii versions
dir.create(file.path(mypath, "2041-2070_ssp585_GFDL", "v1_maxent"))

# 10km aggregated versions of ascii
dir.create(file.path(mypath, "2041-2070_ssp585_GFDL", "v1_maxent_10km"))
```


``` r
# I will load in the files and then get the new names I would like to give them

# load in bioclim layers to be cropped- the original .tif files
env.files <- list.files(path = file.path(mypath, "2041-2070_ssp585_GFDL", "originals"), pattern = "\\.tif$", full.names = TRUE)

# output file names
output.files <- list.files(path = file.path(mypath, "2041-2070_ssp585_GFDL", "originals"), pattern = "\\.tif$", full.names = FALSE) %>%
  # get rid of endings
  gsub(pattern = "_V.2.1.tif", replacement = "") %>%
  # crop out some detail
  gsub(pattern = "-esm4_ssp", replacement = "_") %>%
  tolower()

# more edits to file names
output.files <- output.files %>%
  gsub(pattern = "chelsa_", replacement = "") 
```

*Note* In this version of the vignette, I have isolated only the variables I selected for the final analysis. If you would like to tidy and compare all variables, simply skip this next chunk.


``` r
if(FALSE) {

  env.files <- grep("bio2|bio11|bio12|bio15", env.files, value = TRUE)
  
  output.files <- grep("bio2|bio11|bio12|bio15", output.files, value = TRUE)
  
}
```


``` r
# view list of filetypes for terra, use .ascii
  terra::gdal(drivers = TRUE)

  # loop to crop extent for all files
  for(a in seq_along(env.files)) {
    
    # load each raster into temp object
    rast.hold <- terra::rast(env.files[a])
    
    
    
    # begin edits
    # crop new rasters to extent
    rast.hold <- terra::crop(x = rast.hold, y = ext.obj)
    
    # mask the bioclim layer by global_atc
    rast.hold <- terra::mask(x = rast.hold, mask = ref_atc_mask)
    
    # set crs
    rast.hold <- terra::project(x = rast.hold, y = "EPSG:4326", method = "bilinear", threads = TRUE)
    
    # set origin
    terra::origin(rast.hold) <- c(-0.0001396088, -0.0001392488)
    
    #resample to fit the extent/resolution of the main layer global_bio1
    #use bilinear interpolation, since values are continuous
    rast.hold <- terra::resample(x = rast.hold, y = ref_chelsa_bio1_main, method = "bilinear", threads = TRUE)

    
    
    
    #write out the new resampled rasters!
    terra::writeRaster(
      x = rast.hold,
      filename = file.path(mypath, "2041-2070_ssp585_GFDL", "v1", paste0(output.files[a], "_global", ".tif")), 
      filetype = "GTiff", 
      overwrite = FALSE
      )
    
    # remove object once its done
    rm(rast.hold)

}
```

#### tidy


``` r
# directory of files to modify
env.files <- list.files(path = file.path(mypath, "2041-2070_ssp585_GFDL", "v1"), pattern = "\\.tif$", full.names = TRUE) 

# output file names
output.files <- list.files(path = file.path(mypath, "2041-2070_ssp585_GFDL", "v1"), pattern = "\\.tif$", full.names = FALSE)  %>%
  gsub(pattern = ".tif", replacement = ".asc")
```

*Note* In this version of the vignette, I have isolated only the variables I selected for the final analysis. If you would like to tidy and compare all variables, simply skip this next chunk.


``` r
if(FALSE) {

  env.files <- grep("bio2_2041-2070_gfdl_585_global|bio11_2041-2070_gfdl_585_global|bio12_2041-2070_gfdl_585_global|bio15_2041-2070_gfdl_585_global", env.files, value = TRUE)
  
  output.files <- grep("bio2_2041-2070_gfdl_585_global|bio11_2041-2070_gfdl_585_global|bio12_2041-2070_gfdl_585_global|bio15_2041-2070_gfdl_585_global", output.files, value = TRUE)
  
}
```


``` r
# loop to convert to .ascii
for(a in seq_along(env.files)) {
  
  # holding object  
  rast.hold <- terra::rast(env.files[a])
  
  # write output
  terra::writeRaster(
    x = rast.hold, 
    filename = file.path(mypath, "2041-2070_ssp585_GFDL", "v1_maxent", output.files[a]), 
    filetype = "AAIGrid", 
    overwrite = FALSE
    )
  
  # remove object once its done
  rm(rast.hold)
    
  }
```


``` r
# loop to aggregate and convert to .ascii
for(a in seq_along(env.files)){
  
  # holding object  
  rast.hold <- terra::rast(env.files[a])
  
  # aggregate to 10km scale. cells are roughly 1km, so aggregate by factor of 10
  rast.hold <- terra::aggregate(x = rast.hold, fact = 10, fun = "mean", na.rm = TRUE, threads = TRUE)
  
  # crop again to ensure aggregation doesnt increase extent
  rast.hold <- terra::crop(x = rast.hold, y = ext.obj)
  
  
  
  # write output
  terra::writeRaster(
    x = rast.hold, 
    filename = file.path(mypath, "2041-2070_ssp585_GFDL", "v1_maxent_10km", output.files[a]), 
    filetype = "AAIGrid", 
    overwrite = FALSE
    )
  
  # remove object once its done
  rm(rast.hold)
    
}
```

-->
</div>
</div>
</div>
</div>
<div class="section level2">
<h2 id="assess-colinearity">3. Assess Colinearity<a class="anchor" aria-label="anchor" href="#assess-colinearity"></a>
</h2>
<p>Now that these different climatologies have been tidied for use, we
need to decide which variables are the most logical to use in a model
for <em>Lycorma delicatula</em>. This can be done by assessing the level
of co-linearity between the variables and assessing their biological
relevance to SLF.</p>
<p>Before using any of these climatologies in a MaxEnt model, we need to
assess their level of co-linearity (the amount the layers are correlated
to each other). I expect that most of them will be, as they are all
derived from either temperature or precipitation. I will be using a
threshold of 0.7 pearson’s correlation or lower to select which
variables I use in downstream models. I will only perform a correlation
analysis on the historical versions of the rasters, as the climate
change versions of the variables are likely to display the same trends.
I will use this analysis to decide what covariates go into both the
historical and interpolated (climate change) models.</p>
<p>While it is very important to reduce co-linearity, this cannot be the
only metric used to select covariates for species distribution models.
The biology of the target species is arguably more important than
reducing co-linearity. A MaxEnt model that has not been informed by the
biology of <em>Lycorma delicatula</em> will likely produce misleading or
wrong predictions of its realized niche. Our process of selecting
covariates will also need to be informed by the literature. For example,
there is evidence that minimum winter temperature has a significantly
negative impact on egg survival (Lee et.al, 2011).</p>
<p>We will downsize the rasters from the <code>v1</code> folder to
perform a co-linearity analysis between the layers. This will only be
done for the historical variables. We will be using
<code><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">terra::aggregate()</a></code> to combine cells in a 2x2 grid fashion
and take the mean of the 4 cells.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mypath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                      <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                    <span class="st">"maxent/historical_climate_rasters/chelsa2.1_30arcsec"</span><span class="op">)</span></span>
<span></span>
<span><span class="co">#list env layers, load</span></span>
<span><span class="va">env.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"v1"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\.tif$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">output.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"v1"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\.tif$"</span>, full.names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co"># I had to modify "pattern" to not include any .tif.aux.xml files</span></span>
<span></span>
<span><span class="co"># loop to downsample rasters for colinearity analysis</span></span>
<span><span class="co"># code taken from Huron et.al</span></span>
<span><span class="kw">for</span><span class="op">(</span><span class="va">a</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="co"># holding object</span></span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">rast.hold</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span></span>
<span>    <span class="va">rast.hold</span>, </span>
<span>    fact <span class="op">=</span> <span class="fl">2</span>, <span class="co"># downsampling by factor of 2 (read 2 cells deep around cell) and take mean of cells</span></span>
<span>    fun <span class="op">=</span> <span class="st">"mean"</span>, <span class="co"># take mean of these cells</span></span>
<span>    <span class="co"># expand = TRUE, # a carryover from raster::aggregate, terra does this automatically</span></span>
<span>    na.rm <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>    filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"v1_downsampled"</span>, <span class="va">output.files</span><span class="op">[</span><span class="va">a</span><span class="op">]</span><span class="op">)</span>, overwrite <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>    <span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># remove object once its done</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/rm.html" class="external-link">rm</a></span><span class="op">(</span><span class="va">rast.hold</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<div class="section level4">
<h4 id="create-and-tidy-correlation-matrix">3.1 create and tidy correlation matrix<a class="anchor" aria-label="anchor" href="#create-and-tidy-correlation-matrix"></a>
</h4>
<p>We will use <code><a href="https://rdrr.io/pkg/ENMTools/man/raster.cor.matrix.html" class="external-link">ENMTools::raster.cor.matrix()</a></code> to perform the
correlation analysis. This chunk will also take awhile, so its time to
break out that book again.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span><span class="op">{</span></span>
<span>  </span>
<span>  <span class="va">mypath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      <span class="st">"maxent/historical_climate_rasters/chelsa2.1_30arcsec"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># load downsampled layers and stack for raster.cor.matrix command</span></span>
<span></span>
<span>  <span class="co"># list of layer paths</span></span>
<span>  <span class="va">env.files</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.files.html" class="external-link">list.files</a></span><span class="op">(</span>path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"v1_downsampled"</span><span class="op">)</span>, pattern <span class="op">=</span> <span class="st">"\\.tif$"</span>, full.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="co"># only grab bioclim variables</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">grep</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"bio"</span>, value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>    </span>
<span>  </span>
<span>  <span class="co"># stack downsampled layers</span></span>
<span>  <span class="va">env</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="va">env.files</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="co"># use nlyr, a command of the function terra::dimensions() to see if stacking was successful</span></span>
<span>  <span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">env</span><span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span>  <span class="co"># create a correlation matrix for picking model layers</span></span>
<span>  <span class="va">env.cor</span> <span class="op">&lt;-</span> <span class="fu">ENMTools</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/ENMTools/man/raster.cor.matrix.html" class="external-link">raster.cor.matrix</a></span><span class="op">(</span>env <span class="op">=</span> <span class="va">env</span>, method <span class="op">=</span> <span class="st">"pearson"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># write out correlations as .csv.</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">env.cor</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"env_cor_chelsa_downsampled_v2.csv"</span><span class="op">)</span>, col.names <span class="op">=</span> <span class="cn">TRUE</span>, row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>The correlation values have been saved as a 24x24 matrix. Now that
the values have been saved as a .csv file, we need to tidy the data into
a more readable format. We will simplify the column and row names and
reorder them. We will also convert the correlations to their absolute
values so that we can analyze the differences between the layers on a
0-1 scale.</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env.cor2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"env_cor_chelsa_downsampled_v2.csv"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">env.cor2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">env.cor2</span><span class="op">)</span> </span>
<span><span class="co"># convert rownames column to rownames</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">env.cor2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">env.cor2</span><span class="op">$</span><span class="va">X</span></span>
<span><span class="co"># get rid of X column</span></span>
<span><span class="va">env.cor2</span> <span class="op">&lt;-</span> <span class="va">env.cor2</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">env.cor2</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"X"</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># reorder columns and take absolute values of correlations</span></span>
<span><span class="va">env.cor3</span> <span class="op">&lt;-</span> <span class="va">env.cor2</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/order.html" class="external-link">order</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span> </span>
<span></span>
<span><span class="co"># simplify colnames</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">env.cor3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_V.2.1"</span>, replacement <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">env.cor3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">env.cor3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_1981.2010"</span>, replacement <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">env.cor3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">env.cor3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"CHELSA_"</span>, replacement <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">env.cor3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># simplify rownames</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">env.cor3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_V.2.1"</span>, replacement <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">env.cor3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">env.cor3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"_1981.2010"</span>, replacement <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">env.cor3</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">env.cor3</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/grep.html" class="external-link">gsub</a></span><span class="op">(</span>pattern <span class="op">=</span> <span class="st">"CHELSA_"</span>, replacement <span class="op">=</span> <span class="st">""</span>, x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">env.cor3</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># factor levels to order row names</span></span>
<span><span class="va">var.names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"bio1"</span>, <span class="st">"bio2"</span>, <span class="st">"bio3"</span>, <span class="st">"bio4"</span>, <span class="st">"bio5"</span>, <span class="st">"bio6"</span>, <span class="st">"bio7"</span>, <span class="st">"bio8"</span>, <span class="st">"bio9"</span>, <span class="st">"bio10"</span>, <span class="st">"bio11"</span>, <span class="st">"bio12"</span>, <span class="st">"bio13"</span>, <span class="st">"bio14"</span>, <span class="st">"bio15"</span>, <span class="st">"bio16"</span>, <span class="st">"bio17"</span>, <span class="st">"bio18"</span>, <span class="st">"bio19"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># reorder columns </span></span>
<span><span class="va">env.cor4</span> <span class="op">&lt;-</span> <span class="va">env.cor3</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">bio1</span>, <span class="va">bio2</span><span class="op">:</span><span class="va">bio9</span>, <span class="va">bio10</span><span class="op">:</span><span class="va">bio19</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="co"># reorder rows</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>var <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># add column of row names to reorder</span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/arrange.html" class="external-link">arrange</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">var</span>, levels <span class="op">=</span> <span class="va">var.names</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="op">!</span><span class="va">var</span><span class="op">)</span> <span class="co"># take out temp column</span></span>
<span></span>
<span><span class="co"># write tidied data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/write.table.html" class="external-link">write.csv</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">env.cor4</span>, file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"env_cor_chelsa_downsampled_abs_v2.csv"</span><span class="op">)</span>, col.names <span class="op">=</span> <span class="cn">TRUE</span>, row.names <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p>The correlations are now more intuitive to read, so they are ready to
be analyzed.</p>
</div>
<div class="section level4">
<h4 id="covariate-selection-">3.2 Covariate selection.<a class="anchor" aria-label="anchor" href="#covariate-selection-"></a>
</h4>
<p>Now that they are in a more readable format and have been converted
to an absolute scale, we can create heatmaps to display these values and
look for trends. I will create a heatmap of both the raw values and of a
threshold of any above 0.7.</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">env.cor5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html" class="external-link">read.csv</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"data-tables"</span>, <span class="st">"env_cor_chelsa_downsampled_abs_v2.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/row.names.html" class="external-link">row.names</a></span><span class="op">(</span><span class="va">env.cor5</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">env.cor5</span><span class="op">$</span><span class="va">X</span></span>
<span></span>
<span><span class="va">env.cor5</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/coerce.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">env.cor5</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">env.cor5</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"X"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span><span class="co"># Make into triangle</span></span>
<span><span class="co">#env.cor5[upper.tri(env.cor5, diag = FALSE)] &lt;- NA</span></span>
<span></span>
<span><span class="co"># pivot correlation heatmap for plotting</span></span>
<span><span class="co"># code taken from Huron et.al</span></span>
<span><span class="va">env.cor5</span> <span class="op">&lt;-</span> <span class="va">env.cor5</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/as_tibble.html" class="external-link">as_tibble</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>covar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">covar</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># put covar at front</span></span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="op">-</span><span class="va">covar</span>, names_to <span class="op">=</span> <span class="st">"var"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> <span class="co"># pivot longer for plotting</span></span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">var</span>, <span class="va">covar</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html" class="external-link">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> </span></code></pre></div>
<p>I need to set factor levels for the variable names and how to rename
them.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># factor levels to order row names</span></span>
<span><span class="va">var.names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">"bio1"</span>, <span class="st">"bio2"</span>, <span class="st">"bio3"</span>, <span class="st">"bio4"</span>, <span class="st">"bio5"</span>, <span class="st">"bio6"</span>, <span class="st">"bio7"</span>, <span class="st">"bio8"</span>, <span class="st">"bio9"</span>, <span class="st">"bio10"</span>, <span class="st">"bio11"</span>, <span class="st">"bio12"</span>, <span class="st">"bio13"</span>, <span class="st">"bio14"</span>, <span class="st">"bio15"</span>, <span class="st">"bio16"</span>, <span class="st">"bio17"</span>, <span class="st">"bio18"</span>, <span class="st">"bio19"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># factor levels to rename abbreviations to actual names</span></span>
<span><span class="va">var.renames</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span> </span>
<span>  <span class="st">"bio1"</span> <span class="op">=</span> <span class="st">"annual mean temperature"</span>,</span>
<span>  <span class="st">"bio2"</span> <span class="op">=</span> <span class="st">"mean diurnal range"</span>,</span>
<span>  <span class="st">"bio3"</span> <span class="op">=</span> <span class="st">"isothermality"</span>,</span>
<span>  <span class="st">"bio4"</span> <span class="op">=</span> <span class="st">"temperature seasonality"</span>,</span>
<span>  <span class="st">"bio5"</span>    <span class="op">=</span> <span class="st">"max temp of warmest month"</span>,</span>
<span>  <span class="st">"bio6"</span> <span class="op">=</span> <span class="st">"min temp of coldest month"</span>,</span>
<span>  <span class="st">"bio7"</span> <span class="op">=</span> <span class="st">"temperature annual range"</span>,</span>
<span>  <span class="st">"bio8"</span>    <span class="op">=</span> <span class="st">"mean temp of wettest quarter"</span>,</span>
<span>  <span class="st">"bio9"</span> <span class="op">=</span> <span class="st">"mean temp of driest quarter"</span>,</span>
<span>  <span class="st">"bio10"</span> <span class="op">=</span> <span class="st">"mean temp of warmest quarter"</span>,</span>
<span>  <span class="st">"bio11"</span>   <span class="op">=</span> <span class="st">"mean temp of coldest quarter"</span>,</span>
<span>  <span class="st">"bio12"</span> <span class="op">=</span> <span class="st">"annual precipitation"</span>,</span>
<span>  <span class="st">"bio13"</span> <span class="op">=</span> <span class="st">"precip of wettest month"</span>,</span>
<span>  <span class="st">"bio14"</span> <span class="op">=</span> <span class="st">"precip of driest month"</span>,</span>
<span>  <span class="st">"bio15"</span> <span class="op">=</span> <span class="st">"precipitation seasonality"</span>,</span>
<span>  <span class="st">"bio16"</span> <span class="op">=</span> <span class="st">"precip of wettest quarter"</span>,</span>
<span>  <span class="st">"bio17"</span>   <span class="op">=</span> <span class="st">"precip of driest quarter"</span>,</span>
<span>  <span class="st">"bio18"</span> <span class="op">=</span> <span class="st">"precip of warmest quarter"</span>,</span>
<span>  <span class="st">"bio19"</span> <span class="op">=</span> <span class="st">"precip of coldest quarter"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot correlation matrix</span></span>
<span><span class="op">(</span><span class="va">env.cor_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">env.cor5</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">var</span>, levels <span class="op">=</span> <span class="va">var.names</span><span class="op">)</span>, <span class="co"># reorder according to var.names factor obj</span></span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">covar</span>, levels <span class="op">=</span> <span class="va">var.names</span><span class="op">)</span>, </span>
<span>                fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">viridis</span><span class="fu">::</span><span class="fu"><a href="https://sjmgarnier.github.io/viridis/reference/scale_viridis.html" class="external-link">scale_fill_viridis</a></span><span class="op">(</span>discrete <span class="op">=</span> <span class="cn">FALSE</span>, direction <span class="op">=</span> <span class="op">-</span><span class="fl">1</span>, limits <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span><span class="op">)</span>, name <span class="op">=</span> <span class="st">"Correlation"</span>, na.value <span class="op">=</span> <span class="st">"white"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>x <span class="op">=</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_axis.html" class="external-link">guide_axis</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Pearson's correlations: CHELSA bioclim covariate rasters"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_y_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">var.renames</span><span class="op">)</span> <span class="op">+</span></span>
<span>   <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="020_retrieve_bioclim_variables_files/figure-html/visualize%20correlations%20via%20heatmap-1.png" width="700"></p>
<p>I have found that choosing covariates can be rather ad-hoc, so I
developed what I believe is the best-fit methodology for choosing
covariates out of much practice. First, I look at the different
groupings of covariates (those based on temperature and precipitation)
and choose a representative from each group. The ideal representative is
highly correlated with most of the others in the group, which indicates
its predictive power, and represents a generality of its group (ie, the
mean yearly average). In this case, I chose mean temperature of the
coldest quarter and precip (bio 11 and 12). Besides its correlation
values, mean temp of the coldest quarter is highly impactful for the
survival of SLF eggs (Lee et.al, 2011).</p>
<p>I will save this plot and produce a binarized version before I
continue choosing variables. This way, the cutoff is clearer and the
choice is more obvious.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># save correlation heatmap</span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span></span>
<span>  <span class="va">env.cor_plot</span>, filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"figures"</span>, <span class="st">"env_cor_CHELSA_v2.jpg"</span><span class="op">)</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">8</span>, </span>
<span>  width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  device <span class="op">=</span> <span class="va">jpeg</span>,</span>
<span>  dpi <span class="op">=</span> <span class="fl">500</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># binary heatmap</span></span>
<span></span>
<span><span class="va">env.cor6</span> <span class="op">&lt;-</span> <span class="va">env.cor5</span></span>
<span><span class="co"># cut values into ranges above and below 0.7</span></span>
<span><span class="va">env.cor6</span><span class="op">$</span><span class="va">value</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">env.cor6</span><span class="op">$</span><span class="va">value</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0.709</span>, <span class="fl">1</span><span class="op">)</span>, labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"0.7 or below"</span>, <span class="st">"above 0.7"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># 0.7 threshold heatmap</span></span>
<span><span class="op">(</span><span class="va">env.cor_binary_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">env.cor6</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">var</span>, levels <span class="op">=</span> <span class="va">var.names</span><span class="op">)</span>, <span class="co"># reorder according to var.names factor obj</span></span>
<span>                y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">covar</span>, levels <span class="op">=</span> <span class="va">var.names</span><span class="op">)</span>, </span>
<span>                fill <span class="op">=</span> <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guides.html" class="external-link">guides</a></span><span class="op">(</span>x <span class="op">=</span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_axis.html" class="external-link">guide_axis</a></span><span class="op">(</span>angle <span class="op">=</span> <span class="fl">45</span><span class="op">)</span>,</span>
<span>         fill <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/guide_legend.html" class="external-link">guide_legend</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Correlation"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">""</span>, y <span class="op">=</span> <span class="st">""</span><span class="op">)</span>  <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span></span>
<span>    title <span class="op">=</span> <span class="st">"Pearson's correlations: CHELSA bioclim covariate rasters (binarized)"</span></span>
<span>    <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_manual.html" class="external-link">scale_fill_manual</a></span><span class="op">(</span>values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"yellow2"</span>, <span class="st">"azure4"</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"bottom"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_discrete.html" class="external-link">scale_y_discrete</a></span><span class="op">(</span>labels <span class="op">=</span> <span class="va">var.renames</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html" class="external-link">coord_equal</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p><img src="020_retrieve_bioclim_variables_files/figure-html/binarize%20correlation%20heatmap-1.png" width="700"></p>
<p>Indeed, the choice is much clearer on this plot. Mean temp of the
coldest quarter (bio 11) is above 0.7 correlated with all other
temp-based variables, except mean diurnal range (bio 2). Meanwhile,
annual precipitation is highly correlated with all precipitation based
variables, except precipitation seasonality (bio 12). These two
variables were also chosen.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html" class="external-link">ggsave</a></span><span class="op">(</span></span>
<span>  <span class="va">env.cor_binary_plot</span>, filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"vignette-outputs"</span>, <span class="st">"figures"</span>, <span class="st">"env_cor_CHELSA_v2_binary.jpg"</span><span class="op">)</span>,</span>
<span>  height <span class="op">=</span> <span class="fl">8</span>, </span>
<span>  width <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  device <span class="op">=</span> <span class="va">jpeg</span>,</span>
<span>  dpi <span class="op">=</span> <span class="fl">500</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="visualize-rasters">4. Visualize rasters<a class="anchor" aria-label="anchor" href="#visualize-rasters"></a>
</h2>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mypath</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>                        <span class="fu"><a href="https://rdrr.io/r/base/basename.html" class="external-link">dirname</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>                      <span class="st">"maxent/historical_climate_rasters/chelsa2.1_30arcsec"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># load in bio 1</span></span>
<span><span class="va">bio1_df</span> <span class="op">&lt;-</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="va">mypath</span>, <span class="st">"v1_downsampled"</span>, <span class="st">"bio1_1981-2010_global.tif"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">.</span>, xy <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bio1_plot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_tile.html" class="external-link">geom_tile</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bio1_df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span>, fill <span class="op">=</span> <span class="va">`CHELSA_bio1_1981-2010_V.2.1`</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">xlab</a></span><span class="op">(</span><span class="st">"longitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">ylab</a></span><span class="op">(</span><span class="st">"latitude"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_minimal</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link">theme</a></span><span class="op">(</span>legend.position <span class="op">=</span> <span class="st">"none"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">"CHELSA bio 1"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_map.html" class="external-link">coord_quickmap</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">bio1_plot</span></span></code></pre></div>
<p><img src="020_retrieve_bioclim_variables_files/figure-html/visualize%20rasters-1.png" width="700"></p>
<p>The final 4 variables have been selected for SDM of Lycorma
delicatula, which include “mean diurnal range”, “mean temperature of the
coldest quarter”, “annual precipitation”, and “precipitation
seasonality”. These covariates can be projected for climate change and
are biologically relevant to our target species. In the next vignette,
we will crop these covariates to the appropriate spatial scale to run a
global-scale model. We will also create other necessary datasets for
this model.</p>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Huron, N. A., Behm, J. E., &amp; Helmus, M. R. (2022).
Paninvasion severity assessment of a U.S. grape pest to disrupt the
global wine market. Communications Biology, 5(1), 655. <a href="https://doi.org/10.1038/s42003-022-03580-w" class="external-link uri">https://doi.org/10.1038/s42003-022-03580-w</a></p></li>
<li><p>Karger, D.N., Conrad, O., Böhner, J., Kawohl, T., Kreft, H.,
Soria-Auza, R.W., Zimmermann, N.E., Linder, P., Kessler, M. (2017).
Climatologies at high resolution for the Earth land surface areas.
Scientific Data. 4 170122. <a href="https://doi.org/10.1038/sdata.2017.122" class="external-link uri">https://doi.org/10.1038/sdata.2017.122</a></p></li>
<li><p>Karger D.N., Conrad, O., Böhner, J., Kawohl, T., Kreft, H.,
Soria-Auza, R.W., Zimmermann, N.E, Linder, H.P., Kessler, M. (2018):
Data from: Climatologies at high resolution for the earth’s land surface
areas. EnviDat. <a href="https://doi.org/10.16904/envidat.228.v2.1" class="external-link uri">https://doi.org/10.16904/envidat.228.v2.1</a></p></li>
<li><p>Krasting, J. P., John, J. G., Blanton, C., McHugh, C., Nikonov,
S., Radhakrishnan, A., Rand, K., Zadeh, N. T., Balaji, V., Durachta, J.,
Dupuis, C., Menzel, R., Robinson, T., Underwood, S., Vahlenkamp, H.,
Dunne, K. A., Gauthier, P. P., Ginoux, P., Griffies, S. M., … Zhao, M.
(2018). NOAA-GFDL GFDL-ESM4 model output prepared for CMIP6 CMIP
[Dataset]. Earth System Grid Federation. <a href="https://doi.org/10.22033/ESGF/CMIP6.1407" class="external-link uri">https://doi.org/10.22033/ESGF/CMIP6.1407</a></p></li>
<li><p>Lee, J.-S., Kim, I.-K., Koh, S.-H., Cho, S. J., Jang, S.-J., Pyo,
S.-H., &amp; Choi, W. I. (2011). Impact of minimum winter temperature on
Lycorma delicatula (Hemiptera: Fulgoridae) egg mortality. Journal of
Asia-Pacific Entomology, 14(1), 123–125. <a href="https://doi.org/10.1016/j.aspen.2010.09.004" class="external-link uri">https://doi.org/10.1016/j.aspen.2010.09.004</a></p></li>
<li><p>Weiss, D. J., Nelson, A., Gibson, H. S., Temperley, W., Peedell,
S., Lieber, A., Hancher, M., Poyart, E., Belchior, S., Fullman, N.,
Mappin, B., Dalrymple, U., Rozier, J., Lucas, T. C. D., Howes, R. E.,
Tusting, L. S., Kang, S. Y., Cameron, E., Bisanzio, D., … Gething, P. W.
(2018). A global map of travel time to cities to assess inequalities in
accessibility in 2015. Nature, 553(7688), 333–336. <a href="https://doi.org/10.1038/nature25181" class="external-link uri">https://doi.org/10.1038/nature25181</a></p></li>
</ol>
</div>
<div class="section level2">
<h2 id="appendix">Appendix<a class="anchor" aria-label="anchor" href="#appendix"></a>
</h2>
<div class="section level3">
<h3 id="additional-environmental-covariates">Additional environmental covariates<a class="anchor" aria-label="anchor" href="#additional-environmental-covariates"></a>
</h3>
<p>Along with the 19 traditional bioclimatic variables, CHELSA has
created about <a href="https://chelsa-climate.org/wp-admin/download-page/CHELSA_tech_specification_V2.pdf" class="external-link">29
additional variables</a> that may help to explain the SLF invasion in N.
America. I will include 4 metrics of growing degree day. Several studies
have attempted to characterize the lower threshold for egg development
and have found numbers between 8-13C (Maino et.al, 2022). Maino et.al
also found that egg mortality increased significantly under 10C (Maino
et.al, 2022). We will include various measures of degree day with a 10C
threshold. Here are the additional variables I will add to the
models:</p>
<ul>
<li>
<code>GDD10</code>: Growing degree days heat sum above 10°C</li>
<li>
<code>NGD10</code>: Number of growing degree days above 10°C</li>
<li>
<code>GDGFGD10</code>: First growing degree day above 10°C</li>
<li>
<code>GDDLGD10</code>: Last growing degree day above 10°C</li>
</ul>
<div class="section level4">
<h4 id="download-historical-dd-variables">Download historical DD variables<a class="anchor" aria-label="anchor" href="#download-historical-dd-variables"></a>
</h4>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span></span>
<span></span>
<span>  <span class="co"># historical data</span></span>
<span>  <span class="va">chelsa_historic_URLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://readr.tidyverse.org/reference/read_table.html" class="external-link">read_table</a></span><span class="op">(</span>file <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/file.path.html" class="external-link">file.path</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"data-raw"</span>, <span class="st">"CHELSA"</span>, <span class="st">"chelsa_1981-2010_bioclim_URLs.txt"</span><span class="op">)</span>,</span>
<span>                                col_names <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"X1"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span><span class="st">"URL"</span> <span class="op">=</span> <span class="st">"X1"</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># select only DD URLs</span></span>
<span>  <span class="va">chelsa_historic_URLs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/slice.html" class="external-link">slice</a></span><span class="op">(</span>.data <span class="op">=</span> <span class="va">chelsa_historic_URLs</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">32</span>, <span class="fl">35</span>, <span class="fl">38</span>, <span class="fl">55</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="co"># loop to download historical URLs</span></span>
<span>  <span class="kw">for</span><span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">chelsa_historic_URLs</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    </span>
<span>    <span class="va">file.tmp</span> <span class="op">&lt;-</span> <span class="va">chelsa_historic_URLs</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span></span>
<span>    </span>
<span>    <span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/browseURL.html" class="external-link">browseURL</a></span><span class="op">(</span>url <span class="op">=</span> <span class="va">file.tmp</span><span class="op">)</span></span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>Files were placed in
<code>"maxent/historical_climate_rasters/chelsa2.1_30arcsec/originals"</code>.</p>
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Samuel M. Owens, Matthew R. Helmus.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
