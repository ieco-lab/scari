---
title: "Plot response curves"
output: rmarkdown::html_vignette
author: 
    - "Samuel M. Owens^[Temple University, sam.owens@temple.edu]"
date: "2024-08-23"
---

# Overview

In this vignette, I will plot the marginal and univariate response curves for the global and each of the regional-scale models. These plots will help me to explore the biological realism of our modeled scales. 

I hypothesized that the regional models would have more nuanced responses to the environmental variables than the global model, so these plots will allow me to explore the differences in response curves between these models. These regional models should more closely  is because the regional models are trained on a smaller subset of the global data, and thus may be more sensitive to the range of our covariates present in each region.

# Setup

```{r load necesssary packages, message = FALSE}

# general tools
library(tidyverse)  #data manipulation
library(here) #making directory pathways easier on different instances
here::here() # here::here() starts at the root folder of this package.
library(devtools)

# SDMtune and dependencies
library(SDMtune) # main package used to run SDMs
library(dismo) # package underneath SDMtune
library(rJava)
library(plotROC) # plots ROCs

# spatial data handling
library(raster) 
library(terra) 
library(sf)

library(viridis)
library(patchwork)

```

These plots depict the activity of the variables put into the MaxEnt models. I will create a combined figure for the 3 models in the regional_ensemble

```{r set wd}

mypath <- file.path(here::here() %>% 
                       dirname(),
                     "maxent/models")

```

```{r scatter style object- marginal}

ensemble_colors <- c(
  "Rn (native)" = "#4daf4a",
  "Ri.NAmerica" =  "#e41a1c",
  "Ri.Asia" = "#377eb8"
)

marginal_plots_style <- list(
  theme_bw(),
  # labs
  labs(
    title = "Marginal response of 'regional_ensemble' models",
    color = "Model",
    caption = "rug plots indicate presences"
    ),
  ylab("cloglog_output"),
  # aes
  scale_color_manual(
    name = "model",
    values = ensemble_colors,
    aesthetics = "color"
  ),
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1), limits = c(0, 1)),
  theme(legend.position = "bottom"),
  geom_hline(aes(yintercept = 0), color = "black", linewidth = 0.5) 
)

```

```{r load model objects- regional ensemble}

regional_native_model <- read_rds(file = file.path(mypath, "slf_regional_native_v3", "regional_native_model.rds"))

regional_invaded_model <- read_rds(file = file.path(mypath, "slf_regional_invaded_v7", "regional_invaded_model.rds"))

regional_invaded_asian_model <- read_rds(file = file.path(mypath, "slf_regional_invaded_asian_v2", "regional_invaded_asian_model.rds"))

```

# create marginal response plots

I will smooth these plots using a GAM formula, after the methods of Elith et al, 2011.

A note that these curves were created using a Beta multiplier of 1.5.

## Bio 11

```{r extract marginal plots per model- bio 11}

regional_native_marginal_bio11 <- SDMtune::plotResponse(
  model = regional_native_model,
  var = "bio11",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = TRUE,
  rug = TRUE
) %>%
  ggplot_build()


regional_invaded_marginal_bio11 <- SDMtune::plotResponse(
  model = regional_invaded_model,
  var = "bio11",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = TRUE,
  rug = TRUE
) %>%
  ggplot_build()

regional_invaded_asian_marginal_bio11 <- SDMtune::plotResponse(
  model = regional_invaded_asian_model,
  var = "bio11",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = TRUE,
  rug = TRUE
) %>%
  ggplot_build()
           

```

```{r maximum activity- bio 11 marginal}

# peak y trendline object 
bio11_max_activity_values <- c(
  native_bio_11 = regional_native_marginal_bio11$data[[1]][which.max(regional_native_marginal_bio11$data[[1]]$y), ]$x,
  invaded_bio_11 = regional_invaded_marginal_bio11$data[[1]][which.max(regional_invaded_marginal_bio11$data[[1]]$y), ]$x,
  invaded_asian_bio_11 = regional_invaded_asian_marginal_bio11$data[[1]][which.max(regional_invaded_asian_marginal_bio11$data[[1]]$y), ]$x
)

```

```{r combine plots- bio 11 marginal}

bio11_marginal_combined <- ggplot() +
  # native model data
  geom_smooth(data = regional_native_marginal_bio11$data[[1]], aes(x = x, y = y, color = "Rn (native)"), se = FALSE, method = "gam") +
  # invaded model data
  geom_smooth(data = regional_invaded_marginal_bio11$data[[1]], aes(x = x, y = y, color = "Ri.NAmerica"), se = FALSE, method = "gam") +
  # invaded_asian model data
  geom_smooth(data = regional_invaded_asian_marginal_bio11$data[[1]], aes(x = x, y = y, color = "Ri.Asia"), se = FALSE, method = "gam") +
  # plot peak trendline and labels
  # Rn (native)
  geom_vline(aes(xintercept = bio11_max_activity_values[[1]], color = "Rn (native)"), linetype = "dashed", linewidth = 0.5) +
  # invaded
  geom_vline(aes(xintercept = bio11_max_activity_values[[2]], color = "Ri.NAmerica"), linetype = "dashed", linewidth = 0.5) +
  # Ri.Asia
  geom_vline(aes(xintercept = bio11_max_activity_values[[3]], color = "Ri.Asia"), linetype = "dashed", linewidth = 0.5) +
  # plot rug plots
  # Rn (native)
  geom_rug(aes(x = regional_native_marginal_bio11$data[[2]]$x, color = "Rn (native)"), sides = "t") +
  # invaded
  geom_rug(aes(x = regional_invaded_marginal_bio11$data[[2]]$x, color = "Ri.NAmerica"), sides = "t", alpha = 0.8) +
  # Ri.Asia
  geom_rug(aes(x = regional_invaded_asian_marginal_bio11$data[[2]]$x, color = "Ri.Asia"), sides = "t", alpha = 0.6) +
  # default style
  marginal_plots_style +
  # labels
  labs(
    subtitle = "Bio 11 (mean temperature of the coldest quarter)",
    x = "mean temperature of the coldest quarter (C)"
    ) +
  # aesthetics
  xlim(-20, 20) 
  

```

```{r save plot- bio 11 marginal}

ggsave(
  bio11_marginal_combined, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "regional_ensemble_bio11_marginal_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

## Bio 12

```{r extract marginal plots per model- bio 12}

regional_native_marginal_bio12 <- SDMtune::plotResponse(
  model = regional_native_model,
  var = "bio12",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = TRUE,
  rug = TRUE
) %>%
  ggplot_build()


regional_invaded_marginal_bio12 <- SDMtune::plotResponse(
  model = regional_invaded_model,
  var = "bio12",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = TRUE,
  rug = TRUE
) %>%
  ggplot_build()

regional_invaded_asian_marginal_bio12 <- SDMtune::plotResponse(
  model = regional_invaded_asian_model,
  var = "bio12",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = TRUE,
  rug = TRUE
) %>%
  ggplot_build()
           

```

```{r maximum activity- bio 12 marginal}

# peak y trendline object 
bio12_max_activity_values <- c(
  native_bio_12 = regional_native_marginal_bio12$data[[1]][which.max(regional_native_marginal_bio12$data[[1]]$y), ]$x,
  invaded_bio_12 = regional_invaded_marginal_bio12$data[[1]][which.max(regional_invaded_marginal_bio12$data[[1]]$y), ]$x,
  invaded_asian_bio_12 = regional_invaded_asian_marginal_bio12$data[[1]][which.max(regional_invaded_asian_marginal_bio12$data[[1]]$y), ]$x
)

```

```{r combine plots- bio 12 marginal}

bio12_marginal_combined <- ggplot() +
  # native model data
  geom_smooth(data = regional_native_marginal_bio12$data[[1]], aes(x = x, y = y, color = "Rn (native)"), se = FALSE, method = "gam") +
  # invaded model data
  geom_smooth(data = regional_invaded_marginal_bio12$data[[1]], aes(x = x, y = y, color = "Ri.NAmerica"), se = FALSE, method = "gam") +
  # Ri.Asia model data
  geom_smooth(data = regional_invaded_asian_marginal_bio12$data[[1]], aes(x = x, y = y, color = "Ri.Asia"), se = FALSE, method = "gam") +
  # plot peak trendline and labels
  # Rn (native)
  geom_vline(aes(xintercept = bio12_max_activity_values[[1]], color = "Rn (native)"), linetype = "dashed", linewidth = 0.5) +
  # invaded
  geom_vline(aes(xintercept = bio12_max_activity_values[[2]], color = "Ri.NAmerica"), linetype = "dashed", linewidth = 0.5) +
  # Ri.Asia
  geom_vline(aes(xintercept = bio12_max_activity_values[[3]], color = "Ri.Asia"), linetype = "dashed", linewidth = 0.5) +
  # plot rug plots
  # Rn (native)
  geom_rug(aes(x = regional_native_marginal_bio12$data[[2]]$x, color = "Rn (native)"), sides = "t") +
  # invaded
  geom_rug(aes(x = regional_invaded_marginal_bio12$data[[2]]$x, color = "Ri.NAmerica"), sides = "t", alpha = 0.8) +
  # Ri.Asia
  geom_rug(aes(x = regional_invaded_asian_marginal_bio12$data[[2]]$x, color = "Ri.Asia"), sides = "t", alpha = 0.6) +
  # default style
  marginal_plots_style +
  # labels
  labs(
    subtitle = "Bio 12 (Annual Precipitation)",
    x = "annual precipitation (mm)"
    ) +
  # aesthetics
  xlim(0, 4250) 
  

```

```{r save plot- bio 12 marginal}

ggsave(
  bio12_marginal_combined, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "regional_ensemble_bio12_marginal_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

## Bio 15

```{r extract marginal plots per model- bio 15}

regional_native_marginal_bio15 <- SDMtune::plotResponse(
  model = regional_native_model,
  var = "bio15",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = TRUE,
  rug = TRUE
) %>%
  ggplot_build()


regional_invaded_marginal_bio15 <- SDMtune::plotResponse(
  model = regional_invaded_model,
  var = "bio15",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = TRUE,
  rug = TRUE
) %>%
  ggplot_build()

regional_invaded_asian_marginal_bio15 <- SDMtune::plotResponse(
  model = regional_invaded_asian_model,
  var = "bio15",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = TRUE,
  rug = TRUE
) %>%
  ggplot_build()
           

```

```{r maximum activity- bio 15 marginal}

# peak y trendline object 
bio15_max_activity_values <- c(
  native_bio_15 = regional_native_marginal_bio15$data[[1]][which.max(regional_native_marginal_bio15$data[[1]]$y), ]$x,
  invaded_bio_15 = regional_invaded_marginal_bio15$data[[1]][which.max(regional_invaded_marginal_bio15$data[[1]]$y), ]$x,
  invaded_asian_bio_15 = regional_invaded_asian_marginal_bio15$data[[1]][which.max(regional_invaded_asian_marginal_bio15$data[[1]]$y), ]$x
)

```

```{r combine plots- bio 15 marginal}

bio15_marginal_combined <- ggplot() +
  # native model data
  geom_smooth(data = regional_native_marginal_bio15$data[[1]], aes(x = x, y = y, color = "Rn (native)"), se = FALSE, method = "gam") +
  # invaded model data
  geom_smooth(data = regional_invaded_marginal_bio15$data[[1]], aes(x = x, y = y, color = "Ri.NAmerica"), se = FALSE, method = "gam") +
  # invaded_asian model data
  geom_smooth(data = regional_invaded_asian_marginal_bio15$data[[1]], aes(x = x, y = y, color = "Ri.Asia"), se = FALSE, method = "gam") +
  # plot peak trendline and labels
  # Rn (native)
  geom_vline(aes(xintercept = bio15_max_activity_values[[1]], color = "Rn (native)"), linetype = "dashed", linewidth = 0.5) +
  # invaded
  geom_vline(aes(xintercept = bio15_max_activity_values[[2]], color = "Ri.NAmerica"), linetype = "dashed", linewidth = 0.5) +
  # Ri.Asia
  geom_vline(aes(xintercept = bio15_max_activity_values[[3]], color = "Ri.Asia"), linetype = "dashed", linewidth = 0.5) +
  # plot rug plots
  # Rn (native)
  geom_rug(aes(x = regional_native_marginal_bio15$data[[2]]$x, color = "Rn (native)"), sides = "t") +
  # invaded
  geom_rug(aes(x = regional_invaded_marginal_bio15$data[[2]]$x, color = "Ri.NAmerica"), sides = "t", alpha = 0.8) +
  # Ri.Asia
  geom_rug(aes(x = regional_invaded_asian_marginal_bio15$data[[2]]$x, color = "Ri.Asia"), sides = "t", alpha = 0.6) +
  # default style
  marginal_plots_style +
  # labels
  labs(
    subtitle = "Bio 15 (Precipitation Seasonality, CV)",
    x = "precipitation seasonality (%)"
    ) +
  # aesthetics
  xlim(0, 120) 
  

```

```{r save plot- bio 15 marginal}

ggsave(
  bio15_marginal_combined, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "regional_ensemble_bio15_marginal_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

## Bio 2

```{r extract marginal plots per model- bio 2}

regional_native_marginal_bio2 <- SDMtune::plotResponse(
  model = regional_native_model,
  var = "bio2",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = TRUE,
  rug = TRUE
) %>%
  ggplot_build()


regional_invaded_marginal_bio2 <- SDMtune::plotResponse(
  model = regional_invaded_model,
  var = "bio2",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = TRUE,
  rug = TRUE
) %>%
  ggplot_build()

regional_invaded_asian_marginal_bio2 <- SDMtune::plotResponse(
  model = regional_invaded_asian_model,
  var = "bio2",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = TRUE,
  rug = TRUE
) %>%
  ggplot_build()
           

```

```{r maximum activity- bio 2 marginal}

# peak y trendline object 
bio2_max_activity_values <- c(
  native_bio_2 = regional_native_marginal_bio2$data[[1]][which.max(regional_native_marginal_bio2$data[[1]]$y), ]$x,
  invaded_bio_2 = regional_invaded_marginal_bio2$data[[1]][which.max(regional_invaded_marginal_bio2$data[[1]]$y), ]$x,
  invaded_asian_bio_2 = regional_invaded_asian_marginal_bio2$data[[1]][which.max(regional_invaded_asian_marginal_bio2$data[[1]]$y), ]$x
)

```

```{r combine plots- bio 2 marginal}

bio2_marginal_combined <- ggplot() +
  # native model data
  geom_smooth(data = regional_native_marginal_bio2$data[[1]], aes(x = x, y = y, color = "Rn (native)"), se = FALSE, method = "gam") +
  # invaded model data
  geom_smooth(data = regional_invaded_marginal_bio2$data[[1]], aes(x = x, y = y, color = "Ri.NAmerica"), se = FALSE, method = "gam") +
  # invaded_asian model data
  geom_smooth(data = regional_invaded_asian_marginal_bio2$data[[1]], aes(x = x, y = y, color = "Ri.Asia"), se = FALSE, method = "gam") +
  # plot peak trendline and labels
  # Rn (native)
  geom_vline(aes(xintercept = bio2_max_activity_values[[1]], color = "Rn (native)"), linetype = "dashed", linewidth = 0.5) +
  # invaded
  geom_vline(aes(xintercept = bio2_max_activity_values[[2]], color = "Ri.NAmerica"), linetype = "dashed", linewidth = 0.5) +
  # Ri.Asia
  geom_vline(aes(xintercept = bio2_max_activity_values[[3]], color = "Ri.Asia"), linetype = "dashed", linewidth = 0.5) +
  # plot rug plots
  # Rn (native)
  geom_rug(aes(x = regional_native_marginal_bio2$data[[2]]$x, color = "Rn (native)"), sides = "t") +
  # invaded
  geom_rug(aes(x = regional_invaded_marginal_bio2$data[[2]]$x, color = "Ri.NAmerica"), sides = "t", alpha = 0.8) +
  # Ri.Asia
  geom_rug(aes(x = regional_invaded_asian_marginal_bio2$data[[2]]$x, color = "Ri.Asia"), sides = "t", alpha = 0.6) +
  # default style
  marginal_plots_style +
  # labels
  labs(
    subtitle = "Bio 2 (Mean Diurnal Range)",
    x = "mean diurnal range (C)"
    ) +
  # aesthetics
  xlim(0, 15) 
  

```

```{r save plot- bio 2 marginal}

ggsave(
  bio2_marginal_combined, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "regional_ensemble_bio2_marginal_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

# create univariate response curves

```{r scatter style object- univar}

ensemble_colors <- c(
  "Rn (native)" = "#4daf4a",
  "Ri.NAmerica" =  "#e41a1c",
  "Ri.Asia" = "#377eb8"
)

univar_plots_style <- list(
  theme_bw(),
  # labs
  labs(
    title = "Univariate response in 'regional_ensemble' models",
    color = "Model",
    caption = "rug plots indicate presences"
    ),
  ylab("cloglog_output"),
  # aes
  scale_color_manual(
    name = "model",
    values = ensemble_colors,
    aesthetics = "color"
  ),
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1), limits = c(0, 1)),
  theme(legend.position = "bottom"),
  geom_hline(aes(yintercept = 0), color = "black", linewidth = 0.5) 
)

```

## Bio 11

```{r extract univar plots per model- bio 11 univar}

regional_native_univar_bio11 <- SDMtune::plotResponse(
  model = regional_native_model,
  var = "bio11",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = FALSE,
  rug = TRUE
) %>%
  ggplot_build()


regional_invaded_univar_bio11 <- SDMtune::plotResponse(
  model = regional_invaded_model,
  var = "bio11",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = FALSE,
  rug = TRUE
) %>%
  ggplot_build()

regional_invaded_asian_univar_bio11 <- SDMtune::plotResponse(
  model = regional_invaded_asian_model,
  var = "bio11",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = FALSE,
  rug = TRUE
) %>%
  ggplot_build()
           

```

```{r maximum activity- bio 11 univar}

# peak y trendline object 
bio11_univar_max_activity_values <- c(
  native_bio11 = regional_native_univar_bio11$data[[1]][which.max(regional_native_univar_bio11$data[[1]]$y), ]$x,
  invaded_bio11 = regional_invaded_univar_bio11$data[[1]][which.max(regional_invaded_univar_bio11$data[[1]]$y), ]$x,
  invaded_asian_bio11 = regional_invaded_asian_univar_bio11$data[[1]][which.max(regional_invaded_asian_univar_bio11$data[[1]]$y), ]$x
)

```

```{r combine plots- bio 11 univar}

bio11_univar_combined <- ggplot() +
  # native model data
  geom_smooth(data = regional_native_univar_bio11$data[[1]], aes(x = x, y = y, color = "Rn (native)"), se = FALSE, method = "gam") +
  # invaded model data
  geom_smooth(data = regional_invaded_univar_bio11$data[[1]], aes(x = x, y = y, color = "Ri.NAmerica"), se = FALSE, method = "gam") +
  # Ri.Asia model data
  geom_smooth(data = regional_invaded_asian_univar_bio11$data[[1]], aes(x = x, y = y, color = "Ri.Asia"), se = FALSE, method = "gam") +
  # plot peak trendline and labels
  # Rn (native)
  geom_vline(aes(xintercept = bio11_univar_max_activity_values[[1]], color = "Rn (native)"), linetype = "dashed", linewidth = 0.5) +
  # invaded
  geom_vline(aes(xintercept = bio11_univar_max_activity_values[[2]], color = "Ri.NAmerica"), linetype = "dashed", linewidth = 0.5) +
  # Ri.Asia
  geom_vline(aes(xintercept = bio11_univar_max_activity_values[[3]], color = "Ri.Asia"), linetype = "dashed", linewidth = 0.5) +
  # plot rug plots
  # Rn (native)
  geom_rug(aes(x = regional_native_univar_bio11$data[[2]]$x, color = "Rn (native)"), sides = "t") +
  # invaded
  geom_rug(aes(x = regional_invaded_univar_bio11$data[[2]]$x, color = "Ri.NAmerica"), sides = "t", alpha = 0.8) +
  # Ri.Asia
  geom_rug(aes(x = regional_invaded_asian_univar_bio11$data[[2]]$x, color = "Ri.Asia"), sides = "t", alpha = 0.6) +
  # default style
  univar_plots_style +
  # labels
  labs(
    subtitle = "Bio 11 (mean temperature of the coldest quarter)",
    x = "mean temperature of the coldest quarter (C)"
    ) +
  # aesthetics
  xlim(-20, 20) 
  

```

```{r save plot- bio 11 univar}

ggsave(
  bio11_univar_combined, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "regional_ensemble_bio11_univar_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

## Bio 12

```{r extract univar plots per model- bio 12}

regional_native_univar_bio12 <- SDMtune::plotResponse(
  model = regional_native_model,
  var = "bio12",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = FALSE,
  rug = TRUE
) %>%
  ggplot_build()


regional_invaded_univar_bio12 <- SDMtune::plotResponse(
  model = regional_invaded_model,
  var = "bio12",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = FALSE,
  rug = TRUE
) %>%
  ggplot_build()

regional_invaded_asian_univar_bio12 <- SDMtune::plotResponse(
  model = regional_invaded_asian_model,
  var = "bio12",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = FALSE,
  rug = TRUE
) %>%
  ggplot_build()
           

```

```{r maximum activity- bio 12 univar}

# peak y trendline object 
bio12_univar_max_activity_values <- c(
  native_bio12 = regional_native_univar_bio12$data[[1]][which.max(regional_native_univar_bio12$data[[1]]$y), ]$x,
  invaded_bio12 = regional_invaded_univar_bio12$data[[1]][which.max(regional_invaded_univar_bio12$data[[1]]$y), ]$x,
  invaded_asian_bio12 = regional_invaded_asian_univar_bio12$data[[1]][which.max(regional_invaded_asian_univar_bio12$data[[1]]$y), ]$x
)

```

```{r combine plots- bio 12 univar}

bio12_univar_combined <- ggplot() +
  # native model data
  geom_smooth(data = regional_native_univar_bio12$data[[1]], aes(x = x, y = y, color = "Rn (native)"), se = FALSE, method = "gam") +
  # invaded model data
  geom_smooth(data = regional_invaded_univar_bio12$data[[1]], aes(x = x, y = y, color = "Ri.NAmerica"), se = FALSE, method = "gam") +
  # invaded_asian model data
  geom_smooth(data = regional_invaded_asian_univar_bio12$data[[1]], aes(x = x, y = y, color = "Ri.Asia"), se = FALSE, method = "gam") +
  # plot peak trendline and labels
  # Rn (native)
  geom_vline(aes(xintercept = bio12_univar_max_activity_values[[1]], color = "Rn (native)"), linetype = "dashed", linewidth = 0.5) +
  # invaded
  geom_vline(aes(xintercept = bio12_univar_max_activity_values[[2]], color = "Ri.NAmerica"), linetype = "dashed", linewidth = 0.5) +
  # Ri.Asia
  geom_vline(aes(xintercept = bio12_univar_max_activity_values[[3]], color = "Ri.Asia"), linetype = "dashed", linewidth = 0.5) +
  # plot rug plots
  # Rn (native)
  geom_rug(aes(x = regional_native_univar_bio12$data[[2]]$x, color = "Rn (native)"), sides = "t") +
  # invaded
  geom_rug(aes(x = regional_invaded_univar_bio12$data[[2]]$x, color = "Ri.NAmerica"), sides = "t", alpha = 0.8) +
  # Ri.Asia
  geom_rug(aes(x = regional_invaded_asian_univar_bio12$data[[2]]$x, color = "Ri.Asia"), sides = "t", alpha = 0.6) +
  # default style
  univar_plots_style +
  # labels
  labs(
    subtitle = "Bio 12 (Annual Precipitation)",
    x = "annual precipitation (mm)"
    ) +
  # aesthetics
  xlim(0, 4250) 
  

```

```{r save plot- bio 12 univar}

ggsave(
  bio12_univar_combined, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "regional_ensemble_bio12_univar_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

## Bio 15

```{r extract univar plots per model- bio 15}

regional_native_univar_bio15 <- SDMtune::plotResponse(
  model = regional_native_model,
  var = "bio15",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = FALSE,
  rug = TRUE
) %>%
  ggplot_build()


regional_invaded_univar_bio15 <- SDMtune::plotResponse(
  model = regional_invaded_model,
  var = "bio15",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = FALSE,
  rug = TRUE
) %>%
  ggplot_build()

regional_invaded_asian_univar_bio15 <- SDMtune::plotResponse(
  model = regional_invaded_asian_model,
  var = "bio15",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = FALSE,
  rug = TRUE
) %>%
  ggplot_build()
           

```

```{r maximum activity- bio 15 univar}

# peak y trendline object 
bio15_univar_max_activity_values <- c(
  native_bio15 = regional_native_univar_bio15$data[[1]][which.max(regional_native_univar_bio15$data[[1]]$y), ]$x,
  invaded_bio15 = regional_invaded_univar_bio15$data[[1]][which.max(regional_invaded_univar_bio15$data[[1]]$y), ]$x,
  invaded_asian_bio15 = regional_invaded_asian_univar_bio15$data[[1]][which.max(regional_invaded_asian_univar_bio15$data[[1]]$y), ]$x
)

```

```{r combine plots- bio 15 univar}

bio15_univar_combined <- ggplot() +
  # native model data
  geom_smooth(data = regional_native_univar_bio15$data[[1]], aes(x = x, y = y, color = "Rn (native)"), se = FALSE, method = "gam") +
  # invaded model data
  geom_smooth(data = regional_invaded_univar_bio15$data[[1]], aes(x = x, y = y, color = "Ri.NAmerica"), se = FALSE, method = "gam") +
  # invaded_asian model data
  geom_smooth(data = regional_invaded_asian_univar_bio15$data[[1]], aes(x = x, y = y, color = "Ri.Asia"), se = FALSE, method = "gam") +
  # plot peak trendline and labels
  # Rn (native)
  geom_vline(aes(xintercept = bio15_univar_max_activity_values[[1]], color = "Rn (native)"), linetype = "dashed", linewidth = 0.5) +
  # invaded
  geom_vline(aes(xintercept = bio15_univar_max_activity_values[[2]], color = "Ri.NAmerica"), linetype = "dashed", linewidth = 0.5) +
  # Ri.Asia
  geom_vline(aes(xintercept = bio15_univar_max_activity_values[[3]], color = "Ri.Asia"), linetype = "dashed", linewidth = 0.5) +
  # plot rug plots
  # Rn (native)
  geom_rug(aes(x = regional_native_univar_bio15$data[[2]]$x, color = "Rn (native)"), sides = "t") +
  # invaded
  geom_rug(aes(x = regional_invaded_univar_bio15$data[[2]]$x, color = "Ri.NAmerica"), sides = "t", alpha = 0.8) +
  # Ri.Asia
  geom_rug(aes(x = regional_invaded_asian_univar_bio15$data[[2]]$x, color = "Ri.Asia"), sides = "t", alpha = 0.6) +
  # default style
  univar_plots_style +
  # labels
  labs(
    subtitle = "Bio 15 (Precipitation Seasonality, CV)",
    x = "precipitation seasonality (%)"
    ) +
  # aesthetics
  xlim(0, 120) 
  

```

```{r save plot- bio 15 univar}

ggsave(
  bio15_univar_combined, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "regional_ensemble_bio15_univar_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

## Bio 2

```{r extract univar plots per model- bio 2}

regional_native_univar_bio2 <- SDMtune::plotResponse(
  model = regional_native_model,
  var = "bio2",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = FALSE,
  rug = TRUE
) %>%
  ggplot_build()


regional_invaded_univar_bio2 <- SDMtune::plotResponse(
  model = regional_invaded_model,
  var = "bio2",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = FALSE,
  rug = TRUE
) %>%
  ggplot_build()

regional_invaded_asian_univar_bio2 <- SDMtune::plotResponse(
  model = regional_invaded_asian_model,
  var = "bio2",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = FALSE,
  rug = TRUE
) %>%
  ggplot_build()
           

```

```{r maximum activity- bio 2 univar}

# peak y trendline object 
bio2_univar_max_activity_values <- c(
  native_bio2 = regional_native_univar_bio2$data[[1]][which.max(regional_native_univar_bio2$data[[1]]$y), ]$x,
  invaded_bio2 = regional_invaded_univar_bio2$data[[1]][which.max(regional_invaded_univar_bio2$data[[1]]$y), ]$x,
  invaded_asian_bio2 = regional_invaded_asian_univar_bio2$data[[1]][which.max(regional_invaded_asian_univar_bio2$data[[1]]$y), ]$x
)

```

```{r combine plots- bio 2 univar}

bio2_univar_combined <- ggplot() +
  # native model data
  geom_smooth(data = regional_native_univar_bio2$data[[1]], aes(x = x, y = y, color = "Rn (native)"), se = FALSE, method = "gam") +
  # invaded model data
  geom_smooth(data = regional_invaded_univar_bio2$data[[1]], aes(x = x, y = y, color = "Ri.NAmerica"), se = FALSE, method = "gam") +
  # Ri.Asia model data
  geom_smooth(data = regional_invaded_asian_univar_bio2$data[[1]], aes(x = x, y = y, color = "Ri.Asia"), se = FALSE, method = "gam") +
  # plot peak trendline and labels
  # Rn (native)
  geom_vline(aes(xintercept = bio2_univar_max_activity_values[[1]], color = "Rn (native)"), linetype = "dashed", linewidth = 0.5) +
  # invaded
  geom_vline(aes(xintercept = bio2_univar_max_activity_values[[2]], color = "Ri.NAmerica"), linetype = "dashed", linewidth = 0.5) +
  # Ri.Asia
  geom_vline(aes(xintercept = bio2_univar_max_activity_values[[3]], color = "Ri.Asia"), linetype = "dashed", linewidth = 0.5) +
  # plot rug plots
  # Rn (native)
  geom_rug(aes(x = regional_native_univar_bio2$data[[2]]$x, color = "Rn (native)"), sides = "t") +
  # invaded
  geom_rug(aes(x = regional_invaded_univar_bio2$data[[2]]$x, color = "Ri.NAmerica"), sides = "t", alpha = 0.8) +
  # Ri.Asia
  geom_rug(aes(x = regional_invaded_asian_univar_bio2$data[[2]]$x, color = "Ri.Asia"), sides = "t", alpha = 0.6) +
  # default style
  univar_plots_style +
  # labels
  labs(
    subtitle = "Bio 2 (Mean Diurnal Range)",
    x = "mean diurnal range (C)"
    ) +
  # aesthetics
  xlim(0, 15) 
  

```

```{r save plot- bio 2 univar}

ggsave(
  bio2_univar_combined, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "regional_ensemble_bio2_univar_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

# Global Model

## Load in objects and setup

```{r marginal plot style object}

marginal_plots_style_global <- list(
  theme_bw(),
  # labs
  labs(
    title = "Marginal response of 'global' model",
    caption = "rug plot indicates presences"
    ),
  ylab("cloglog_output"),
  # aes
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1), limits = c(0, 1)),
  geom_hline(aes(yintercept = 0), color = "black", linewidth = 0.5) 
)

```

```{r univar plot style object}

univar_plots_style_global <- list(
  theme_bw(),
  # labs
  labs(
    title = "Univariate response of 'global' model",
    caption = "rug plot indicates presences"
    ),
  ylab("cloglog_output"),
  # aes
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1), limits = c(0, 1)),
  geom_hline(aes(yintercept = 0), color = "black", linewidth = 0.5) 
)

```

```{r load model objects- global}

global_model <- read_rds(file = file.path(mypath, "slf_global_v3", "global_model.rds"))

```

## Create marginal plots

```{r extract marginal plots for global model}

global_marginal_bio11 <- SDMtune::plotResponse(
  model = global_model,
  var = "bio11",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = TRUE,
  rug = TRUE
) %>%
  ggplot_build()


global_marginal_bio12 <- SDMtune::plotResponse(
  model = global_model,
  var = "bio12",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = TRUE,
  rug = TRUE
) %>%
  ggplot_build()

global_marginal_bio15 <- SDMtune::plotResponse(
  model = global_model,
  var = "bio15",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = TRUE,
  rug = TRUE
) %>%
  ggplot_build()
           

global_marginal_bio2 <- SDMtune::plotResponse(
  model = global_model,
  var = "bio2",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = TRUE,
  rug = TRUE
) %>%
  ggplot_build()

```

```{r maximum activity- global marginal}

# peak y trendline object 
bio11_marginal_max_activity_global <- global_marginal_bio11$data[[1]][which.max(global_marginal_bio11$data[[1]]$y), ]$x

bio12_marginal_max_activity_global <- global_marginal_bio12$data[[1]][which.max(global_marginal_bio12$data[[1]]$y), ]$x

bio15_marginal_max_activity_global <- global_marginal_bio15$data[[1]][which.max(global_marginal_bio15$data[[1]]$y), ]$x

bio2_marginal_max_activity_global <- global_marginal_bio2$data[[1]][which.max(global_marginal_bio2$data[[1]]$y), ]$x

```

### plots

```{r bio11 plot- global marginal}

bio11_marginal_global <- ggplot() +
  geom_smooth(data = global_marginal_bio11$data[[1]], aes(x = x, y = y), color = "orangered2", se = FALSE, method = "gam") +
  # plot peak trendline and labels
  geom_vline(aes(xintercept = bio11_marginal_max_activity_global), color = "orangered2", linetype = "dashed", linewidth = 0.5) +
  # plot rug
  geom_rug(aes(x = global_marginal_bio11$data[[3]]$x), color = "orangered2", sides = "t") +
  # default style
  marginal_plots_style_global +
  # labels
  # labels
  labs(
    subtitle = "Bio 11 (mean temperature of the coldest quarter)",
    x = "mean temperature of the coldest quarter (C)"
    ) +
  # aesthetics
  xlim(-20, 20)

```

```{r save plot- global bio11 marginal}

ggsave(
  bio11_marginal_global, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "global_bio11_marginal_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

```{r bio12 plot- global marginal}

bio12_marginal_global <- ggplot() +
  geom_smooth(data = global_marginal_bio12$data[[1]], aes(x = x, y = y), color = "orangered2", se = FALSE, method = "gam") +
  # plot peak trendline and labels
  geom_vline(aes(xintercept = bio12_marginal_max_activity_global), color = "orangered2", linetype = "dashed", linewidth = 0.5) +
  # plot rug
  geom_rug(aes(x = global_marginal_bio12$data[[3]]$x), color = "orangered2", sides = "t") +
  # default style
  marginal_plots_style_global +
  # labels
  # labels
  labs(
    subtitle = "Bio 12 (Annual Precipitation)",
    x = "annual precipitation (mm)"
    ) +
  # aesthetics
  xlim(0, 4250)

```

```{r save plot- global bio 12 marginal}

ggsave(
  bio12_marginal_global, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "global_bio12_marginal_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

```{r bio15 plot- global marginal}

bio15_marginal_global <- ggplot() +
  geom_smooth(data = global_marginal_bio15$data[[1]], aes(x = x, y = y), color = "orangered2", se = FALSE, method = "gam") +
  # plot peak trendline and labels
  geom_vline(aes(xintercept = bio15_marginal_max_activity_global), color = "orangered2", linetype = "dashed", linewidth = 0.5) +
  # plot rug
  geom_rug(aes(x = global_marginal_bio15$data[[3]]$x), color = "orangered2", sides = "t") +
  # default style
  marginal_plots_style_global +
  # labels
  labs(
    subtitle = "Bio 15 (Precipitation Seasonality, CV)",
    x = "precipitation seasonality (%)"
    ) +
  # aesthetics
  xlim(0, 120) 

```

```{r save plot- global bio 15 marginal}

ggsave(
  bio15_marginal_global, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "global_bio15_marginal_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

```{r bio2 plot- global marginal}

bio2_marginal_global <- ggplot() +
  geom_smooth(data = global_marginal_bio2$data[[1]], aes(x = x, y = y), color = "orangered2", se = FALSE, method = "gam") +
  # plot peak trendline and labels
  geom_vline(aes(xintercept = bio2_marginal_max_activity_global), color = "orangered2", linetype = "dashed", linewidth = 0.5) +
  # plot rug
  geom_rug(aes(x = global_marginal_bio2$data[[3]]$x), color = "orangered2", sides = "t") +
  # default style
  marginal_plots_style_global +
  # labels
  labs(
    subtitle = "Bio 2 (Mean Diurnal Range)",
    x = "mean diurnal range (C)"
    ) +
  # aesthetics
  xlim(0, 15) 

```

```{r save plot- global bio 2 marginal}

ggsave(
  bio2_marginal_global, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "global_bio2_marginal_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

## Create univariate plots

```{r extract univariate plots for global model}

global_univar_bio11 <- SDMtune::plotResponse(
  model = global_model,
  var = "bio11",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = FALSE,
  rug = TRUE
) %>%
  ggplot_build()


global_univar_bio12 <- SDMtune::plotResponse(
  model = global_model,
  var = "bio12",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = FALSE,
  rug = TRUE
) %>%
  ggplot_build()

global_univar_bio15 <- SDMtune::plotResponse(
  model = global_model,
  var = "bio15",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = FALSE,
  rug = TRUE
) %>%
  ggplot_build()
           

global_univar_bio2 <- SDMtune::plotResponse(
  model = global_model,
  var = "bio2",
  type = "cloglog",
  fun = mean,
  only_presence = TRUE,
  marginal = FALSE,
  rug = TRUE
) %>%
  ggplot_build()

```

```{r maximum activity- global univar}

# peak y trendline object 
bio11_univar_max_activity_global <- global_univar_bio11$data[[1]][which.max(global_univar_bio11$data[[1]]$y), ]$x

bio12_univar_max_activity_global <- global_univar_bio12$data[[1]][which.max(global_univar_bio12$data[[1]]$y), ]$x

bio15_univar_max_activity_global <- global_univar_bio15$data[[1]][which.max(global_univar_bio15$data[[1]]$y), ]$x

bio2_univar_max_activity_global <- global_univar_bio2$data[[1]][which.max(global_univar_bio2$data[[1]]$y), ]$x

```

### plots

```{r bio11 plot- global univar}

bio11_univar_global <- ggplot() +
  geom_smooth(data = global_univar_bio11$data[[1]], aes(x = x, y = y), color = "orangered2", se = FALSE, method = "gam") +
  # plot peak trendline and labels
  geom_vline(aes(xintercept = bio11_univar_max_activity_global), color = "orangered2", linetype = "dashed", linewidth = 0.5) +
  # plot rug
  geom_rug(aes(x = global_univar_bio11$data[[3]]$x), color = "orangered2", sides = "t") +
  # default style
  univar_plots_style_global +
  # labels
  # labels
  labs(
    subtitle = "Bio 11 (mean temperature of the coldest quarter)",
    x = "mean temperature of the coldest quarter (C)"
    ) +
  # aesthetics
  xlim(-20, 20)

```

```{r save plot- global bio 11 univar}

ggsave(
  bio11_univar_global, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "global_bio11_univar_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

```{r bio12 plot- global univar}

bio12_univar_global <- ggplot() +
  geom_smooth(data = global_univar_bio12$data[[1]], aes(x = x, y = y), color = "orangered2", se = FALSE, method = "gam") +
  # plot peak trendline and labels
  geom_vline(aes(xintercept = bio12_univar_max_activity_global), color = "orangered2", linetype = "dashed", linewidth = 0.5) +
  # plot rug
  geom_rug(aes(x = global_univar_bio12$data[[3]]$x), color = "orangered2", sides = "t") +
  # default style
  univar_plots_style_global +
  # labels
  # labels
  labs(
    subtitle = "Bio 12 (Annual Precipitation)",
    x = "annual precipitation (mm)"
    ) +
  # aesthetics
  xlim(0, 4250)

```

```{r save plot- global bio 12 univar}

ggsave(
  bio12_univar_global, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "global_bio12_univar_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

```{r bio15 plot- global univar}

bio15_univar_global <- ggplot() +
  geom_smooth(data = global_univar_bio15$data[[1]], aes(x = x, y = y), color = "orangered2", se = FALSE, method = "gam") +
  # plot peak trendline and labels
  geom_vline(aes(xintercept = bio15_univar_max_activity_global), color = "orangered2", linetype = "dashed", linewidth = 0.5) +
  # plot rug
  geom_rug(aes(x = global_univar_bio15$data[[3]]$x), color = "orangered2", sides = "t") +
  # default style
  univar_plots_style_global +
  # labels
  labs(
    subtitle = "Bio 15 (Precipitation Seasonality, CV)",
    x = "precipitation seasonality (%)"
    ) +
  # aesthetics
  xlim(0, 120) 

```

```{r save plot- global bio 15 univar}

ggsave(
  bio15_univar_global, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "global_bio15_univar_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

```{r bio2 plot- global univar}

bio2_univar_global <- ggplot() +
  geom_smooth(data = global_univar_bio2$data[[1]], aes(x = x, y = y), color = "orangered2", se = FALSE, method = "gam") +
  # plot peak trendline and labels
  geom_vline(aes(xintercept = bio2_univar_max_activity_global), color = "orangered2", linetype = "dashed", linewidth = 0.5) +
  # plot rug
  geom_rug(aes(x = global_univar_bio2$data[[3]]$x), color = "orangered2", sides = "t") +
  # default style
  univar_plots_style_global +
  # labels
  labs(
    subtitle = "Bio 2 (Mean Diurnal Range)",
    x = "mean diurnal range (C)"
    ) +
  # aesthetics
  xlim(0, 15) 

```

```{r save plot- global bio 2 univar}

ggsave(
  bio2_univar_global, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "global_bio2_univar_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

# Combine ensemble and global models

## marginal response

```{r scatter style object- marginal combined}

ensemble_global_colors <- c(
  "Rn (native)" = "#4daf4a",
  "Ri.NAmerica" =  "#e41a1c",
  "Ri.Asia" = "#377eb8",
  "global" = "black"
)

marginal_plots_style <- list(
  theme_bw(),
  # labs
  labs(
    title = "Marginal response of 'regional_ensemble' and global models",
    color = "Model",
    caption = "rug plots indicate presences"
    ),
  ylab("cloglog_output"),
  # aes
  scale_color_manual(
    name = "model",
    values = ensemble_global_colors,
    aesthetics = "color"
  ),
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1), limits = c(0, 1)),
  theme(legend.position = "bottom"),
  geom_hline(aes(yintercept = 0), color = "black", linewidth = 0.5) 
)

```

## Bio 11

```{r combine plots- bio11}

bio11_marginal_combined <- ggplot() +
  # global model
  geom_smooth(data = global_marginal_bio11$data[[1]], aes(x = x, y = y, color = "global"), se = FALSE, method = "gam") +
  # native model data
  geom_smooth(data = regional_native_marginal_bio11$data[[1]], aes(x = x, y = y, color = "Rn (native)"), se = FALSE, method = "gam") +
  # invaded model data
  geom_smooth(data = regional_invaded_marginal_bio11$data[[1]], aes(x = x, y = y, color = "Ri.NAmerica"), se = FALSE, method = "gam") +
  # Ri.Asia model data
  geom_smooth(data = regional_invaded_asian_marginal_bio11$data[[1]], aes(x = x, y = y, color = "Ri.Asia"), se = FALSE, method = "gam") +
  # plot peak trendline and labels
  # global
  geom_vline(aes(xintercept = bio11_marginal_max_activity_global, color = "global"), linetype = "dashed", linewidth = 0.5) +
  # Rn (native)
  geom_vline(aes(xintercept = bio11_max_activity_values[[1]], color = "Rn (native)"), linetype = "dashed", linewidth = 0.5) +
  # invaded
  geom_vline(aes(xintercept = bio11_max_activity_values[[2]], color = "Ri.NAmerica"), linetype = "dashed", linewidth = 0.5) +
  # Ri.Asia
  geom_vline(aes(xintercept = bio11_max_activity_values[[3]], color = "Ri.Asia"), linetype = "dashed", linewidth = 0.5) +
  # plot rug plots
  # global is just all presences so it does not need a rug plot
  # Rn (native)
  geom_rug(aes(x = regional_native_marginal_bio11$data[[2]]$x, color = "Rn (native)"), sides = "t") +
  # invaded
  geom_rug(aes(x = regional_invaded_marginal_bio11$data[[2]]$x, color = "Ri.NAmerica"), sides = "t", alpha = 0.8) +
  # Ri.Asia
  geom_rug(aes(x = regional_invaded_asian_marginal_bio11$data[[2]]$x, color = "Ri.Asia"), sides = "t", alpha = 0.6) +
  # default style
  marginal_plots_style +
  # labels
  labs(
    subtitle = "Bio 11 (mean temperature of the coldest quarter)",
    x = "Bio 11: mean temperature of the coldest quarter (C)"
    ) +
  # aesthetics
  xlim(-20, 20) 
  

```

```{r save plot- bio11 combined}

ggsave(
  bio11_marginal_combined, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "regional_ensemble_global_bio11_marginal_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

## Bio 12

```{r combine plots- bio12}

bio12_marginal_combined <- ggplot() +
  # global model
  geom_smooth(data = global_marginal_bio12$data[[1]], aes(x = x, y = y, color = "global"), se = FALSE, method = "gam") +
  # Rn (native) model data
  geom_smooth(data = regional_native_marginal_bio12$data[[1]], aes(x = x, y = y, color = "Rn (native)"), se = FALSE, method = "gam") +
  # invaded model data
  geom_smooth(data = regional_invaded_marginal_bio12$data[[1]], aes(x = x, y = y, color = "Ri.NAmerica"), se = FALSE, method = "gam") +
  # Ri.Asia model data
  geom_smooth(data = regional_invaded_asian_marginal_bio12$data[[1]], aes(x = x, y = y, color = "Ri.Asia"), se = FALSE, method = "gam") +
  # plot peak trendline and labels
  # global
  geom_vline(aes(xintercept = bio12_marginal_max_activity_global, color = "global"), linetype = "dashed", linewidth = 0.5) +
  # Rn (native)
  geom_vline(aes(xintercept = bio12_max_activity_values[[1]], color = "Rn (native)"), linetype = "dashed", linewidth = 0.5) +
  # invaded
  geom_vline(aes(xintercept = bio12_max_activity_values[[2]], color = "Ri.NAmerica"), linetype = "dashed", linewidth = 0.5) +
  # Ri.Asia
  geom_vline(aes(xintercept = bio12_max_activity_values[[3]], color = "Ri.Asia"), linetype = "dashed", linewidth = 0.5) +
  # plot rug plots
  # Rn (native)
  geom_rug(aes(x = regional_native_marginal_bio12$data[[2]]$x, color = "Rn (native)"), sides = "t") +
  # invaded
  geom_rug(aes(x = regional_invaded_marginal_bio12$data[[2]]$x, color = "Ri.NAmerica"), sides = "t", alpha = 0.8) +
  # Ri.Asia
  geom_rug(aes(x = regional_invaded_asian_marginal_bio12$data[[2]]$x, color = "Ri.Asia"), sides = "t", alpha = 0.6) +
  # default style
  marginal_plots_style +
  # labels
  labs(
    subtitle = "Bio 12 (Annual Precipitation)",
    x = "Bio 12: annual precipitation (mm)"
    ) +
  # aesthetics
  xlim(0, 4250) 
  

```

```{r save plot- bio12 combined}

ggsave(
  bio12_marginal_combined, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "regional_ensemble_global_bio12_marginal_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

## Bio 15

```{r combine plots- bio15 combined}

bio15_marginal_combined <- ggplot() +
  # global model
  geom_smooth(data = global_marginal_bio15$data[[1]], aes(x = x, y = y, color = "global"), se = FALSE, method = "gam") +
  # Rn (native) model data
  geom_smooth(data = regional_native_marginal_bio15$data[[1]], aes(x = x, y = y, color = "Rn (native)"), se = FALSE, method = "gam") +
  # invaded model data
  geom_smooth(data = regional_invaded_marginal_bio15$data[[1]], aes(x = x, y = y, color = "Ri.NAmerica"), se = FALSE, method = "gam") +
  # Ri.Asia model data
  geom_smooth(data = regional_invaded_asian_marginal_bio15$data[[1]], aes(x = x, y = y, color = "Ri.Asia"), se = FALSE, method = "gam") +
  # plot peak trendline and labels
  # global
  geom_vline(aes(xintercept = bio15_marginal_max_activity_global, color = "global"), linetype = "dashed", linewidth = 0.5) +
  # Rn (native)
  geom_vline(aes(xintercept = bio15_max_activity_values[[1]], color = "Rn (native)"), linetype = "dashed", linewidth = 0.5) +
  # invaded
  geom_vline(aes(xintercept = bio15_max_activity_values[[2]], color = "Ri.NAmerica"), linetype = "dashed", linewidth = 0.5) +
  # Ri.Asia
  geom_vline(aes(xintercept = bio15_max_activity_values[[3]], color = "Ri.Asia"), linetype = "dashed", linewidth = 0.5) +
  # plot rug plots
  # Rn (native)
  geom_rug(aes(x = regional_native_marginal_bio15$data[[2]]$x, color = "Rn (native)"), sides = "t") +
  # invaded
  geom_rug(aes(x = regional_invaded_marginal_bio15$data[[2]]$x, color = "Ri.NAmerica"), sides = "t", alpha = 0.8) +
  # Ri.Asia
  geom_rug(aes(x = regional_invaded_asian_marginal_bio15$data[[2]]$x, color = "Ri.Asia"), sides = "t", alpha = 0.6) +
  # default style
  marginal_plots_style +
  # labels
  labs(
    subtitle = "Bio 15 (Precipitation Seasonality, CV)",
    x = "Bio 15: precipitation seasonality (%)"
    ) +
  # aesthetics
  xlim(0, 120) 
  

```

```{r save plot- bio15 combined}

ggsave(
  bio15_marginal_combined, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "regional_ensemble_global_bio15_marginal_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

## Bio 2

```{r combine plots- bio2}

bio2_marginal_combined <- ggplot() +
  # global model
  geom_smooth(data = global_marginal_bio2$data[[1]], aes(x = x, y = y, color = "global"), se = FALSE, method = "gam") +
  # Rn (native) model data
  geom_smooth(data = regional_native_marginal_bio2$data[[1]], aes(x = x, y = y, color = "Rn (native)"), se = FALSE, method = "gam") +
  # invaded model data
  geom_smooth(data = regional_invaded_marginal_bio2$data[[1]], aes(x = x, y = y, color = "Ri.NAmerica"), se = FALSE, method = "gam") +
  # Ri.Asia model data
  geom_smooth(data = regional_invaded_asian_marginal_bio2$data[[1]], aes(x = x, y = y, color = "Ri.Asia"), se = FALSE, method = "gam") +
  # plot peak trendline and labels
  # global
  geom_vline(aes(xintercept = bio2_marginal_max_activity_global, color = "global"), linetype = "dashed", linewidth = 0.5) +
  # Rn (native)
  geom_vline(aes(xintercept = bio2_max_activity_values[[1]], color = "Rn (native)"), linetype = "dashed", linewidth = 0.5) +
  # invaded
  geom_vline(aes(xintercept = bio2_max_activity_values[[2]], color = "Ri.NAmerica"), linetype = "dashed", linewidth = 0.5) +
  # Ri.Asia
  geom_vline(aes(xintercept = bio2_max_activity_values[[3]], color = "Ri.Asia"), linetype = "dashed", linewidth = 0.5) +
  # plot rug plots
  # Rn (native)
  geom_rug(aes(x = regional_native_marginal_bio2$data[[2]]$x, color = "Rn (native)"), sides = "t") +
  # invaded
  geom_rug(aes(x = regional_invaded_marginal_bio2$data[[2]]$x, color = "Ri.NAmerica"), sides = "t", alpha = 0.8) +
  # Ri.Asia
  geom_rug(aes(x = regional_invaded_asian_marginal_bio2$data[[2]]$x, color = "Ri.Asia"), sides = "t", alpha = 0.6) +
  # default style
  marginal_plots_style +
  # labels
  labs(
    subtitle = "Bio 2 (Mean Diurnal Range)",
    x = "Bio 2: mean diurnal range (C)"
    ) +
  # aesthetics
  xlim(0, 15) 
  

```

```{r save plot- bio2 combined}

ggsave(
  bio2_marginal_combined, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "regional_ensemble_global_bio2_marginal_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

```{r save figure objects- marg}
# bio 11
write_rds(
  bio11_marginal_combined,
  file = file.path(here::here(), "vignette-outputs", "figures", "figures-rds", "regional_ensemble_global_bio11_marginal_resp_curve_cloglog.rds")
)
# bio 12
write_rds(
  bio12_marginal_combined,
  file = file.path(here::here(), "vignette-outputs", "figures", "figures-rds", "regional_ensemble_global_bio12_marginal_resp_curve_cloglog.rds")
)
# bio 15
write_rds(
  bio15_marginal_combined,
  file = file.path(here::here(), "vignette-outputs", "figures", "figures-rds", "regional_ensemble_global_bio15_marginal_resp_curve_cloglog.rds")
)
# bio 2
write_rds(
  bio2_marginal_combined,
  file = file.path(here::here(), "vignette-outputs", "figures", "figures-rds", "regional_ensemble_global_bio2_marginal_resp_curve_cloglog.rds")
)

```

# create univariate response curves

```{r scatter style object- univar combined}

ensemble_colors <- c(
  "Rn (native)" = "#4daf4a",
  "Ri.NAmerica" =  "#e41a1c",
  "Ri.Asia" = "#377eb8",
  "global" = "black"
)

univar_plots_style <- list(
  theme_bw(),
  # labs
  labs(
    title = "Univariate response in 'regional_ensemble' and 'global' models",
    color = "Model",
    caption = "rug plots indicate presences"
    ),
  ylab("cloglog_output"),
  # aes
  scale_color_manual(
    name = "model",
    values = ensemble_colors,
    aesthetics = "color"
  ),
  scale_y_continuous(breaks = c(0, 0.25, 0.5, 0.75, 1), limits = c(0, 1)),
  theme(legend.position = "bottom"),
  geom_hline(aes(yintercept = 0), color = "black", linewidth = 0.5) 
)

```

## Bio 11

```{r combine plots- bio 11 univar combined}

bio11_univar_combined <- ggplot() +
  # global
  geom_smooth(data = global_univar_bio11$data[[1]], aes(x = x, y = y, color = "global"), se = FALSE, method = "gam") +
  # Rn (native) model data
  geom_smooth(data = regional_native_univar_bio11$data[[1]], aes(x = x, y = y, color = "Rn (native)"), se = FALSE, method = "gam") +
  # invaded model data
  geom_smooth(data = regional_invaded_univar_bio11$data[[1]], aes(x = x, y = y, color = "Ri.NAmerica"), se = FALSE, method = "gam") +
  # Ri.Asia model data
  geom_smooth(data = regional_invaded_asian_univar_bio11$data[[1]], aes(x = x, y = y, color = "Ri.Asia"), se = FALSE, method = "gam") +
  # plot peak trendline and labels
  # global
   geom_vline(aes(xintercept = bio11_univar_max_activity_global, color = "global"), linetype = "dashed", linewidth = 0.5) +
  # Rn (native)
  geom_vline(aes(xintercept = bio11_univar_max_activity_values[[1]], color = "Rn (native)"), linetype = "dashed", linewidth = 0.5) +
  # invaded
  geom_vline(aes(xintercept = bio11_univar_max_activity_values[[2]], color = "Ri.NAmerica"), linetype = "dashed", linewidth = 0.5) +
  # Ri.Asia
  geom_vline(aes(xintercept = bio11_univar_max_activity_values[[3]], color = "Ri.Asia"), linetype = "dashed", linewidth = 0.5) +
  # plot rug plots
  # Rn (native)
  geom_rug(aes(x = regional_native_univar_bio11$data[[2]]$x, color = "Rn (native)"), sides = "t") +
  # invaded
  geom_rug(aes(x = regional_invaded_univar_bio11$data[[2]]$x, color = "Ri.NAmerica"), sides = "t", alpha = 0.8) +
  # Ri.Asia
  geom_rug(aes(x = regional_invaded_asian_univar_bio11$data[[2]]$x, color = "Ri.Asia"), sides = "t", alpha = 0.6) +
  # default style
  univar_plots_style +
  # labels
  labs(
    subtitle = "Bio 11 (mean temperature of the coldest quarter)",
    x = "Bio 11: mean temperature of the coldest quarter (C)"
    ) +
  # aesthetics
  xlim(-20, 20) 
  

```

```{r save plot- bio 11 univar combined}

ggsave(
  bio11_univar_combined, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "regional_ensemble_global_bio11_univar_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

## Bio 12

```{r combine plots- bio 12 univar combined}

bio12_univar_combined <- ggplot() +
  # global
  geom_smooth(data = global_univar_bio12$data[[1]], aes(x = x, y = y, color = "global"), se = FALSE, method = "gam") +
  # Rn (native) model data
  geom_smooth(data = regional_native_univar_bio12$data[[1]], aes(x = x, y = y, color = "Rn (native)"), se = FALSE, method = "gam") +
  # invaded model data
  geom_smooth(data = regional_invaded_univar_bio12$data[[1]], aes(x = x, y = y, color = "Ri.NAmerica"), se = FALSE, method = "gam") +
  # Ri.Asia model data
  geom_smooth(data = regional_invaded_asian_univar_bio12$data[[1]], aes(x = x, y = y, color = "Ri.Asia"), se = FALSE, method = "gam") +
  # plot peak trendline and labels
  # global
  geom_vline(aes(xintercept = bio12_univar_max_activity_global, color = "global"), linetype = "dashed", linewidth = 0.5) +
  # Rn (native)
  geom_vline(aes(xintercept = bio12_univar_max_activity_values[[1]], color = "Rn (native)"), linetype = "dashed", linewidth = 0.5) +
  # invaded
  geom_vline(aes(xintercept = bio12_univar_max_activity_values[[2]], color = "Ri.NAmerica"), linetype = "dashed", linewidth = 0.5) +
  # Ri.Asia
  geom_vline(aes(xintercept = bio12_univar_max_activity_values[[3]], color = "Ri.Asia"), linetype = "dashed", linewidth = 0.5) +
  # plot rug plots
  # Rn (native)
  geom_rug(aes(x = regional_native_univar_bio12$data[[2]]$x, color = "Rn (native)"), sides = "t") +
  # invaded
  geom_rug(aes(x = regional_invaded_univar_bio12$data[[2]]$x, color = "Ri.NAmerica"), sides = "t", alpha = 0.8) +
  # Ri.Asia
  geom_rug(aes(x = regional_invaded_asian_univar_bio12$data[[2]]$x, color = "Ri.Asia"), sides = "t", alpha = 0.6) +
  # default style
  univar_plots_style +
  # labels
  labs(
    subtitle = "Bio 12 (Annual Precipitation)",
    x = "Bio 12: annual precipitation (mm)"
    ) +
  # aesthetics
  xlim(0, 4250) 
  

```

```{r save plot- bio 12 univar combined}

ggsave(
  bio12_univar_combined, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "regional_ensemble_global_bio12_univar_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

## Bio 15

```{r combine plots- bio 15 univar combined}

bio15_univar_combined <- ggplot() +
  # global
  geom_smooth(data = global_univar_bio15$data[[1]], aes(x = x, y = y, color = "global"), se = FALSE, method = "gam") +
  # native model data
  geom_smooth(data = regional_native_univar_bio15$data[[1]], aes(x = x, y = y, color = "Rn (native)"), se = FALSE, method = "gam") +
  # invaded model data
  geom_smooth(data = regional_invaded_univar_bio15$data[[1]], aes(x = x, y = y, color = "Ri.NAmerica"), se = FALSE, method = "gam") +
  # Ri.Asia model data
  geom_smooth(data = regional_invaded_asian_univar_bio15$data[[1]], aes(x = x, y = y, color = "Ri.Asia"), se = FALSE, method = "gam") +
  # plot peak trendline and labels
  # global
  geom_vline(aes(xintercept = bio15_univar_max_activity_global, color = "global"), linetype = "dashed", linewidth = 0.5) +
  # Rn (native)
  geom_vline(aes(xintercept = bio15_univar_max_activity_values[[1]], color = "Rn (native)"), linetype = "dashed", linewidth = 0.5) +
  # invaded
  geom_vline(aes(xintercept = bio15_univar_max_activity_values[[2]], color = "Ri.NAmerica"), linetype = "dashed", linewidth = 0.5) +
  # Ri.Asia
  geom_vline(aes(xintercept = bio15_univar_max_activity_values[[3]], color = "Ri.Asia"), linetype = "dashed", linewidth = 0.5) +
  # plot rug plots
  # Rn (native)
  geom_rug(aes(x = regional_native_univar_bio15$data[[2]]$x, color = "Rn (native)"), sides = "t") +
  # invaded
  geom_rug(aes(x = regional_invaded_univar_bio15$data[[2]]$x, color = "Ri.NAmerica"), sides = "t", alpha = 0.8) +
  # Ri.Asia
  geom_rug(aes(x = regional_invaded_asian_univar_bio15$data[[2]]$x, color = "Ri.Asia"), sides = "t", alpha = 0.6) +
  # default style
  univar_plots_style +
  # labels
  labs(
    subtitle = "Bio 15 (Precipitation Seasonality, CV)",
    x = "Bio 15: precipitation seasonality (%)"
    ) +
  # aesthetics
  xlim(0, 120) 
  

```

```{r save plot- bio 15 univar combined}

ggsave(
  bio15_univar_combined, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "regional_ensemble_global_bio15_univar_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

## Bio 2

```{r combine plots- bio 2 univar combined}

bio2_univar_combined <- ggplot() +
  # global
  geom_smooth(data = global_univar_bio2$data[[1]], aes(x = x, y = y, color = "global"), se = FALSE, method = "gam") +
  # Rn (native) model data
  geom_smooth(data = regional_native_univar_bio2$data[[1]], aes(x = x, y = y, color = "Rn (native)"), se = FALSE, method = "gam") +
  # invaded model data
  geom_smooth(data = regional_invaded_univar_bio2$data[[1]], aes(x = x, y = y, color = "Ri.NAmerica"), se = FALSE, method = "gam") +
  # Ri.Asia model data
  geom_smooth(data = regional_invaded_asian_univar_bio2$data[[1]], aes(x = x, y = y, color = "Ri.Asia"), se = FALSE, method = "gam") +
  # plot peak trendline and labels
  # global
  geom_vline(aes(xintercept = bio15_univar_max_activity_global, color = "global"), linetype = "dashed", linewidth = 0.5) +
  # Rn (native)
  geom_vline(aes(xintercept = bio2_univar_max_activity_values[[1]], color = "Rn (native)"), linetype = "dashed", linewidth = 0.5) +
  # invaded
  geom_vline(aes(xintercept = bio2_univar_max_activity_values[[2]], color = "Ri.NAmerica"), linetype = "dashed", linewidth = 0.5) +
  # Ri.Asia
  geom_vline(aes(xintercept = bio2_univar_max_activity_values[[3]], color = "Ri.Asia"), linetype = "dashed", linewidth = 0.5) +
  # plot rug plots
  # Rn (native)
  geom_rug(aes(x = regional_native_univar_bio2$data[[2]]$x, color = "Rn (native)"), sides = "t") +
  # invaded
  geom_rug(aes(x = regional_invaded_univar_bio2$data[[2]]$x, color = "Ri.NAmerica"), sides = "t", alpha = 0.8) +
  # Ri.Asia
  geom_rug(aes(x = regional_invaded_asian_univar_bio2$data[[2]]$x, color = "Ri.Asia"), sides = "t", alpha = 0.6) +
  # default style
  univar_plots_style +
  # labels
  labs(
    subtitle = "Bio 2 (Mean Diurnal Range)",
    x = "Bio 2: mean diurnal range (C)"
    ) +
  # aesthetics
  xlim(0, 15) 
  

```

```{r save plot- bio 2 univar combined}

ggsave(
  bio2_univar_combined, 
  filename = file.path(
    here::here(), "vignette-outputs", "figures", "regional_ensemble_global_bio2_univar_resp_curve_cloglog.jpg"
    ),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

```{r save figure objects- univar combined}
# bio 11
write_rds(
  bio11_univar_combined,
  file = file.path(here::here(), "vignette-outputs", "figures", "figures-rds", "regional_ensemble_global_bio11_univar_resp_curve_cloglog.rds")
)
# bio 12
write_rds(
  bio12_univar_combined,
  file = file.path(here::here(), "vignette-outputs", "figures", "figures-rds", "regional_ensemble_global_bio12_univar_resp_curve_cloglog.rds")
)
# bio 15
write_rds(
  bio15_univar_combined,
  file = file.path(here::here(), "vignette-outputs", "figures", "figures-rds", "regional_ensemble_global_bio15_univar_resp_curve_cloglog.rds")
)
# bio 2
write_rds(
  bio2_univar_combined,
  file = file.path(here::here(), "vignette-outputs", "figures", "figures-rds", "regional_ensemble_global_bio2_univar_resp_curve_cloglog.rds")
)

```

# Patchwork together plots

## univariate response curves

```{r re-load objects- univar}
# bio 11
bio11_univar_combined <- read_rds(file = file.path(here::here(), "vignette-outputs", "figures", "figures-rds", "regional_ensemble_global_bio11_univar_resp_curve_cloglog.rds")
)
# bio 12
bio12_univar_combined <- read_rds(file = file.path(here::here(), "vignette-outputs", "figures", "figures-rds", "regional_ensemble_global_bio12_univar_resp_curve_cloglog.rds")
)
# bio 15
bio15_univar_combined <- read_rds(file = file.path(here::here(), "vignette-outputs", "figures", "figures-rds", "regional_ensemble_global_bio15_univar_resp_curve_cloglog.rds")
)
# bio 2
bio2_univar_combined <- read_rds(file = file.path(here::here(), "vignette-outputs", "figures", "figures-rds", "regional_ensemble_global_bio2_univar_resp_curve_cloglog.rds")
)

```

```{r univariate}


bio2_univar_combined  <- bio2_univar_combined +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.9),
    plot.tag = element_text(face = "bold", size = 25)
    ) +
  labs(tag = "A") 



bio11_univar_combined <- bio11_univar_combined + 
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.9),
    plot.tag = element_text(face = "bold", size = 25)
    ) +
  labs(tag = "B") 



bio12_univar_combined <- bio12_univar_combined + 
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.9),
    plot.tag = element_text(face = "bold", size = 25)
    ) +
  labs(tag = "C") 


  
bio15_univar_combined <- bio15_univar_combined + 
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.9),
    plot.tag = element_text(face = "bold", size = 25)
    ) +
  labs(tag = "D") 




univar_combined_patchwork <- (bio2_univar_combined + bio11_univar_combined + bio12_univar_combined + bio15_univar_combined) +
  plot_annotation(title = "Univariate response of 'regional_ensemble' and 'global' models") +
  plot_layout(axes = "collect_y", axis_titles = "collect_y", guides = "collect") & # collect y axis and legends
  theme(legend.position = "bottom") 

```

```{r save plot- univar patchwork main}

ggsave(
  univar_combined_patchwork, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "regional_ensemble_global_combined_univar_resp_curve_cloglog.jpg"),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

```{r patchwork in halves- pt 1}

univar_combined_patchwork_pt1 <- (bio2_univar_combined + bio11_univar_combined) +
  plot_annotation(title = "Univariate response of 'regional_ensemble' and 'global' models") +
  plot_layout(axes = "collect_y", axis_titles = "collect_y", guides = "collect", nrow = 2) & # collect y axis and legends
  theme(legend.position = "bottom") 

# save
ggsave(
  univar_combined_patchwork_pt1, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "regional_ensemble_global_combined_univar_resp_curve_cloglog_half1.jpg"),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

```{r patchwork in halves- pt 2}

univar_combined_patchwork_pt2 <- (bio12_univar_combined + bio15_univar_combined) +
  plot_annotation(title = "Univariate response of 'regional_ensemble' and 'global' models") +
  plot_layout(axes = "collect_y", axis_titles = "collect_y", guides = "collect", nrow = 2) & # collect y axis and legends
  theme(legend.position = "bottom") 

# save
ggsave(
  univar_combined_patchwork_pt2, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "regional_ensemble_global_combined_univar_resp_curve_cloglog_half2.jpg"),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

```{r univariate main paper}


bio11_univar_combined <- bio11_univar_combined + 
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    ) +
  labs(tag = "A") 



bio15_univar_combined  <- bio15_univar_combined +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    ) +
  labs(tag = "B")  




univar_combined_patchwork_main <- (bio11_univar_combined / bio15_univar_combined) +
  plot_annotation(title = "Univariate response of 'regional_ensemble' and 'global' models") +
  plot_layout(axes = "collect_y", axis_titles = "collect_y", guides = "collect") & # collect y axis and legends
  theme(legend.position = "bottom")

```

```{r save plot- univar patchwork main2}

ggsave(
  univar_combined_patchwork_main, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "regional_ensemble_global_combined_univar_resp_curve_cloglog_main.jpg"),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

```{r univariate supp materials}


bio12_univar_combined <- bio12_univar_combined + 
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    ) +
  labs(tag = "A") 



bio2_univar_combined  <- bio2_univar_combined +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    ) +
  labs(tag = "B") 




univar_combined_patchwork_supp <- (bio12_univar_combined / bio2_univar_combined) +
  plot_annotation(title = "Univariate response of 'regional_ensemble' and 'global' models") +
  plot_layout(axes = "collect_y", axis_titles = "collect_y", guides = "collect") & # collect y axis and legends
  theme(legend.position = "bottom")

```

```{r save plot- univar patchwork supp}

ggsave(
  univar_combined_patchwork_supp, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "regional_ensemble_global_combined_univar_resp_curve_cloglog_supp.jpg"),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

## marginal

```{r re-load objects- marginal}
# bio 11
bio11_marginal_combined <- read_rds(file = file.path(here::here(), "vignette-outputs", "figures", "figures-rds", "regional_ensemble_global_bio11_marginal_resp_curve_cloglog.rds")
)
# bio 12
bio12_marginal_combined <- read_rds(file = file.path(here::here(), "vignette-outputs", "figures", "figures-rds", "regional_ensemble_global_bio12_marginal_resp_curve_cloglog.rds")
)
# bio 15
bio15_marginal_combined <- read_rds(file = file.path(here::here(), "vignette-outputs", "figures", "figures-rds", "regional_ensemble_global_bio15_marginal_resp_curve_cloglog.rds")
)
# bio 2
bio2_marginal_combined <- read_rds(file = file.path(here::here(), "vignette-outputs", "figures", "figures-rds", "regional_ensemble_global_bio2_marginal_resp_curve_cloglog.rds")
)

```

```{r marginal patchwork}

bio11_marginal_combined <- bio11_marginal_combined + 
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.9),
    plot.tag = element_text(face = "bold")
    ) +
  labs(tag = "A") 



bio12_marginal_combined <- bio12_marginal_combined + 
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.9),
    plot.tag = element_text(face = "bold")
    ) +
  labs(tag = "B") 


  
bio15_marginal_combined <- bio15_marginal_combined + 
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.9),
    plot.tag = element_text(face = "bold")
    ) +
  labs(tag = "C") 


bio2_marginal_combined  <- bio2_marginal_combined +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    plot.tag.location = "panel",
    plot.tag.position = c(0.05, 0.9),
    plot.tag = element_text(face = "bold")
    ) +
  labs(tag = "D") 




marginal_combined_patchwork <- (bio11_marginal_combined + bio12_marginal_combined + bio15_marginal_combined + bio2_marginal_combined) +
  plot_annotation(title = "Marginal response of 'regional_ensemble' and 'global' models") +
  plot_layout(axes = "collect_y", axis_titles = "collect_y", guides = "collect") & # collect y axis and legends
  theme(legend.position = "bottom")

```

```{r save plot- marginal patchwork}

ggsave(
  marginal_combined_patchwork, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "regional_ensemble_global_combined_marginal_resp_curve_cloglog.jpg"),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

# References

1. Elith, J., Kearney, M., & Phillips, S. (2010). The art of modelling range-shifting species. Methods in Ecology and Evolution, 1(4), 330–342. https://doi.org/10.1111/j.2041-210X.2010.00036.x
