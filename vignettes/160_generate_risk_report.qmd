---
title: "Example usage of create_risk_report.R to create reports of key viticultural areas"
author: "Samuel M. Owens"
contact: "sam.owens@temple.edu"
date: "2024-05-13"
format: html
editor: visual
---

INTRO

# Setup

```{r library}

library(tidyverse)
library(cli)
library(here)

# spatial data
library(terra)
library(rnaturalearth)
# remotes::install_github("ropensci/rnaturalearthhires")
library(rnaturalearthhires)
# remotes::install_github("ropensci/scrubr")
library(scrubr)

# aesthetics
library(kableExtra)
library(formattable)
library(webshot2)
# devtools::install_github("eliocamp/ggnewscale")
library(ggnewscale)

# for analysis
library(patchwork)
#install.packages("gginnards")
library(gginnards)

```

# Create internal dataset for function

```{r datasets for function data import}

# .csv files
threshold_exponential_values <- read.csv(file = file.path(here::here(), "data-raw", "threshold_exponential_values.csv"))
# .rds files
IVR_locations <- readr::read_rds(file = file.path(here::here(), "data", "wineries_tidied.rds"))
summary_global <- readr::read_rds(file = file.path(here::here(), "data", "global_summary_all_iterations_v2.rds"))
summary_regional_ensemble <- readr::read_rds(file = file.path(here::here(), "data", "ensemble_threshold_values.rds"))
# predicted xy suitability
xy_global_1995 <- readr::read_rds(file = file.path(here::here(), "data", "global_wineries_1981-2010_xy_pred_suit.rds"))
xy_global_2055 <- readr::read_rds(file = file.path(here::here(), "data", "global_wineries_2041-2070_GFDL_ssp370_xy_pred_suit.rds"))
xy_regional_ensemble_1995 <- readr::read_rds(file = file.path(here::here(), "data", "regional_ensemble_wineries_1981-2010_xy_pred_suit.rds"))
xy_regional_ensemble_2055 <- readr::read_rds(file = file.path(here::here(), "data", "regional_ensemble_wineries_2041-2070_GFDL_ssp370_xy_pred_suit.rds"))

```

```{r internal data object}

# transform all data frames to internal dataset
usethis::use_data(
  threshold_exponential_values, IVR_locations, summary_global, summary_regional_ensemble, xy_global_1995, xy_global_2055, xy_regional_ensemble_1995, xy_regional_ensemble_2055,
  internal = TRUE,
  overwrite = FALSE
)

```

# Apply function

## USA

```{r USA reports}

slfSpread::create_risk_report(
  locality.iso = "usa",
  locality.name = "united states",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "USA"),
  create.dir = FALSE,
  save.report = TRUE
)

# try state level
slfSpread::create_risk_report(
  locality.iso = "usa",
  locality.name = "california",
  locality.type = "states_provinces",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "USA"),
  create.dir = FALSE,
  save.report = TRUE
)

slfSpread::create_risk_report(
  locality.iso = "usa",
  locality.name = "pennsylvania",
  locality.type = "states_provinces",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "USA"),
  create.dir = FALSE,
  save.report = TRUE
)

```

```{r edit USA reports}

### USA
# the USA map usually comes including Alaska and hawaii, which we do not want

USA_current <- united_states_slf_risk_report[["risk_maps"]][["current_risk_map"]] +
  xlim(-125, -65) +
  ylim(25, 50)

USA_future <- united_states_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  xlim(-125, -65) +
  ylim(25, 50)

USA_shift <- united_states_slf_risk_report[["range_shift_map"]] +
  xlim(-125, -65) +
  ylim(25, 50)


#save
ggsave(
  USA_current,
  filename = file.path(here::here(), "vignette-outputs", "reports", "USA", "united_states__risk_map_present_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  USA_future,
  filename = file.path(here::here(), "vignette-outputs", "reports", "USA", "united_states_risk_map_2055_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  USA_shift,
  filename = file.path(here::here(), "vignette-outputs", "reports", "USA", "united_states_shift_map_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

```

## China

```{r china}

slfSpread::create_risk_report(
  locality.iso = "chn", 
  locality.name = "china",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "china"),
  create.dir = FALSE,
  save.report = TRUE
)

# this report should have 2 IVR points
slfSpread::create_risk_report(
  locality.iso = "chn",
  locality.name = "shandong",
  locality.type = "states_provinces",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "china"),
  create.dir = FALSE,
  save.report = TRUE
)

# this report should have no IVR records
slfSpread::create_risk_report(
  locality.iso = "chn",
  locality.name = "yunnan",
  locality.type = "states_provinces",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "china"),
  create.dir = FALSE,
  save.report = TRUE
)
# it worked still so thats good

```

# Viticultural shifts due to climate change

Morales-Castilla et al 2020 predicted that the following areas would experience a loss in suitability for viticulture under a 4C warming scenario of climate change:

highest losses: \* Italy \* Spain

others: \* Turkey \* South Africa \* Portugal \* mexico

Concurrently, they predicted that the following areas would experience a gain in suitability under the same scenario:

-   Pacific Northwestern States (USA)
-   New Zealand
-   Great Britain
-   Ireland
-   Sweden

Finally, some countries are expected to experience a more balanced ratio of losses and gains in suitability:

-   France

Another paper, Webb et al 2013 predicted analogous climates for specific Vitis cultivars under climate change. This paper focused more on predicting where specific cultivars might move as growers keep pace with climate change. Based on predicted climate shifts in temperature and precipitation, this study predicts that the following areas will be generally less suitable for Vitis cultivars in the future:

-   Central valley, California, USA
-   Hotter parts of Australia

Meanwhile, the following areas may increase in suitabiliy due to warming winter temperature minimums:

-   Michigan, USA
-   New Zealand

## Countries experiencing a loss in viticultural suitability

```{r countries experiencing a loss of Vitis suitability}

# spain
slfSpread::create_risk_report(
  locality.iso = "esp",
  locality.name = "spain",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "spain"),
  create.dir = FALSE,
  save.report = TRUE
)

# italy
slfSpread::create_risk_report(
  locality.iso = "ita",
  locality.name = "italy",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "italy"),
  create.dir = FALSE,
  save.report = TRUE
)

# portugal
slfSpread::create_risk_report(
  locality.iso = "prt",
  locality.name = "portugal",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "portugal"),
  create.dir = FALSE,
  save.report = TRUE
)

# türkiye
slfSpread::create_risk_report(
  locality.iso = "tur",
  locality.name = "türkiye",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "türkiye"),
  create.dir = TRUE,
  save.report = TRUE
)


# south africa
slfSpread::create_risk_report(
  locality.iso = "zaf",
  locality.name =  "south africa",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "south_africa"),
  create.dir = FALSE,
  save.report = TRUE
)

# mexico
slfSpread::create_risk_report(
  locality.iso = "mex",
  locality.name = "mexico",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "mexico"),
  create.dir = FALSE,
  save.report = TRUE
)


```

```{r edit spain maps}

# the spain report came out with the the maps needing some work.
# The map is zoomed very far out because of some territories belonging to spain.
# I will try to limiting the x and y coordinates of the plot to zoom in.

spain_current <- spain_slf_risk_report[["risk_maps"]][["current_risk_map"]] +
  xlim(-10, 5) +
  ylim(35, 44)

spain_future <- spain_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  xlim(-10, 5) +
  ylim(35, 44)

spain_shift <- spain_slf_risk_report[["range_shift_map"]] +
  xlim(-10, 5) +
  ylim(35, 44)


#save
ggsave(
  spain_current,
  filename = file.path(here::here(), "vignette-outputs", "reports", "spain", "Spain_risk_map_present_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  spain_future,
  filename = file.path(here::here(), "vignette-outputs", "reports", "spain", "Spain_risk_map_2055_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  spain_shift,
  filename = file.path(here::here(), "vignette-outputs", "reports", "spain", "Spain_range_shift_map_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

# the canary islands also have a number of vineyards so I will create maps of just those
canary_current <- spain_slf_risk_report[["risk_maps"]][["current_risk_map"]] +
  xlim(-19, -13) +
  ylim(27, 30) +
  labs(subtitle = "Spain: canary islands")

canary_future <- spain_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  xlim(-19, -13) +
  ylim(27, 30) +
  labs(subtitle = "Spain: canary islands")

canary_shift <- spain_slf_risk_report[["range_shift_map"]] +
  xlim(-19, -13) +
  ylim(27, 30) +
  labs(subtitle = "Spain: canary islands")


#save
ggsave(
  canary_current,
  filename = file.path(here::here(), "vignette-outputs", "reports", "spain", "canary_islands_risk_map_present_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  canary_future,
  filename = file.path(here::here(), "vignette-outputs", "reports", "spain", "canary_islands_risk_map_2055_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  canary_shift,
  filename = file.path(here::here(), "vignette-outputs", "reports", "spain", "canary_islands_range_shift_map_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)


```

```{r edit portugal maps}

# the spain report came out with the the maps needing some work.
# The map is zoomed very far out because of some territories belonging to spain.
# I will try to limiting the x and y coordinates of the plot to zoom in.

portugal_current <- portugal_slf_risk_report[["risk_maps"]][["current_risk_map"]] +
  xlim(-18, -6) +
  ylim(32, 42)

portugal_future <- portugal_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  xlim(-18, -6) +
  ylim(32, 42)

portugal_shift <- portugal_slf_risk_report[["range_shift_map"]] +
  xlim(-18, -6) +
  ylim(32, 42)


#save
ggsave(
  portugal_current,
  filename = file.path(here::here(), "vignette-outputs", "reports", "portugal", "portugal_risk_map_present_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  portugal_future,
  filename = file.path(here::here(), "vignette-outputs", "reports", "portugal", "portugal_risk_map_2055_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  portugal_shift,
  filename = file.path(here::here(), "vignette-outputs", "reports", "portugal", "portugal_range_shift_map_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

```

```{r edit south_africa maps}

# the spain report came out with the the maps needing some work.
# The map is zoomed very far out because of some territories belonging to spain.
# I will try to limiting the x and y coordinates of the plot to zoom in.

south_africa_current <- south_africa_slf_risk_report[["risk_maps"]][["current_risk_map"]] +
  xlim(15, 35) +
  ylim(-35, -22)

south_africa_future <- south_africa_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  xlim(15, 35) +
  ylim(-35, -22)

south_africa_shift <- south_africa_slf_risk_report[["range_shift_map"]] +
  xlim(15, 35) +
  ylim(-35, -22)


#save
ggsave(
  south_africa_current,
  filename = file.path(here::here(), "vignette-outputs", "reports", "south_africa", "south_africa_risk_map_present_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  south_africa_future,
  filename = file.path(here::here(), "vignette-outputs", "reports", "south_africa", "south_africa_risk_map_2055_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  south_africa_shift,
  filename = file.path(here::here(), "vignette-outputs", "reports", "south_africa", "south_africa_range_shift_map_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

```

## Countries experiencing a gain in viticultural suitability

```{r countries with a gain in vitis suitability}

# united kingdom
slfSpread::create_risk_report(
  locality.iso = "gbr",
  locality.name = "united kingdom",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "UK"),
  create.dir = FALSE,
  save.report = TRUE
)

# Ireland
slfSpread::create_risk_report(
  locality.iso = "irl",
  locality.name = "Ireland",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "Ireland"),
  create.dir = FALSE,
  save.report = TRUE
)

# New zealand
slfSpread::create_risk_report(
  locality.iso = "nzl",
  locality.name = "new zealand",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "new_zealand"),
  create.dir = FALSE,
  save.report = TRUE
)

# sweden
slfSpread::create_risk_report(
  locality.iso = "swe",
  locality.name = "sweden",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "sweden"),
  create.dir = FALSE,
  save.report = TRUE
)

```

```{r states with projected increase in viticultural suitability}

# michigan
slfSpread::create_risk_report(
  locality.iso = "usa",
  locality.name = "michigan",
  locality.type = "states_provinces",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "USA"),
  create.dir = FALSE,
  save.report = TRUE
)

# oregon
slfSpread::create_risk_report(
  locality.iso = "usa",
  locality.name = "oregon",
  locality.type = "states_provinces",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "USA"),
  create.dir = FALSE,
  save.report = TRUE
)

# washington
slfSpread::create_risk_report(
  locality.iso = "usa",
  locality.name = "washington",
  locality.type = "states_provinces",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "USA"),
  create.dir = FALSE,
  save.report = TRUE
)

# tasmania
slfSpread::create_risk_report(
  locality.iso = "aus",
  locality.name = "tasmania",
  locality.type = "states_provinces",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "australia"),
  create.dir = FALSE,
  save.report = TRUE
)



```

```{r edit new_zealand maps}

# the spain report came out with the the maps needing some work.
# The map is zoomed very far out because of some territories belonging to spain.
# I will try to limiting the x and y coordinates of the plot to zoom in.

new_zealand_current <- new_zealand_slf_risk_report[["risk_maps"]][["current_risk_map"]] +
  xlim(165, 180) +
  ylim(-48, -34)

new_zealand_future <- new_zealand_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  xlim(165, 180) +
  ylim(-48, -34)

new_zealand_shift <- new_zealand_slf_risk_report[["range_shift_map"]] +
  xlim(165, 180) +
  ylim(-48, -34)


#save
ggsave(
  new_zealand_current,
  filename = file.path(here::here(), "vignette-outputs", "reports", "new_zealand", "new_zealand_risk_map_present_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  new_zealand_future,
  filename = file.path(here::here(), "vignette-outputs", "reports", "new_zealand", "new_zealand_risk_map_2055_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  new_zealand_shift,
  filename = file.path(here::here(), "vignette-outputs", "reports", "new_zealand", "new_zealand_range_shift_map_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

```

## other countries of interest

```{r countries of interest}

# countries of interest
# chile
slfSpread::create_risk_report(
  locality.iso = "chl",
  locality.name = "chile",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "chile"),
  create.dir = TRUE,
  save.report = TRUE
)

# australia
slfSpread::create_risk_report(
  locality.iso = "aus",
  locality.name = "australia",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "australia"),
  create.dir = FALSE,
  save.report = TRUE
)

# romania
slfSpread::create_risk_report(
  locality.iso = "rou",
  locality.name = "romania",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "romania"),
  create.dir = FALSE,
  save.report = TRUE
)

# argentina
slfSpread::create_risk_report(
  locality.iso = "arg",
  locality.name = "argentina",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "argentina"),
  create.dir = TRUE,
  save.report = TRUE
)

# georgia
slfSpread::create_risk_report(
  locality.iso = "geo",
  locality.name = "georgia",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "georgia"),
  create.dir = FALSE,
  save.report = TRUE
)

# russia
slfSpread::create_risk_report(
  locality.iso = "rus",
  locality.name = "russia",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "russia"),
  create.dir = TRUE,
  save.report = TRUE
)
# no shapefile data exist


```

```{r edit australia maps}

australia_current <- australia_slf_risk_report[["risk_maps"]][["current_risk_map"]] +
  xlim(110, 155) +
  ylim(-44, -10)

australia_future <- australia_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  xlim(110, 155) +
  ylim(-44, -10)

australia_shift <- australia_slf_risk_report[["range_shift_map"]] +
  xlim(110, 155) +
  ylim(-44, -10)


#save
ggsave(
  australia_current,
  filename = file.path(here::here(), "vignette-outputs", "reports", "australia", "australia_risk_map_present_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  australia_future,
  filename = file.path(here::here(), "vignette-outputs", "reports", "australia", "australia_risk_map_2055_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  australia_shift,
  filename = file.path(here::here(), "vignette-outputs", "reports", "australia", "australia_range_shift_map_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

```

```{r edit russia maps}

russia_current <- russia_slf_risk_report[["risk_maps"]][["current_risk_map"]] +
  xlim(20, 180) 

russia_future <- russia_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  xlim(20, 180) 

russia_shift <- russia_slf_risk_report[["range_shift_map"]] +
  xlim(20, 180) 


#save
ggsave(
  russia_current,
  filename = file.path(here::here(), "vignette-outputs", "reports", "russia", "russia_risk_map_present_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  russia_future,
  filename = file.path(here::here(), "vignette-outputs", "reports", "russia", "russia_risk_map_2055_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  russia_shift,
  filename = file.path(here::here(), "vignette-outputs", "reports", "russia", "russia_range_shift_map_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

```

```{r edit chile maps}

chile_current <- chile_slf_risk_report[["risk_maps"]][["current_risk_map"]] +
  xlim(-78, -65) 

chile_future <- chile_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  xlim(-78, -65) 

chile_shift <- chile_slf_risk_report[["range_shift_map"]] +
  xlim(-78, -65) 


#save
ggsave(
  chile_current,
  filename = file.path(here::here(), "vignette-outputs", "reports", "chile", "chile_risk_map_present_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  chile_future,
  filename = file.path(here::here(), "vignette-outputs", "reports", "chile", "chile_risk_map_2055_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  chile_shift,
  filename = file.path(here::here(), "vignette-outputs", "reports", "chile", "chile_range_shift_map_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

```

## other areas of CC interest

These areas experienced a significant increase in SLF risk on the main global maps.

```{r other areas}

# finland
# projected gain of slf suitability here
slfSpread::create_risk_report(
  locality.iso = "fin",
  locality.name = "finland",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "finland"),
  create.dir = TRUE,
  save.report = TRUE
)



## ESTONIA
##LATVIA
## LITHUANIA

```

## Geographic Areas

### Western europe

```{r western europe}

# germany
slfSpread::create_risk_report(
  locality.iso = "DEU",
  locality.name = "germany",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "germany"),
  create.dir = FALSE,
  save.report = TRUE
)


# france
slfSpread::create_risk_report(
  locality.iso = "fra",
  locality.name = "france",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "france"),
  create.dir = FALSE,
  save.report = TRUE
)


# portugual and italy done above

```

```{r edit france maps}

france_current <- france_slf_risk_report[["risk_maps"]][["current_risk_map"]] +
  xlim(-5, 10) +
  ylim(41, 51)

france_future <- france_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  xlim(-5, 10) +
  ylim(41, 51)

france_shift <- france_slf_risk_report[["range_shift_map"]] +
  xlim(-5, 10) +
  ylim(41, 51)


#save
ggsave(
  france_current,
  filename = file.path(here::here(), "vignette-outputs", "reports", "france", "france_risk_map_present_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  france_future,
  filename = file.path(here::here(), "vignette-outputs", "reports", "france", "france_risk_map_2055_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

ggsave(
  france_shift,
  filename = file.path(here::here(), "vignette-outputs", "reports", "france", "france_range_shift_map_edited.jpg"),
  height = 8,
  width = 10,
  device = "jpeg",
  dpi = "retina"
)

```

### Eastern Europe

```{r eastern europe}

# greece
slfSpread::create_risk_report(
  locality.iso = "GRC",
  locality.name = "greece",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "greece"),
  create.dir = TRUE,
  save.report = TRUE
)


# austria
slfSpread::create_risk_report(
  locality.iso = "AUT",
  locality.name = "austria",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "austria"),
  create.dir = TRUE,
  save.report = TRUE
)

# hungary
slfSpread::create_risk_report(
  locality.iso = "HUN",
  locality.name = "hungary",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "hungary"),
  create.dir = TRUE,
  save.report = TRUE
)

# czech republic (Czechia)
slfSpread::create_risk_report(
  locality.iso = "CZE",
  locality.name = "Czechia",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "czechia"),
  create.dir = TRUE,
  save.report = TRUE
)


```

### Africa

```{r Africa}

# algeria
slfSpread::create_risk_report(
  locality.iso = "DZA",
  locality.name = "algeria",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "algeria"),
  create.dir = TRUE,
  save.report = TRUE
)

## south africa above

```

### N America

```{r N America}

# canada
slfSpread::create_risk_report(
  locality.iso = "CAN",
  locality.name = "canada",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "canada"),
  create.dir = TRUE,
  save.report = TRUE
)

# mexico above

```


### West Asia

```{r west asia}

# turkey
slfSpread::create_risk_report(
  locality.iso = "TUR",
  locality.name = "turkey",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "turkey"),
  create.dir = TRUE,
  save.report = TRUE
)


# georgia above

```

### East Asia

```{r east asia}

## china above

# south korea
slfSpread::create_risk_report(
  locality.iso = "KOR",
  locality.name = "south korea",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "south korea"),
  create.dir = TRUE,
  save.report = TRUE
)

# japan
slfSpread::create_risk_report(
  locality.iso = "JPN",
  locality.name = "japan",
  locality.type = "country",
  mypath = file.path(here::here(), "vignette-outputs", "reports", "japan"),
  create.dir = TRUE,
  save.report = TRUE
)

```

# Appendix

## Create faceted maps

First I will facet some examples of different risk scenarios for SLF with their respective risk maps. I will use Romania, the USA and Spain. Romania is an example of a country with a high shift toward the regional model predictions because almost all viticultural regions shift from extreme to high suitability, highlighting the importance of the regional model. The USA exhibits this same trend, but not with the same strength that Romania does. Viticultural regions in spain exhibit a general shift to unsuitability in both models. The regional model seems to display risk under the current climate, but that risk disappears with climate change.

### Example countries

```{r edit plots}

romania_risk_plot <- romania_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "A") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

# edits
# remove geom_text
romania_risk_plot <- romania_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
romania_risk_plot$data[[4]]$size <- 1.5
romania_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#romania_risk_plot$data[[3]]$linewidth <- 0.1

romania_risk_plot <- ggplot_gtable(romania_risk_plot) %>%
  wrap_ggplot_grob()



united_states_risk_plot <- united_states_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "C") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

united_states_risk_plot <- united_states_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
united_states_risk_plot$data[[4]]$size <- 1.5
united_states_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#united_states_risk_plot$data[[3]]$linewidth <- 0.1

united_states_risk_plot <- ggplot_gtable(united_states_risk_plot) %>%
  wrap_ggplot_grob()

  

spain_risk_plot <- spain_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "E") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

spain_risk_plot <- spain_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
spain_risk_plot$data[[4]]$size <- 1.5
spain_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#spain_risk_plot$data[[3]]$linewidth <- 0.1

spain_risk_plot <- ggplot_gtable(spain_risk_plot) %>%
  wrap_ggplot_grob()


  # edit maps

romania_risk_map <- romania_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "B") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.1, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )


romania_risk_map <- ggplot_build(romania_risk_map)
# edit point size
romania_risk_map$data[[3]]$size <- 1.5

romania_risk_map <- ggplot_gtable(romania_risk_map) %>%
  wrap_ggplot_grob()



USA_risk_map <-  united_states_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "D") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.1, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    ) +
  xlim(-125, -65) +
  ylim(25, 50)

USA_risk_map <- ggplot_build(USA_risk_map)
# edit point size
USA_risk_map$data[[3]]$size <- 1.5

USA_risk_map <- ggplot_gtable(USA_risk_map) %>%
  wrap_ggplot_grob()
 


spain_risk_map <- spain_future +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "F") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.1, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )
  
spain_risk_map <- ggplot_build(spain_risk_map)
# edit point size
spain_risk_map$data[[3]]$size <- 1.5
# rebuild plot
spain_risk_map <- ggplot_gtable(spain_risk_map) %>%
  wrap_ggplot_grob()
  
  
```

```{r patchwork plots}

#layout <- c(
#  area(t = 1, b = 1, l = 1, r = 1),
#  area(t = 1, b = 1, l = 2, r = 2),
##  area(t = 2, b = 2, l = 1, r = 1),
#  area(t = 2, b = 2, l = 2, r = 3),
#  area(t = 3, b = 3, l = 1, r = 1),
#  area(t = 3, b = 3, l = 2, r = 2)
#)

example_countries_patchwork <- (
  # romania top row
  romania_risk_plot + plot_spacer() + romania_risk_map + 
  # USA 2nd row
  united_states_risk_plot + plot_spacer() + USA_risk_map + 
  # spain 3rd row
  spain_risk_plot + plot_spacer() + spain_risk_map
  ) +
  # annotation
  plot_annotation(title = "Differential risk shift due to climate change among countries") +
  plot_layout(ncol = 3, widths = c(1, 0, -1)) 

```

```{r save plot}

ggsave(
  example_countries_patchwork, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "differential_risk_shift_countries.jpg"),
  height = 10, 
  width = 8,
  device = "jpeg",
  dpi = "retina"
  )

```

### US States

```{r edit plots}

washington_risk_plot <- washington_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "A") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold")
    )

# edits
# remove geom_text
washington_risk_plot <- washington_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
washington_risk_plot$data[[4]]$size <- 1.5
washington_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#washington_risk_plot$data[[3]]$linewidth <- 0.1

washington_risk_plot <- ggplot_gtable(washington_risk_plot) %>%
  wrap_ggplot_grob()



oregon_risk_plot <- oregon_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "C") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold")
    )

oregon_risk_plot <- oregon_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
oregon_risk_plot$data[[4]]$size <- 1.5
oregon_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#oregon_risk_plot$data[[3]]$linewidth <- 0.1

oregon_risk_plot <- ggplot_gtable(oregon_risk_plot) %>%
  wrap_ggplot_grob()

  

michigan_risk_plot <- michigan_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "E") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold")
    )

michigan_risk_plot <- michigan_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
michigan_risk_plot$data[[4]]$size <- 1.5
michigan_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#michigan_risk_plot$data[[3]]$linewidth <- 0.1

michigan_risk_plot <- ggplot_gtable(michigan_risk_plot) %>%
  wrap_ggplot_grob()


  # edit maps

washington_risk_map <- washington_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "B") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(-0.1, 0.9),
    plot.tag = element_text(face = "bold")
    )


washington_risk_map <- ggplot_build(washington_risk_map)
# edit point size
washington_risk_map$data[[3]]$size <- 1.5

washington_risk_map <- ggplot_gtable(washington_risk_map) %>%
  wrap_ggplot_grob()



oregon_risk_map <-  oregon_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "D") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(-0.1, 0.9),
    plot.tag = element_text(face = "bold")
    ) 

oregon_risk_map <- ggplot_build(oregon_risk_map)
# edit point size
oregon_risk_map$data[[3]]$size <- 1.5

oregon_risk_map <- ggplot_gtable(oregon_risk_map) %>%
  wrap_ggplot_grob()
 


michigan_risk_map <- michigan_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "F") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(-0.1, 0.9),
    plot.tag = element_text(face = "bold")
    )
  
michigan_risk_map <- ggplot_build(michigan_risk_map)
# edit point size
michigan_risk_map$data[[3]]$size <- 1.5
# rebuild plot
michigan_risk_map <- ggplot_gtable(michigan_risk_map) %>%
  wrap_ggplot_grob()
  
  
```

```{r patchwork plots}

example_states_patchwork <- (
  # washington top row
  washington_risk_plot + plot_spacer() + washington_risk_map + 
  # USA 2nd row
  oregon_risk_plot + plot_spacer() + oregon_risk_map + 
  # michigan 3rd row
  michigan_risk_plot + plot_spacer() + michigan_risk_map
  ) +
  # annotation
  plot_annotation(title = "Risk shift in US states of future interest for viticulture") +
  plot_layout(ncol = 3, nrow = 3, widths = unit(c(5.5, 1, 5.5), "cm"), heights = unit(5.5, "cm"))


```

```{r save plot}

ggsave(
  example_states_patchwork, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "risk_shift_viticultural_states.jpg"),
  height = 8, 
  width = 10,
  device = "jpeg",
  dpi = "retina"
  )

```

### Viticultural regions of interest- Oceania

```{r edit plots}

new_zealand_risk_plot <- new_zealand_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "A") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

# edits
# remove geom_text
new_zealand_risk_plot <- new_zealand_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
new_zealand_risk_plot$data[[4]]$size <- 1.5
new_zealand_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#new_zealand_risk_plot$data[[3]]$linewidth <- 0.1

new_zealand_risk_plot <- ggplot_gtable(new_zealand_risk_plot) %>%
  wrap_ggplot_grob()


# australia
australia_risk_plot <- australia_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "C") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

# edits
# remove geom_text
australia_risk_plot <- australia_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
australia_risk_plot$data[[4]]$size <- 1.5
australia_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#australia_risk_plot$data[[3]]$linewidth <- 0.1

australia_risk_plot <- ggplot_gtable(australia_risk_plot) %>%
  wrap_ggplot_grob()



# tasmania
tasmania_risk_plot <- tasmania_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "E") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

tasmania_risk_plot <- tasmania_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
tasmania_risk_plot$data[[4]]$size <- 1.5
tasmania_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#tasmania_risk_plot$data[[3]]$linewidth <- 0.1

tasmania_risk_plot <- ggplot_gtable(tasmania_risk_plot) %>%
  wrap_ggplot_grob()


  # edit maps
# new zealand
new_zealand_risk_map <- new_zealand_future +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "B") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )


new_zealand_risk_map <- ggplot_build(new_zealand_risk_map)
# edit point size
new_zealand_risk_map$data[[3]]$size <- 1.5

new_zealand_risk_map <- ggplot_gtable(new_zealand_risk_map) %>%
  wrap_ggplot_grob()



# australia
australia_risk_map <- australia_future +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "D") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(-0.05, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )


australia_risk_map <- ggplot_build(australia_risk_map)
# edit point size
australia_risk_map$data[[3]]$size <- 1.5

australia_risk_map <- ggplot_gtable(australia_risk_map) %>%
  wrap_ggplot_grob()


# tasmania
tasmania_risk_map <- tasmania_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "F") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )
  
tasmania_risk_map <- ggplot_build(tasmania_risk_map)
# edit point size
tasmania_risk_map$data[[3]]$size <- 1.5
# rebuild plot
tasmania_risk_map <- ggplot_gtable(tasmania_risk_map) %>%
  wrap_ggplot_grob()
  
  
```

```{r patchwork plots}

oceania_patchwork <- (
  # new_zealand top row
  new_zealand_risk_plot + plot_spacer() + new_zealand_risk_map + 
  # australia
  australia_risk_plot + plot_spacer() + australia_risk_map +
  # tasmania bottom row
  tasmania_risk_plot + plot_spacer() + tasmania_risk_map
  ) +
  # annotation
  plot_annotation(
    title = "Risk shift in regions of future interest for viticulture",
    subtitle = "Oceania"
    ) +
  plot_layout(ncol = 3, nrow = 3, widths = unit(c(5.5, 1, 5.5), "cm"), heights = unit(5.5, "cm"))


```

```{r save plot}

ggsave(
  oceania_patchwork, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "future_viticultural_regions_oceania.jpg"),
  height = 10, 
  width = 8,
  device = "jpeg",
  dpi = "retina"
  )

```

### Viticultural regions of interest- South America

```{r edit plots}

chile_risk_plot <- chile_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "A") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold")
    )

# edits
# remove geom_text
chile_risk_plot <- chile_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
chile_risk_plot$data[[4]]$size <- 1.5
chile_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#chile_risk_plot$data[[3]]$linewidth <- 0.1

chile_risk_plot <- ggplot_gtable(chile_risk_plot) %>%
  wrap_ggplot_grob()


argentina_risk_plot <- argentina_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "C") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold")
    )

argentina_risk_plot <- argentina_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
argentina_risk_plot$data[[4]]$size <- 1.5
argentina_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#argentina_risk_plot$data[[3]]$linewidth <- 0.1

argentina_risk_plot <- ggplot_gtable(argentina_risk_plot) %>%
  wrap_ggplot_grob()


  # edit maps

chile_risk_map <- chile_future +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "B") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold")
    )


chile_risk_map <- ggplot_build(chile_risk_map)
# edit point size
chile_risk_map$data[[3]]$size <- 1.5

chile_risk_map <- ggplot_gtable(chile_risk_map) %>%
  wrap_ggplot_grob()


argentina_risk_map <- argentina_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "D") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.15, 0.9),
    plot.tag = element_text(face = "bold")
    )
  
argentina_risk_map <- ggplot_build(argentina_risk_map)
# edit point size
argentina_risk_map$data[[3]]$size <- 1.5
# rebuild plot
argentina_risk_map <- ggplot_gtable(argentina_risk_map) %>%
  wrap_ggplot_grob()
  
  
```

```{r patchwork plots}

SAmerica_patchwork <- (
  chile_risk_plot + argentina_risk_plot +
  plot_spacer() + plot_spacer() +
  chile_risk_map + argentina_risk_map 
  ) +
  # annotation
  plot_annotation(
    title = "Risk shift in regions of future interest for viticulture",
    subtitle = "South America"
    ) +
  plot_layout(ncol = 2, nrow = 3, widths = unit(5, "cm"), heights = unit(c(5, 0, 7.5), "cm"))


```

```{r save plot}

ggsave(
  SAmerica_patchwork, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "future_viticultural_regions_SAmerica.jpg"),
  height = 8, 
  width = 8,
  device = "jpeg",
  dpi = "retina"
  )

```

### Viticultural regions of interest- Western Europe

```{r edit plots}

# portugal
portugal_risk_plot <- portugal_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "A") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

# edits
# remove geom_text
portugal_risk_plot <- portugal_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
portugal_risk_plot$data[[4]]$size <- 1.5
portugal_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#portugal_risk_plot$data[[3]]$linewidth <- 0.1

portugal_risk_plot <- ggplot_gtable(portugal_risk_plot) %>%
  wrap_ggplot_grob()


# france
france_risk_plot <- france_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "C") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

# edits
# remove geom_text
france_risk_plot <- france_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
france_risk_plot$data[[4]]$size <- 1.5
france_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#france_risk_plot$data[[3]]$linewidth <- 0.1

france_risk_plot <- ggplot_gtable(france_risk_plot) %>%
  wrap_ggplot_grob()

# germany
germany_risk_plot <- germany_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "E") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

germany_risk_plot <- germany_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
germany_risk_plot$data[[4]]$size <- 1.5
germany_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#germany_risk_plot$data[[3]]$linewidth <- 0.1

germany_risk_plot <- ggplot_gtable(germany_risk_plot) %>%
  wrap_ggplot_grob()


# italy
italy_risk_plot <- italy_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "G") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

italy_risk_plot <- italy_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
italy_risk_plot$data[[4]]$size <- 1.5
italy_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#italy_risk_plot$data[[3]]$linewidth <- 0.1

italy_risk_plot <- ggplot_gtable(italy_risk_plot) %>%
  wrap_ggplot_grob()


# edit maps
# france
portugal_risk_map <- portugal_future +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "B") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.1, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )


portugal_risk_map <- ggplot_build(portugal_risk_map)
# edit point size
portugal_risk_map$data[[3]]$size <- 1.5

portugal_risk_map <- ggplot_gtable(portugal_risk_map) %>%
  wrap_ggplot_grob()



# france
france_risk_map <- france_future +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "D") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.1, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )


france_risk_map <- ggplot_build(france_risk_map)
# edit point size
france_risk_map$data[[3]]$size <- 1.5

france_risk_map <- ggplot_gtable(france_risk_map) %>%
  wrap_ggplot_grob()

# germany map
germany_risk_map <- germany_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "F") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.05, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )
  
germany_risk_map <- ggplot_build(germany_risk_map)
# edit point size
germany_risk_map$data[[3]]$size <- 1.5
# rebuild plot
germany_risk_map <- ggplot_gtable(germany_risk_map) %>%
  wrap_ggplot_grob()
  
# italy map
italy_risk_map <- italy_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "H") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.05, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )
  
italy_risk_map <- ggplot_build(italy_risk_map)
# edit point size
italy_risk_map$data[[3]]$size <- 1.5
# rebuild plot
italy_risk_map <- ggplot_gtable(italy_risk_map) %>%
  wrap_ggplot_grob()
  
  
```

```{r patchwork plots}

west_europe_patchwork <- (
  portugal_risk_plot + plot_spacer() + portugal_risk_map +
  france_risk_plot + plot_spacer() + france_risk_map +
  germany_risk_plot + plot_spacer() + germany_risk_map +
  italy_risk_plot + plot_spacer() + italy_risk_map 
  ) +
  # annotation
  plot_annotation(
    title = "Risk shift in regions of future interest for viticulture",
    subtitle = "Western Europe"
    ) +
  plot_layout(ncol = 3, nrow = 4, widths = unit(c(5.5, 1, 5.5), "cm"), heights = unit(5.5, "cm"))


```

```{r save plot}

ggsave(
  west_europe_patchwork, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "future_viticultural_regions_western_europe.jpg"),
  height = 12, 
  width = 8,
  device = "jpeg",
  dpi = "retina"
  )

```

### Viticultural regions of interest- Eastern Europe

```{r edit plots}

# portugal
austria_risk_plot <- austria_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "A") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

# edits
# remove geom_text
austria_risk_plot <- austria_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
austria_risk_plot$data[[4]]$size <- 1.5
austria_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#austria_risk_plot$data[[3]]$linewidth <- 0.1

austria_risk_plot <- ggplot_gtable(austria_risk_plot) %>%
  wrap_ggplot_grob()


# france
hungary_risk_plot <- hungary_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "C") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

# edits
# remove geom_text
hungary_risk_plot <- hungary_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
hungary_risk_plot$data[[4]]$size <- 1.5
hungary_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#hungary_risk_plot$data[[3]]$linewidth <- 0.1

hungary_risk_plot <- ggplot_gtable(hungary_risk_plot) %>%
  wrap_ggplot_grob()

# czechia
czechia_risk_plot <- czechia_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "E") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

czechia_risk_plot <- czechia_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
czechia_risk_plot$data[[4]]$size <- 1.5
czechia_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#czechia_risk_plot$data[[3]]$linewidth <- 0.1

czechia_risk_plot <- ggplot_gtable(czechia_risk_plot) %>%
  wrap_ggplot_grob()


# italy
greece_risk_plot <- greece_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "G") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

greece_risk_plot <- greece_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
greece_risk_plot$data[[4]]$size <- 1.5
greece_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#greece_risk_plot$data[[3]]$linewidth <- 0.1

greece_risk_plot <- ggplot_gtable(greece_risk_plot) %>%
  wrap_ggplot_grob()


# edit maps
# hungary
austria_risk_map <- austria_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "B") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.1, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )


austria_risk_map <- ggplot_build(austria_risk_map)
# edit point size
austria_risk_map$data[[3]]$size <- 1.5

austria_risk_map <- ggplot_gtable(austria_risk_map) %>%
  wrap_ggplot_grob()



# hungary
hungary_risk_map <- hungary_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "D") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.1, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )


hungary_risk_map <- ggplot_build(hungary_risk_map)
# edit point size
hungary_risk_map$data[[3]]$size <- 1.5

hungary_risk_map <- ggplot_gtable(hungary_risk_map) %>%
  wrap_ggplot_grob()

# czechia map
czechia_risk_map <- czechia_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "F") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.1, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )
  
czechia_risk_map <- ggplot_build(czechia_risk_map)
# edit point size
czechia_risk_map$data[[3]]$size <- 1.5
# rebuild plot
czechia_risk_map <- ggplot_gtable(czechia_risk_map) %>%
  wrap_ggplot_grob()
  
# greece map
greece_risk_map <- greece_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "H") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.1, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )
  
greece_risk_map <- ggplot_build(greece_risk_map)
# edit point size
greece_risk_map$data[[3]]$size <- 1.5
# rebuild plot
greece_risk_map <- ggplot_gtable(greece_risk_map) %>%
  wrap_ggplot_grob()
  
  
```

```{r patchwork plots}

east_europe_patchwork <- (
  austria_risk_plot + plot_spacer() + austria_risk_map +
  hungary_risk_plot + plot_spacer() + hungary_risk_map +
  czechia_risk_plot + plot_spacer() + czechia_risk_map +
  greece_risk_plot + plot_spacer() + greece_risk_map 
  ) +
  # annotation
  plot_annotation(
    title = "Risk shift in regions of future interest for viticulture",
    subtitle = "Eastern Europe"
    ) +
  plot_layout(ncol = 3, nrow = 4, widths = unit(c(5.5, 1, 5.5), "cm"), heights = unit(5.5, "cm"))


```

```{r save plot}

ggsave(
  east_europe_patchwork, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "future_viticultural_regions_eastern_europe.jpg"),
  height = 12, 
  width = 8,
  device = "jpeg",
  dpi = "retina"
  )

```

### Viticultural regions of interest- Africa

```{r edit plots}

# south_africa
south_africa_risk_plot <- south_africa_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "A") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )
# edits
# remove geom_text
south_africa_risk_plot <- south_africa_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
south_africa_risk_plot$data[[4]]$size <- 1.5
south_africa_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#algeria_risk_plot$data[[3]]$linewidth <- 0.1

south_africa_risk_plot <- ggplot_gtable(south_africa_risk_plot) %>%
  wrap_ggplot_grob()



# algeria
algeria_risk_plot <- algeria_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "C") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

# edits
# remove geom_text
algeria_risk_plot <- algeria_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
algeria_risk_plot$data[[4]]$size <- 1.5
algeria_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#algeria_risk_plot$data[[3]]$linewidth <- 0.1

algeria_risk_plot <- ggplot_gtable(algeria_risk_plot) %>%
  wrap_ggplot_grob()


# edit maps
# south_africa
south_africa_risk_map <- south_africa_future +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "B") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.1, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )


south_africa_risk_map <- ggplot_build(south_africa_risk_map)
# edit point size
south_africa_risk_map$data[[3]]$size <- 1.5

south_africa_risk_map <- ggplot_gtable(south_africa_risk_map) %>%
  wrap_ggplot_grob()


# algeria
algeria_risk_map <- algeria_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "D") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.1, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )


algeria_risk_map <- ggplot_build(algeria_risk_map)
# edit point size
algeria_risk_map$data[[3]]$size <- 1.5

algeria_risk_map <- ggplot_gtable(algeria_risk_map) %>%
  wrap_ggplot_grob()

```

```{r patchwork plots}

africa_patchwork <- (
  south_africa_risk_plot + plot_spacer() + south_africa_risk_map +
  algeria_risk_plot + plot_spacer() + algeria_risk_map
  ) +
  # annotation
  plot_annotation(
    title = "Risk shift in regions of future interest for viticulture",
    subtitle = "Africa"
    ) +
  plot_layout(ncol = 3, nrow = 2, widths = unit(c(5.5, 1, 5.5), "cm"), heights = unit(5.5, "cm"))


```

```{r save plot}

ggsave(
  africa_patchwork, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "future_viticultural_regions_africa.jpg"),
  height = 8, 
  width = 8,
  device = "jpeg",
  dpi = "retina"
  )

```

### Viticultural regions of interest- North America

```{r edit plots}

# canada
canada_risk_plot <- canada_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "A") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

# edits
# remove geom_text
canada_risk_plot <- canada_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
canada_risk_plot$data[[4]]$size <- 1.5
canada_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#canada_risk_plot$data[[3]]$linewidth <- 0.1

canada_risk_plot <- ggplot_gtable(canada_risk_plot) %>%
  wrap_ggplot_grob()



# mexico
mexico_risk_plot <- mexico_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "C") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

# edits
# remove geom_text
mexico_risk_plot <- mexico_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
mexico_risk_plot$data[[4]]$size <- 1.5
mexico_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#mexico_risk_plot$data[[3]]$linewidth <- 0.1

mexico_risk_plot <- ggplot_gtable(mexico_risk_plot) %>%
  wrap_ggplot_grob()


# edit maps
# canada
canada_risk_map <- canada_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "B") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.1, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )


canada_risk_map <- ggplot_build(canada_risk_map)
# edit point size
canada_risk_map$data[[3]]$size <- 1.5

canada_risk_map <- ggplot_gtable(canada_risk_map) %>%
  wrap_ggplot_grob()


# mexico
mexico_risk_map <- mexico_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "D") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.1, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )


mexico_risk_map <- ggplot_build(mexico_risk_map)
# edit point size
mexico_risk_map$data[[3]]$size <- 1.5

mexico_risk_map <- ggplot_gtable(mexico_risk_map) %>%
  wrap_ggplot_grob()


```

```{r patchwork plots}

NAmerica_patchwork <- (
    canada_risk_plot + plot_spacer() + canada_risk_map +
    mexico_risk_plot + plot_spacer() + mexico_risk_map
  ) +
  # annotation
  plot_annotation(
    title = "Risk shift in regions of future interest for viticulture",
    subtitle = "North America"
    ) +
  plot_layout(ncol = 3, nrow = 2, widths = unit(c(5.5, 1, 5.5), "cm"), heights = unit(5.5, "cm"))


```

```{r save plot}

ggsave(
  NAmerica_patchwork, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "future_viticultural_regions_north_america.jpg"),
  height = 8, 
  width = 8,
  device = "jpeg",
  dpi = "retina"
  )

```

### Viticultural regions of interest- West Asia

```{r edit plots}

# türkiye
türkiye_risk_plot <- türkiye_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "A") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

# edits
# remove geom_text
türkiye_risk_plot <- türkiye_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
türkiye_risk_plot$data[[4]]$size <- 1.5
türkiye_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#türkiye_risk_plot$data[[3]]$linewidth <- 0.1

türkiye_risk_plot <- ggplot_gtable(türkiye_risk_plot) %>%
  wrap_ggplot_grob()



# georgia
georgia_risk_plot <- georgia_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "C") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

# edits
# remove geom_text
georgia_risk_plot <- georgia_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
georgia_risk_plot$data[[4]]$size <- 1.5
georgia_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#georgia_risk_plot$data[[3]]$linewidth <- 0.1

georgia_risk_plot <- ggplot_gtable(georgia_risk_plot) %>%
  wrap_ggplot_grob()


# edit maps
# türkiye
türkiye_risk_map <- türkiye_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "B") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.1, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )


türkiye_risk_map <- ggplot_build(türkiye_risk_map)
# edit point size
türkiye_risk_map$data[[3]]$size <- 1.5

türkiye_risk_map <- ggplot_gtable(türkiye_risk_map) %>%
  wrap_ggplot_grob()


# georgia
georgia_risk_map <- georgia_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "D") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(0.1, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )


georgia_risk_map <- ggplot_build(georgia_risk_map)
# edit point size
georgia_risk_map$data[[3]]$size <- 1.5

georgia_risk_map <- ggplot_gtable(georgia_risk_map) %>%
  wrap_ggplot_grob()


```

```{r patchwork plots}

west_asia_patchwork <- (
    türkiye_risk_plot + plot_spacer() + türkiye_risk_map +
    georgia_risk_plot + plot_spacer() + georgia_risk_map
  ) +
  # annotation
  plot_annotation(
    title = "Risk shift in regions of future interest for viticulture",
    subtitle = "Western Asia"
    ) +
  plot_layout(ncol = 3, nrow = 2, widths = unit(c(5.5, 1, 5.5), "cm"), heights = unit(5.5, "cm"))


```

```{r save plot}

ggsave(
  west_asia_patchwork, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "future_viticultural_regions_west_asia.jpg"),
  height = 8, 
  width = 8,
  device = "jpeg",
  dpi = "retina"
  )

```


### Viticultural regions of interest- East Asia

```{r edit plots}

# china
china_risk_plot <- china_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "A") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

# edits
# remove geom_text
china_risk_plot <- china_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
china_risk_plot$data[[4]]$size <- 1.5
china_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#china_risk_plot$data[[3]]$linewidth <- 0.1

china_risk_plot <- ggplot_gtable(china_risk_plot) %>%
  wrap_ggplot_grob()


# south_korea
south_korea_risk_plot <- south_korea_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "C") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

# edits
# remove geom_text
south_korea_risk_plot <- south_korea_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
south_korea_risk_plot$data[[4]]$size <- 1.5
south_korea_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#south_korea_risk_plot$data[[3]]$linewidth <- 0.1

south_korea_risk_plot <- ggplot_gtable(south_korea_risk_plot) %>%
  wrap_ggplot_grob()



# japan
japan_risk_plot <- japan_slf_risk_report[["viticultural_risk_plot"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank()
    ) +
  labs(tag = "E") +
  theme(
    legend.position = "none", 
    panel.border = element_rect(size = 1, linetype = "solid", color = "black"), 
    plot.tag.position = c(0.2, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )

japan_risk_plot <- japan_risk_plot %>%
  gginnards::delete_layers(match_type = "GeomLabel") %>%
  ggplot_build()
# edit point size
japan_risk_plot$data[[4]]$size <- 1.5
japan_risk_plot$data[[5]]$size <- 1.5
# edit linewidth
#japan_risk_plot$data[[3]]$linewidth <- 0.1

japan_risk_plot <- ggplot_gtable(japan_risk_plot) %>%
  wrap_ggplot_grob()


  # edit maps
# new zealand
china_risk_map <- china_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "B") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(-0.1, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )


china_risk_map <- ggplot_build(china_risk_map)
# edit point size
china_risk_map$data[[3]]$size <- 1.5

china_risk_map <- ggplot_gtable(china_risk_map) %>%
  wrap_ggplot_grob()



# south_korea
south_korea_risk_map <- south_korea_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "D") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(-0.1, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )


south_korea_risk_map <- ggplot_build(south_korea_risk_map)
# edit point size
south_korea_risk_map$data[[3]]$size <- 1.5

south_korea_risk_map <- ggplot_gtable(south_korea_risk_map) %>%
  wrap_ggplot_grob()


# japan
japan_risk_map <- japan_slf_risk_report[["risk_maps"]][["2055_risk_map"]] +
  theme(
    plot.title = element_blank(),
    plot.subtitle = element_blank(),
    plot.caption = element_blank(),
    axis.title = element_blank(),
    axis.text = element_blank(),
    axis.ticks = element_blank()
    ) +
  labs(tag = "F") +
  theme(
    legend.position = "none", 
    plot.tag.position = c(-0.1, 0.9),
    plot.tag = element_text(face = "bold", size = 20)
    )
  
japan_risk_map <- ggplot_build(japan_risk_map)
# edit point size
japan_risk_map$data[[3]]$size <- 1.5
# rebuild plot
japan_risk_map <- ggplot_gtable(japan_risk_map) %>%
  wrap_ggplot_grob()
  
  
```

```{r patchwork plots}

east_asia_patchwork <- (
  # china top row
  china_risk_plot + plot_spacer() + china_risk_map + 
  # south_korea
  south_korea_risk_plot + plot_spacer() + south_korea_risk_map +
  # japan bottom row
  japan_risk_plot + plot_spacer() + japan_risk_map
  ) +
  # annotation
  plot_annotation(
    title = "Risk shift in regions of future interest for viticulture",
    subtitle = "Eastern Asia"
    ) +
  plot_layout(ncol = 3, nrow = 3, widths = unit(c(5.5, 1, 5.5), "cm"), heights = unit(5.5, "cm"))


```

```{r save plot}

ggsave(
  east_asia_patchwork, 
  filename = file.path(here::here(), "vignette-outputs", "figures", "future_viticultural_regions_east_asia.jpg"),
  height = 10, 
  width = 8,
  device = "jpeg",
  dpi = "retina"
  )

```

## DEPRECATED

```{r bbox cropping in function}
# inclusion of bbox cropping in function

library(sf)
library(cartographer)

# I originally included package cargtographer in the dependencies, but decided
# against it because it depends on some superceded packages. I only need the data object called
# countries_bbox from the package, so I downloaded it from the
# package and will include it in the import for my function.
# info retrieved from: https://gist.github.com/graydon/11198540

 bbox_list <- countries_bbox

# append france because that is absent for some reason
# it was causing issues because of its territories
# info from http://bboxfinder.com/#42.240307,-5.075684,51.171134,8.336426
# xmin and ymin edited slightly for visualization
 
 bbox_list <- tibble::add_row(bbox_list, iso = "FR", name = "France", x_min = -5.000, x_max = 8.336426, y_min = 42.00, y_max = 51.171134)

```

# References

Webb, L. B., I. Watterson, J. Bhend, P. H. Whetton, and E. W. R. Barlow. 2013. Global climate analogues for winegrowing regions in future periods: projections of temperature and precipitation. Australian Journal of Grape and Wine Research 19:331--341.
