---
title: "jumps_leaflet_mapping_v2"
author: "Sam Owens"
date: '2022-04-14'
contact: 'sam.owens@temple.edu'
output: html_document
---

This code is being rerun because errors were found in the output of the lycordata packages by Seba de bona. The script to discern which data points in the SLF occurrence data are jumps (999_Dataset_rarefication) was re-run by Nadege. This script will produce add to the table produced by slf_spread_jumps_locations_v3, which added state, county and municipal data to the list of jumps. Leaflet maps will be appended into each column so that each can be run to produce a map of that jump location.

file paths edited 2023-06-01

# Load necessary packages, datasets to be used

```{r load necessary packages, eval=FALSE}

# install.packages(c("tidyverse", "here", "leaflet"))

library(tidyverse)

library(here)
here()
# here() is "C:/Users/tun83449/OneDrive - Temple University/Shared drives/slfClimate/projects/slfSpread/slfSpread_pkg"
library(leaflet)

library(lycormap)
# this package is only available to iEco lab members at the time this script was written- it cannot be downloaded from the github CRAN. Please contact a senior member of the lab for access.

```

```{r load necessary datasets, echo=FALSE}

tinyslf <- tinyslf %>%
  filter(slf_present == "TRUE")

jumps <- read_csv(
  file.path(here(), "data_root/slfSpread_jumps_locations_SMO_v3.csv")
)

```

# Create custom Icon for Mapping

``` {r create marker object, echo = FALSE}

SLF_marker <- makeAwesomeIcon(
  icon = "bug",
  iconColor = "black",
  markerColor = "orange",
  library = "fa"
)

```

# Simplified version of map_jumps function

``` {r map_jumps function- simplified}

map_jumps_v2 <- function(point_long, point_lat, point_label, extent = 0.01, zoom = 10) {

  # point_long and point_lat represent the longitude and latitude of the point you want to map
  # point_label is the label you gave to that point 
  # the variable "extent" is the width and height on either side of each point that you want mapped, in degrees latitude or longitude
  # zoom allows you to set the zoom level, if you want tot have a different one- even if you choose to use fitBounds() to zoom in on the point, a zoom level must still be established within setView(). fitBounds() would then override the zoom level

  leaflet() %>%
    setView(lng = point_long,
            lat = point_lat,
            zoom = 10
    ) %>%
    fitBounds(lng1 = point_long + extent,
              lng2 = point_long - extent,
              lat1 = point_lat + extent,
              lat2 = point_lat - extent
    ) %>%
    addTiles() %>%
    addAwesomeMarkers(lng = point_long,
                      lat = point_lat,
                      icon = SLF_marker,
                      popup = point_label
    ) %>%
    addScaleBar(position = "bottomleft") %>%
    
    return()
}

```

# Examples of how to use map_jumps_v2

Simply defining each variable as a row in a particular tibble/data frame (in this case a tibble is used) will produce a map, as shown below

```{r Mapping a single point, from jumps data table}

jump_1_mapped <- map_jumps_v2(
  point_long = jumps$longitude_rounded[1],
  point_lat = jumps$latitude_rounded[1],
  point_label = jumps$ref_ID[1],
  extent = 0.01,
  zoom = 10
)

```


```{r Mapping of all coordinate pairs and pairing adding it to the dataset}

jump_locations_with_maps <- jumps %>%
  mutate(mapped_jumps = purrr::pmap(
    list(longitude_rounded, latitude_rounded, ref_ID), 
    map_jumps_v2 
  ))

jump_locations_with_maps$mapped_jumps[[2]]
# this executes the list stored in row 2 of the jump_locations_with_maps tibble

```


