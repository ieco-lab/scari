---
title: "lycormap_jumps_mapped"
author: "Sam Owens"
date: '2022-03-14'
output: html_document
---

This vignette will create a streamlined approach for overlaying new SLF occurrence data with all records iEco lab possesses of SLF occurrence, as recorded in the "lycormap" pkg. Specifically, the "tinyslf" object, which contains all records of SLF occurrence, will be overlayed with the clumped SLF jump data. These data were clumped by determining which of the data points were considered a new SLF spread event and then grouping all data points within 15km of each other. The data point closest to the centroid of each group was kept as a representative point. 

file paths edited 2023-06-01

# Load Packages, Datasets and SF objects

```{r load necessary packages, eval=FALSE}

# install.packages(c("tidyverse", "ggplot2", "here", "sf"))
# install.packages("USAboundariesData", repos = "https://ropensci.r-universe.dev", type = "source")

library(tidyverse)
library(ggplot2)

library(here)
here()
# here() is "C:/Users/tun83449/OneDrive - Temple University/Shared drives/slfClimate/projects/slfSpread/slfSpread_pkg"

library(lycormap)
library(sf)
library(USAboundaries)

```

```{r load necessary datasets and map sf objects, echo=FALSE}

tinyslf <- tinyslf %>%
  filter(slf_present == "TRUE")

jumps <- read_csv(
  file.path(here(), "data_root/data_old/slfSpread_jumps_locations_SMO_v2.csv")
)

states_map <- us_states()

counties_map <- st_read(
  file.path(here(), "data_raw/US_County_Boundaries/US_CountyBndrys.shp")
  # retrieved from https://hub.arcgis.com/datasets/geoplatform::us-county-boundaries/about
)

```

# Mapping- All tinySLF records vs Jump spread events

```{r mapping- All slf occurrence and jumps}

slf_jumps_map <- ggplot() +
  geom_sf(data = states_map,
          fill = "slategray3", 
          color = "white"
  ) +
  geom_point(data = tinyslf, 
             aes(x = longitude,
                 y = latitude),
             color = "dark green"
             ) +
  geom_point(data = jumps,
             aes(x = longitude_rounded,
                 y = latitude_rounded),
             color = "dark orange"
             ) +
  coord_sf(xlim = c(-125, -65), 
           ylim = c(50, 25)
           ) +
  theme_classic()

```

```{r mapping- PA all SLF records vs jumps}

PA_map <- ggplot() +
geom_sf(data = counties_map %>%
        filter(STATEFP == 42), # for some reason, I can only get it to map one state at a time. It will not do groups of states
        fill = "slategray3", 
        color = "white"
        ) +
  geom_point(data = tinyslf, 
             aes(x = longitude,
                 y = latitude),
             color = "dark green",
             alpha = 0.5
             ) +
  geom_point(data = jumps,
             aes(x = longitude_rounded,
                 y = latitude_rounded),
             color = "dark orange"
             ) +
  coord_sf(xlim = c(-81, -74),
                  ylim = c(39.5, 42.5)
                  ) +
  theme_classic() +
  theme(legend.position = "top")

```

# Mapping- tinySLF records visualized

```{r mapping- PA tinySLF records by year}

# This map will color all SLF records by year detected
PA_slf_year <- ggplot() +
geom_sf(data = counties_map %>%
        filter(STATEFP == 42),
        fill = "slategray3", 
        color = "white"
        ) +
  geom_point(data = tinyslf, 
             aes(x = longitude,
                 y = latitude,
                 color = desc(year)),
             alpha = 0.2
             ) +
  coord_sf(xlim = c(-81, -74),
                  ylim = c(39.5, 42.5)
                  ) +
  theme_classic() +
  theme(legend.position = "top")

```

``` {r mapping- PA tinySLF established Y/N}

PA_slf_established <- ggplot() +
geom_sf(data = counties_map %>%
        filter(STATEFP == 42),
        fill = "slategray3", 
        color = "white"
        ) +
  geom_point(data = tinyslf, 
             aes(x = longitude,
                 y = latitude,
                 color = slf_established),
             alpha = 0.2
             ) +
  coord_sf(xlim = c(-81, -74),
                  ylim = c(39.5, 42.5)
                  ) +
  scale_color_brewer(palette = "Set1", 
                     aesthetics = "color"
                     ) +
  theme_classic() +
  theme(legend.position = "top")

```

``` {r mapping- PA tinySLF pop density}

PA_slf_density <- ggplot() +
geom_sf(data = counties_map %>%
        filter(STATEFP == 42),
        fill = "slategray3", 
        color = "white"
        ) +
  geom_point(data = tinyslf %>%
               filter(!is.na(slf_density),
                      slf_density != "Unpopulated"
                      # Need to add arrangement of rows High to low here
                       ),
             aes(x = longitude,
                 y = latitude,
                 color = slf_density),
             alpha = 0.5
             ) +
  coord_sf(xlim = c(-81, -74),
                  ylim = c(39.5, 42.5)
                  ) +
  scale_color_brewer(palette = "Oranges", 
                     aesthetics = "color"
                     ) +
  theme_classic() +
  theme(legend.position = "top")

```

# Mapping- jump spread records visualized

``` {r mapping- PA jump records by year}

PA_jumps_year <- ggplot() +
geom_sf(data = counties_map %>%
        filter(STATEFP == 42),
        fill = "slategray3", 
        color = "white"
        ) +
  geom_point(data = jumps, 
             aes(x = longitude_rounded,
                 y = latitude_rounded,
                 size = bio_year)
             ) +
  coord_sf(xlim = c(-81, -74),
                  ylim = c(39.5, 42.5)
                  ) +
  labs(
    x = "Longitude",
    y = "Latitude"
  ) +
  scale_color_distiller(palette = "Oranges", 
                     aesthetics = "color"
                     ) +
  theme_classic() +
  theme(legend.position = "top")


```

# Mapping- Utah Spread Event

``` {r mapping- Utah spread}

Utah_map <- ggplot() +
geom_sf(data = counties_map %>%
        filter(STATEFP == 49),
        fill = "slategray3", 
        color = "white"
        ) +
  geom_point(data = tinyslf, 
             aes(x = longitude,
                 y = latitude),
             color = "dark green" 
             ) +
  geom_point(data = jumps,
             aes(x = longitude_rounded,
                 y = latitude_rounded),
             color = "dark orange"
             ) +
  coord_sf(xlim = c(-112, -111),
           ylim = c(40, 41)
                  ) +
  theme_classic()

```
The Utah spread event was not considered a jump spread event, possibly indicating that SLF didnt establish there? Will need to do more research.

# tinySLF analysis

``` {r SLF density by state}

# NOT DONE- was trying to think of a way to visualize rough population density by longitude

tinyslf_density <- tinyslf %>%
  filter(!is.na(slf_density),
        slf_density != "Unpopulated"
         ) %>%
  group_by(state, slf_density) %>%
  summarize(count = n()
            )
  ggplot() +
  geom_col(aes(slf_density, longitude)
           )

```

